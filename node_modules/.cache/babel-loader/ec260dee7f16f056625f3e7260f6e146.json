{"ast":null,"code":"import _classCallCheck from\"C:\\\\Users\\\\zura.ph\\\\WebstormProjects\\\\zz-regul\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\zura.ph\\\\WebstormProjects\\\\zz-regul\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _assertThisInitialized from\"C:\\\\Users\\\\zura.ph\\\\WebstormProjects\\\\zz-regul\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";import _inherits from\"C:\\\\Users\\\\zura.ph\\\\WebstormProjects\\\\zz-regul\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\zura.ph\\\\WebstormProjects\\\\zz-regul\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{Component}from'react';import{classNames}from'../utils/ClassNames';import ObjectUtils from'../utils/ObjectUtils';import DomHandler from'../utils/DomHandler';import OverlayEventBus from'../overlayeventbus/OverlayEventBus';export var TreeTableBodyCell=/*#__PURE__*/function(_Component){_inherits(TreeTableBodyCell,_Component);var _super=_createSuper(TreeTableBodyCell);function TreeTableBodyCell(props){var _this;_classCallCheck(this,TreeTableBodyCell);_this=_super.call(this,props);if(_this.props.editor){_this.state={};}_this.onClick=_this.onClick.bind(_assertThisInitialized(_this));_this.onKeyDown=_this.onKeyDown.bind(_assertThisInitialized(_this));_this.onEditorFocus=_this.onEditorFocus.bind(_assertThisInitialized(_this));_this.eventBusKey=\"\".concat(_this.props.field,\"_\").concat(_this.props.rowIndex);return _this;}_createClass(TreeTableBodyCell,[{key:\"onClick\",value:function onClick(){var _this2=this;if(this.props.editor&&!this.state.editing){this.selfClick=true;this.setState({editing:true},function(){_this2.bindDocumentEditListener();OverlayEventBus.on('overlay-click',function(e){if(!_this2.isOutsideClicked(e.target)){_this2.selfClick=true;}},_this2.eventBusKey);});}}},{key:\"onKeyDown\",value:function onKeyDown(event){if(event.which===13||event.which===9){this.switchCellToViewMode(event);}}},{key:\"bindDocumentEditListener\",value:function bindDocumentEditListener(){var _this3=this;if(!this.documentEditListener){this.documentEditListener=function(e){if(!_this3.selfClick&&_this3.isOutsideClicked(e.target)){_this3.switchCellToViewMode(e);}_this3.selfClick=false;};document.addEventListener('click',this.documentEditListener);}}},{key:\"isOutsideClicked\",value:function isOutsideClicked(target){return this.container&&!(this.container.isSameNode(target)||this.container.contains(target));}},{key:\"unbindDocumentEditListener\",value:function unbindDocumentEditListener(){if(this.documentEditListener){document.removeEventListener('click',this.documentEditListener);this.documentEditListener=null;this.selfClick=false;}}},{key:\"closeCell\",value:function closeCell(){var _this4=this;/* When using the 'tab' key, the focus event of the next cell is not called in IE. */setTimeout(function(){_this4.setState({editing:false},function(){_this4.unbindDocumentEditListener();OverlayEventBus.off('overlay-click',_this4.eventBusKey);});},1);}},{key:\"onEditorFocus\",value:function onEditorFocus(event){this.onClick(event);}},{key:\"switchCellToViewMode\",value:function switchCellToViewMode(event){if(this.props.editorValidator){var valid=this.props.editorValidator({originalEvent:event,columnProps:this.props});if(valid){this.closeCell();}}else{this.closeCell();}}},{key:\"componentDidUpdate\",value:function componentDidUpdate(){var _this5=this;if(this.container&&this.props.editor){clearTimeout(this.tabindexTimeout);if(this.state&&this.state.editing){var focusable=DomHandler.findSingle(this.container,'input');if(focusable&&document.activeElement!==focusable&&!focusable.hasAttribute('data-isCellEditing')){focusable.setAttribute('data-isCellEditing',true);focusable.focus();}this.keyHelper.tabIndex=-1;}else{this.tabindexTimeout=setTimeout(function(){if(_this5.keyHelper){_this5.keyHelper.setAttribute('tabindex',0);}},50);}}}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.unbindDocumentEditListener();}},{key:\"render\",value:function render(){var _this6=this;var className=classNames(this.props.bodyClassName||this.props.className,{'p-editable-column':this.props.editor,'p-cell-editing':this.props.editor?this.state.editing:false});var style=this.props.bodyStyle||this.props.style;var content;if(this.state&&this.state.editing){if(this.props.editor)content=this.props.editor(this.props);else throw new Error(\"Editor is not found on column.\");}else{if(this.props.body)content=this.props.body(this.props.node,this.props);else content=ObjectUtils.resolveFieldData(this.props.node.data,this.props.field);}/* eslint-disable */var editorKeyHelper=this.props.editor&&/*#__PURE__*/React.createElement(\"a\",{tabIndex:0,ref:function ref(el){_this6.keyHelper=el;},className:\"p-cell-editor-key-helper p-hidden-accessible\",onFocus:this.onEditorFocus},/*#__PURE__*/React.createElement(\"span\",null));/* eslint-enable */return/*#__PURE__*/React.createElement(\"td\",{ref:function ref(el){return _this6.container=el;},className:className,style:style,onClick:this.onClick,onKeyDown:this.onKeyDown},this.props.children,editorKeyHelper,content);}}]);return TreeTableBodyCell;}(Component);","map":{"version":3,"sources":["C:/Users/zura.ph/WebstormProjects/zz-regul/src/components/treetable/TreeTableBodyCell.js"],"names":["React","Component","classNames","ObjectUtils","DomHandler","OverlayEventBus","TreeTableBodyCell","props","editor","state","onClick","bind","onKeyDown","onEditorFocus","eventBusKey","field","rowIndex","editing","selfClick","setState","bindDocumentEditListener","on","e","isOutsideClicked","target","event","which","switchCellToViewMode","documentEditListener","document","addEventListener","container","isSameNode","contains","removeEventListener","setTimeout","unbindDocumentEditListener","off","editorValidator","valid","originalEvent","columnProps","closeCell","clearTimeout","tabindexTimeout","focusable","findSingle","activeElement","hasAttribute","setAttribute","focus","keyHelper","tabIndex","className","bodyClassName","style","bodyStyle","content","Error","body","node","resolveFieldData","data","editorKeyHelper","el","children"],"mappings":"k1BAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,OAASC,UAAT,KAA2B,qBAA3B,CACA,MAAOC,CAAAA,WAAP,KAAwB,sBAAxB,CACA,MAAOC,CAAAA,UAAP,KAAuB,qBAAvB,CACA,MAAOC,CAAAA,eAAP,KAA4B,oCAA5B,CAEA,UAAaC,CAAAA,iBAAb,sHAEI,2BAAYC,KAAZ,CAAmB,mDACf,uBAAMA,KAAN,EAEA,GAAI,MAAKA,KAAL,CAAWC,MAAf,CAAuB,CACnB,MAAKC,KAAL,CAAa,EAAb,CACH,CAED,MAAKC,OAAL,CAAe,MAAKA,OAAL,CAAaC,IAAb,+BAAf,CACA,MAAKC,SAAL,CAAiB,MAAKA,SAAL,CAAeD,IAAf,+BAAjB,CACA,MAAKE,aAAL,CAAqB,MAAKA,aAAL,CAAmBF,IAAnB,+BAArB,CAEA,MAAKG,WAAL,WAAsB,MAAKP,KAAL,CAAWQ,KAAjC,aAA0C,MAAKR,KAAL,CAAWS,QAArD,EAXe,aAYlB,CAdL,qDAgBI,kBAAU,iBACN,GAAI,KAAKT,KAAL,CAAWC,MAAX,EAAqB,CAAC,KAAKC,KAAL,CAAWQ,OAArC,CAA8C,CAC1C,KAAKC,SAAL,CAAiB,IAAjB,CAEA,KAAKC,QAAL,CAAc,CACVF,OAAO,CAAE,IADC,CAAd,CAEG,UAAM,CACL,MAAI,CAACG,wBAAL,GAEAf,eAAe,CAACgB,EAAhB,CAAmB,eAAnB,CAAoC,SAACC,CAAD,CAAO,CACvC,GAAI,CAAC,MAAI,CAACC,gBAAL,CAAsBD,CAAC,CAACE,MAAxB,CAAL,CAAsC,CAClC,MAAI,CAACN,SAAL,CAAiB,IAAjB,CACH,CACJ,CAJD,CAIG,MAAI,CAACJ,WAJR,EAKH,CAVD,EAWH,CACJ,CAhCL,yBAkCI,mBAAUW,KAAV,CAAiB,CACb,GAAIA,KAAK,CAACC,KAAN,GAAgB,EAAhB,EAAsBD,KAAK,CAACC,KAAN,GAAgB,CAA1C,CAA6C,CACzC,KAAKC,oBAAL,CAA0BF,KAA1B,EACH,CACJ,CAtCL,wCAwCI,mCAA2B,iBACvB,GAAI,CAAC,KAAKG,oBAAV,CAAgC,CAC5B,KAAKA,oBAAL,CAA4B,SAACN,CAAD,CAAO,CAC/B,GAAI,CAAC,MAAI,CAACJ,SAAN,EAAmB,MAAI,CAACK,gBAAL,CAAsBD,CAAC,CAACE,MAAxB,CAAvB,CAAwD,CACpD,MAAI,CAACG,oBAAL,CAA0BL,CAA1B,EACH,CAED,MAAI,CAACJ,SAAL,CAAiB,KAAjB,CACH,CAND,CAQAW,QAAQ,CAACC,gBAAT,CAA0B,OAA1B,CAAmC,KAAKF,oBAAxC,EACH,CACJ,CApDL,gCAsDI,0BAAiBJ,MAAjB,CAAyB,CACrB,MAAO,MAAKO,SAAL,EAAkB,EAAE,KAAKA,SAAL,CAAeC,UAAf,CAA0BR,MAA1B,GAAqC,KAAKO,SAAL,CAAeE,QAAf,CAAwBT,MAAxB,CAAvC,CAAzB,CACH,CAxDL,0CA0DI,qCAA6B,CACzB,GAAG,KAAKI,oBAAR,CAA8B,CAC1BC,QAAQ,CAACK,mBAAT,CAA6B,OAA7B,CAAsC,KAAKN,oBAA3C,EACA,KAAKA,oBAAL,CAA4B,IAA5B,CACA,KAAKV,SAAL,CAAiB,KAAjB,CACH,CACJ,CAhEL,yBAkEI,oBAAY,iBACR,qFACAiB,UAAU,CAAC,UAAM,CACb,MAAI,CAAChB,QAAL,CAAc,CACVF,OAAO,CAAE,KADC,CAAd,CAEG,UAAM,CACL,MAAI,CAACmB,0BAAL,GACA/B,eAAe,CAACgC,GAAhB,CAAoB,eAApB,CAAqC,MAAI,CAACvB,WAA1C,EACH,CALD,EAMH,CAPS,CAOP,CAPO,CAAV,CAQH,CA5EL,6BA8EI,uBAAcW,KAAd,CAAqB,CACjB,KAAKf,OAAL,CAAae,KAAb,EACH,CAhFL,oCAkFI,8BAAqBA,KAArB,CAA4B,CACxB,GAAI,KAAKlB,KAAL,CAAW+B,eAAf,CAAgC,CAC5B,GAAIC,CAAAA,KAAK,CAAG,KAAKhC,KAAL,CAAW+B,eAAX,CAA2B,CACnCE,aAAa,CAAEf,KADoB,CAEnCgB,WAAW,CAAE,KAAKlC,KAFiB,CAA3B,CAAZ,CAKA,GAAGgC,KAAH,CAAU,CACN,KAAKG,SAAL,GACH,CACJ,CATD,IAUK,CACD,KAAKA,SAAL,GACH,CACJ,CAhGL,kCAkGI,6BAAqB,iBACjB,GAAI,KAAKX,SAAL,EAAkB,KAAKxB,KAAL,CAAWC,MAAjC,CAAyC,CACrCmC,YAAY,CAAC,KAAKC,eAAN,CAAZ,CACA,GAAI,KAAKnC,KAAL,EAAc,KAAKA,KAAL,CAAWQ,OAA7B,CAAsC,CAClC,GAAI4B,CAAAA,SAAS,CAAGzC,UAAU,CAAC0C,UAAX,CAAsB,KAAKf,SAA3B,CAAsC,OAAtC,CAAhB,CACA,GAAIc,SAAS,EAAIhB,QAAQ,CAACkB,aAAT,GAA2BF,SAAxC,EAAqD,CAACA,SAAS,CAACG,YAAV,CAAuB,oBAAvB,CAA1D,CAAwG,CACpGH,SAAS,CAACI,YAAV,CAAuB,oBAAvB,CAA6C,IAA7C,EACAJ,SAAS,CAACK,KAAV,GACH,CAED,KAAKC,SAAL,CAAeC,QAAf,CAA0B,CAAC,CAA3B,CACH,CARD,IASK,CACD,KAAKR,eAAL,CAAuBT,UAAU,CAAC,UAAM,CACpC,GAAI,MAAI,CAACgB,SAAT,CAAoB,CAChB,MAAI,CAACA,SAAL,CAAeF,YAAf,CAA4B,UAA5B,CAAwC,CAAxC,EACH,CACJ,CAJgC,CAI9B,EAJ8B,CAAjC,CAKH,CACJ,CACJ,CAtHL,oCAwHI,+BAAuB,CACnB,KAAKb,0BAAL,GACH,CA1HL,sBA4HI,iBAAS,iBACL,GAAMiB,CAAAA,SAAS,CAAGnD,UAAU,CAAC,KAAKK,KAAL,CAAW+C,aAAX,EAA0B,KAAK/C,KAAL,CAAW8C,SAAtC,CAAiD,CACzE,oBAAqB,KAAK9C,KAAL,CAAWC,MADyC,CAEzE,iBAAkB,KAAKD,KAAL,CAAWC,MAAX,CAAoB,KAAKC,KAAL,CAAWQ,OAA/B,CAAyC,KAFc,CAAjD,CAA5B,CAIA,GAAMsC,CAAAA,KAAK,CAAG,KAAKhD,KAAL,CAAWiD,SAAX,EAAwB,KAAKjD,KAAL,CAAWgD,KAAjD,CACA,GAAIE,CAAAA,OAAJ,CAEA,GAAG,KAAKhD,KAAL,EAAc,KAAKA,KAAL,CAAWQ,OAA5B,CAAqC,CACjC,GAAG,KAAKV,KAAL,CAAWC,MAAd,CACIiD,OAAO,CAAG,KAAKlD,KAAL,CAAWC,MAAX,CAAkB,KAAKD,KAAvB,CAAV,CADJ,IAGI,MAAM,IAAImD,CAAAA,KAAJ,CAAU,gCAAV,CAAN,CACP,CALD,IAMK,CACD,GAAI,KAAKnD,KAAL,CAAWoD,IAAf,CACIF,OAAO,CAAG,KAAKlD,KAAL,CAAWoD,IAAX,CAAgB,KAAKpD,KAAL,CAAWqD,IAA3B,CAAiC,KAAKrD,KAAtC,CAAV,CADJ,IAGIkD,CAAAA,OAAO,CAAGtD,WAAW,CAAC0D,gBAAZ,CAA6B,KAAKtD,KAAL,CAAWqD,IAAX,CAAgBE,IAA7C,CAAmD,KAAKvD,KAAL,CAAWQ,KAA9D,CAAV,CACP,CAED,oBACA,GAAMgD,CAAAA,eAAe,CAAG,KAAKxD,KAAL,CAAWC,MAAX,eAAqB,yBAAG,QAAQ,CAAE,CAAb,CAAgB,GAAG,CAAE,aAACwD,EAAD,CAAQ,CAAC,MAAI,CAACb,SAAL,CAAiBa,EAAjB,CAAqB,CAAnD,CAAqD,SAAS,CAAC,8CAA/D,CAA8G,OAAO,CAAE,KAAKnD,aAA5H,eAA2I,gCAA3I,CAA7C,CACA,mBAEA,mBACI,0BAAI,GAAG,CAAE,aAAAmD,EAAE,QAAI,CAAA,MAAI,CAACjC,SAAL,CAAiBiC,EAArB,EAAX,CAAoC,SAAS,CAAEX,SAA/C,CAA0D,KAAK,CAAEE,KAAjE,CAAwE,OAAO,CAAE,KAAK7C,OAAtF,CAA+F,SAAS,CAAE,KAAKE,SAA/G,EACK,KAAKL,KAAL,CAAW0D,QADhB,CAEKF,eAFL,CAGKN,OAHL,CADJ,CAOH,CA5JL,+BAAuCxD,SAAvC","sourcesContent":["import React, { Component } from 'react';\r\nimport { classNames } from '../utils/ClassNames';\r\nimport ObjectUtils from '../utils/ObjectUtils';\r\nimport DomHandler from '../utils/DomHandler';\r\nimport OverlayEventBus from '../overlayeventbus/OverlayEventBus';\r\n\r\nexport class TreeTableBodyCell extends Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        if (this.props.editor) {\r\n            this.state = {};\r\n        }\r\n\r\n        this.onClick = this.onClick.bind(this);\r\n        this.onKeyDown = this.onKeyDown.bind(this);\r\n        this.onEditorFocus = this.onEditorFocus.bind(this);\r\n\r\n        this.eventBusKey = `${this.props.field}_${this.props.rowIndex}`;\r\n    }\r\n\r\n    onClick() {\r\n        if (this.props.editor && !this.state.editing) {\r\n            this.selfClick = true;\r\n\r\n            this.setState({\r\n                editing: true\r\n            }, () => {\r\n                this.bindDocumentEditListener();\r\n\r\n                OverlayEventBus.on('overlay-click', (e) => {\r\n                    if (!this.isOutsideClicked(e.target)) {\r\n                        this.selfClick = true;\r\n                    }\r\n                }, this.eventBusKey);\r\n            });\r\n        }\r\n    }\r\n\r\n    onKeyDown(event) {\r\n        if (event.which === 13 || event.which === 9) {\r\n            this.switchCellToViewMode(event);\r\n        }\r\n    }\r\n\r\n    bindDocumentEditListener() {\r\n        if (!this.documentEditListener) {\r\n            this.documentEditListener = (e) => {\r\n                if (!this.selfClick && this.isOutsideClicked(e.target)) {\r\n                    this.switchCellToViewMode(e);\r\n                }\r\n\r\n                this.selfClick = false;\r\n            };\r\n\r\n            document.addEventListener('click', this.documentEditListener);\r\n        }\r\n    }\r\n\r\n    isOutsideClicked(target) {\r\n        return this.container && !(this.container.isSameNode(target) || this.container.contains(target));\r\n    }\r\n\r\n    unbindDocumentEditListener() {\r\n        if(this.documentEditListener) {\r\n            document.removeEventListener('click', this.documentEditListener);\r\n            this.documentEditListener = null;\r\n            this.selfClick = false;\r\n        }\r\n    }\r\n\r\n    closeCell() {\r\n        /* When using the 'tab' key, the focus event of the next cell is not called in IE. */\r\n        setTimeout(() => {\r\n            this.setState({\r\n                editing: false\r\n            }, () => {\r\n                this.unbindDocumentEditListener();\r\n                OverlayEventBus.off('overlay-click', this.eventBusKey);\r\n            });\r\n        }, 1);\r\n    }\r\n\r\n    onEditorFocus(event) {\r\n        this.onClick(event);\r\n    }\r\n\r\n    switchCellToViewMode(event) {\r\n        if (this.props.editorValidator) {\r\n            let valid = this.props.editorValidator({\r\n                originalEvent: event,\r\n                columnProps: this.props\r\n            });\r\n\r\n            if(valid) {\r\n                this.closeCell();\r\n            }\r\n        }\r\n        else {\r\n            this.closeCell();\r\n        }\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        if (this.container && this.props.editor) {\r\n            clearTimeout(this.tabindexTimeout);\r\n            if (this.state && this.state.editing) {\r\n                let focusable = DomHandler.findSingle(this.container, 'input');\r\n                if (focusable && document.activeElement !== focusable && !focusable.hasAttribute('data-isCellEditing')) {\r\n                    focusable.setAttribute('data-isCellEditing', true);\r\n                    focusable.focus();\r\n                }\r\n\r\n                this.keyHelper.tabIndex = -1;\r\n            }\r\n            else {\r\n                this.tabindexTimeout = setTimeout(() => {\r\n                    if (this.keyHelper) {\r\n                        this.keyHelper.setAttribute('tabindex', 0);\r\n                    }\r\n                }, 50);\r\n            }\r\n        }\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this.unbindDocumentEditListener();\r\n    }\r\n\r\n    render() {\r\n        const className = classNames(this.props.bodyClassName||this.props.className, {\r\n            'p-editable-column': this.props.editor,\r\n            'p-cell-editing': this.props.editor ? this.state.editing : false\r\n        });\r\n        const style = this.props.bodyStyle || this.props.style\r\n        let content;\r\n\r\n        if(this.state && this.state.editing) {\r\n            if(this.props.editor)\r\n                content = this.props.editor(this.props);\r\n            else\r\n                throw new Error(\"Editor is not found on column.\");\r\n        }\r\n        else {\r\n            if (this.props.body)\r\n                content = this.props.body(this.props.node, this.props);\r\n            else\r\n                content = ObjectUtils.resolveFieldData(this.props.node.data, this.props.field);\r\n        }\r\n\r\n        /* eslint-disable */\r\n        const editorKeyHelper = this.props.editor && <a tabIndex={0} ref={(el) => {this.keyHelper = el;}} className=\"p-cell-editor-key-helper p-hidden-accessible\" onFocus={this.onEditorFocus}><span></span></a>;\r\n        /* eslint-enable */\r\n\r\n        return (\r\n            <td ref={el => this.container = el} className={className} style={style} onClick={this.onClick} onKeyDown={this.onKeyDown}>\r\n                {this.props.children}\r\n                {editorKeyHelper}\r\n                {content}\r\n            </td>\r\n        );\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}