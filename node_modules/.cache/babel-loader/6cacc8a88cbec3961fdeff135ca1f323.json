{"ast":null,"code":"/*!\n@fullcalendar/core v4.0.1\nDocs & License: https://fullcalendar.io/\n(c) 2019 Adam Shaw\n*/\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) : typeof define === 'function' && define.amd ? define(['exports'], factory) : (global = global || self, factory(global.FullCalendar = {}));\n})(this, function (exports) {\n  'use strict'; // Creating\n  // ----------------------------------------------------------------------------------------------------------------\n\n  var elementPropHash = {\n    className: true,\n    colSpan: true,\n    rowSpan: true\n  };\n  var containerTagHash = {\n    '<tr': 'tbody',\n    '<td': 'tr'\n  };\n\n  function createElement(tagName, attrs, content) {\n    var el = document.createElement(tagName);\n\n    if (attrs) {\n      for (var attrName in attrs) {\n        if (attrName === 'style') {\n          applyStyle(el, attrs[attrName]);\n        } else if (elementPropHash[attrName]) {\n          el[attrName] = attrs[attrName];\n        } else {\n          el.setAttribute(attrName, attrs[attrName]);\n        }\n      }\n    }\n\n    if (typeof content === 'string') {\n      el.innerHTML = content; // shortcut. no need to process HTML in any way\n    } else if (content != null) {\n      appendToElement(el, content);\n    }\n\n    return el;\n  }\n\n  function htmlToElement(html) {\n    html = html.trim();\n    var container = document.createElement(computeContainerTag(html));\n    container.innerHTML = html;\n    return container.firstChild;\n  }\n\n  function htmlToElements(html) {\n    return Array.prototype.slice.call(htmlToNodeList(html));\n  }\n\n  function htmlToNodeList(html) {\n    html = html.trim();\n    var container = document.createElement(computeContainerTag(html));\n    container.innerHTML = html;\n    return container.childNodes;\n  } // assumes html already trimmed and tag names are lowercase\n\n\n  function computeContainerTag(html) {\n    return containerTagHash[html.substr(0, 3) // faster than using regex\n    ] || 'div';\n  }\n\n  function appendToElement(el, content) {\n    var childNodes = normalizeContent(content);\n\n    for (var i = 0; i < childNodes.length; i++) {\n      el.appendChild(childNodes[i]);\n    }\n  }\n\n  function prependToElement(parent, content) {\n    var newEls = normalizeContent(content);\n    var afterEl = parent.firstChild || null; // if no firstChild, will append to end, but that's okay, b/c there were no children\n\n    for (var i = 0; i < newEls.length; i++) {\n      parent.insertBefore(newEls[i], afterEl);\n    }\n  }\n\n  function insertAfterElement(refEl, content) {\n    var newEls = normalizeContent(content);\n    var afterEl = refEl.nextSibling || null;\n\n    for (var i = 0; i < newEls.length; i++) {\n      refEl.parentNode.insertBefore(newEls[i], afterEl);\n    }\n  }\n\n  function normalizeContent(content) {\n    var els;\n\n    if (typeof content === 'string') {\n      els = htmlToElements(content);\n    } else if (content instanceof Node) {\n      els = [content];\n    } else {\n      // Node[] or NodeList\n      els = Array.prototype.slice.call(content);\n    }\n\n    return els;\n  }\n\n  function removeElement(el) {\n    if (el.parentNode) {\n      el.parentNode.removeChild(el);\n    }\n  } // Querying\n  // ----------------------------------------------------------------------------------------------------------------\n  // from https://developer.mozilla.org/en-US/docs/Web/API/Element/closest\n\n\n  var matchesMethod = Element.prototype.matches || Element.prototype.matchesSelector || Element.prototype.msMatchesSelector;\n\n  var closestMethod = Element.prototype.closest || function (selector) {\n    // polyfill\n    var el = this;\n\n    if (!document.documentElement.contains(el)) {\n      return null;\n    }\n\n    do {\n      if (elementMatches(el, selector)) {\n        return el;\n      }\n\n      el = el.parentElement || el.parentNode;\n    } while (el !== null && el.nodeType === 1);\n\n    return null;\n  };\n\n  function elementClosest(el, selector) {\n    return closestMethod.call(el, selector);\n  }\n\n  function elementMatches(el, selector) {\n    return matchesMethod.call(el, selector);\n  } // accepts multiple subject els\n  // returns a real array. good for methods like forEach\n\n\n  function findElements(container, selector) {\n    var containers = container instanceof HTMLElement ? [container] : container;\n    var allMatches = [];\n\n    for (var i = 0; i < containers.length; i++) {\n      var matches = containers[i].querySelectorAll(selector);\n\n      for (var j = 0; j < matches.length; j++) {\n        allMatches.push(matches[j]);\n      }\n    }\n\n    return allMatches;\n  } // accepts multiple subject els\n  // only queries direct child elements\n\n\n  function findChildren(parent, selector) {\n    var parents = parent instanceof HTMLElement ? [parent] : parent;\n    var allMatches = [];\n\n    for (var i = 0; i < parents.length; i++) {\n      var childNodes = parents[i].children; // only ever elements\n\n      for (var j = 0; j < childNodes.length; j++) {\n        var childNode = childNodes[j];\n\n        if (!selector || elementMatches(childNode, selector)) {\n          allMatches.push(childNode);\n        }\n      }\n    }\n\n    return allMatches;\n  } // Attributes\n  // ----------------------------------------------------------------------------------------------------------------\n\n\n  function forceClassName(el, className, bool) {\n    if (bool) {\n      el.classList.add(className);\n    } else {\n      el.classList.remove(className);\n    }\n  } // Style\n  // ----------------------------------------------------------------------------------------------------------------\n\n\n  var PIXEL_PROP_RE = /(top|left|right|bottom|width|height)$/i;\n\n  function applyStyle(el, props) {\n    for (var propName in props) {\n      applyStyleProp(el, propName, props[propName]);\n    }\n  }\n\n  function applyStyleProp(el, name, val) {\n    if (val == null) {\n      el.style[name] = '';\n    } else if (typeof val === 'number' && PIXEL_PROP_RE.test(name)) {\n      el.style[name] = val + 'px';\n    } else {\n      el.style[name] = val;\n    }\n  }\n\n  function pointInsideRect(point, rect) {\n    return point.left >= rect.left && point.left < rect.right && point.top >= rect.top && point.top < rect.bottom;\n  } // Returns a new rectangle that is the intersection of the two rectangles. If they don't intersect, returns false\n\n\n  function intersectRects(rect1, rect2) {\n    var res = {\n      left: Math.max(rect1.left, rect2.left),\n      right: Math.min(rect1.right, rect2.right),\n      top: Math.max(rect1.top, rect2.top),\n      bottom: Math.min(rect1.bottom, rect2.bottom)\n    };\n\n    if (res.left < res.right && res.top < res.bottom) {\n      return res;\n    }\n\n    return false;\n  }\n\n  function translateRect(rect, deltaX, deltaY) {\n    return {\n      left: rect.left + deltaX,\n      right: rect.right + deltaX,\n      top: rect.top + deltaY,\n      bottom: rect.bottom + deltaY\n    };\n  } // Returns a new point that will have been moved to reside within the given rectangle\n\n\n  function constrainPoint(point, rect) {\n    return {\n      left: Math.min(Math.max(point.left, rect.left), rect.right),\n      top: Math.min(Math.max(point.top, rect.top), rect.bottom)\n    };\n  } // Returns a point that is the center of the given rectangle\n\n\n  function getRectCenter(rect) {\n    return {\n      left: (rect.left + rect.right) / 2,\n      top: (rect.top + rect.bottom) / 2\n    };\n  } // Subtracts point2's coordinates from point1's coordinates, returning a delta\n\n\n  function diffPoints(point1, point2) {\n    return {\n      left: point1.left - point2.left,\n      top: point1.top - point2.top\n    };\n  } // Logic for determining if, when the element is right-to-left, the scrollbar appears on the left side\n\n\n  var isRtlScrollbarOnLeft = null;\n\n  function getIsRtlScrollbarOnLeft() {\n    if (isRtlScrollbarOnLeft === null) {\n      isRtlScrollbarOnLeft = computeIsRtlScrollbarOnLeft();\n    }\n\n    return isRtlScrollbarOnLeft;\n  }\n\n  function computeIsRtlScrollbarOnLeft() {\n    var outerEl = createElement('div', {\n      style: {\n        position: 'absolute',\n        top: -1000,\n        left: 0,\n        border: 0,\n        padding: 0,\n        overflow: 'scroll',\n        direction: 'rtl'\n      }\n    }, '<div></div>');\n    document.body.appendChild(outerEl);\n    var innerEl = outerEl.firstChild;\n    var res = innerEl.getBoundingClientRect().left > outerEl.getBoundingClientRect().left;\n    removeElement(outerEl);\n    return res;\n  } // The scrollbar width computations in computeEdges are sometimes flawed when it comes to\n  // retina displays, rounding, and IE11. Massage them into a usable value.\n\n\n  function sanitizeScrollbarWidth(width) {\n    width = Math.max(0, width); // no negatives\n\n    width = Math.round(width);\n    return width;\n  }\n\n  function computeEdges(el, getPadding) {\n    if (getPadding === void 0) {\n      getPadding = false;\n    }\n\n    var computedStyle = window.getComputedStyle(el);\n    var borderLeft = parseInt(computedStyle.borderLeftWidth, 10) || 0;\n    var borderRight = parseInt(computedStyle.borderRightWidth, 10) || 0;\n    var borderTop = parseInt(computedStyle.borderTopWidth, 10) || 0;\n    var borderBottom = parseInt(computedStyle.borderBottomWidth, 10) || 0;\n    var scrollbarLeftRight = sanitizeScrollbarWidth(el.offsetWidth - el.clientWidth - borderLeft - borderRight);\n    var scrollbarBottom = sanitizeScrollbarWidth(el.offsetHeight - el.clientHeight - borderTop - borderBottom);\n    var res = {\n      borderLeft: borderLeft,\n      borderRight: borderRight,\n      borderTop: borderTop,\n      borderBottom: borderBottom,\n      scrollbarBottom: scrollbarBottom,\n      scrollbarLeft: 0,\n      scrollbarRight: 0\n    };\n\n    if (getIsRtlScrollbarOnLeft() && computedStyle.direction === 'rtl') {\n      // is the scrollbar on the left side?\n      res.scrollbarLeft = scrollbarLeftRight;\n    } else {\n      res.scrollbarRight = scrollbarLeftRight;\n    }\n\n    if (getPadding) {\n      res.paddingLeft = parseInt(computedStyle.paddingLeft, 10) || 0;\n      res.paddingRight = parseInt(computedStyle.paddingRight, 10) || 0;\n      res.paddingTop = parseInt(computedStyle.paddingTop, 10) || 0;\n      res.paddingBottom = parseInt(computedStyle.paddingBottom, 10) || 0;\n    }\n\n    return res;\n  }\n\n  function computeInnerRect(el, goWithinPadding) {\n    if (goWithinPadding === void 0) {\n      goWithinPadding = false;\n    }\n\n    var outerRect = computeRect(el);\n    var edges = computeEdges(el, goWithinPadding);\n    var res = {\n      left: outerRect.left + edges.borderLeft + edges.scrollbarLeft,\n      right: outerRect.right - edges.borderRight - edges.scrollbarRight,\n      top: outerRect.top + edges.borderTop,\n      bottom: outerRect.bottom - edges.borderBottom - edges.scrollbarBottom\n    };\n\n    if (goWithinPadding) {\n      res.left += edges.paddingLeft;\n      res.right -= edges.paddingRight;\n      res.top += edges.paddingTop;\n      res.bottom -= edges.paddingBottom;\n    }\n\n    return res;\n  }\n\n  function computeRect(el) {\n    var rect = el.getBoundingClientRect();\n    return {\n      left: rect.left + window.pageXOffset,\n      top: rect.top + window.pageYOffset,\n      right: rect.right + window.pageXOffset,\n      bottom: rect.bottom + window.pageYOffset\n    };\n  }\n\n  function computeViewportRect() {\n    return {\n      left: window.pageXOffset,\n      right: window.pageXOffset + document.documentElement.clientWidth,\n      top: window.pageYOffset,\n      bottom: window.pageYOffset + document.documentElement.clientHeight\n    };\n  }\n\n  function computeHeightAndMargins(el) {\n    var computed = window.getComputedStyle(el);\n    return el.getBoundingClientRect().height + parseInt(computed.marginTop, 10) + parseInt(computed.marginBottom, 10);\n  } // does not return window\n\n\n  function getClippingParents(el) {\n    var parents = [];\n\n    while (el instanceof HTMLElement) {\n      // will stop when gets to document or null\n      var computedStyle = window.getComputedStyle(el);\n\n      if (computedStyle.position === 'fixed') {\n        break;\n      }\n\n      if (/(auto|scroll)/.test(computedStyle.overflow + computedStyle.overflowY + computedStyle.overflowX)) {\n        parents.push(el);\n      }\n\n      el = el.parentNode;\n    }\n\n    return parents;\n  }\n\n  function computeClippingRect(el) {\n    return getClippingParents(el).map(function (el) {\n      return computeInnerRect(el);\n    }).concat(computeViewportRect()).reduce(function (rect0, rect1) {\n      return intersectRects(rect0, rect1) || rect1; // should always intersect\n    });\n  } // Stops a mouse/touch event from doing it's native browser action\n\n\n  function preventDefault(ev) {\n    ev.preventDefault();\n  } // Event Delegation\n  // ----------------------------------------------------------------------------------------------------------------\n\n\n  function listenBySelector(container, eventType, selector, handler) {\n    function realHandler(ev) {\n      var matchedChild = elementClosest(ev.target, selector);\n\n      if (matchedChild) {\n        handler.call(matchedChild, ev, matchedChild);\n      }\n    }\n\n    container.addEventListener(eventType, realHandler);\n    return function () {\n      container.removeEventListener(eventType, realHandler);\n    };\n  }\n\n  function listenToHoverBySelector(container, selector, onMouseEnter, onMouseLeave) {\n    var currentMatchedChild;\n    return listenBySelector(container, 'mouseover', selector, function (ev, matchedChild) {\n      if (matchedChild !== currentMatchedChild) {\n        currentMatchedChild = matchedChild;\n        onMouseEnter(ev, matchedChild);\n\n        var realOnMouseLeave_1 = function realOnMouseLeave_1(ev) {\n          currentMatchedChild = null;\n          onMouseLeave(ev, matchedChild);\n          matchedChild.removeEventListener('mouseleave', realOnMouseLeave_1);\n        }; // listen to the next mouseleave, and then unattach\n\n\n        matchedChild.addEventListener('mouseleave', realOnMouseLeave_1);\n      }\n    });\n  } // Animation\n  // ----------------------------------------------------------------------------------------------------------------\n\n\n  var transitionEventNames = ['webkitTransitionEnd', 'otransitionend', 'oTransitionEnd', 'msTransitionEnd', 'transitionend']; // triggered only when the next single subsequent transition finishes\n\n  function whenTransitionDone(el, callback) {\n    var realCallback = function realCallback(ev) {\n      callback(ev);\n      transitionEventNames.forEach(function (eventName) {\n        el.removeEventListener(eventName, realCallback);\n      });\n    };\n\n    transitionEventNames.forEach(function (eventName) {\n      el.addEventListener(eventName, realCallback); // cross-browser way to determine when the transition finishes\n    });\n  }\n\n  var DAY_IDS = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat']; // Adding\n\n  function addWeeks(m, n) {\n    var a = dateToUtcArray(m);\n    a[2] += n * 7;\n    return arrayToUtcDate(a);\n  }\n\n  function addDays(m, n) {\n    var a = dateToUtcArray(m);\n    a[2] += n;\n    return arrayToUtcDate(a);\n  }\n\n  function addMs(m, n) {\n    var a = dateToUtcArray(m);\n    a[6] += n;\n    return arrayToUtcDate(a);\n  } // Diffing (all return floats)\n\n\n  function diffWeeks(m0, m1) {\n    return diffDays(m0, m1) / 7;\n  }\n\n  function diffDays(m0, m1) {\n    return (m1.valueOf() - m0.valueOf()) / (1000 * 60 * 60 * 24);\n  }\n\n  function diffHours(m0, m1) {\n    return (m1.valueOf() - m0.valueOf()) / (1000 * 60 * 60);\n  }\n\n  function diffMinutes(m0, m1) {\n    return (m1.valueOf() - m0.valueOf()) / (1000 * 60);\n  }\n\n  function diffSeconds(m0, m1) {\n    return (m1.valueOf() - m0.valueOf()) / 1000;\n  }\n\n  function diffDayAndTime(m0, m1) {\n    var m0day = startOfDay(m0);\n    var m1day = startOfDay(m1);\n    return {\n      years: 0,\n      months: 0,\n      days: Math.round(diffDays(m0day, m1day)),\n      milliseconds: m1.valueOf() - m1day.valueOf() - (m0.valueOf() - m0day.valueOf())\n    };\n  } // Diffing Whole Units\n\n\n  function diffWholeWeeks(m0, m1) {\n    var d = diffWholeDays(m0, m1);\n\n    if (d !== null && d % 7 === 0) {\n      return d / 7;\n    }\n\n    return null;\n  }\n\n  function diffWholeDays(m0, m1) {\n    if (timeAsMs(m0) === timeAsMs(m1)) {\n      return Math.round(diffDays(m0, m1));\n    }\n\n    return null;\n  } // Start-Of\n\n\n  function startOfDay(m) {\n    return arrayToUtcDate([m.getUTCFullYear(), m.getUTCMonth(), m.getUTCDate()]);\n  }\n\n  function startOfHour(m) {\n    return arrayToUtcDate([m.getUTCFullYear(), m.getUTCMonth(), m.getUTCDate(), m.getUTCHours()]);\n  }\n\n  function startOfMinute(m) {\n    return arrayToUtcDate([m.getUTCFullYear(), m.getUTCMonth(), m.getUTCDate(), m.getUTCHours(), m.getUTCMinutes()]);\n  }\n\n  function startOfSecond(m) {\n    return arrayToUtcDate([m.getUTCFullYear(), m.getUTCMonth(), m.getUTCDate(), m.getUTCHours(), m.getUTCMinutes(), m.getUTCSeconds()]);\n  } // Week Computation\n\n\n  function weekOfYear(marker, dow, doy) {\n    var y = marker.getUTCFullYear();\n    var w = weekOfGivenYear(marker, y, dow, doy);\n\n    if (w < 1) {\n      return weekOfGivenYear(marker, y - 1, dow, doy);\n    }\n\n    var nextW = weekOfGivenYear(marker, y + 1, dow, doy);\n\n    if (nextW >= 1) {\n      return Math.min(w, nextW);\n    }\n\n    return w;\n  }\n\n  function weekOfGivenYear(marker, year, dow, doy) {\n    var firstWeekStart = arrayToUtcDate([year, 0, 1 + firstWeekOffset(year, dow, doy)]);\n    var dayStart = startOfDay(marker);\n    var days = Math.round(diffDays(firstWeekStart, dayStart));\n    return Math.floor(days / 7) + 1; // zero-indexed\n  } // start-of-first-week - start-of-year\n\n\n  function firstWeekOffset(year, dow, doy) {\n    // first-week day -- which january is always in the first week (4 for iso, 1 for other)\n    var fwd = 7 + dow - doy; // first-week day local weekday -- which local weekday is fwd\n\n    var fwdlw = (7 + arrayToUtcDate([year, 0, fwd]).getUTCDay() - dow) % 7;\n    return -fwdlw + fwd - 1;\n  } // Array Conversion\n\n\n  function dateToLocalArray(date) {\n    return [date.getFullYear(), date.getMonth(), date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds(), date.getMilliseconds()];\n  }\n\n  function arrayToLocalDate(a) {\n    return new Date(a[0], a[1] || 0, a[2] == null ? 1 : a[2], // day of month\n    a[3] || 0, a[4] || 0, a[5] || 0);\n  }\n\n  function dateToUtcArray(date) {\n    return [date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds(), date.getUTCMilliseconds()];\n  }\n\n  function arrayToUtcDate(a) {\n    // according to web standards (and Safari), a month index is required.\n    // massage if only given a year.\n    if (a.length === 1) {\n      a = a.concat([0]);\n    }\n\n    return new Date(Date.UTC.apply(Date, a));\n  } // Other Utils\n\n\n  function isValidDate(m) {\n    return !isNaN(m.valueOf());\n  }\n\n  function timeAsMs(m) {\n    return m.getUTCHours() * 1000 * 60 * 60 + m.getUTCMinutes() * 1000 * 60 + m.getUTCSeconds() * 1000 + m.getUTCMilliseconds();\n  }\n\n  var INTERNAL_UNITS = ['years', 'months', 'days', 'milliseconds'];\n  var PARSE_RE = /^(-?)(?:(\\d+)\\.)?(\\d+):(\\d\\d)(?::(\\d\\d)(?:\\.(\\d\\d\\d))?)?/; // Parsing and Creation\n\n  function createDuration(input, unit) {\n    var _a;\n\n    if (typeof input === 'string') {\n      return parseString(input);\n    } else if (typeof input === 'object' && input) {\n      // non-null object\n      return normalizeObject(input);\n    } else if (typeof input === 'number') {\n      return normalizeObject((_a = {}, _a[unit || 'milliseconds'] = input, _a));\n    } else {\n      return null;\n    }\n  }\n\n  function parseString(s) {\n    var m = PARSE_RE.exec(s);\n\n    if (m) {\n      var sign = m[1] ? -1 : 1;\n      return {\n        years: 0,\n        months: 0,\n        days: sign * (m[2] ? parseInt(m[2], 10) : 0),\n        milliseconds: sign * ((m[3] ? parseInt(m[3], 10) : 0) * 60 * 60 * 1000 + // hours\n        (m[4] ? parseInt(m[4], 10) : 0) * 60 * 1000 + // minutes\n        (m[5] ? parseInt(m[5], 10) : 0) * 1000 + ( // seconds\n        m[6] ? parseInt(m[6], 10) : 0) // ms\n        )\n      };\n    }\n\n    return null;\n  }\n\n  function normalizeObject(obj) {\n    return {\n      years: obj.years || obj.year || 0,\n      months: obj.months || obj.month || 0,\n      days: (obj.days || obj.day || 0) + getWeeksFromInput(obj) * 7,\n      milliseconds: (obj.hours || obj.hour || 0) * 60 * 60 * 1000 + // hours\n      (obj.minutes || obj.minute || 0) * 60 * 1000 + // minutes\n      (obj.seconds || obj.second || 0) * 1000 + ( // seconds\n      obj.milliseconds || obj.millisecond || obj.ms || 0) // ms\n\n    };\n  }\n\n  function getWeeksFromInput(obj) {\n    return obj.weeks || obj.week || 0;\n  } // Equality\n\n\n  function durationsEqual(d0, d1) {\n    return d0.years === d1.years && d0.months === d1.months && d0.days === d1.days && d0.milliseconds === d1.milliseconds;\n  }\n\n  function isSingleDay(dur) {\n    return dur.years === 0 && dur.months === 0 && dur.days === 1 && dur.milliseconds === 0;\n  } // Simple Math\n\n\n  function addDurations(d0, d1) {\n    return {\n      years: d0.years + d1.years,\n      months: d0.months + d1.months,\n      days: d0.days + d1.days,\n      milliseconds: d0.milliseconds + d1.milliseconds\n    };\n  }\n\n  function subtractDurations(d1, d0) {\n    return {\n      years: d1.years - d0.years,\n      months: d1.months - d0.months,\n      days: d1.days - d0.days,\n      milliseconds: d1.milliseconds - d0.milliseconds\n    };\n  }\n\n  function multiplyDuration(d, n) {\n    return {\n      years: d.years * n,\n      months: d.months * n,\n      days: d.days * n,\n      milliseconds: d.milliseconds * n\n    };\n  } // Conversions\n  // \"Rough\" because they are based on average-case Gregorian months/years\n\n\n  function asRoughYears(dur) {\n    return asRoughDays(dur) / 365;\n  }\n\n  function asRoughMonths(dur) {\n    return asRoughDays(dur) / 30;\n  }\n\n  function asRoughDays(dur) {\n    return asRoughMs(dur) / 864e5;\n  }\n\n  function asRoughMinutes(dur) {\n    return asRoughMs(dur) / (1000 * 60);\n  }\n\n  function asRoughSeconds(dur) {\n    return asRoughMs(dur) / 1000;\n  }\n\n  function asRoughMs(dur) {\n    return dur.years * (365 * 864e5) + dur.months * (30 * 864e5) + dur.days * 864e5 + dur.milliseconds;\n  } // Advanced Math\n\n\n  function wholeDivideDurations(numerator, denominator) {\n    var res = null;\n\n    for (var i = 0; i < INTERNAL_UNITS.length; i++) {\n      var unit = INTERNAL_UNITS[i];\n\n      if (denominator[unit]) {\n        var localRes = numerator[unit] / denominator[unit];\n\n        if (!isInt(localRes) || res !== null && res !== localRes) {\n          return null;\n        }\n\n        res = localRes;\n      } else if (numerator[unit]) {\n        // needs to divide by something but can't!\n        return null;\n      }\n    }\n\n    return res;\n  }\n\n  function greatestDurationDenominator(dur, dontReturnWeeks) {\n    var ms = dur.milliseconds;\n\n    if (ms) {\n      if (ms % 1000 !== 0) {\n        return {\n          unit: 'millisecond',\n          value: ms\n        };\n      }\n\n      if (ms % (1000 * 60) !== 0) {\n        return {\n          unit: 'second',\n          value: ms / 1000\n        };\n      }\n\n      if (ms % (1000 * 60 * 60) !== 0) {\n        return {\n          unit: 'minute',\n          value: ms / (1000 * 60)\n        };\n      }\n\n      if (ms) {\n        return {\n          unit: 'hour',\n          value: ms / (1000 * 60 * 60)\n        };\n      }\n    }\n\n    if (dur.days) {\n      if (!dontReturnWeeks && dur.days % 7 === 0) {\n        return {\n          unit: 'week',\n          value: dur.days / 7\n        };\n      }\n\n      return {\n        unit: 'day',\n        value: dur.days\n      };\n    }\n\n    if (dur.months) {\n      return {\n        unit: 'month',\n        value: dur.months\n      };\n    }\n\n    if (dur.years) {\n      return {\n        unit: 'year',\n        value: dur.years\n      };\n    }\n\n    return {\n      unit: 'millisecond',\n      value: 0\n    };\n  }\n  /* FullCalendar-specific DOM Utilities\n  ----------------------------------------------------------------------------------------------------------------------*/\n  // Given the scrollbar widths of some other container, create borders/margins on rowEls in order to match the left\n  // and right space that was offset by the scrollbars. A 1-pixel border first, then margin beyond that.\n\n\n  function compensateScroll(rowEl, scrollbarWidths) {\n    if (scrollbarWidths.left) {\n      applyStyle(rowEl, {\n        borderLeftWidth: 1,\n        marginLeft: scrollbarWidths.left - 1\n      });\n    }\n\n    if (scrollbarWidths.right) {\n      applyStyle(rowEl, {\n        borderRightWidth: 1,\n        marginRight: scrollbarWidths.right - 1\n      });\n    }\n  } // Undoes compensateScroll and restores all borders/margins\n\n\n  function uncompensateScroll(rowEl) {\n    applyStyle(rowEl, {\n      marginLeft: '',\n      marginRight: '',\n      borderLeftWidth: '',\n      borderRightWidth: ''\n    });\n  } // Make the mouse cursor express that an event is not allowed in the current area\n\n\n  function disableCursor() {\n    document.body.classList.add('fc-not-allowed');\n  } // Returns the mouse cursor to its original look\n\n\n  function enableCursor() {\n    document.body.classList.remove('fc-not-allowed');\n  } // Given a total available height to fill, have `els` (essentially child rows) expand to accomodate.\n  // By default, all elements that are shorter than the recommended height are expanded uniformly, not considering\n  // any other els that are already too tall. if `shouldRedistribute` is on, it considers these tall rows and\n  // reduces the available height.\n\n\n  function distributeHeight(els, availableHeight, shouldRedistribute) {\n    // *FLOORING NOTE*: we floor in certain places because zoom can give inaccurate floating-point dimensions,\n    // and it is better to be shorter than taller, to avoid creating unnecessary scrollbars.\n    var minOffset1 = Math.floor(availableHeight / els.length); // for non-last element\n\n    var minOffset2 = Math.floor(availableHeight - minOffset1 * (els.length - 1)); // for last element *FLOORING NOTE*\n\n    var flexEls = []; // elements that are allowed to expand. array of DOM nodes\n\n    var flexOffsets = []; // amount of vertical space it takes up\n\n    var flexHeights = []; // actual css height\n\n    var usedHeight = 0;\n    undistributeHeight(els); // give all elements their natural height\n    // find elements that are below the recommended height (expandable).\n    // important to query for heights in a single first pass (to avoid reflow oscillation).\n\n    els.forEach(function (el, i) {\n      var minOffset = i === els.length - 1 ? minOffset2 : minOffset1;\n      var naturalOffset = computeHeightAndMargins(el);\n\n      if (naturalOffset < minOffset) {\n        flexEls.push(el);\n        flexOffsets.push(naturalOffset);\n        flexHeights.push(el.offsetHeight);\n      } else {\n        // this element stretches past recommended height (non-expandable). mark the space as occupied.\n        usedHeight += naturalOffset;\n      }\n    }); // readjust the recommended height to only consider the height available to non-maxed-out rows.\n\n    if (shouldRedistribute) {\n      availableHeight -= usedHeight;\n      minOffset1 = Math.floor(availableHeight / flexEls.length);\n      minOffset2 = Math.floor(availableHeight - minOffset1 * (flexEls.length - 1)); // *FLOORING NOTE*\n    } // assign heights to all expandable elements\n\n\n    flexEls.forEach(function (el, i) {\n      var minOffset = i === flexEls.length - 1 ? minOffset2 : minOffset1;\n      var naturalOffset = flexOffsets[i];\n      var naturalHeight = flexHeights[i];\n      var newHeight = minOffset - (naturalOffset - naturalHeight); // subtract the margin/padding\n\n      if (naturalOffset < minOffset) {\n        // we check this again because redistribution might have changed things\n        el.style.height = newHeight + 'px';\n      }\n    });\n  } // Undoes distrubuteHeight, restoring all els to their natural height\n\n\n  function undistributeHeight(els) {\n    els.forEach(function (el) {\n      el.style.height = '';\n    });\n  } // Given `els`, a set of <td> cells, find the cell with the largest natural width and set the widths of all the\n  // cells to be that width.\n  // PREREQUISITE: if you want a cell to take up width, it needs to have a single inner element w/ display:inline\n\n\n  function matchCellWidths(els) {\n    var maxInnerWidth = 0;\n    els.forEach(function (el) {\n      var innerEl = el.firstChild; // hopefully an element\n\n      if (innerEl instanceof HTMLElement) {\n        var innerWidth_1 = innerEl.offsetWidth;\n\n        if (innerWidth_1 > maxInnerWidth) {\n          maxInnerWidth = innerWidth_1;\n        }\n      }\n    });\n    maxInnerWidth++; // sometimes not accurate of width the text needs to stay on one line. insurance\n\n    els.forEach(function (el) {\n      el.style.width = maxInnerWidth + 'px';\n    });\n    return maxInnerWidth;\n  } // Given one element that resides inside another,\n  // Subtracts the height of the inner element from the outer element.\n\n\n  function subtractInnerElHeight(outerEl, innerEl) {\n    // effin' IE8/9/10/11 sometimes returns 0 for dimensions. this weird hack was the only thing that worked\n    var reflowStyleProps = {\n      position: 'relative',\n      left: -1 // ensure reflow in case the el was already relative. negative is less likely to cause new scroll\n\n    };\n    applyStyle(outerEl, reflowStyleProps);\n    applyStyle(innerEl, reflowStyleProps);\n    var diff = outerEl.offsetHeight - innerEl.offsetHeight; // grab the dimensions\n    // undo hack\n\n    var resetStyleProps = {\n      position: '',\n      left: ''\n    };\n    applyStyle(outerEl, resetStyleProps);\n    applyStyle(innerEl, resetStyleProps);\n    return diff;\n  }\n  /* Selection\n  ----------------------------------------------------------------------------------------------------------------------*/\n\n\n  function preventSelection(el) {\n    el.classList.add('fc-unselectable');\n    el.addEventListener('selectstart', preventDefault);\n  }\n\n  function allowSelection(el) {\n    el.classList.remove('fc-unselectable');\n    el.removeEventListener('selectstart', preventDefault);\n  }\n  /* Context Menu\n  ----------------------------------------------------------------------------------------------------------------------*/\n\n\n  function preventContextMenu(el) {\n    el.addEventListener('contextmenu', preventDefault);\n  }\n\n  function allowContextMenu(el) {\n    el.removeEventListener('contextmenu', preventDefault);\n  }\n  /* Object Ordering by Field\n  ----------------------------------------------------------------------------------------------------------------------*/\n\n\n  function parseFieldSpecs(input) {\n    var specs = [];\n    var tokens = [];\n    var i;\n    var token;\n\n    if (typeof input === 'string') {\n      tokens = input.split(/\\s*,\\s*/);\n    } else if (typeof input === 'function') {\n      tokens = [input];\n    } else if (Array.isArray(input)) {\n      tokens = input;\n    }\n\n    for (i = 0; i < tokens.length; i++) {\n      token = tokens[i];\n\n      if (typeof token === 'string') {\n        specs.push(token.charAt(0) === '-' ? {\n          field: token.substring(1),\n          order: -1\n        } : {\n          field: token,\n          order: 1\n        });\n      } else if (typeof token === 'function') {\n        specs.push({\n          func: token\n        });\n      }\n    }\n\n    return specs;\n  }\n\n  function compareByFieldSpecs(obj0, obj1, fieldSpecs) {\n    var i;\n    var cmp;\n\n    for (i = 0; i < fieldSpecs.length; i++) {\n      cmp = compareByFieldSpec(obj0, obj1, fieldSpecs[i]);\n\n      if (cmp) {\n        return cmp;\n      }\n    }\n\n    return 0;\n  }\n\n  function compareByFieldSpec(obj0, obj1, fieldSpec) {\n    if (fieldSpec.func) {\n      return fieldSpec.func(obj0, obj1);\n    }\n\n    return flexibleCompare(obj0[fieldSpec.field], obj1[fieldSpec.field]) * (fieldSpec.order || 1);\n  }\n\n  function flexibleCompare(a, b) {\n    if (!a && !b) {\n      return 0;\n    }\n\n    if (b == null) {\n      return -1;\n    }\n\n    if (a == null) {\n      return 1;\n    }\n\n    if (typeof a === 'string' || typeof b === 'string') {\n      return String(a).localeCompare(String(b));\n    }\n\n    return a - b;\n  }\n  /* String Utilities\n  ----------------------------------------------------------------------------------------------------------------------*/\n\n\n  function capitaliseFirstLetter(str) {\n    return str.charAt(0).toUpperCase() + str.slice(1);\n  }\n\n  function padStart(val, len) {\n    var s = String(val);\n    return '000'.substr(0, len - s.length) + s;\n  }\n  /* Number Utilities\n  ----------------------------------------------------------------------------------------------------------------------*/\n\n\n  function compareNumbers(a, b) {\n    return a - b;\n  }\n\n  function isInt(n) {\n    return n % 1 === 0;\n  }\n  /* Weird Utilities\n  ----------------------------------------------------------------------------------------------------------------------*/\n\n\n  function applyAll(functions, thisObj, args) {\n    if (typeof functions === 'function') {\n      // supplied a single function\n      functions = [functions];\n    }\n\n    if (functions) {\n      var i = void 0;\n      var ret = void 0;\n\n      for (i = 0; i < functions.length; i++) {\n        ret = functions[i].apply(thisObj, args) || ret;\n      }\n\n      return ret;\n    }\n  }\n\n  function firstDefined() {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    for (var i = 0; i < args.length; i++) {\n      if (args[i] !== undefined) {\n        return args[i];\n      }\n    }\n  } // Returns a function, that, as long as it continues to be invoked, will not\n  // be triggered. The function will be called after it stops being called for\n  // N milliseconds. If `immediate` is passed, trigger the function on the\n  // leading edge, instead of the trailing.\n  // https://github.com/jashkenas/underscore/blob/1.6.0/underscore.js#L714\n\n\n  function debounce(func, wait) {\n    var timeout;\n    var args;\n    var context;\n    var timestamp;\n    var result;\n\n    var later = function later() {\n      var last = new Date().valueOf() - timestamp;\n\n      if (last < wait) {\n        timeout = setTimeout(later, wait - last);\n      } else {\n        timeout = null;\n        result = func.apply(context, args);\n        context = args = null;\n      }\n    };\n\n    return function () {\n      context = this;\n      args = arguments;\n      timestamp = new Date().valueOf();\n\n      if (!timeout) {\n        timeout = setTimeout(later, wait);\n      }\n\n      return result;\n    };\n  } // Number and Boolean are only types that defaults or not computed for\n  // TODO: write more comments\n\n\n  function refineProps(rawProps, processors, defaults, leftoverProps) {\n    if (defaults === void 0) {\n      defaults = {};\n    }\n\n    var refined = {};\n\n    for (var key in processors) {\n      var processor = processors[key];\n\n      if (rawProps[key] !== undefined) {\n        // found\n        if (processor === Function) {\n          refined[key] = typeof rawProps[key] === 'function' ? rawProps[key] : null;\n        } else if (processor) {\n          // a refining function?\n          refined[key] = processor(rawProps[key]);\n        } else {\n          refined[key] = rawProps[key];\n        }\n      } else if (defaults[key] !== undefined) {\n        // there's an explicit default\n        refined[key] = defaults[key];\n      } else {\n        // must compute a default\n        if (processor === String) {\n          refined[key] = ''; // empty string is default for String\n        } else if (!processor || processor === Number || processor === Boolean || processor === Function) {\n          refined[key] = null; // assign null for other non-custom processor funcs\n        } else {\n          refined[key] = processor(null); // run the custom processor func\n        }\n      }\n    }\n\n    if (leftoverProps) {\n      for (var key in rawProps) {\n        if (processors[key] === undefined) {\n          leftoverProps[key] = rawProps[key];\n        }\n      }\n    }\n\n    return refined;\n  }\n  /* Date stuff that doesn't belong in datelib core\n  ----------------------------------------------------------------------------------------------------------------------*/\n  // given a timed range, computes an all-day range that has the same exact duration,\n  // but whose start time is aligned with the start of the day.\n\n\n  function computeAlignedDayRange(timedRange) {\n    var dayCnt = Math.floor(diffDays(timedRange.start, timedRange.end)) || 1;\n    var start = startOfDay(timedRange.start);\n    var end = addDays(start, dayCnt);\n    return {\n      start: start,\n      end: end\n    };\n  } // given a timed range, computes an all-day range based on how for the end date bleeds into the next day\n  // TODO: give nextDayThreshold a default arg\n\n\n  function computeVisibleDayRange(timedRange, nextDayThreshold) {\n    if (nextDayThreshold === void 0) {\n      nextDayThreshold = createDuration(0);\n    }\n\n    var startDay = null;\n    var endDay = null;\n\n    if (timedRange.end) {\n      endDay = startOfDay(timedRange.end);\n      var endTimeMS = timedRange.end.valueOf() - endDay.valueOf(); // # of milliseconds into `endDay`\n      // If the end time is actually inclusively part of the next day and is equal to or\n      // beyond the next day threshold, adjust the end to be the exclusive end of `endDay`.\n      // Otherwise, leaving it as inclusive will cause it to exclude `endDay`.\n\n      if (endTimeMS && endTimeMS >= asRoughMs(nextDayThreshold)) {\n        endDay = addDays(endDay, 1);\n      }\n    }\n\n    if (timedRange.start) {\n      startDay = startOfDay(timedRange.start); // the beginning of the day the range starts\n      // If end is within `startDay` but not past nextDayThreshold, assign the default duration of one day.\n\n      if (endDay && endDay <= startDay) {\n        endDay = addDays(startDay, 1);\n      }\n    }\n\n    return {\n      start: startDay,\n      end: endDay\n    };\n  } // spans from one day into another?\n\n\n  function isMultiDayRange(range) {\n    var visibleRange = computeVisibleDayRange(range);\n    return diffDays(visibleRange.start, visibleRange.end) > 1;\n  }\n\n  function diffDates(date0, date1, dateEnv, largeUnit) {\n    if (largeUnit === 'year') {\n      return createDuration(dateEnv.diffWholeYears(date0, date1), 'year');\n    } else if (largeUnit === 'month') {\n      return createDuration(dateEnv.diffWholeMonths(date0, date1), 'month');\n    } else {\n      return diffDayAndTime(date0, date1); // returns a duration\n    }\n  }\n  /*\n  KNOWN BUG: will populate lefovers only up until a recurring type works\n  */\n\n\n  function parseRecurring(eventInput, allDayDefault, dateEnv, recurringTypes, leftovers) {\n    for (var i = 0; i < recurringTypes.length; i++) {\n      var parsed = recurringTypes[i].parse(eventInput, allDayDefault, leftovers, dateEnv);\n\n      if (parsed) {\n        return {\n          allDay: parsed.allDay,\n          duration: parsed.duration,\n          typeData: parsed.typeData,\n          typeId: i\n        };\n      }\n    }\n\n    return null;\n  }\n  /*\n  Event MUST have a recurringDef\n  */\n\n\n  function expandRecurringRanges(eventDef, framingRange, dateEnv, recurringTypes) {\n    var typeDef = recurringTypes[eventDef.recurringDef.typeId];\n    var markers = typeDef.expand(eventDef.recurringDef.typeData, eventDef, framingRange, dateEnv); // the recurrence plugins don't guarantee that all-day events are start-of-day, so we have to\n\n    if (eventDef.allDay) {\n      markers = markers.map(startOfDay);\n    }\n\n    return markers;\n  }\n  /*! *****************************************************************************\r\n  Copyright (c) Microsoft Corporation. All rights reserved.\r\n  Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\n  this file except in compliance with the License. You may obtain a copy of the\r\n  License at http://www.apache.org/licenses/LICENSE-2.0\r\n    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\n  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\n  MERCHANTABLITY OR NON-INFRINGEMENT.\r\n    See the Apache Version 2.0 License for specific language governing permissions\r\n  and limitations under the License.\r\n  ***************************************************************************** */\n\n  /* global Reflect, Promise */\n\n\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  function __extends(d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  }\n\n  var _assign = function __assign() {\n    _assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n\n        for (var p in s) {\n          if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n        }\n      }\n\n      return t;\n    };\n\n    return _assign.apply(this, arguments);\n  }; // Merges an array of objects into a single object.\n  // The second argument allows for an array of property names who's object values will be merged together.\n\n\n  function mergeProps(propObjs, complexProps) {\n    var dest = {};\n    var i;\n    var name;\n    var complexObjs;\n    var j;\n    var val;\n    var props;\n\n    if (complexProps) {\n      for (i = 0; i < complexProps.length; i++) {\n        name = complexProps[i];\n        complexObjs = []; // collect the trailing object values, stopping when a non-object is discovered\n\n        for (j = propObjs.length - 1; j >= 0; j--) {\n          val = propObjs[j][name];\n\n          if (typeof val === 'object' && val) {\n            // non-null object\n            complexObjs.unshift(val);\n          } else if (val !== undefined) {\n            dest[name] = val; // if there were no objects, this value will be used\n\n            break;\n          }\n        } // if the trailing values were objects, use the merged value\n\n\n        if (complexObjs.length) {\n          dest[name] = mergeProps(complexObjs);\n        }\n      }\n    } // copy values into the destination, going from last to first\n\n\n    for (i = propObjs.length - 1; i >= 0; i--) {\n      props = propObjs[i];\n\n      for (name in props) {\n        if (!(name in dest)) {\n          // if already assigned by previous props or complex props, don't reassign\n          dest[name] = props[name];\n        }\n      }\n    }\n\n    return dest;\n  }\n\n  function filterHash(hash, func) {\n    var filtered = {};\n\n    for (var key in hash) {\n      if (func(hash[key], key)) {\n        filtered[key] = hash[key];\n      }\n    }\n\n    return filtered;\n  }\n\n  function mapHash(hash, func) {\n    var newHash = {};\n\n    for (var key in hash) {\n      newHash[key] = func(hash[key], key);\n    }\n\n    return newHash;\n  }\n\n  function arrayToHash(a) {\n    var hash = {};\n\n    for (var _i = 0, a_1 = a; _i < a_1.length; _i++) {\n      var item = a_1[_i];\n      hash[item] = true;\n    }\n\n    return hash;\n  }\n\n  function isPropsEqual(obj0, obj1) {\n    for (var key in obj0) {\n      if (obj0[key] !== obj1[key]) {\n        return false;\n      }\n    }\n\n    for (var key in obj1) {\n      if (!(key in obj0)) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  function parseEvents(rawEvents, sourceId, calendar, allowOpenRange) {\n    var eventStore = createEmptyEventStore();\n\n    for (var _i = 0, rawEvents_1 = rawEvents; _i < rawEvents_1.length; _i++) {\n      var rawEvent = rawEvents_1[_i];\n      var tuple = parseEvent(rawEvent, sourceId, calendar, allowOpenRange);\n\n      if (tuple) {\n        eventTupleToStore(tuple, eventStore);\n      }\n    }\n\n    return eventStore;\n  }\n\n  function eventTupleToStore(tuple, eventStore) {\n    if (eventStore === void 0) {\n      eventStore = createEmptyEventStore();\n    }\n\n    eventStore.defs[tuple.def.defId] = tuple.def;\n\n    if (tuple.instance) {\n      eventStore.instances[tuple.instance.instanceId] = tuple.instance;\n    }\n\n    return eventStore;\n  }\n\n  function expandRecurring(eventStore, framingRange, calendar) {\n    var dateEnv = calendar.dateEnv;\n    var defs = eventStore.defs,\n        instances = eventStore.instances; // remove existing recurring instances\n\n    instances = filterHash(instances, function (instance) {\n      return !defs[instance.defId].recurringDef;\n    });\n\n    for (var defId in defs) {\n      var def = defs[defId];\n\n      if (def.recurringDef) {\n        var starts = expandRecurringRanges(def, framingRange, calendar.dateEnv, calendar.pluginSystem.hooks.recurringTypes);\n        var duration = def.recurringDef.duration;\n\n        if (!duration) {\n          duration = def.allDay ? calendar.defaultAllDayEventDuration : calendar.defaultTimedEventDuration;\n        }\n\n        for (var _i = 0, starts_1 = starts; _i < starts_1.length; _i++) {\n          var start = starts_1[_i];\n          var instance = createEventInstance(defId, {\n            start: start,\n            end: dateEnv.add(start, duration)\n          });\n          instances[instance.instanceId] = instance;\n        }\n      }\n    }\n\n    return {\n      defs: defs,\n      instances: instances\n    };\n  } // retrieves events that have the same groupId as the instance specified by `instanceId`\n  // or they are the same as the instance.\n  // why might instanceId not be in the store? an event from another calendar?\n\n\n  function getRelevantEvents(eventStore, instanceId) {\n    var instance = eventStore.instances[instanceId];\n\n    if (instance) {\n      var def_1 = eventStore.defs[instance.defId]; // get events/instances with same group\n\n      var newStore = filterEventStoreDefs(eventStore, function (lookDef) {\n        return isEventDefsGrouped(def_1, lookDef);\n      }); // add the original\n      // TODO: wish we could use eventTupleToStore or something like it\n\n      newStore.defs[def_1.defId] = def_1;\n      newStore.instances[instance.instanceId] = instance;\n      return newStore;\n    }\n\n    return createEmptyEventStore();\n  }\n\n  function isEventDefsGrouped(def0, def1) {\n    return Boolean(def0.groupId && def0.groupId === def1.groupId);\n  }\n\n  function transformRawEvents(rawEvents, eventSource, calendar) {\n    var calEachTransform = calendar.opt('eventDataTransform');\n    var sourceEachTransform = eventSource ? eventSource.eventDataTransform : null;\n\n    if (sourceEachTransform) {\n      rawEvents = transformEachRawEvent(rawEvents, sourceEachTransform);\n    }\n\n    if (calEachTransform) {\n      rawEvents = transformEachRawEvent(rawEvents, calEachTransform);\n    }\n\n    return rawEvents;\n  }\n\n  function transformEachRawEvent(rawEvents, func) {\n    var refinedEvents;\n\n    if (!func) {\n      refinedEvents = rawEvents;\n    } else {\n      refinedEvents = [];\n\n      for (var _i = 0, rawEvents_2 = rawEvents; _i < rawEvents_2.length; _i++) {\n        var rawEvent = rawEvents_2[_i];\n        var refinedEvent = func(rawEvent);\n\n        if (refinedEvent) {\n          refinedEvents.push(refinedEvent);\n        } else if (refinedEvent == null) {\n          refinedEvents.push(rawEvent);\n        } // if a different falsy value, do nothing\n\n      }\n    }\n\n    return refinedEvents;\n  }\n\n  function createEmptyEventStore() {\n    return {\n      defs: {},\n      instances: {}\n    };\n  }\n\n  function mergeEventStores(store0, store1) {\n    return {\n      defs: _assign({}, store0.defs, store1.defs),\n      instances: _assign({}, store0.instances, store1.instances)\n    };\n  }\n\n  function filterEventStoreDefs(eventStore, filterFunc) {\n    var defs = filterHash(eventStore.defs, filterFunc);\n    var instances = filterHash(eventStore.instances, function (instance) {\n      return defs[instance.defId]; // still exists?\n    });\n    return {\n      defs: defs,\n      instances: instances\n    };\n  }\n\n  function parseRange(input, dateEnv) {\n    var start = null;\n    var end = null;\n\n    if (input.start) {\n      start = dateEnv.createMarker(input.start);\n    }\n\n    if (input.end) {\n      end = dateEnv.createMarker(input.end);\n    }\n\n    if (!start && !end) {\n      return null;\n    }\n\n    if (start && end && end < start) {\n      return null;\n    }\n\n    return {\n      start: start,\n      end: end\n    };\n  } // SIDE-EFFECT: will mutate ranges.\n  // Will return a new array result.\n\n\n  function invertRanges(ranges, constraintRange) {\n    var invertedRanges = [];\n    var start = constraintRange.start; // the end of the previous range. the start of the new range\n\n    var i;\n    var dateRange; // ranges need to be in order. required for our date-walking algorithm\n\n    ranges.sort(compareRanges);\n\n    for (i = 0; i < ranges.length; i++) {\n      dateRange = ranges[i]; // add the span of time before the event (if there is any)\n\n      if (dateRange.start > start) {\n        // compare millisecond time (skip any ambig logic)\n        invertedRanges.push({\n          start: start,\n          end: dateRange.start\n        });\n      }\n\n      if (dateRange.end > start) {\n        start = dateRange.end;\n      }\n    } // add the span of time after the last event (if there is any)\n\n\n    if (start < constraintRange.end) {\n      // compare millisecond time (skip any ambig logic)\n      invertedRanges.push({\n        start: start,\n        end: constraintRange.end\n      });\n    }\n\n    return invertedRanges;\n  }\n\n  function compareRanges(range0, range1) {\n    return range0.start.valueOf() - range1.start.valueOf(); // earlier ranges go first\n  }\n\n  function intersectRanges(range0, range1) {\n    var start = range0.start;\n    var end = range0.end;\n    var newRange = null;\n\n    if (range1.start !== null) {\n      if (start === null) {\n        start = range1.start;\n      } else {\n        start = new Date(Math.max(start.valueOf(), range1.start.valueOf()));\n      }\n    }\n\n    if (range1.end != null) {\n      if (end === null) {\n        end = range1.end;\n      } else {\n        end = new Date(Math.min(end.valueOf(), range1.end.valueOf()));\n      }\n    }\n\n    if (start === null || end === null || start < end) {\n      newRange = {\n        start: start,\n        end: end\n      };\n    }\n\n    return newRange;\n  }\n\n  function rangesEqual(range0, range1) {\n    return (range0.start === null ? null : range0.start.valueOf()) === (range1.start === null ? null : range1.start.valueOf()) && (range0.end === null ? null : range0.end.valueOf()) === (range1.end === null ? null : range1.end.valueOf());\n  }\n\n  function rangesIntersect(range0, range1) {\n    return (range0.end === null || range1.start === null || range0.end > range1.start) && (range0.start === null || range1.end === null || range0.start < range1.end);\n  }\n\n  function rangeContainsRange(outerRange, innerRange) {\n    return (outerRange.start === null || innerRange.start !== null && innerRange.start >= outerRange.start) && (outerRange.end === null || innerRange.end !== null && innerRange.end <= outerRange.end);\n  }\n\n  function rangeContainsMarker(range, date) {\n    return (range.start === null || date >= range.start) && (range.end === null || date < range.end);\n  } // If the given date is not within the given range, move it inside.\n  // (If it's past the end, make it one millisecond before the end).\n\n\n  function constrainMarkerToRange(date, range) {\n    if (range.start != null && date < range.start) {\n      return range.start;\n    }\n\n    if (range.end != null && date >= range.end) {\n      return new Date(range.end.valueOf() - 1);\n    }\n\n    return date;\n  }\n\n  function removeExact(array, exactVal) {\n    var removeCnt = 0;\n    var i = 0;\n\n    while (i < array.length) {\n      if (array[i] === exactVal) {\n        array.splice(i, 1);\n        removeCnt++;\n      } else {\n        i++;\n      }\n    }\n\n    return removeCnt;\n  }\n\n  function isArraysEqual(a0, a1) {\n    var len = a0.length;\n    var i;\n\n    if (len !== a1.length) {\n      // not array? or not same length?\n      return false;\n    }\n\n    for (i = 0; i < len; i++) {\n      if (a0[i] !== a1[i]) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  function memoize(workerFunc) {\n    var args;\n    var res;\n    return function () {\n      if (!args || !isArraysEqual(args, arguments)) {\n        args = arguments;\n        res = workerFunc.apply(this, arguments);\n      }\n\n      return res;\n    };\n  }\n  /*\n  always executes the workerFunc, but if the result is equal to the previous result,\n  return the previous result instead.\n  */\n\n\n  function memoizeOutput(workerFunc, equalityFunc) {\n    var cachedRes = null;\n    return function () {\n      var newRes = workerFunc.apply(this, arguments);\n\n      if (cachedRes === null || !(cachedRes === newRes || equalityFunc(cachedRes, newRes))) {\n        cachedRes = newRes;\n      }\n\n      return cachedRes;\n    };\n  }\n\n  var EXTENDED_SETTINGS_AND_SEVERITIES = {\n    week: 3,\n    separator: 0,\n    omitZeroMinute: 0,\n    meridiem: 0,\n    omitCommas: 0\n  };\n  var STANDARD_DATE_PROP_SEVERITIES = {\n    timeZoneName: 7,\n    era: 6,\n    year: 5,\n    month: 4,\n    day: 2,\n    weekday: 2,\n    hour: 1,\n    minute: 1,\n    second: 1\n  };\n  var MERIDIEM_RE = /\\s*([ap])\\.?m\\.?/i; // eats up leading spaces too\n\n  var COMMA_RE = /,/g; // we need re for globalness\n\n  var MULTI_SPACE_RE = /\\s+/g;\n  var LTR_RE = /\\u200e/g; // control character\n\n  var UTC_RE = /UTC|GMT/;\n\n  var NativeFormatter =\n  /** @class */\n  function () {\n    function NativeFormatter(formatSettings) {\n      var standardDateProps = {};\n      var extendedSettings = {};\n      var severity = 0;\n\n      for (var name_1 in formatSettings) {\n        if (name_1 in EXTENDED_SETTINGS_AND_SEVERITIES) {\n          extendedSettings[name_1] = formatSettings[name_1];\n          severity = Math.max(EXTENDED_SETTINGS_AND_SEVERITIES[name_1], severity);\n        } else {\n          standardDateProps[name_1] = formatSettings[name_1];\n\n          if (name_1 in STANDARD_DATE_PROP_SEVERITIES) {\n            severity = Math.max(STANDARD_DATE_PROP_SEVERITIES[name_1], severity);\n          }\n        }\n      }\n\n      this.standardDateProps = standardDateProps;\n      this.extendedSettings = extendedSettings;\n      this.severity = severity;\n      this.buildFormattingFunc = memoize(buildFormattingFunc);\n    }\n\n    NativeFormatter.prototype.format = function (date, context) {\n      return this.buildFormattingFunc(this.standardDateProps, this.extendedSettings, context)(date);\n    };\n\n    NativeFormatter.prototype.formatRange = function (start, end, context) {\n      var _a = this,\n          standardDateProps = _a.standardDateProps,\n          extendedSettings = _a.extendedSettings;\n\n      var diffSeverity = computeMarkerDiffSeverity(start.marker, end.marker, context.calendarSystem);\n\n      if (!diffSeverity) {\n        return this.format(start, context);\n      }\n\n      var biggestUnitForPartial = diffSeverity;\n\n      if (biggestUnitForPartial > 1 && ( // the two dates are different in a way that's larger scale than time\n      standardDateProps.year === 'numeric' || standardDateProps.year === '2-digit') && (standardDateProps.month === 'numeric' || standardDateProps.month === '2-digit') && (standardDateProps.day === 'numeric' || standardDateProps.day === '2-digit')) {\n        biggestUnitForPartial = 1; // make it look like the dates are only different in terms of time\n      }\n\n      var full0 = this.format(start, context);\n      var full1 = this.format(end, context);\n\n      if (full0 === full1) {\n        return full0;\n      }\n\n      var partialDateProps = computePartialFormattingOptions(standardDateProps, biggestUnitForPartial);\n      var partialFormattingFunc = buildFormattingFunc(partialDateProps, extendedSettings, context);\n      var partial0 = partialFormattingFunc(start);\n      var partial1 = partialFormattingFunc(end);\n      var insertion = findCommonInsertion(full0, partial0, full1, partial1);\n      var separator = extendedSettings.separator || '';\n\n      if (insertion) {\n        return insertion.before + partial0 + separator + partial1 + insertion.after;\n      }\n\n      return full0 + separator + full1;\n    };\n\n    NativeFormatter.prototype.getLargestUnit = function () {\n      switch (this.severity) {\n        case 7:\n        case 6:\n        case 5:\n          return 'year';\n\n        case 4:\n          return 'month';\n\n        case 3:\n          return 'week';\n\n        default:\n          return 'day';\n      }\n    };\n\n    return NativeFormatter;\n  }();\n\n  function buildFormattingFunc(standardDateProps, extendedSettings, context) {\n    var standardDatePropCnt = Object.keys(standardDateProps).length;\n\n    if (standardDatePropCnt === 1 && standardDateProps.timeZoneName === 'short') {\n      return function (date) {\n        return formatTimeZoneOffset(date.timeZoneOffset);\n      };\n    }\n\n    if (standardDatePropCnt === 0 && extendedSettings.week) {\n      return function (date) {\n        return formatWeekNumber(context.computeWeekNumber(date.marker), context.weekLabel, context.locale, extendedSettings.week);\n      };\n    }\n\n    return buildNativeFormattingFunc(standardDateProps, extendedSettings, context);\n  }\n\n  function buildNativeFormattingFunc(standardDateProps, extendedSettings, context) {\n    standardDateProps = _assign({}, standardDateProps); // copy\n\n    extendedSettings = _assign({}, extendedSettings); // copy\n\n    sanitizeSettings(standardDateProps, extendedSettings);\n    standardDateProps.timeZone = 'UTC'; // we leverage the only guaranteed timeZone for our UTC markers\n\n    var normalFormat = new Intl.DateTimeFormat(context.locale.codes, standardDateProps);\n    var zeroFormat; // needed?\n\n    if (extendedSettings.omitZeroMinute) {\n      var zeroProps = _assign({}, standardDateProps);\n\n      delete zeroProps.minute; // seconds and ms were already considered in sanitizeSettings\n\n      zeroFormat = new Intl.DateTimeFormat(context.locale.codes, zeroProps);\n    }\n\n    return function (date) {\n      var marker = date.marker;\n      var format;\n\n      if (zeroFormat && !marker.getUTCMinutes()) {\n        format = zeroFormat;\n      } else {\n        format = normalFormat;\n      }\n\n      var s = format.format(marker);\n      return postProcess(s, date, standardDateProps, extendedSettings, context);\n    };\n  }\n\n  function sanitizeSettings(standardDateProps, extendedSettings) {\n    // deal with a browser inconsistency where formatting the timezone\n    // requires that the hour/minute be present.\n    if (standardDateProps.timeZoneName) {\n      if (!standardDateProps.hour) {\n        standardDateProps.hour = '2-digit';\n      }\n\n      if (!standardDateProps.minute) {\n        standardDateProps.minute = '2-digit';\n      }\n    } // only support short timezone names\n\n\n    if (standardDateProps.timeZoneName === 'long') {\n      standardDateProps.timeZoneName = 'short';\n    } // if requesting to display seconds, MUST display minutes\n\n\n    if (extendedSettings.omitZeroMinute && (standardDateProps.second || standardDateProps.millisecond)) {\n      delete extendedSettings.omitZeroMinute;\n    }\n  }\n\n  function postProcess(s, date, standardDateProps, extendedSettings, context) {\n    s = s.replace(LTR_RE, ''); // remove left-to-right control chars. do first. good for other regexes\n\n    if (standardDateProps.timeZoneName === 'short') {\n      s = injectTzoStr(s, context.timeZone === 'UTC' || date.timeZoneOffset == null ? 'UTC' : // important to normalize for IE, which does \"GMT\"\n      formatTimeZoneOffset(date.timeZoneOffset));\n    }\n\n    if (extendedSettings.omitCommas) {\n      s = s.replace(COMMA_RE, '').trim();\n    }\n\n    if (extendedSettings.omitZeroMinute) {\n      s = s.replace(':00', ''); // zeroFormat doesn't always achieve this\n    } // ^ do anything that might create adjacent spaces before this point,\n    // because MERIDIEM_RE likes to eat up loading spaces\n\n\n    if (extendedSettings.meridiem === false) {\n      s = s.replace(MERIDIEM_RE, '').trim();\n    } else if (extendedSettings.meridiem === 'narrow') {\n      // a/p\n      s = s.replace(MERIDIEM_RE, function (m0, m1) {\n        return m1.toLocaleLowerCase();\n      });\n    } else if (extendedSettings.meridiem === 'short') {\n      // am/pm\n      s = s.replace(MERIDIEM_RE, function (m0, m1) {\n        return m1.toLocaleLowerCase() + 'm';\n      });\n    } else if (extendedSettings.meridiem === 'lowercase') {\n      // other meridiem transformers already converted to lowercase\n      s = s.replace(MERIDIEM_RE, function (m0) {\n        return m0.toLocaleLowerCase();\n      });\n    }\n\n    s = s.replace(MULTI_SPACE_RE, ' ');\n    s = s.trim();\n    return s;\n  }\n\n  function injectTzoStr(s, tzoStr) {\n    var replaced = false;\n    s = s.replace(UTC_RE, function () {\n      replaced = true;\n      return tzoStr;\n    }); // IE11 doesn't include UTC/GMT in the original string, so append to end\n\n    if (!replaced) {\n      s += ' ' + tzoStr;\n    }\n\n    return s;\n  }\n\n  function formatWeekNumber(num, weekLabel, locale, display) {\n    var parts = [];\n\n    if (display === 'narrow') {\n      parts.push(weekLabel);\n    } else if (display === 'short') {\n      parts.push(weekLabel, ' ');\n    } // otherwise, considered 'numeric'\n\n\n    parts.push(locale.simpleNumberFormat.format(num));\n\n    if (locale.options.isRtl) {\n      // TODO: use control characters instead?\n      parts.reverse();\n    }\n\n    return parts.join('');\n  } // Range Formatting Utils\n  // 0 = exactly the same\n  // 1 = different by time\n  // and bigger\n\n\n  function computeMarkerDiffSeverity(d0, d1, ca) {\n    if (ca.getMarkerYear(d0) !== ca.getMarkerYear(d1)) {\n      return 5;\n    }\n\n    if (ca.getMarkerMonth(d0) !== ca.getMarkerMonth(d1)) {\n      return 4;\n    }\n\n    if (ca.getMarkerDay(d0) !== ca.getMarkerDay(d1)) {\n      return 2;\n    }\n\n    if (timeAsMs(d0) !== timeAsMs(d1)) {\n      return 1;\n    }\n\n    return 0;\n  }\n\n  function computePartialFormattingOptions(options, biggestUnit) {\n    var partialOptions = {};\n\n    for (var name_2 in options) {\n      if (!(name_2 in STANDARD_DATE_PROP_SEVERITIES) || // not a date part prop (like timeZone)\n      STANDARD_DATE_PROP_SEVERITIES[name_2] <= biggestUnit) {\n        partialOptions[name_2] = options[name_2];\n      }\n    }\n\n    return partialOptions;\n  }\n\n  function findCommonInsertion(full0, partial0, full1, partial1) {\n    var i0 = 0;\n\n    while (i0 < full0.length) {\n      var found0 = full0.indexOf(partial0, i0);\n\n      if (found0 === -1) {\n        break;\n      }\n\n      var before0 = full0.substr(0, found0);\n      i0 = found0 + partial0.length;\n      var after0 = full0.substr(i0);\n      var i1 = 0;\n\n      while (i1 < full1.length) {\n        var found1 = full1.indexOf(partial1, i1);\n\n        if (found1 === -1) {\n          break;\n        }\n\n        var before1 = full1.substr(0, found1);\n        i1 = found1 + partial1.length;\n        var after1 = full1.substr(i1);\n\n        if (before0 === before1 && after0 === after1) {\n          return {\n            before: before0,\n            after: after0\n          };\n        }\n      }\n    }\n\n    return null;\n  }\n  /*\n  TODO: fix the terminology of \"formatter\" vs \"formatting func\"\n  */\n\n  /*\n  At the time of instantiation, this object does not know which cmd-formatting system it will use.\n  It receives this at the time of formatting, as a setting.\n  */\n\n\n  var CmdFormatter =\n  /** @class */\n  function () {\n    function CmdFormatter(cmdStr, separator) {\n      this.cmdStr = cmdStr;\n      this.separator = separator;\n    }\n\n    CmdFormatter.prototype.format = function (date, context) {\n      return context.cmdFormatter(this.cmdStr, createVerboseFormattingArg(date, null, context, this.separator));\n    };\n\n    CmdFormatter.prototype.formatRange = function (start, end, context) {\n      return context.cmdFormatter(this.cmdStr, createVerboseFormattingArg(start, end, context, this.separator));\n    };\n\n    return CmdFormatter;\n  }();\n\n  var FuncFormatter =\n  /** @class */\n  function () {\n    function FuncFormatter(func) {\n      this.func = func;\n    }\n\n    FuncFormatter.prototype.format = function (date, context) {\n      return this.func(createVerboseFormattingArg(date, null, context));\n    };\n\n    FuncFormatter.prototype.formatRange = function (start, end, context) {\n      return this.func(createVerboseFormattingArg(start, end, context));\n    };\n\n    return FuncFormatter;\n  }(); // Formatter Object Creation\n\n\n  function createFormatter(input, defaultSeparator) {\n    if (typeof input === 'object' && input) {\n      // non-null object\n      if (typeof defaultSeparator === 'string') {\n        input = _assign({\n          separator: defaultSeparator\n        }, input);\n      }\n\n      return new NativeFormatter(input);\n    } else if (typeof input === 'string') {\n      return new CmdFormatter(input, defaultSeparator);\n    } else if (typeof input === 'function') {\n      return new FuncFormatter(input);\n    }\n  } // String Utils\n  // timeZoneOffset is in minutes\n\n\n  function buildIsoString(marker, timeZoneOffset, stripZeroTime) {\n    if (stripZeroTime === void 0) {\n      stripZeroTime = false;\n    }\n\n    var s = marker.toISOString();\n    s = s.replace('.000', '');\n\n    if (stripZeroTime) {\n      s = s.replace('T00:00:00Z', '');\n    }\n\n    if (s.length > 10) {\n      // time part wasn't stripped, can add timezone info\n      if (timeZoneOffset == null) {\n        s = s.replace('Z', '');\n      } else if (timeZoneOffset !== 0) {\n        s = s.replace('Z', formatTimeZoneOffset(timeZoneOffset, true));\n      } // otherwise, its UTC-0 and we want to keep the Z\n\n    }\n\n    return s;\n  }\n\n  function formatIsoTimeString(marker) {\n    return padStart(marker.getUTCHours(), 2) + ':' + padStart(marker.getUTCMinutes(), 2) + ':' + padStart(marker.getUTCSeconds(), 2);\n  }\n\n  function formatTimeZoneOffset(minutes, doIso) {\n    if (doIso === void 0) {\n      doIso = false;\n    }\n\n    var sign = minutes < 0 ? '-' : '+';\n    var abs = Math.abs(minutes);\n    var hours = Math.floor(abs / 60);\n    var mins = Math.round(abs % 60);\n\n    if (doIso) {\n      return sign + padStart(hours, 2) + ':' + padStart(mins, 2);\n    } else {\n      return 'GMT' + sign + hours + (mins ? ':' + padStart(mins, 2) : '');\n    }\n  } // Arg Utils\n\n\n  function createVerboseFormattingArg(start, end, context, separator) {\n    var startInfo = expandZonedMarker(start, context.calendarSystem);\n    var endInfo = end ? expandZonedMarker(end, context.calendarSystem) : null;\n    return {\n      date: startInfo,\n      start: startInfo,\n      end: endInfo,\n      timeZone: context.timeZone,\n      localeCodes: context.locale.codes,\n      separator: separator\n    };\n  }\n\n  function expandZonedMarker(dateInfo, calendarSystem) {\n    var a = calendarSystem.markerToArray(dateInfo.marker);\n    return {\n      marker: dateInfo.marker,\n      timeZoneOffset: dateInfo.timeZoneOffset,\n      array: a,\n      year: a[0],\n      month: a[1],\n      day: a[2],\n      hour: a[3],\n      minute: a[4],\n      second: a[5],\n      millisecond: a[6]\n    };\n  }\n\n  var EventSourceApi =\n  /** @class */\n  function () {\n    function EventSourceApi(calendar, internalEventSource) {\n      this.calendar = calendar;\n      this.internalEventSource = internalEventSource;\n    }\n\n    EventSourceApi.prototype.remove = function () {\n      this.calendar.dispatch({\n        type: 'REMOVE_EVENT_SOURCE',\n        sourceId: this.internalEventSource.sourceId\n      });\n    };\n\n    EventSourceApi.prototype.refetch = function () {\n      this.calendar.dispatch({\n        type: 'FETCH_EVENT_SOURCES',\n        sourceIds: [this.internalEventSource.sourceId]\n      });\n    };\n\n    Object.defineProperty(EventSourceApi.prototype, \"id\", {\n      get: function get() {\n        return this.internalEventSource.publicId;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(EventSourceApi.prototype, \"url\", {\n      // only relevant to json-feed event sources\n      get: function get() {\n        return this.internalEventSource.meta.url;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    return EventSourceApi;\n  }();\n\n  var EventApi =\n  /** @class */\n  function () {\n    function EventApi(calendar, def, instance) {\n      this._calendar = calendar;\n      this._def = def;\n      this._instance = instance || null;\n    }\n    /*\n    TODO: make event struct more responsible for this\n    */\n\n\n    EventApi.prototype.setProp = function (name, val) {\n      var _a, _b;\n\n      if (name in DATE_PROPS) ;else if (name in NON_DATE_PROPS) {\n        if (typeof NON_DATE_PROPS[name] === 'function') {\n          val = NON_DATE_PROPS[name](val);\n        }\n\n        this.mutate({\n          standardProps: (_a = {}, _a[name] = val, _a)\n        });\n      } else if (name in UNSCOPED_EVENT_UI_PROPS) {\n        var ui = void 0;\n\n        if (typeof UNSCOPED_EVENT_UI_PROPS[name] === 'function') {\n          val = UNSCOPED_EVENT_UI_PROPS[name](val);\n        }\n\n        if (name === 'color') {\n          ui = {\n            backgroundColor: val,\n            borderColor: val\n          };\n        } else if (name === 'editable') {\n          ui = {\n            startEditable: val,\n            durationEditable: val\n          };\n        } else {\n          ui = (_b = {}, _b[name] = val, _b);\n        }\n\n        this.mutate({\n          standardProps: {\n            ui: ui\n          }\n        });\n      }\n    };\n\n    EventApi.prototype.setExtendedProp = function (name, val) {\n      var _a;\n\n      this.mutate({\n        extendedProps: (_a = {}, _a[name] = val, _a)\n      });\n    };\n\n    EventApi.prototype.setStart = function (startInput, options) {\n      if (options === void 0) {\n        options = {};\n      }\n\n      var dateEnv = this._calendar.dateEnv;\n      var start = dateEnv.createMarker(startInput);\n\n      if (start && this._instance) {\n        // TODO: warning if parsed bad\n        var instanceRange = this._instance.range;\n        var startDelta = diffDates(instanceRange.start, start, dateEnv, options.granularity); // what if parsed bad!?\n\n        var endDelta = null;\n\n        if (options.maintainDuration) {\n          var origDuration = diffDates(instanceRange.start, instanceRange.end, dateEnv, options.granularity);\n          var newDuration = diffDates(start, instanceRange.end, dateEnv, options.granularity);\n          endDelta = subtractDurations(origDuration, newDuration);\n        }\n\n        this.mutate({\n          startDelta: startDelta,\n          endDelta: endDelta\n        });\n      }\n    };\n\n    EventApi.prototype.setEnd = function (endInput, options) {\n      if (options === void 0) {\n        options = {};\n      }\n\n      var dateEnv = this._calendar.dateEnv;\n      var end;\n\n      if (endInput != null) {\n        end = dateEnv.createMarker(endInput);\n\n        if (!end) {\n          return; // TODO: warning if parsed bad\n        }\n      }\n\n      if (this._instance) {\n        if (end) {\n          var endDelta = diffDates(this._instance.range.end, end, dateEnv, options.granularity);\n          this.mutate({\n            endDelta: endDelta\n          });\n        } else {\n          this.mutate({\n            standardProps: {\n              hasEnd: false\n            }\n          });\n        }\n      }\n    };\n\n    EventApi.prototype.setDates = function (startInput, endInput, options) {\n      if (options === void 0) {\n        options = {};\n      }\n\n      var dateEnv = this._calendar.dateEnv;\n      var standardProps = {\n        allDay: options.allDay\n      };\n      var start = dateEnv.createMarker(startInput);\n      var end;\n\n      if (!start) {\n        return; // TODO: warning if parsed bad\n      }\n\n      if (endInput != null) {\n        end = dateEnv.createMarker(endInput);\n\n        if (!end) {\n          // TODO: warning if parsed bad\n          return;\n        }\n      }\n\n      if (this._instance) {\n        var instanceRange = this._instance.range; // when computing the diff for an event being converted to all-day,\n        // compute diff off of the all-day values the way event-mutation does.\n\n        if (options.allDay === true) {\n          instanceRange = computeAlignedDayRange(instanceRange);\n        }\n\n        var startDelta = diffDates(instanceRange.start, start, dateEnv, options.granularity);\n\n        if (end) {\n          var endDelta = diffDates(instanceRange.end, end, dateEnv, options.granularity);\n          this.mutate({\n            startDelta: startDelta,\n            endDelta: endDelta,\n            standardProps: standardProps\n          });\n        } else {\n          standardProps.hasEnd = false;\n          this.mutate({\n            startDelta: startDelta,\n            standardProps: standardProps\n          });\n        }\n      }\n    };\n\n    EventApi.prototype.moveStart = function (deltaInput) {\n      var delta = createDuration(deltaInput);\n\n      if (delta) {\n        // TODO: warning if parsed bad\n        this.mutate({\n          startDelta: delta\n        });\n      }\n    };\n\n    EventApi.prototype.moveEnd = function (deltaInput) {\n      var delta = createDuration(deltaInput);\n\n      if (delta) {\n        // TODO: warning if parsed bad\n        this.mutate({\n          endDelta: delta\n        });\n      }\n    };\n\n    EventApi.prototype.moveDates = function (deltaInput) {\n      var delta = createDuration(deltaInput);\n\n      if (delta) {\n        // TODO: warning if parsed bad\n        this.mutate({\n          startDelta: delta,\n          endDelta: delta\n        });\n      }\n    };\n\n    EventApi.prototype.setAllDay = function (allDay, options) {\n      if (options === void 0) {\n        options = {};\n      }\n\n      var standardProps = {\n        allDay: allDay\n      };\n      var maintainDuration = options.maintainDuration;\n\n      if (maintainDuration == null) {\n        maintainDuration = this._calendar.opt('allDayMaintainDuration');\n      }\n\n      if (this._def.allDay !== allDay) {\n        standardProps.hasEnd = maintainDuration;\n      }\n\n      this.mutate({\n        standardProps: standardProps\n      });\n    };\n\n    EventApi.prototype.formatRange = function (formatInput) {\n      var dateEnv = this._calendar.dateEnv;\n      var instance = this._instance;\n      var formatter = createFormatter(formatInput, this._calendar.opt('defaultRangeSeparator'));\n\n      if (this._def.hasEnd) {\n        return dateEnv.formatRange(instance.range.start, instance.range.end, formatter, {\n          forcedStartTzo: instance.forcedStartTzo,\n          forcedEndTzo: instance.forcedEndTzo\n        });\n      } else {\n        return dateEnv.format(instance.range.start, formatter, {\n          forcedTzo: instance.forcedStartTzo\n        });\n      }\n    };\n\n    EventApi.prototype.mutate = function (mutation) {\n      var def = this._def;\n      var instance = this._instance;\n\n      if (instance) {\n        this._calendar.dispatch({\n          type: 'MUTATE_EVENTS',\n          instanceId: instance.instanceId,\n          mutation: mutation,\n          fromApi: true\n        });\n\n        var eventStore = this._calendar.state.eventStore;\n        this._def = eventStore.defs[def.defId];\n        this._instance = eventStore.instances[instance.instanceId];\n      }\n    };\n\n    EventApi.prototype.remove = function () {\n      this._calendar.dispatch({\n        type: 'REMOVE_EVENT_DEF',\n        defId: this._def.defId\n      });\n    };\n\n    Object.defineProperty(EventApi.prototype, \"source\", {\n      get: function get() {\n        var sourceId = this._def.sourceId;\n\n        if (sourceId) {\n          return new EventSourceApi(this._calendar, this._calendar.state.eventSources[sourceId]);\n        }\n\n        return null;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"start\", {\n      get: function get() {\n        return this._instance ? this._calendar.dateEnv.toDate(this._instance.range.start) : null;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"end\", {\n      get: function get() {\n        return this._instance && this._def.hasEnd ? this._calendar.dateEnv.toDate(this._instance.range.end) : null;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"id\", {\n      // computable props that all access the def\n      // TODO: find a TypeScript-compatible way to do this at scale\n      get: function get() {\n        return this._def.publicId;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"groupId\", {\n      get: function get() {\n        return this._def.groupId;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"allDay\", {\n      get: function get() {\n        return this._def.allDay;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"title\", {\n      get: function get() {\n        return this._def.title;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"url\", {\n      get: function get() {\n        return this._def.url;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"rendering\", {\n      get: function get() {\n        return this._def.rendering;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"startEditable\", {\n      get: function get() {\n        return this._def.ui.startEditable;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"durationEditable\", {\n      get: function get() {\n        return this._def.ui.durationEditable;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"constraint\", {\n      get: function get() {\n        return this._def.ui.constraints[0] || null;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"overlap\", {\n      get: function get() {\n        return this._def.ui.overlap;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"allow\", {\n      get: function get() {\n        return this._def.ui.allows[0] || null;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"backgroundColor\", {\n      get: function get() {\n        return this._def.ui.backgroundColor;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"borderColor\", {\n      get: function get() {\n        return this._def.ui.borderColor;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"textColor\", {\n      get: function get() {\n        return this._def.ui.textColor;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"classNames\", {\n      // NOTE: user can't modify these because Object.freeze was called in event-def parsing\n      get: function get() {\n        return this._def.ui.classNames;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(EventApi.prototype, \"extendedProps\", {\n      get: function get() {\n        return this._def.extendedProps;\n      },\n      enumerable: true,\n      configurable: true\n    });\n    return EventApi;\n  }();\n  /*\n  Specifying nextDayThreshold signals that all-day ranges should be sliced.\n  */\n\n\n  function sliceEventStore(eventStore, eventUiBases, framingRange, nextDayThreshold) {\n    var inverseBgByGroupId = {};\n    var inverseBgByDefId = {};\n    var defByGroupId = {};\n    var bgRanges = [];\n    var fgRanges = [];\n    var eventUis = compileEventUis(eventStore.defs, eventUiBases);\n\n    for (var defId in eventStore.defs) {\n      var def = eventStore.defs[defId];\n\n      if (def.rendering === 'inverse-background') {\n        if (def.groupId) {\n          inverseBgByGroupId[def.groupId] = [];\n\n          if (!defByGroupId[def.groupId]) {\n            defByGroupId[def.groupId] = def;\n          }\n        } else {\n          inverseBgByDefId[defId] = [];\n        }\n      }\n    }\n\n    for (var instanceId in eventStore.instances) {\n      var instance = eventStore.instances[instanceId];\n      var def = eventStore.defs[instance.defId];\n      var ui = eventUis[def.defId];\n      var origRange = instance.range;\n      var normalRange = !def.allDay && nextDayThreshold ? computeVisibleDayRange(origRange, nextDayThreshold) : origRange;\n      var slicedRange = intersectRanges(normalRange, framingRange);\n\n      if (slicedRange) {\n        if (def.rendering === 'inverse-background') {\n          if (def.groupId) {\n            inverseBgByGroupId[def.groupId].push(slicedRange);\n          } else {\n            inverseBgByDefId[instance.defId].push(slicedRange);\n          }\n        } else {\n          (def.rendering === 'background' ? bgRanges : fgRanges).push({\n            def: def,\n            ui: ui,\n            instance: instance,\n            range: slicedRange,\n            isStart: normalRange.start && normalRange.start.valueOf() === slicedRange.start.valueOf(),\n            isEnd: normalRange.end && normalRange.end.valueOf() === slicedRange.end.valueOf()\n          });\n        }\n      }\n    }\n\n    for (var groupId in inverseBgByGroupId) {\n      // BY GROUP\n      var ranges = inverseBgByGroupId[groupId];\n      var invertedRanges = invertRanges(ranges, framingRange);\n\n      for (var _i = 0, invertedRanges_1 = invertedRanges; _i < invertedRanges_1.length; _i++) {\n        var invertedRange = invertedRanges_1[_i];\n        var def = defByGroupId[groupId];\n        var ui = eventUis[def.defId];\n        bgRanges.push({\n          def: def,\n          ui: ui,\n          instance: null,\n          range: invertedRange,\n          isStart: false,\n          isEnd: false\n        });\n      }\n    }\n\n    for (var defId in inverseBgByDefId) {\n      var ranges = inverseBgByDefId[defId];\n      var invertedRanges = invertRanges(ranges, framingRange);\n\n      for (var _a = 0, invertedRanges_2 = invertedRanges; _a < invertedRanges_2.length; _a++) {\n        var invertedRange = invertedRanges_2[_a];\n        bgRanges.push({\n          def: eventStore.defs[defId],\n          ui: eventUis[defId],\n          instance: null,\n          range: invertedRange,\n          isStart: false,\n          isEnd: false\n        });\n      }\n    }\n\n    return {\n      bg: bgRanges,\n      fg: fgRanges\n    };\n  }\n\n  function hasBgRendering(def) {\n    return def.rendering === 'background' || def.rendering === 'inverse-background';\n  }\n\n  function filterSegsViaEls(view, segs, isMirror) {\n    if (view.hasPublicHandlers('eventRender')) {\n      segs = segs.filter(function (seg) {\n        var custom = view.publiclyTrigger('eventRender', [{\n          event: new EventApi(view.calendar, seg.eventRange.def, seg.eventRange.instance),\n          isMirror: isMirror,\n          isStart: seg.isStart,\n          isEnd: seg.isEnd,\n          // TODO: include seg.range once all components consistently generate it\n          el: seg.el,\n          view: view\n        }]);\n\n        if (custom === false) {\n          // means don't render at all\n          return false;\n        } else if (custom && custom !== true) {\n          seg.el = custom;\n        }\n\n        return true;\n      });\n    }\n\n    for (var _i = 0, segs_1 = segs; _i < segs_1.length; _i++) {\n      var seg = segs_1[_i];\n      setElSeg(seg.el, seg);\n    }\n\n    return segs;\n  }\n\n  function setElSeg(el, seg) {\n    el.fcSeg = seg;\n  }\n\n  function getElSeg(el) {\n    return el.fcSeg || null;\n  } // event ui computation\n\n\n  function compileEventUis(eventDefs, eventUiBases) {\n    return mapHash(eventDefs, function (eventDef) {\n      return compileEventUi(eventDef, eventUiBases);\n    });\n  }\n\n  function compileEventUi(eventDef, eventUiBases) {\n    var uis = [];\n\n    if (eventUiBases['']) {\n      uis.push(eventUiBases['']);\n    }\n\n    if (eventUiBases[eventDef.defId]) {\n      uis.push(eventUiBases[eventDef.defId]);\n    }\n\n    uis.push(eventDef.ui);\n    return combineEventUis(uis);\n  } // applies the mutation to ALL defs/instances within the event store\n\n\n  function applyMutationToEventStore(eventStore, eventConfigBase, mutation, calendar) {\n    var eventConfigs = compileEventUis(eventStore.defs, eventConfigBase);\n    var dest = createEmptyEventStore();\n\n    for (var defId in eventStore.defs) {\n      var def = eventStore.defs[defId];\n      dest.defs[defId] = applyMutationToEventDef(def, eventConfigs[defId], mutation, calendar.pluginSystem.hooks.eventDefMutationAppliers, calendar);\n    }\n\n    for (var instanceId in eventStore.instances) {\n      var instance = eventStore.instances[instanceId];\n      var def = dest.defs[instance.defId]; // important to grab the newly modified def\n\n      dest.instances[instanceId] = applyMutationToEventInstance(instance, def, eventConfigs[instance.defId], mutation, calendar);\n    }\n\n    return dest;\n  }\n\n  function applyMutationToEventDef(eventDef, eventConfig, mutation, appliers, calendar) {\n    var standardProps = mutation.standardProps || {}; // if hasEnd has not been specified, guess a good value based on deltas.\n    // if duration will change, there's no way the default duration will persist,\n    // and thus, we need to mark the event as having a real end\n\n    if (standardProps.hasEnd == null && eventConfig.durationEditable && willDeltasAffectDuration(eventConfig.startEditable ? mutation.startDelta : null, mutation.endDelta || null)) {\n      standardProps.hasEnd = true; // TODO: is this mutation okay?\n    }\n\n    var copy = _assign({}, eventDef, standardProps, {\n      ui: _assign({}, eventDef.ui, standardProps.ui)\n    });\n\n    if (mutation.extendedProps) {\n      copy.extendedProps = _assign({}, copy.extendedProps, mutation.extendedProps);\n    }\n\n    for (var _i = 0, appliers_1 = appliers; _i < appliers_1.length; _i++) {\n      var applier = appliers_1[_i];\n      applier(copy, mutation, calendar);\n    }\n\n    if (!copy.hasEnd && calendar.opt('forceEventDuration')) {\n      copy.hasEnd = true;\n    }\n\n    return copy;\n  }\n\n  function willDeltasAffectDuration(startDelta, endDelta) {\n    if (startDelta && !asRoughMs(startDelta)) {\n      startDelta = null;\n    }\n\n    if (endDelta && !asRoughMs(endDelta)) {\n      endDelta = null;\n    }\n\n    if (!startDelta && !endDelta) {\n      return false;\n    }\n\n    if (Boolean(startDelta) !== Boolean(endDelta)) {\n      return true;\n    }\n\n    return !durationsEqual(startDelta, endDelta);\n  }\n\n  function applyMutationToEventInstance(eventInstance, eventDef, // must first be modified by applyMutationToEventDef\n  eventConfig, mutation, calendar) {\n    var dateEnv = calendar.dateEnv;\n    var forceAllDay = mutation.standardProps && mutation.standardProps.allDay === true;\n    var clearEnd = mutation.standardProps && mutation.standardProps.hasEnd === false;\n\n    var copy = _assign({}, eventInstance);\n\n    if (forceAllDay) {\n      copy.range = computeAlignedDayRange(copy.range);\n    }\n\n    if (mutation.startDelta && eventConfig.startEditable) {\n      copy.range = {\n        start: dateEnv.add(copy.range.start, mutation.startDelta),\n        end: copy.range.end\n      };\n    }\n\n    if (clearEnd) {\n      copy.range = {\n        start: copy.range.start,\n        end: calendar.getDefaultEventEnd(eventDef.allDay, copy.range.start)\n      };\n    } else if (mutation.endDelta && (eventConfig.durationEditable || !willDeltasAffectDuration( // TODO: nonDRY logic above\n    eventConfig.startEditable ? mutation.startDelta : null, mutation.endDelta))) {\n      copy.range = {\n        start: copy.range.start,\n        end: dateEnv.add(copy.range.end, mutation.endDelta)\n      };\n    } // in case event was all-day but the supplied deltas were not\n    // better util for this?\n\n\n    if (eventDef.allDay) {\n      copy.range = {\n        start: startOfDay(copy.range.start),\n        end: startOfDay(copy.range.end)\n      };\n    } // handle invalid durations\n\n\n    if (copy.range.end < copy.range.start) {\n      copy.range.end = calendar.getDefaultEventEnd(eventDef.allDay, copy.range.start);\n    }\n\n    return copy;\n  }\n\n  function reduceEventStore(eventStore, action, eventSources, dateProfile, calendar) {\n    switch (action.type) {\n      case 'RECEIVE_EVENTS':\n        // raw\n        return receiveRawEvents(eventStore, eventSources[action.sourceId], action.fetchId, action.fetchRange, action.rawEvents, calendar);\n\n      case 'ADD_EVENTS':\n        // already parsed, but not expanded\n        return addEvent(eventStore, action.eventStore, // new ones\n        dateProfile ? dateProfile.activeRange : null, calendar);\n\n      case 'MERGE_EVENTS':\n        // already parsed and expanded\n        return mergeEventStores(eventStore, action.eventStore);\n\n      case 'PREV': // TODO: how do we track all actions that affect dateProfile :(\n\n      case 'NEXT':\n      case 'SET_DATE':\n      case 'SET_VIEW_TYPE':\n        if (dateProfile) {\n          return expandRecurring(eventStore, dateProfile.activeRange, calendar);\n        } else {\n          return eventStore;\n        }\n\n      case 'CHANGE_TIMEZONE':\n        return rezoneDates(eventStore, action.oldDateEnv, calendar.dateEnv);\n\n      case 'MUTATE_EVENTS':\n        return applyMutationToRelated(eventStore, action.instanceId, action.mutation, action.fromApi, calendar);\n\n      case 'REMOVE_EVENT_INSTANCES':\n        return excludeInstances(eventStore, action.instances);\n\n      case 'REMOVE_EVENT_DEF':\n        return filterEventStoreDefs(eventStore, function (eventDef) {\n          return eventDef.defId !== action.defId;\n        });\n\n      case 'REMOVE_EVENT_SOURCE':\n        return excludeEventsBySourceId(eventStore, action.sourceId);\n\n      case 'REMOVE_ALL_EVENT_SOURCES':\n        return filterEventStoreDefs(eventStore, function (eventDef) {\n          return !eventDef.sourceId; // only keep events with no source id\n        });\n\n      case 'REMOVE_ALL_EVENTS':\n        return createEmptyEventStore();\n\n      case 'RESET_EVENTS':\n        return {\n          defs: eventStore.defs,\n          instances: eventStore.instances\n        };\n\n      default:\n        return eventStore;\n    }\n  }\n\n  function receiveRawEvents(eventStore, eventSource, fetchId, fetchRange, rawEvents, calendar) {\n    if (eventSource && // not already removed\n    fetchId === eventSource.latestFetchId // TODO: wish this logic was always in event-sources\n    ) {\n        var subset = parseEvents(transformRawEvents(rawEvents, eventSource, calendar), eventSource.sourceId, calendar);\n\n        if (fetchRange) {\n          subset = expandRecurring(subset, fetchRange, calendar);\n        }\n\n        return mergeEventStores(excludeEventsBySourceId(eventStore, eventSource.sourceId), subset);\n      }\n\n    return eventStore;\n  }\n\n  function addEvent(eventStore, subset, expandRange, calendar) {\n    if (expandRange) {\n      subset = expandRecurring(subset, expandRange, calendar);\n    }\n\n    return mergeEventStores(eventStore, subset);\n  }\n\n  function rezoneDates(eventStore, oldDateEnv, newDateEnv) {\n    var defs = eventStore.defs;\n    var instances = mapHash(eventStore.instances, function (instance) {\n      var def = defs[instance.defId];\n\n      if (def.allDay || def.recurringDef) {\n        return instance; // isn't dependent on timezone\n      } else {\n        return _assign({}, instance, {\n          range: {\n            start: newDateEnv.createMarker(oldDateEnv.toDate(instance.range.start, instance.forcedStartTzo)),\n            end: newDateEnv.createMarker(oldDateEnv.toDate(instance.range.end, instance.forcedEndTzo))\n          },\n          forcedStartTzo: newDateEnv.canComputeOffset ? null : instance.forcedStartTzo,\n          forcedEndTzo: newDateEnv.canComputeOffset ? null : instance.forcedEndTzo\n        });\n      }\n    });\n    return {\n      defs: defs,\n      instances: instances\n    };\n  }\n\n  function applyMutationToRelated(eventStore, instanceId, mutation, fromApi, calendar) {\n    var relevant = getRelevantEvents(eventStore, instanceId);\n    var eventConfigBase = fromApi ? {\n      '': {\n        startEditable: true,\n        durationEditable: true,\n        constraints: [],\n        overlap: null,\n        allows: [],\n        backgroundColor: '',\n        borderColor: '',\n        textColor: '',\n        classNames: []\n      }\n    } : calendar.eventUiBases;\n    relevant = applyMutationToEventStore(relevant, eventConfigBase, mutation, calendar);\n    return mergeEventStores(eventStore, relevant);\n  }\n\n  function excludeEventsBySourceId(eventStore, sourceId) {\n    return filterEventStoreDefs(eventStore, function (eventDef) {\n      return eventDef.sourceId !== sourceId;\n    });\n  } // QUESTION: why not just return instances? do a general object-property-exclusion util\n\n\n  function excludeInstances(eventStore, removals) {\n    return {\n      defs: eventStore.defs,\n      instances: filterHash(eventStore.instances, function (instance) {\n        return !removals[instance.instanceId];\n      })\n    };\n  } // high-level segmenting-aware tester functions\n  // ------------------------------------------------------------------------------------------------------------------------\n\n\n  function isInteractionValid(interaction, calendar) {\n    return isNewPropsValid({\n      eventDrag: interaction\n    }, calendar); // HACK: the eventDrag props is used for ALL interactions\n  }\n\n  function isDateSelectionValid(dateSelection, calendar) {\n    return isNewPropsValid({\n      dateSelection: dateSelection\n    }, calendar);\n  }\n\n  function isNewPropsValid(newProps, calendar) {\n    var view = calendar.view;\n\n    var props = _assign({\n      businessHours: view ? view.props.businessHours : createEmptyEventStore(),\n      dateSelection: '',\n      eventStore: calendar.state.eventStore,\n      eventUiBases: calendar.eventUiBases,\n      eventSelection: '',\n      eventDrag: null,\n      eventResize: null\n    }, newProps);\n\n    return (calendar.pluginSystem.hooks.isPropsValid || isPropsValid)(props, calendar);\n  }\n\n  function isPropsValid(state, calendar, dateSpanMeta, filterConfig) {\n    if (dateSpanMeta === void 0) {\n      dateSpanMeta = {};\n    }\n\n    if (state.eventDrag && !isInteractionPropsValid(state, calendar, dateSpanMeta, filterConfig)) {\n      return false;\n    }\n\n    if (state.dateSelection && !isDateSelectionPropsValid(state, calendar, dateSpanMeta, filterConfig)) {\n      return false;\n    }\n\n    return true;\n  } // Moving Event Validation\n  // ------------------------------------------------------------------------------------------------------------------------\n\n\n  function isInteractionPropsValid(state, calendar, dateSpanMeta, filterConfig) {\n    var interaction = state.eventDrag; // HACK: the eventDrag props is used for ALL interactions\n\n    var subjectEventStore = interaction.mutatedEvents;\n    var subjectDefs = subjectEventStore.defs;\n    var subjectInstances = subjectEventStore.instances;\n    var subjectConfigs = compileEventUis(subjectDefs, interaction.isEvent ? state.eventUiBases : {\n      '': calendar.selectionConfig\n    } // if not a real event, validate as a selection\n    );\n\n    if (filterConfig) {\n      subjectConfigs = mapHash(subjectConfigs, filterConfig);\n    }\n\n    var otherEventStore = excludeInstances(state.eventStore, interaction.affectedEvents.instances); // exclude the subject events. TODO: exclude defs too?\n\n    var otherDefs = otherEventStore.defs;\n    var otherInstances = otherEventStore.instances;\n    var otherConfigs = compileEventUis(otherDefs, state.eventUiBases);\n\n    for (var subjectInstanceId in subjectInstances) {\n      var subjectInstance = subjectInstances[subjectInstanceId];\n      var subjectRange = subjectInstance.range;\n      var subjectConfig = subjectConfigs[subjectInstance.defId];\n      var subjectDef = subjectDefs[subjectInstance.defId]; // constraint\n\n      if (!allConstraintsPass(subjectConfig.constraints, subjectRange, otherEventStore, state.businessHours, calendar)) {\n        return false;\n      } // overlap\n\n\n      var overlapFunc = calendar.opt('eventOverlap');\n\n      if (typeof overlapFunc !== 'function') {\n        overlapFunc = null;\n      }\n\n      for (var otherInstanceId in otherInstances) {\n        var otherInstance = otherInstances[otherInstanceId]; // intersect! evaluate\n\n        if (rangesIntersect(subjectRange, otherInstance.range)) {\n          var otherOverlap = otherConfigs[otherInstance.defId].overlap; // consider the other event's overlap. only do this if the subject event is a \"real\" event\n\n          if (otherOverlap === false && interaction.isEvent) {\n            return false;\n          }\n\n          if (subjectConfig.overlap === false) {\n            return false;\n          }\n\n          if (overlapFunc && !overlapFunc(new EventApi(calendar, otherDefs[otherInstance.defId], otherInstance), // still event\n          new EventApi(calendar, subjectDef, subjectInstance) // moving event\n          )) {\n            return false;\n          }\n        }\n      } // allow (a function)\n\n\n      for (var _i = 0, _a = subjectConfig.allows; _i < _a.length; _i++) {\n        var subjectAllow = _a[_i];\n        var origDef = state.eventStore.defs[subjectDef.defId];\n        var origInstance = state.eventStore.instances[subjectInstanceId];\n\n        var subjectDateSpan = _assign({}, dateSpanMeta, {\n          range: subjectInstance.range,\n          allDay: subjectDef.allDay\n        });\n\n        if (!subjectAllow(calendar.buildDateSpanApi(subjectDateSpan), new EventApi(calendar, origDef, origInstance))) {\n          return false;\n        }\n      }\n    }\n\n    return true;\n  } // Date Selection Validation\n  // ------------------------------------------------------------------------------------------------------------------------\n\n\n  function isDateSelectionPropsValid(state, calendar, dateSpanMeta, filterConfig) {\n    var relevantEventStore = state.eventStore;\n    var relevantDefs = relevantEventStore.defs;\n    var relevantInstances = relevantEventStore.instances;\n    var selection = state.dateSelection;\n    var selectionRange = selection.range;\n    var selectionConfig = calendar.selectionConfig;\n\n    if (filterConfig) {\n      selectionConfig = filterConfig(selectionConfig);\n    } // constraint\n\n\n    if (!allConstraintsPass(selectionConfig.constraints, selectionRange, relevantEventStore, state.businessHours, calendar)) {\n      return false;\n    } // overlap\n\n\n    var overlapFunc = calendar.opt('selectOverlap');\n\n    if (typeof overlapFunc !== 'function') {\n      overlapFunc = null;\n    }\n\n    for (var relevantInstanceId in relevantInstances) {\n      var relevantInstance = relevantInstances[relevantInstanceId]; // intersect! evaluate\n\n      if (rangesIntersect(selectionRange, relevantInstance.range)) {\n        if (selectionConfig.overlap === false) {\n          return false;\n        }\n\n        if (overlapFunc && !overlapFunc(new EventApi(calendar, relevantDefs[relevantInstance.defId], relevantInstance))) {\n          return false;\n        }\n      }\n    } // allow (a function)\n\n\n    for (var _i = 0, _a = selectionConfig.allows; _i < _a.length; _i++) {\n      var selectionAllow = _a[_i];\n\n      var fullDateSpan = _assign({}, dateSpanMeta, selection);\n\n      if (!selectionAllow(calendar.buildDateSpanApi(fullDateSpan), null)) {\n        return false;\n      }\n    }\n\n    return true;\n  } // Constraint Utils\n  // ------------------------------------------------------------------------------------------------------------------------\n\n\n  function allConstraintsPass(constraints, subjectRange, otherEventStore, businessHoursUnexpanded, calendar) {\n    for (var _i = 0, constraints_1 = constraints; _i < constraints_1.length; _i++) {\n      var constraint = constraints_1[_i];\n\n      if (!anyRangesContainRange(constraintToRanges(constraint, subjectRange, otherEventStore, businessHoursUnexpanded, calendar), subjectRange)) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  function constraintToRanges(constraint, subjectRange, // for expanding a recurring constraint, or expanding business hours\n  otherEventStore, // for if constraint is an even group ID\n  businessHoursUnexpanded, // for if constraint is 'businessHours'\n  calendar // for expanding businesshours\n  ) {\n    if (constraint === 'businessHours') {\n      return eventStoreToRanges(expandRecurring(businessHoursUnexpanded, subjectRange, calendar));\n    } else if (typeof constraint === 'string') {\n      // an group ID\n      return eventStoreToRanges(filterEventStoreDefs(otherEventStore, function (eventDef) {\n        return eventDef.groupId === constraint;\n      }));\n    } else if (typeof constraint === 'object' && constraint) {\n      // non-null object\n      return eventStoreToRanges(expandRecurring(constraint, subjectRange, calendar));\n    }\n\n    return []; // if it's false\n  } // TODO: move to event-store file?\n\n\n  function eventStoreToRanges(eventStore) {\n    var instances = eventStore.instances;\n    var ranges = [];\n\n    for (var instanceId in instances) {\n      ranges.push(instances[instanceId].range);\n    }\n\n    return ranges;\n  } // TODO: move to geom file?\n\n\n  function anyRangesContainRange(outerRanges, innerRange) {\n    for (var _i = 0, outerRanges_1 = outerRanges; _i < outerRanges_1.length; _i++) {\n      var outerRange = outerRanges_1[_i];\n\n      if (rangeContainsRange(outerRange, innerRange)) {\n        return true;\n      }\n    }\n\n    return false;\n  } // Parsing\n  // ------------------------------------------------------------------------------------------------------------------------\n\n\n  function normalizeConstraint(input, calendar) {\n    if (Array.isArray(input)) {\n      return parseEvents(input, '', calendar, true); // allowOpenRange=true\n    } else if (typeof input === 'object' && input) {\n      // non-null object\n      return parseEvents([input], '', calendar, true); // allowOpenRange=true\n    } else if (input != null) {\n      return String(input);\n    } else {\n      return null;\n    }\n  }\n\n  function htmlEscape(s) {\n    return (s + '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/'/g, '&#039;').replace(/\"/g, '&quot;').replace(/\\n/g, '<br />');\n  } // Given a hash of CSS properties, returns a string of CSS.\n  // Uses property names as-is (no camel-case conversion). Will not make statements for null/undefined values.\n\n\n  function cssToStr(cssProps) {\n    var statements = [];\n\n    for (var name_1 in cssProps) {\n      var val = cssProps[name_1];\n\n      if (val != null && val !== '') {\n        statements.push(name_1 + ':' + val);\n      }\n    }\n\n    return statements.join(';');\n  } // Given an object hash of HTML attribute names to values,\n  // generates a string that can be injected between < > in HTML\n\n\n  function attrsToStr(attrs) {\n    var parts = [];\n\n    for (var name_2 in attrs) {\n      var val = attrs[name_2];\n\n      if (val != null) {\n        parts.push(name_2 + '=\"' + htmlEscape(val) + '\"');\n      }\n    }\n\n    return parts.join(' ');\n  }\n\n  function parseClassName(raw) {\n    if (Array.isArray(raw)) {\n      return raw;\n    } else if (typeof raw === 'string') {\n      return raw.split(/\\s+/);\n    } else {\n      return [];\n    }\n  }\n\n  var UNSCOPED_EVENT_UI_PROPS = {\n    editable: Boolean,\n    startEditable: Boolean,\n    durationEditable: Boolean,\n    constraint: null,\n    overlap: null,\n    allow: null,\n    className: parseClassName,\n    classNames: parseClassName,\n    color: String,\n    backgroundColor: String,\n    borderColor: String,\n    textColor: String\n  };\n\n  function processUnscopedUiProps(rawProps, calendar, leftovers) {\n    var props = refineProps(rawProps, UNSCOPED_EVENT_UI_PROPS, {}, leftovers);\n    var constraint = normalizeConstraint(props.constraint, calendar);\n    return {\n      startEditable: props.startEditable != null ? props.startEditable : props.editable,\n      durationEditable: props.durationEditable != null ? props.durationEditable : props.editable,\n      constraints: constraint != null ? [constraint] : [],\n      overlap: props.overlap,\n      allows: props.allow != null ? [props.allow] : [],\n      backgroundColor: props.backgroundColor || props.color,\n      borderColor: props.borderColor || props.color,\n      textColor: props.textColor,\n      classNames: props.classNames.concat(props.className)\n    };\n  }\n\n  function processScopedUiProps(prefix, rawScoped, calendar, leftovers) {\n    var rawUnscoped = {};\n    var wasFound = {};\n\n    for (var key in UNSCOPED_EVENT_UI_PROPS) {\n      var scopedKey = prefix + capitaliseFirstLetter(key);\n      rawUnscoped[key] = rawScoped[scopedKey];\n      wasFound[scopedKey] = true;\n    }\n\n    if (prefix === 'event') {\n      rawUnscoped.editable = rawScoped.editable; // special case. there is no 'eventEditable', just 'editable'\n    }\n\n    if (leftovers) {\n      for (var key in rawScoped) {\n        if (!wasFound[key]) {\n          leftovers[key] = rawScoped[key];\n        }\n      }\n    }\n\n    return processUnscopedUiProps(rawUnscoped, calendar);\n  }\n\n  var EMPTY_EVENT_UI = {\n    startEditable: null,\n    durationEditable: null,\n    constraints: [],\n    overlap: null,\n    allows: [],\n    backgroundColor: '',\n    borderColor: '',\n    textColor: '',\n    classNames: []\n  }; // prevent against problems with <2 args!\n\n  function combineEventUis(uis) {\n    return uis.reduce(combineTwoEventUis, EMPTY_EVENT_UI);\n  }\n\n  function combineTwoEventUis(item0, item1) {\n    return {\n      startEditable: item1.startEditable != null ? item1.startEditable : item0.startEditable,\n      durationEditable: item1.durationEditable != null ? item1.durationEditable : item0.durationEditable,\n      constraints: item0.constraints.concat(item1.constraints),\n      overlap: typeof item1.overlap === 'boolean' ? item1.overlap : item0.overlap,\n      allows: item0.allows.concat(item1.allows),\n      backgroundColor: item1.backgroundColor || item0.backgroundColor,\n      borderColor: item1.borderColor || item0.borderColor,\n      textColor: item1.textColor || item0.textColor,\n      classNames: item0.classNames.concat(item1.classNames)\n    };\n  }\n\n  var NON_DATE_PROPS = {\n    id: String,\n    groupId: String,\n    title: String,\n    url: String,\n    rendering: String,\n    extendedProps: null\n  };\n  var DATE_PROPS = {\n    start: null,\n    date: null,\n    end: null,\n    allDay: null\n  };\n  var uid = 0;\n\n  function parseEvent(raw, sourceId, calendar, allowOpenRange) {\n    var allDayDefault = computeIsAllDayDefault(sourceId, calendar);\n    var leftovers0 = {};\n    var recurringRes = parseRecurring(raw, // raw, but with single-event stuff stripped out\n    allDayDefault, calendar.dateEnv, calendar.pluginSystem.hooks.recurringTypes, leftovers0 // will populate with non-recurring props\n    );\n\n    if (recurringRes) {\n      var def = parseEventDef(leftovers0, sourceId, recurringRes.allDay, Boolean(recurringRes.duration), calendar);\n      def.recurringDef = {\n        typeId: recurringRes.typeId,\n        typeData: recurringRes.typeData,\n        duration: recurringRes.duration\n      };\n      return {\n        def: def,\n        instance: null\n      };\n    } else {\n      var leftovers1 = {};\n      var singleRes = parseSingle(raw, allDayDefault, calendar, leftovers1, allowOpenRange);\n\n      if (singleRes) {\n        var def = parseEventDef(leftovers1, sourceId, singleRes.allDay, singleRes.hasEnd, calendar);\n        var instance = createEventInstance(def.defId, singleRes.range, singleRes.forcedStartTzo, singleRes.forcedEndTzo);\n        return {\n          def: def,\n          instance: instance\n        };\n      }\n    }\n\n    return null;\n  }\n  /*\n  Will NOT populate extendedProps with the leftover properties.\n  Will NOT populate date-related props.\n  The EventNonDateInput has been normalized (id => publicId, etc).\n  */\n\n\n  function parseEventDef(raw, sourceId, allDay, hasEnd, calendar) {\n    var leftovers = {};\n    var def = pluckNonDateProps(raw, calendar, leftovers);\n    def.defId = String(uid++);\n    def.sourceId = sourceId;\n    def.allDay = allDay;\n    def.hasEnd = hasEnd;\n\n    for (var _i = 0, _a = calendar.pluginSystem.hooks.eventDefParsers; _i < _a.length; _i++) {\n      var eventDefParser = _a[_i];\n      var newLeftovers = {};\n      eventDefParser(def, leftovers, newLeftovers);\n      leftovers = newLeftovers;\n    }\n\n    def.extendedProps = _assign(leftovers, def.extendedProps || {}); // help out EventApi from having user modify props\n\n    Object.freeze(def.ui.classNames);\n    Object.freeze(def.extendedProps);\n    return def;\n  }\n\n  function createEventInstance(defId, range, forcedStartTzo, forcedEndTzo) {\n    return {\n      instanceId: String(uid++),\n      defId: defId,\n      range: range,\n      forcedStartTzo: forcedStartTzo == null ? null : forcedStartTzo,\n      forcedEndTzo: forcedEndTzo == null ? null : forcedEndTzo\n    };\n  }\n\n  function parseSingle(raw, allDayDefault, calendar, leftovers, allowOpenRange) {\n    var props = pluckDateProps(raw, leftovers);\n    var allDay = props.allDay;\n    var startMeta;\n    var startMarker = null;\n    var hasEnd = false;\n    var endMeta;\n    var endMarker = null;\n    startMeta = calendar.dateEnv.createMarkerMeta(props.start);\n\n    if (startMeta) {\n      startMarker = startMeta.marker;\n    } else if (!allowOpenRange) {\n      return null;\n    }\n\n    if (props.end != null) {\n      endMeta = calendar.dateEnv.createMarkerMeta(props.end);\n    }\n\n    if (allDay == null) {\n      if (allDayDefault != null) {\n        allDay = allDayDefault;\n      } else {\n        // fall back to the date props LAST\n        allDay = (!startMeta || startMeta.isTimeUnspecified) && (!endMeta || endMeta.isTimeUnspecified);\n      }\n    }\n\n    if (allDay && startMarker) {\n      startMarker = startOfDay(startMarker);\n    }\n\n    if (endMeta) {\n      endMarker = endMeta.marker;\n\n      if (allDay) {\n        endMarker = startOfDay(endMarker);\n      }\n\n      if (startMarker && endMarker <= startMarker) {\n        endMarker = null;\n      }\n    }\n\n    if (endMarker) {\n      hasEnd = true;\n    } else if (!allowOpenRange) {\n      hasEnd = calendar.opt('forceEventDuration') || false;\n      endMarker = calendar.dateEnv.add(startMarker, allDay ? calendar.defaultAllDayEventDuration : calendar.defaultTimedEventDuration);\n    }\n\n    return {\n      allDay: allDay,\n      hasEnd: hasEnd,\n      range: {\n        start: startMarker,\n        end: endMarker\n      },\n      forcedStartTzo: startMeta ? startMeta.forcedTzo : null,\n      forcedEndTzo: endMeta ? endMeta.forcedTzo : null\n    };\n  }\n\n  function pluckDateProps(raw, leftovers) {\n    var props = refineProps(raw, DATE_PROPS, {}, leftovers);\n    props.start = props.start !== null ? props.start : props.date;\n    delete props.date;\n    return props;\n  }\n\n  function pluckNonDateProps(raw, calendar, leftovers) {\n    var preLeftovers = {};\n    var props = refineProps(raw, NON_DATE_PROPS, {}, preLeftovers);\n    var ui = processUnscopedUiProps(preLeftovers, calendar, leftovers);\n    props.publicId = props.id;\n    delete props.id;\n    props.ui = ui;\n    return props;\n  }\n\n  function computeIsAllDayDefault(sourceId, calendar) {\n    var res = null;\n\n    if (sourceId) {\n      var source = calendar.state.eventSources[sourceId];\n      res = source.allDayDefault;\n    }\n\n    if (res == null) {\n      res = calendar.opt('allDayDefault');\n    }\n\n    return res;\n  }\n\n  var DEF_DEFAULTS = {\n    startTime: '09:00',\n    endTime: '17:00',\n    daysOfWeek: [1, 2, 3, 4, 5],\n    rendering: 'inverse-background',\n    classNames: 'fc-nonbusiness',\n    groupId: '_businessHours' // so multiple defs get grouped\n\n  };\n  /*\n  TODO: pass around as EventDefHash!!!\n  */\n\n  function parseBusinessHours(input, calendar) {\n    return parseEvents(refineInputs(input), '', calendar);\n  }\n\n  function refineInputs(input) {\n    var rawDefs;\n\n    if (input === true) {\n      rawDefs = [{}]; // will get DEF_DEFAULTS verbatim\n    } else if (Array.isArray(input)) {\n      // if specifying an array, every sub-definition NEEDS a day-of-week\n      rawDefs = input.filter(function (rawDef) {\n        return rawDef.daysOfWeek;\n      });\n    } else if (typeof input === 'object' && input) {\n      // non-null object\n      rawDefs = [input];\n    } else {\n      // is probably false\n      rawDefs = [];\n    }\n\n    rawDefs = rawDefs.map(function (rawDef) {\n      return _assign({}, DEF_DEFAULTS, rawDef);\n    });\n    return rawDefs;\n  }\n\n  function memoizeRendering(renderFunc, unrenderFunc, dependencies) {\n    if (dependencies === void 0) {\n      dependencies = [];\n    }\n\n    var dependents = [];\n    var thisContext;\n    var prevArgs;\n\n    function unrender() {\n      if (prevArgs) {\n        for (var _i = 0, dependents_1 = dependents; _i < dependents_1.length; _i++) {\n          var dependent = dependents_1[_i];\n          dependent.unrender();\n        }\n\n        if (unrenderFunc) {\n          unrenderFunc.apply(thisContext, prevArgs);\n        }\n\n        prevArgs = null;\n      }\n    }\n\n    function res() {\n      if (!prevArgs || !isArraysEqual(prevArgs, arguments)) {\n        unrender();\n        thisContext = this;\n        prevArgs = arguments;\n        renderFunc.apply(this, arguments);\n      }\n    }\n\n    res.dependents = dependents;\n    res.unrender = unrender;\n\n    for (var _i = 0, dependencies_1 = dependencies; _i < dependencies_1.length; _i++) {\n      var dependency = dependencies_1[_i];\n      dependency.dependents.push(res);\n    }\n\n    return res;\n  }\n\n  var EMPTY_EVENT_STORE = createEmptyEventStore(); // for purecomponents. TODO: keep elsewhere\n\n  var Splitter =\n  /** @class */\n  function () {\n    function Splitter() {\n      this.getKeysForEventDefs = memoize(this._getKeysForEventDefs);\n      this.splitDateSelection = memoize(this._splitDateSpan);\n      this.splitEventStore = memoize(this._splitEventStore);\n      this.splitIndividualUi = memoize(this._splitIndividualUi);\n      this.splitEventDrag = memoize(this._splitInteraction);\n      this.splitEventResize = memoize(this._splitInteraction);\n      this.eventUiBuilders = {}; // TODO: typescript protection\n    }\n\n    Splitter.prototype.splitProps = function (props) {\n      var _this = this;\n\n      var keyInfos = this.getKeyInfo(props);\n      var defKeys = this.getKeysForEventDefs(props.eventStore);\n      var dateSelections = this.splitDateSelection(props.dateSelection);\n      var individualUi = this.splitIndividualUi(props.eventUiBases, defKeys); // the individual *bases*\n\n      var eventStores = this.splitEventStore(props.eventStore, defKeys);\n      var eventDrags = this.splitEventDrag(props.eventDrag);\n      var eventResizes = this.splitEventResize(props.eventResize);\n      var splitProps = {};\n      this.eventUiBuilders = mapHash(keyInfos, function (info, key) {\n        return _this.eventUiBuilders[key] || memoize(buildEventUiForKey);\n      });\n\n      for (var key in keyInfos) {\n        var keyInfo = keyInfos[key];\n        var eventStore = eventStores[key] || EMPTY_EVENT_STORE;\n        var buildEventUi = this.eventUiBuilders[key];\n        splitProps[key] = {\n          businessHours: keyInfo.businessHours || props.businessHours,\n          dateSelection: dateSelections[key] || null,\n          eventStore: eventStore,\n          eventUiBases: buildEventUi(props.eventUiBases[''], keyInfo.ui, individualUi[key]),\n          eventSelection: eventStore.instances[props.eventSelection] ? props.eventSelection : '',\n          eventDrag: eventDrags[key] || null,\n          eventResize: eventResizes[key] || null\n        };\n      }\n\n      return splitProps;\n    };\n\n    Splitter.prototype._splitDateSpan = function (dateSpan) {\n      var dateSpans = {};\n\n      if (dateSpan) {\n        var keys = this.getKeysForDateSpan(dateSpan);\n\n        for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n          var key = keys_1[_i];\n          dateSpans[key] = dateSpan;\n        }\n      }\n\n      return dateSpans;\n    };\n\n    Splitter.prototype._getKeysForEventDefs = function (eventStore) {\n      var _this = this;\n\n      return mapHash(eventStore.defs, function (eventDef) {\n        return _this.getKeysForEventDef(eventDef);\n      });\n    };\n\n    Splitter.prototype._splitEventStore = function (eventStore, defKeys) {\n      var defs = eventStore.defs,\n          instances = eventStore.instances;\n      var splitStores = {};\n\n      for (var defId in defs) {\n        for (var _i = 0, _a = defKeys[defId]; _i < _a.length; _i++) {\n          var key = _a[_i];\n\n          if (!splitStores[key]) {\n            splitStores[key] = createEmptyEventStore();\n          }\n\n          splitStores[key].defs[defId] = defs[defId];\n        }\n      }\n\n      for (var instanceId in instances) {\n        var instance = instances[instanceId];\n\n        for (var _b = 0, _c = defKeys[instance.defId]; _b < _c.length; _b++) {\n          var key = _c[_b];\n\n          if (splitStores[key]) {\n            // must have already been created\n            splitStores[key].instances[instanceId] = instance;\n          }\n        }\n      }\n\n      return splitStores;\n    };\n\n    Splitter.prototype._splitIndividualUi = function (eventUiBases, defKeys) {\n      var splitHashes = {};\n\n      for (var defId in eventUiBases) {\n        if (defId) {\n          // not the '' key\n          for (var _i = 0, _a = defKeys[defId]; _i < _a.length; _i++) {\n            var key = _a[_i];\n\n            if (!splitHashes[key]) {\n              splitHashes[key] = {};\n            }\n\n            splitHashes[key][defId] = eventUiBases[defId];\n          }\n        }\n      }\n\n      return splitHashes;\n    };\n\n    Splitter.prototype._splitInteraction = function (interaction) {\n      var splitStates = {};\n\n      if (interaction) {\n        var affectedStores_1 = this._splitEventStore(interaction.affectedEvents, this._getKeysForEventDefs(interaction.affectedEvents) // can't use cached. might be events from other calendar\n        ); // can't rely on defKeys because event data is mutated\n\n\n        var mutatedKeysByDefId = this._getKeysForEventDefs(interaction.mutatedEvents);\n\n        var mutatedStores_1 = this._splitEventStore(interaction.mutatedEvents, mutatedKeysByDefId);\n\n        var populate = function populate(key) {\n          if (!splitStates[key]) {\n            splitStates[key] = {\n              affectedEvents: affectedStores_1[key] || EMPTY_EVENT_STORE,\n              mutatedEvents: mutatedStores_1[key] || EMPTY_EVENT_STORE,\n              isEvent: interaction.isEvent,\n              origSeg: interaction.origSeg\n            };\n          }\n        };\n\n        for (var key in affectedStores_1) {\n          populate(key);\n        }\n\n        for (var key in mutatedStores_1) {\n          populate(key);\n        }\n      }\n\n      return splitStates;\n    };\n\n    return Splitter;\n  }();\n\n  function buildEventUiForKey(allUi, eventUiForKey, individualUi) {\n    var baseParts = [];\n\n    if (allUi) {\n      baseParts.push(allUi);\n    }\n\n    if (eventUiForKey) {\n      baseParts.push(eventUiForKey);\n    }\n\n    var stuff = {\n      '': combineEventUis(baseParts)\n    };\n\n    if (individualUi) {\n      _assign(stuff, individualUi);\n    }\n\n    return stuff;\n  } // Generates HTML for an anchor to another view into the calendar.\n  // Will either generate an <a> tag or a non-clickable <span> tag, depending on enabled settings.\n  // `gotoOptions` can either be a DateMarker, or an object with the form:\n  // { date, type, forceOff }\n  // `type` is a view-type like \"day\" or \"week\". default value is \"day\".\n  // `attrs` and `innerHtml` are use to generate the rest of the HTML tag.\n\n\n  function buildGotoAnchorHtml(component, gotoOptions, attrs, innerHtml) {\n    var dateEnv = component.dateEnv;\n    var date;\n    var type;\n    var forceOff;\n    var finalOptions;\n\n    if (gotoOptions instanceof Date) {\n      date = gotoOptions; // a single date-like input\n    } else {\n      date = gotoOptions.date;\n      type = gotoOptions.type;\n      forceOff = gotoOptions.forceOff;\n    }\n\n    finalOptions = {\n      date: dateEnv.formatIso(date, {\n        omitTime: true\n      }),\n      type: type || 'day'\n    };\n\n    if (typeof attrs === 'string') {\n      innerHtml = attrs;\n      attrs = null;\n    }\n\n    attrs = attrs ? ' ' + attrsToStr(attrs) : ''; // will have a leading space\n\n    innerHtml = innerHtml || '';\n\n    if (!forceOff && component.opt('navLinks')) {\n      return '<a' + attrs + ' data-goto=\"' + htmlEscape(JSON.stringify(finalOptions)) + '\">' + innerHtml + '</a>';\n    } else {\n      return '<span' + attrs + '>' + innerHtml + '</span>';\n    }\n  }\n\n  function getAllDayHtml(component) {\n    return component.opt('allDayHtml') || htmlEscape(component.opt('allDayText'));\n  } // Computes HTML classNames for a single-day element\n\n\n  function getDayClasses(date, dateProfile, context, noThemeHighlight) {\n    var calendar = context.calendar,\n        view = context.view,\n        theme = context.theme,\n        dateEnv = context.dateEnv;\n    var classes = [];\n    var todayStart;\n    var todayEnd;\n\n    if (!rangeContainsMarker(dateProfile.activeRange, date)) {\n      classes.push('fc-disabled-day');\n    } else {\n      classes.push('fc-' + DAY_IDS[date.getUTCDay()]);\n\n      if (view.opt('monthMode') && dateEnv.getMonth(date) !== dateEnv.getMonth(dateProfile.currentRange.start)) {\n        classes.push('fc-other-month');\n      }\n\n      todayStart = startOfDay(calendar.getNow());\n      todayEnd = addDays(todayStart, 1);\n\n      if (date < todayStart) {\n        classes.push('fc-past');\n      } else if (date >= todayEnd) {\n        classes.push('fc-future');\n      } else {\n        classes.push('fc-today');\n\n        if (noThemeHighlight !== true) {\n          classes.push(theme.getClass('today'));\n        }\n      }\n    }\n\n    return classes;\n  } // given a function that resolves a result asynchronously.\n  // the function can either call passed-in success and failure callbacks,\n  // or it can return a promise.\n  // if you need to pass additional params to func, bind them first.\n\n\n  function unpromisify(func, success, failure) {\n    // guard against success/failure callbacks being called more than once\n    // and guard against a promise AND callback being used together.\n    var isResolved = false;\n\n    var wrappedSuccess = function wrappedSuccess() {\n      if (!isResolved) {\n        isResolved = true;\n        success.apply(this, arguments);\n      }\n    };\n\n    var wrappedFailure = function wrappedFailure() {\n      if (!isResolved) {\n        isResolved = true;\n\n        if (failure) {\n          failure.apply(this, arguments);\n        }\n      }\n    };\n\n    var res = func(wrappedSuccess, wrappedFailure);\n\n    if (res && typeof res.then === 'function') {\n      res.then(wrappedSuccess, wrappedFailure);\n    }\n  }\n\n  var Mixin =\n  /** @class */\n  function () {\n    function Mixin() {} // mix into a CLASS\n\n\n    Mixin.mixInto = function (destClass) {\n      this.mixIntoObj(destClass.prototype);\n    }; // mix into ANY object\n\n\n    Mixin.mixIntoObj = function (destObj) {\n      var _this = this;\n\n      Object.getOwnPropertyNames(this.prototype).forEach(function (name) {\n        if (!destObj[name]) {\n          // if destination doesn't already define it\n          destObj[name] = _this.prototype[name];\n        }\n      });\n    };\n    /*\n    will override existing methods\n    TODO: remove! not used anymore\n    */\n\n\n    Mixin.mixOver = function (destClass) {\n      var _this = this;\n\n      Object.getOwnPropertyNames(this.prototype).forEach(function (name) {\n        destClass.prototype[name] = _this.prototype[name];\n      });\n    };\n\n    return Mixin;\n  }();\n  /*\n  USAGE:\n    import { default as EmitterMixin, EmitterInterface } from './EmitterMixin'\n  in class:\n    on: EmitterInterface['on']\n    one: EmitterInterface['one']\n    off: EmitterInterface['off']\n    trigger: EmitterInterface['trigger']\n    triggerWith: EmitterInterface['triggerWith']\n    hasHandlers: EmitterInterface['hasHandlers']\n  after class:\n    EmitterMixin.mixInto(TheClass)\n  */\n\n\n  var EmitterMixin =\n  /** @class */\n  function (_super) {\n    __extends(EmitterMixin, _super);\n\n    function EmitterMixin() {\n      return _super !== null && _super.apply(this, arguments) || this;\n    }\n\n    EmitterMixin.prototype.on = function (type, handler) {\n      addToHash(this._handlers || (this._handlers = {}), type, handler);\n      return this; // for chaining\n    }; // todo: add comments\n\n\n    EmitterMixin.prototype.one = function (type, handler) {\n      addToHash(this._oneHandlers || (this._oneHandlers = {}), type, handler);\n      return this; // for chaining\n    };\n\n    EmitterMixin.prototype.off = function (type, handler) {\n      if (this._handlers) {\n        removeFromHash(this._handlers, type, handler);\n      }\n\n      if (this._oneHandlers) {\n        removeFromHash(this._oneHandlers, type, handler);\n      }\n\n      return this; // for chaining\n    };\n\n    EmitterMixin.prototype.trigger = function (type) {\n      var args = [];\n\n      for (var _i = 1; _i < arguments.length; _i++) {\n        args[_i - 1] = arguments[_i];\n      }\n\n      this.triggerWith(type, this, args);\n      return this; // for chaining\n    };\n\n    EmitterMixin.prototype.triggerWith = function (type, context, args) {\n      if (this._handlers) {\n        applyAll(this._handlers[type], context, args);\n      }\n\n      if (this._oneHandlers) {\n        applyAll(this._oneHandlers[type], context, args);\n        delete this._oneHandlers[type]; // will never fire again\n      }\n\n      return this; // for chaining\n    };\n\n    EmitterMixin.prototype.hasHandlers = function (type) {\n      return this._handlers && this._handlers[type] && this._handlers[type].length || this._oneHandlers && this._oneHandlers[type] && this._oneHandlers[type].length;\n    };\n\n    return EmitterMixin;\n  }(Mixin);\n\n  function addToHash(hash, type, handler) {\n    (hash[type] || (hash[type] = [])).push(handler);\n  }\n\n  function removeFromHash(hash, type, handler) {\n    if (handler) {\n      if (hash[type]) {\n        hash[type] = hash[type].filter(function (func) {\n          return func !== handler;\n        });\n      }\n    } else {\n      delete hash[type]; // remove all handler funcs for this type\n    }\n  }\n  /*\n  Records offset information for a set of elements, relative to an origin element.\n  Can record the left/right OR the top/bottom OR both.\n  Provides methods for querying the cache by position.\n  */\n\n\n  var PositionCache =\n  /** @class */\n  function () {\n    function PositionCache(originEl, els, isHorizontal, isVertical) {\n      this.originEl = originEl;\n      this.els = els;\n      this.isHorizontal = isHorizontal;\n      this.isVertical = isVertical;\n    } // Queries the els for coordinates and stores them.\n    // Call this method before using and of the get* methods below.\n\n\n    PositionCache.prototype.build = function () {\n      var originEl = this.originEl;\n      var originClientRect = this.originClientRect = originEl.getBoundingClientRect(); // relative to viewport top-left\n\n      if (this.isHorizontal) {\n        this.buildElHorizontals(originClientRect.left);\n      }\n\n      if (this.isVertical) {\n        this.buildElVerticals(originClientRect.top);\n      }\n    }; // Populates the left/right internal coordinate arrays\n\n\n    PositionCache.prototype.buildElHorizontals = function (originClientLeft) {\n      var lefts = [];\n      var rights = [];\n\n      for (var _i = 0, _a = this.els; _i < _a.length; _i++) {\n        var el = _a[_i];\n        var rect = el.getBoundingClientRect();\n        lefts.push(rect.left - originClientLeft);\n        rights.push(rect.right - originClientLeft);\n      }\n\n      this.lefts = lefts;\n      this.rights = rights;\n    }; // Populates the top/bottom internal coordinate arrays\n\n\n    PositionCache.prototype.buildElVerticals = function (originClientTop) {\n      var tops = [];\n      var bottoms = [];\n\n      for (var _i = 0, _a = this.els; _i < _a.length; _i++) {\n        var el = _a[_i];\n        var rect = el.getBoundingClientRect();\n        tops.push(rect.top - originClientTop);\n        bottoms.push(rect.bottom - originClientTop);\n      }\n\n      this.tops = tops;\n      this.bottoms = bottoms;\n    }; // Given a left offset (from document left), returns the index of the el that it horizontally intersects.\n    // If no intersection is made, returns undefined.\n\n\n    PositionCache.prototype.leftToIndex = function (leftPosition) {\n      var lefts = this.lefts;\n      var rights = this.rights;\n      var len = lefts.length;\n      var i;\n\n      for (i = 0; i < len; i++) {\n        if (leftPosition >= lefts[i] && leftPosition < rights[i]) {\n          return i;\n        }\n      }\n    }; // Given a top offset (from document top), returns the index of the el that it vertically intersects.\n    // If no intersection is made, returns undefined.\n\n\n    PositionCache.prototype.topToIndex = function (topPosition) {\n      var tops = this.tops;\n      var bottoms = this.bottoms;\n      var len = tops.length;\n      var i;\n\n      for (i = 0; i < len; i++) {\n        if (topPosition >= tops[i] && topPosition < bottoms[i]) {\n          return i;\n        }\n      }\n    }; // Gets the width of the element at the given index\n\n\n    PositionCache.prototype.getWidth = function (leftIndex) {\n      return this.rights[leftIndex] - this.lefts[leftIndex];\n    }; // Gets the height of the element at the given index\n\n\n    PositionCache.prototype.getHeight = function (topIndex) {\n      return this.bottoms[topIndex] - this.tops[topIndex];\n    };\n\n    return PositionCache;\n  }();\n  /*\n  An object for getting/setting scroll-related information for an element.\n  Internally, this is done very differently for window versus DOM element,\n  so this object serves as a common interface.\n  */\n\n\n  var ScrollController =\n  /** @class */\n  function () {\n    function ScrollController() {}\n\n    ScrollController.prototype.getMaxScrollTop = function () {\n      return this.getScrollHeight() - this.getClientHeight();\n    };\n\n    ScrollController.prototype.getMaxScrollLeft = function () {\n      return this.getScrollWidth() - this.getClientWidth();\n    };\n\n    ScrollController.prototype.canScrollVertically = function () {\n      return this.getMaxScrollTop() > 0;\n    };\n\n    ScrollController.prototype.canScrollHorizontally = function () {\n      return this.getMaxScrollLeft() > 0;\n    };\n\n    ScrollController.prototype.canScrollUp = function () {\n      return this.getScrollTop() > 0;\n    };\n\n    ScrollController.prototype.canScrollDown = function () {\n      return this.getScrollTop() < this.getMaxScrollTop();\n    };\n\n    ScrollController.prototype.canScrollLeft = function () {\n      return this.getScrollLeft() > 0;\n    };\n\n    ScrollController.prototype.canScrollRight = function () {\n      return this.getScrollLeft() < this.getMaxScrollLeft();\n    };\n\n    return ScrollController;\n  }();\n\n  var ElementScrollController =\n  /** @class */\n  function (_super) {\n    __extends(ElementScrollController, _super);\n\n    function ElementScrollController(el) {\n      var _this = _super.call(this) || this;\n\n      _this.el = el;\n      return _this;\n    }\n\n    ElementScrollController.prototype.getScrollTop = function () {\n      return this.el.scrollTop;\n    };\n\n    ElementScrollController.prototype.getScrollLeft = function () {\n      return this.el.scrollLeft;\n    };\n\n    ElementScrollController.prototype.setScrollTop = function (top) {\n      this.el.scrollTop = top;\n    };\n\n    ElementScrollController.prototype.setScrollLeft = function (left) {\n      this.el.scrollLeft = left;\n    };\n\n    ElementScrollController.prototype.getScrollWidth = function () {\n      return this.el.scrollWidth;\n    };\n\n    ElementScrollController.prototype.getScrollHeight = function () {\n      return this.el.scrollHeight;\n    };\n\n    ElementScrollController.prototype.getClientHeight = function () {\n      return this.el.clientHeight;\n    };\n\n    ElementScrollController.prototype.getClientWidth = function () {\n      return this.el.clientWidth;\n    };\n\n    return ElementScrollController;\n  }(ScrollController);\n\n  var WindowScrollController =\n  /** @class */\n  function (_super) {\n    __extends(WindowScrollController, _super);\n\n    function WindowScrollController() {\n      return _super !== null && _super.apply(this, arguments) || this;\n    }\n\n    WindowScrollController.prototype.getScrollTop = function () {\n      return window.pageYOffset;\n    };\n\n    WindowScrollController.prototype.getScrollLeft = function () {\n      return window.pageXOffset;\n    };\n\n    WindowScrollController.prototype.setScrollTop = function (n) {\n      window.scroll(window.pageXOffset, n);\n    };\n\n    WindowScrollController.prototype.setScrollLeft = function (n) {\n      window.scroll(n, window.pageYOffset);\n    };\n\n    WindowScrollController.prototype.getScrollWidth = function () {\n      return document.documentElement.scrollWidth;\n    };\n\n    WindowScrollController.prototype.getScrollHeight = function () {\n      return document.documentElement.scrollHeight;\n    };\n\n    WindowScrollController.prototype.getClientHeight = function () {\n      return document.documentElement.clientHeight;\n    };\n\n    WindowScrollController.prototype.getClientWidth = function () {\n      return document.documentElement.clientWidth;\n    };\n\n    return WindowScrollController;\n  }(ScrollController);\n  /*\n  Embodies a div that has potential scrollbars\n  */\n\n\n  var ScrollComponent =\n  /** @class */\n  function (_super) {\n    __extends(ScrollComponent, _super);\n\n    function ScrollComponent(overflowX, overflowY) {\n      var _this = _super.call(this, createElement('div', {\n        className: 'fc-scroller'\n      })) || this;\n\n      _this.overflowX = overflowX;\n      _this.overflowY = overflowY;\n\n      _this.applyOverflow();\n\n      return _this;\n    } // sets to natural height, unlocks overflow\n\n\n    ScrollComponent.prototype.clear = function () {\n      this.setHeight('auto');\n      this.applyOverflow();\n    };\n\n    ScrollComponent.prototype.destroy = function () {\n      removeElement(this.el);\n    }; // Overflow\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    ScrollComponent.prototype.applyOverflow = function () {\n      applyStyle(this.el, {\n        overflowX: this.overflowX,\n        overflowY: this.overflowY\n      });\n    }; // Causes any 'auto' overflow values to resolves to 'scroll' or 'hidden'.\n    // Useful for preserving scrollbar widths regardless of future resizes.\n    // Can pass in scrollbarWidths for optimization.\n\n\n    ScrollComponent.prototype.lockOverflow = function (scrollbarWidths) {\n      var overflowX = this.overflowX;\n      var overflowY = this.overflowY;\n      scrollbarWidths = scrollbarWidths || this.getScrollbarWidths();\n\n      if (overflowX === 'auto') {\n        overflowX = scrollbarWidths.bottom || // horizontal scrollbars?\n        this.canScrollHorizontally() // OR scrolling pane with massless scrollbars?\n        ? 'scroll' : 'hidden';\n      }\n\n      if (overflowY === 'auto') {\n        overflowY = scrollbarWidths.left || scrollbarWidths.right || // horizontal scrollbars?\n        this.canScrollVertically() // OR scrolling pane with massless scrollbars?\n        ? 'scroll' : 'hidden';\n      }\n\n      applyStyle(this.el, {\n        overflowX: overflowX,\n        overflowY: overflowY\n      });\n    };\n\n    ScrollComponent.prototype.setHeight = function (height) {\n      applyStyleProp(this.el, 'height', height);\n    };\n\n    ScrollComponent.prototype.getScrollbarWidths = function () {\n      var edges = computeEdges(this.el);\n      return {\n        left: edges.scrollbarLeft,\n        right: edges.scrollbarRight,\n        bottom: edges.scrollbarBottom\n      };\n    };\n\n    return ScrollComponent;\n  }(ElementScrollController);\n\n  var Theme =\n  /** @class */\n  function () {\n    function Theme(calendarOptions) {\n      this.calendarOptions = calendarOptions;\n      this.processIconOverride();\n    }\n\n    Theme.prototype.processIconOverride = function () {\n      if (this.iconOverrideOption) {\n        this.setIconOverride(this.calendarOptions[this.iconOverrideOption]);\n      }\n    };\n\n    Theme.prototype.setIconOverride = function (iconOverrideHash) {\n      var iconClassesCopy;\n      var buttonName;\n\n      if (typeof iconOverrideHash === 'object' && iconOverrideHash) {\n        // non-null object\n        iconClassesCopy = _assign({}, this.iconClasses);\n\n        for (buttonName in iconOverrideHash) {\n          iconClassesCopy[buttonName] = this.applyIconOverridePrefix(iconOverrideHash[buttonName]);\n        }\n\n        this.iconClasses = iconClassesCopy;\n      } else if (iconOverrideHash === false) {\n        this.iconClasses = {};\n      }\n    };\n\n    Theme.prototype.applyIconOverridePrefix = function (className) {\n      var prefix = this.iconOverridePrefix;\n\n      if (prefix && className.indexOf(prefix) !== 0) {\n        // if not already present\n        className = prefix + className;\n      }\n\n      return className;\n    };\n\n    Theme.prototype.getClass = function (key) {\n      return this.classes[key] || '';\n    };\n\n    Theme.prototype.getIconClass = function (buttonName) {\n      var className = this.iconClasses[buttonName];\n\n      if (className) {\n        return this.baseIconClass + ' ' + className;\n      }\n\n      return '';\n    };\n\n    Theme.prototype.getCustomButtonIconClass = function (customButtonProps) {\n      var className;\n\n      if (this.iconOverrideCustomButtonOption) {\n        className = customButtonProps[this.iconOverrideCustomButtonOption];\n\n        if (className) {\n          return this.baseIconClass + ' ' + this.applyIconOverridePrefix(className);\n        }\n      }\n\n      return '';\n    };\n\n    return Theme;\n  }();\n\n  Theme.prototype.classes = {};\n  Theme.prototype.iconClasses = {};\n  Theme.prototype.baseIconClass = '';\n  Theme.prototype.iconOverridePrefix = '';\n  var guid = 0;\n\n  var Component =\n  /** @class */\n  function () {\n    function Component(context, isView) {\n      // HACK to populate view at top of component instantiation call chain\n      if (isView) {\n        context.view = this;\n      }\n\n      this.uid = String(guid++);\n      this.context = context;\n      this.dateEnv = context.dateEnv;\n      this.theme = context.theme;\n      this.view = context.view;\n      this.calendar = context.calendar;\n      this.isRtl = this.opt('dir') === 'rtl';\n    }\n\n    Component.addEqualityFuncs = function (newFuncs) {\n      this.prototype.equalityFuncs = _assign({}, this.prototype.equalityFuncs, newFuncs);\n    };\n\n    Component.prototype.opt = function (name) {\n      return this.context.options[name];\n    };\n\n    Component.prototype.receiveProps = function (props) {\n      var _a = recycleProps(this.props || {}, props, this.equalityFuncs),\n          anyChanges = _a.anyChanges,\n          comboProps = _a.comboProps;\n\n      this.props = comboProps;\n\n      if (anyChanges) {\n        this.render(comboProps);\n      }\n    };\n\n    Component.prototype.render = function (props) {}; // after destroy is called, this component won't ever be used again\n\n\n    Component.prototype.destroy = function () {};\n\n    return Component;\n  }();\n\n  Component.prototype.equalityFuncs = {};\n  /*\n  Reuses old values when equal. If anything is unequal, returns newProps as-is.\n  Great for PureComponent, but won't be feasible with React, so just eliminate and use React's DOM diffing.\n  */\n\n  function recycleProps(oldProps, newProps, equalityFuncs) {\n    var comboProps = {}; // some old, some new\n\n    var anyChanges = false;\n\n    for (var key in newProps) {\n      if (key in oldProps && (oldProps[key] === newProps[key] || equalityFuncs[key] && equalityFuncs[key](oldProps[key], newProps[key]))) {\n        // equal to old? use old prop\n        comboProps[key] = oldProps[key];\n      } else {\n        comboProps[key] = newProps[key];\n        anyChanges = true;\n      }\n    }\n\n    for (var key in oldProps) {\n      if (!(key in newProps)) {\n        anyChanges = true;\n        break;\n      }\n    }\n\n    return {\n      anyChanges: anyChanges,\n      comboProps: comboProps\n    };\n  }\n  /*\n  PURPOSES:\n  - hook up to fg, fill, and mirror renderers\n  - interface for dragging and hits\n  */\n\n\n  var DateComponent =\n  /** @class */\n  function (_super) {\n    __extends(DateComponent, _super);\n\n    function DateComponent(context, el, isView) {\n      var _this = _super.call(this, context, isView) || this;\n\n      _this.el = el;\n      return _this;\n    }\n\n    DateComponent.prototype.destroy = function () {\n      _super.prototype.destroy.call(this);\n\n      removeElement(this.el);\n    }; // TODO: WHAT ABOUT (sourceSeg && sourceSeg.component.doesDragMirror)\n    //\n    // Event Drag-n-Drop Rendering (for both events and external elements)\n    // ---------------------------------------------------------------------------------------------------------------\n\n    /*\n    renderEventDragSegs(state: EventSegUiInteractionState) {\n      if (state) {\n        let { isEvent, segs, sourceSeg } = state\n               if (this.eventRenderer) {\n          this.eventRenderer.hideByHash(state.affectedInstances)\n        }\n               // if the user is dragging something that is considered an event with real event data,\n        // and this component likes to do drag mirrors OR the component where the seg came from\n        // likes to do drag mirrors, then render a drag mirror.\n        if (isEvent && (this.doesDragMirror || sourceSeg && sourceSeg.component.doesDragMirror)) {\n          if (this.mirrorRenderer) {\n            this.mirrorRenderer.renderSegs(segs, { isDragging: true, sourceSeg })\n          }\n        }\n               // if it would be impossible to render a drag mirror OR this component likes to render\n        // highlights, then render a highlight.\n        if (!isEvent || this.doesDragHighlight) {\n          if (this.fillRenderer) {\n            this.fillRenderer.renderSegs('highlight', segs)\n          }\n        }\n      }\n    }\n    */\n    // Hit System\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    DateComponent.prototype.queryHit = function (positionLeft, positionTop, elWidth, elHeight) {\n      return null; // this should be abstract\n    }; // Validation\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    DateComponent.prototype.isInteractionValid = function (interaction) {\n      var calendar = this.calendar;\n      var dateProfile = this.props.dateProfile; // HACK\n\n      var instances = interaction.mutatedEvents.instances;\n\n      if (dateProfile) {\n        // HACK for DayTile\n        for (var instanceId in instances) {\n          if (!rangeContainsRange(dateProfile.validRange, instances[instanceId].range)) {\n            return false;\n          }\n        }\n      }\n\n      return isInteractionValid(interaction, calendar);\n    };\n\n    DateComponent.prototype.isDateSelectionValid = function (selection) {\n      var dateProfile = this.props.dateProfile; // HACK\n\n      if (dateProfile && // HACK for DayTile\n      !rangeContainsRange(dateProfile.validRange, selection.range)) {\n        return false;\n      }\n\n      return isDateSelectionValid(selection, this.calendar);\n    }; // Triggering\n    // -----------------------------------------------------------------------------------------------------------------\n    // TODO: move to Calendar\n\n\n    DateComponent.prototype.publiclyTrigger = function (name, args) {\n      var calendar = this.calendar;\n      return calendar.publiclyTrigger(name, args);\n    };\n\n    DateComponent.prototype.publiclyTriggerAfterSizing = function (name, args) {\n      var calendar = this.calendar;\n      return calendar.publiclyTriggerAfterSizing(name, args);\n    };\n\n    DateComponent.prototype.hasPublicHandlers = function (name) {\n      var calendar = this.calendar;\n      return calendar.hasPublicHandlers(name);\n    };\n\n    DateComponent.prototype.triggerRenderedSegs = function (segs, isMirrors) {\n      var calendar = this.calendar;\n\n      if (this.hasPublicHandlers('eventPositioned')) {\n        for (var _i = 0, segs_1 = segs; _i < segs_1.length; _i++) {\n          var seg = segs_1[_i];\n          this.publiclyTriggerAfterSizing('eventPositioned', [{\n            event: new EventApi(calendar, seg.eventRange.def, seg.eventRange.instance),\n            isMirror: isMirrors,\n            isStart: seg.isStart,\n            isEnd: seg.isEnd,\n            el: seg.el,\n            view: this // ?\n\n          }]);\n        }\n      }\n\n      if (!calendar.state.loadingLevel) {\n        // avoid initial empty state while pending\n        calendar.afterSizingTriggers._eventsPositioned = [null]; // fire once\n      }\n    };\n\n    DateComponent.prototype.triggerWillRemoveSegs = function (segs, isMirrors) {\n      var calendar = this.calendar;\n\n      for (var _i = 0, segs_2 = segs; _i < segs_2.length; _i++) {\n        var seg = segs_2[_i];\n        calendar.trigger('eventElRemove', seg.el);\n      }\n\n      if (this.hasPublicHandlers('eventDestroy')) {\n        for (var _a = 0, segs_3 = segs; _a < segs_3.length; _a++) {\n          var seg = segs_3[_a];\n          this.publiclyTrigger('eventDestroy', [{\n            event: new EventApi(calendar, seg.eventRange.def, seg.eventRange.instance),\n            isMirror: isMirrors,\n            el: seg.el,\n            view: this // ?\n\n          }]);\n        }\n      }\n    }; // Pointer Interaction Utils\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    DateComponent.prototype.isValidSegDownEl = function (el) {\n      return !this.props.eventDrag && // HACK\n      !this.props.eventResize && // HACK\n      !elementClosest(el, '.fc-mirror') && !this.isInPopover(el); // how to determine if not in a sub-component???\n    };\n\n    DateComponent.prototype.isValidDateDownEl = function (el) {\n      var segEl = elementClosest(el, this.fgSegSelector);\n      return (!segEl || segEl.classList.contains('fc-mirror')) && !elementClosest(el, '.fc-more') && // a \"more..\" link\n      !elementClosest(el, 'a[data-goto]') && // a clickable nav link\n      !this.isInPopover(el);\n    }; // is the element inside of an inner popover?\n\n\n    DateComponent.prototype.isInPopover = function (el) {\n      var popoverEl = elementClosest(el, '.fc-popover');\n      return popoverEl && popoverEl !== this.el; // if the current component IS a popover, okay\n    };\n\n    return DateComponent;\n  }(Component);\n\n  DateComponent.prototype.fgSegSelector = '.fc-event-container > *';\n  DateComponent.prototype.bgSegSelector = '.fc-bgevent:not(.fc-nonbusiness)';\n  var uid$1 = 0;\n\n  function createPlugin(input) {\n    return {\n      id: String(uid$1++),\n      deps: input.deps || [],\n      reducers: input.reducers || [],\n      eventDefParsers: input.eventDefParsers || [],\n      eventDragMutationMassagers: input.eventDragMutationMassagers || [],\n      eventDefMutationAppliers: input.eventDefMutationAppliers || [],\n      dateSelectionTransformers: input.dateSelectionTransformers || [],\n      datePointTransforms: input.datePointTransforms || [],\n      dateSpanTransforms: input.dateSpanTransforms || [],\n      views: input.views || {},\n      viewPropsTransformers: input.viewPropsTransformers || [],\n      isPropsValid: input.isPropsValid || null,\n      externalDefTransforms: input.externalDefTransforms || [],\n      eventResizeJoinTransforms: input.eventResizeJoinTransforms || [],\n      viewContainerModifiers: input.viewContainerModifiers || [],\n      eventDropTransformers: input.eventDropTransformers || [],\n      componentInteractions: input.componentInteractions || [],\n      calendarInteractions: input.calendarInteractions || [],\n      themeClasses: input.themeClasses || {},\n      eventSourceDefs: input.eventSourceDefs || [],\n      cmdFormatter: input.cmdFormatter,\n      recurringTypes: input.recurringTypes || [],\n      namedTimeZonedImpl: input.namedTimeZonedImpl,\n      defaultView: input.defaultView || '',\n      elementDraggingImpl: input.elementDraggingImpl\n    };\n  }\n\n  var PluginSystem =\n  /** @class */\n  function () {\n    function PluginSystem() {\n      this.hooks = {\n        reducers: [],\n        eventDefParsers: [],\n        eventDragMutationMassagers: [],\n        eventDefMutationAppliers: [],\n        dateSelectionTransformers: [],\n        datePointTransforms: [],\n        dateSpanTransforms: [],\n        views: {},\n        viewPropsTransformers: [],\n        isPropsValid: null,\n        externalDefTransforms: [],\n        eventResizeJoinTransforms: [],\n        viewContainerModifiers: [],\n        eventDropTransformers: [],\n        componentInteractions: [],\n        calendarInteractions: [],\n        themeClasses: {},\n        eventSourceDefs: [],\n        cmdFormatter: null,\n        recurringTypes: [],\n        namedTimeZonedImpl: null,\n        defaultView: '',\n        elementDraggingImpl: null\n      };\n      this.addedHash = {};\n    }\n\n    PluginSystem.prototype.add = function (plugin) {\n      if (!this.addedHash[plugin.id]) {\n        this.addedHash[plugin.id] = true;\n\n        for (var _i = 0, _a = plugin.deps; _i < _a.length; _i++) {\n          var dep = _a[_i];\n          this.add(dep);\n        }\n\n        this.hooks = combineHooks(this.hooks, plugin);\n      }\n    };\n\n    return PluginSystem;\n  }();\n\n  function combineHooks(hooks0, hooks1) {\n    return {\n      reducers: hooks0.reducers.concat(hooks1.reducers),\n      eventDefParsers: hooks0.eventDefParsers.concat(hooks1.eventDefParsers),\n      eventDragMutationMassagers: hooks0.eventDragMutationMassagers.concat(hooks1.eventDragMutationMassagers),\n      eventDefMutationAppliers: hooks0.eventDefMutationAppliers.concat(hooks1.eventDefMutationAppliers),\n      dateSelectionTransformers: hooks0.dateSelectionTransformers.concat(hooks1.dateSelectionTransformers),\n      datePointTransforms: hooks0.datePointTransforms.concat(hooks1.datePointTransforms),\n      dateSpanTransforms: hooks0.dateSpanTransforms.concat(hooks1.dateSpanTransforms),\n      views: _assign({}, hooks0.views, hooks1.views),\n      viewPropsTransformers: hooks0.viewPropsTransformers.concat(hooks1.viewPropsTransformers),\n      isPropsValid: hooks1.isPropsValid || hooks0.isPropsValid,\n      externalDefTransforms: hooks0.externalDefTransforms.concat(hooks1.externalDefTransforms),\n      eventResizeJoinTransforms: hooks0.eventResizeJoinTransforms.concat(hooks1.eventResizeJoinTransforms),\n      viewContainerModifiers: hooks0.viewContainerModifiers.concat(hooks1.viewContainerModifiers),\n      eventDropTransformers: hooks0.eventDropTransformers.concat(hooks1.eventDropTransformers),\n      calendarInteractions: hooks0.calendarInteractions.concat(hooks1.calendarInteractions),\n      componentInteractions: hooks0.componentInteractions.concat(hooks1.componentInteractions),\n      themeClasses: _assign({}, hooks0.themeClasses, hooks1.themeClasses),\n      eventSourceDefs: hooks0.eventSourceDefs.concat(hooks1.eventSourceDefs),\n      cmdFormatter: hooks1.cmdFormatter || hooks0.cmdFormatter,\n      recurringTypes: hooks0.recurringTypes.concat(hooks1.recurringTypes),\n      namedTimeZonedImpl: hooks1.namedTimeZonedImpl || hooks0.namedTimeZonedImpl,\n      defaultView: hooks0.defaultView || hooks1.defaultView,\n      elementDraggingImpl: hooks0.elementDraggingImpl || hooks1.elementDraggingImpl // \"\n\n    };\n  }\n\n  var eventSourceDef = {\n    ignoreRange: true,\n    parseMeta: function parseMeta(raw) {\n      if (Array.isArray(raw)) {\n        // short form\n        return raw;\n      } else if (Array.isArray(raw.events)) {\n        return raw.events;\n      }\n\n      return null;\n    },\n    fetch: function fetch(arg, success) {\n      success({\n        rawEvents: arg.eventSource.meta\n      });\n    }\n  };\n  var ArrayEventSourcePlugin = createPlugin({\n    eventSourceDefs: [eventSourceDef]\n  });\n  var eventSourceDef$1 = {\n    parseMeta: function parseMeta(raw) {\n      if (typeof raw === 'function') {\n        // short form\n        return raw;\n      } else if (typeof raw.events === 'function') {\n        return raw.events;\n      }\n\n      return null;\n    },\n    fetch: function fetch(arg, success, failure) {\n      var dateEnv = arg.calendar.dateEnv;\n      var func = arg.eventSource.meta;\n      unpromisify(func.bind(null, {\n        start: dateEnv.toDate(arg.range.start),\n        end: dateEnv.toDate(arg.range.end),\n        startStr: dateEnv.formatIso(arg.range.start),\n        endStr: dateEnv.formatIso(arg.range.end),\n        timeZone: dateEnv.timeZone\n      }), function (rawEvents) {\n        success({\n          rawEvents: rawEvents\n        }); // needs an object response\n      }, failure // send errorObj directly to failure callback\n      );\n    }\n  };\n  var FuncEventSourcePlugin = createPlugin({\n    eventSourceDefs: [eventSourceDef$1]\n  });\n\n  function requestJson(method, url, params, successCallback, failureCallback) {\n    method = method.toUpperCase();\n    var body = null;\n\n    if (method === 'GET') {\n      url = injectQueryStringParams(url, params);\n    } else {\n      body = encodeParams(params);\n    }\n\n    var xhr = new XMLHttpRequest();\n    xhr.open(method, url, true);\n\n    if (method !== 'GET') {\n      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n    }\n\n    xhr.onload = function () {\n      if (xhr.status >= 200 && xhr.status < 400) {\n        try {\n          var res = JSON.parse(xhr.responseText);\n          successCallback(res, xhr);\n        } catch (err) {\n          failureCallback('Failure parsing JSON', xhr);\n        }\n      } else {\n        failureCallback('Request failed', xhr);\n      }\n    };\n\n    xhr.onerror = function () {\n      failureCallback('Request failed', xhr);\n    };\n\n    xhr.send(body);\n  }\n\n  function injectQueryStringParams(url, params) {\n    return url + (url.indexOf('?') === -1 ? '?' : '&') + encodeParams(params);\n  }\n\n  function encodeParams(params) {\n    var parts = [];\n\n    for (var key in params) {\n      parts.push(encodeURIComponent(key) + '=' + encodeURIComponent(params[key]));\n    }\n\n    return parts.join('&');\n  }\n\n  var eventSourceDef$2 = {\n    parseMeta: function parseMeta(raw) {\n      if (typeof raw === 'string') {\n        // short form\n        raw = {\n          url: raw\n        };\n      } else if (!raw || typeof raw !== 'object' || !raw.url) {\n        return null;\n      }\n\n      return {\n        url: raw.url,\n        method: (raw.method || 'GET').toUpperCase(),\n        extraParams: raw.extraParams,\n        startParam: raw.startParam,\n        endParam: raw.endParam,\n        timeZoneParam: raw.timeZoneParam\n      };\n    },\n    fetch: function fetch(arg, success, failure) {\n      var meta = arg.eventSource.meta;\n      var requestParams = buildRequestParams(meta, arg.range, arg.calendar);\n      requestJson(meta.method, meta.url, requestParams, function (rawEvents, xhr) {\n        success({\n          rawEvents: rawEvents,\n          xhr: xhr\n        });\n      }, function (errorMessage, xhr) {\n        failure({\n          message: errorMessage,\n          xhr: xhr\n        });\n      });\n    }\n  };\n  var JsonFeedEventSourcePlugin = createPlugin({\n    eventSourceDefs: [eventSourceDef$2]\n  });\n\n  function buildRequestParams(meta, range, calendar) {\n    var dateEnv = calendar.dateEnv;\n    var startParam;\n    var endParam;\n    var timeZoneParam;\n    var customRequestParams;\n    var params = {};\n    startParam = meta.startParam;\n\n    if (startParam == null) {\n      startParam = calendar.opt('startParam');\n    }\n\n    endParam = meta.endParam;\n\n    if (endParam == null) {\n      endParam = calendar.opt('endParam');\n    }\n\n    timeZoneParam = meta.timeZoneParam;\n\n    if (timeZoneParam == null) {\n      timeZoneParam = calendar.opt('timeZoneParam');\n    } // retrieve any outbound GET/POST data from the options\n\n\n    if (typeof meta.extraParams === 'function') {\n      // supplied as a function that returns a key/value object\n      customRequestParams = meta.extraParams();\n    } else {\n      // probably supplied as a straight key/value object\n      customRequestParams = meta.extraParams || {};\n    }\n\n    _assign(params, customRequestParams);\n\n    params[startParam] = dateEnv.formatIso(range.start);\n    params[endParam] = dateEnv.formatIso(range.end);\n\n    if (dateEnv.timeZone !== 'local') {\n      params[timeZoneParam] = dateEnv.timeZone;\n    }\n\n    return params;\n  }\n\n  var recurring = {\n    parse: function parse(rawEvent, allDayDefault, leftoverProps, dateEnv) {\n      var createMarker = dateEnv.createMarker.bind(dateEnv);\n      var processors = {\n        daysOfWeek: null,\n        startTime: createDuration,\n        endTime: createDuration,\n        startRecur: createMarker,\n        endRecur: createMarker\n      };\n      var props = refineProps(rawEvent, processors, {}, leftoverProps);\n      var anyValid = false;\n\n      for (var propName in props) {\n        if (props[propName] != null) {\n          anyValid = true;\n          break;\n        }\n      }\n\n      var allDay;\n\n      if (props.startTime || props.endTime) {\n        allDay = false;\n      } else if (allDayDefault != null) {\n        allDay = allDayDefault;\n      } else {\n        allDay = true;\n      }\n\n      if (anyValid) {\n        return {\n          allDay: allDay,\n          duration: props.startTime && props.endTime ? subtractDurations(props.endTime, props.startTime) : null,\n          typeData: props // doesn't need endTime anymore but oh well\n\n        };\n      }\n\n      return null;\n    },\n    expand: function expand(typeData, eventDef, framingRange, dateEnv) {\n      var clippedFramingRange = intersectRanges(framingRange, {\n        start: typeData.startRecur,\n        end: typeData.endRecur\n      });\n\n      if (clippedFramingRange) {\n        return expandRanges(typeData.daysOfWeek, typeData.startTime, clippedFramingRange, dateEnv);\n      } else {\n        return [];\n      }\n    }\n  };\n  var SimpleRecurrencePlugin = createPlugin({\n    recurringTypes: [recurring]\n  });\n\n  function expandRanges(daysOfWeek, startTime, framingRange, dateEnv) {\n    var dowHash = daysOfWeek ? arrayToHash(daysOfWeek) : null;\n    var dayMarker = startOfDay(framingRange.start);\n    var endMarker = framingRange.end;\n    var instanceStarts = [];\n\n    while (dayMarker < endMarker) {\n      var instanceStart // if everyday, or this particular day-of-week\n      = void 0; // if everyday, or this particular day-of-week\n\n      if (!dowHash || dowHash[dayMarker.getUTCDay()]) {\n        if (startTime) {\n          instanceStart = dateEnv.add(dayMarker, startTime);\n        } else {\n          instanceStart = dayMarker;\n        }\n\n        instanceStarts.push(instanceStart);\n      }\n\n      dayMarker = addDays(dayMarker, 1);\n    }\n\n    return instanceStarts;\n  }\n\n  var config = {}; // TODO: make these options\n\n  var globalDefaults = {\n    defaultRangeSeparator: ' - ',\n    titleRangeSeparator: \" \\u2013 \",\n    defaultTimedEventDuration: '01:00:00',\n    defaultAllDayEventDuration: {\n      day: 1\n    },\n    forceEventDuration: false,\n    nextDayThreshold: '00:00:00',\n    // display\n    columnHeader: true,\n    defaultView: '',\n    aspectRatio: 1.35,\n    header: {\n      left: 'title',\n      center: '',\n      right: 'today prev,next'\n    },\n    weekends: true,\n    weekNumbers: false,\n    weekNumberCalculation: 'local',\n    editable: false,\n    // nowIndicator: false,\n    scrollTime: '06:00:00',\n    minTime: '00:00:00',\n    maxTime: '24:00:00',\n    showNonCurrentDates: true,\n    // event ajax\n    lazyFetching: true,\n    startParam: 'start',\n    endParam: 'end',\n    timeZoneParam: 'timeZone',\n    timeZone: 'local',\n    // allDayDefault: undefined,\n    // locale\n    locales: [],\n    locale: '',\n    // dir: will get this from the default locale\n    // buttonIcons: null,\n    // allows setting a min-height to the event segment to prevent short events overlapping each other\n    timeGridEventMinHeight: 0,\n    themeSystem: 'standard',\n    // eventResizableFromStart: false,\n    dragRevertDuration: 500,\n    dragScroll: true,\n    allDayMaintainDuration: false,\n    // selectable: false,\n    unselectAuto: true,\n    // selectMinDistance: 0,\n    dropAccept: '*',\n    eventOrder: 'start,-duration,allDay,title',\n    // ^ if start tie, longer events go before shorter. final tie-breaker is title text\n    // rerenderDelay: null,\n    eventLimit: false,\n    eventLimitClick: 'popover',\n    dayPopoverFormat: {\n      month: 'long',\n      day: 'numeric',\n      year: 'numeric'\n    },\n    handleWindowResize: true,\n    windowResizeDelay: 100,\n    longPressDelay: 1000,\n    eventDragMinDistance: 5 // only applies to mouse\n\n  };\n  var rtlDefaults = {\n    header: {\n      left: 'next,prev today',\n      center: '',\n      right: 'title'\n    },\n    buttonIcons: {\n      // TODO: make RTL support the responibility of the theme\n      prev: 'fc-icon-chevron-right',\n      next: 'fc-icon-chevron-left',\n      prevYear: 'fc-icon-chevrons-right',\n      nextYear: 'fc-icon-chevrons-left'\n    }\n  };\n  var complexOptions = ['header', 'footer', 'buttonText', 'buttonIcons']; // Merges an array of option objects into a single object\n\n  function mergeOptions(optionObjs) {\n    return mergeProps(optionObjs, complexOptions);\n  } // TODO: move this stuff to a \"plugin\"-related file...\n\n\n  var INTERNAL_PLUGINS = [ArrayEventSourcePlugin, FuncEventSourcePlugin, JsonFeedEventSourcePlugin, SimpleRecurrencePlugin];\n\n  function refinePluginDefs(pluginInputs) {\n    var plugins = [];\n\n    for (var _i = 0, pluginInputs_1 = pluginInputs; _i < pluginInputs_1.length; _i++) {\n      var pluginInput = pluginInputs_1[_i];\n\n      if (typeof pluginInput === 'string') {\n        var globalName = 'FullCalendar' + capitaliseFirstLetter(pluginInput);\n\n        if (!window[globalName]) {\n          console.warn('Plugin file not loaded for ' + pluginInput);\n        } else {\n          plugins.push(window[globalName].default); // is an ES6 module\n        }\n      } else {\n        plugins.push(pluginInput);\n      }\n    }\n\n    return INTERNAL_PLUGINS.concat(plugins);\n  }\n\n  var RAW_EN_LOCALE = {\n    code: 'en',\n    week: {\n      dow: 0,\n      doy: 4 // 4 days need to be within the year to be considered the first week\n\n    },\n    dir: 'ltr',\n    buttonText: {\n      prev: 'prev',\n      next: 'next',\n      prevYear: 'prev year',\n      nextYear: 'next year',\n      year: 'year',\n      today: 'today',\n      month: 'month',\n      week: 'week',\n      day: 'day',\n      list: 'list'\n    },\n    weekLabel: 'W',\n    allDayText: 'all-day',\n    eventLimitText: 'more',\n    noEventsMessage: 'No events to display'\n  };\n\n  function parseRawLocales(inputPlural) {\n    var globalArray = window['FullCalendarLocalesAll'] || [];\n    var globalMap = window['FullCalendarLocales'] || {};\n    var rawLocaleArray = [];\n\n    for (var _i = 0, inputPlural_1 = inputPlural; _i < inputPlural_1.length; _i++) {\n      var inputItem = inputPlural_1[_i];\n\n      if (typeof inputItem === 'string') {\n        if (globalMap[inputItem]) {\n          rawLocaleArray.push(globalMap[inputItem]);\n        } else {\n          console.warn('You must have ' + inputItem + '.js locale file loaded.');\n        }\n      } else {\n        rawLocaleArray.push(inputItem);\n      }\n    }\n\n    var defaultCode = rawLocaleArray.length ? rawLocaleArray[0].code : 'en';\n    var rawLocaleMap = {\n      en: RAW_EN_LOCALE\n    };\n\n    for (var _a = 0, _b = rawLocaleArray.concat(globalArray); _a < _b.length; _a++) {\n      var rawLocale = _b[_a];\n      rawLocaleMap[rawLocale.code] = rawLocale;\n    }\n\n    return {\n      map: rawLocaleMap,\n      defaultCode: defaultCode\n    };\n  }\n\n  function buildLocale(inputSingular, available) {\n    if (typeof inputSingular === 'object' && !Array.isArray(inputSingular)) {\n      return parseLocale(inputSingular.code, [inputSingular.code], inputSingular);\n    } else {\n      return queryLocale(inputSingular, available);\n    }\n  }\n\n  function queryLocale(codeArg, available) {\n    var codes = [].concat(codeArg || []); // will convert to array\n\n    var raw = queryRawLocale(codes, available) || RAW_EN_LOCALE;\n    return parseLocale(codeArg, codes, raw);\n  }\n\n  function queryRawLocale(codes, available) {\n    for (var i = 0; i < codes.length; i++) {\n      var parts = codes[i].toLocaleLowerCase().split('-');\n\n      for (var j = parts.length; j > 0; j--) {\n        var simpleId = parts.slice(0, j).join('-');\n\n        if (available[simpleId]) {\n          return available[simpleId];\n        }\n      }\n    }\n\n    return null;\n  }\n\n  function parseLocale(codeArg, codes, raw) {\n    var merged = mergeProps([RAW_EN_LOCALE, raw], ['buttonText']);\n    delete merged.code; // don't want this part of the options\n\n    var week = merged.week;\n    delete merged.week;\n    return {\n      codeArg: codeArg,\n      codes: codes,\n      week: week,\n      simpleNumberFormat: new Intl.NumberFormat(codeArg),\n      options: merged\n    };\n  }\n\n  var OptionsManager =\n  /** @class */\n  function () {\n    function OptionsManager(overrides) {\n      this.overrides = _assign({}, overrides); // make a copy\n\n      this.dynamicOverrides = {};\n      this.compute();\n    }\n\n    OptionsManager.prototype.add = function (name, value) {\n      this.dynamicOverrides[name] = value;\n      this.compute();\n    }; // Computes the flattened options hash for the calendar and assigns to `this.options`.\n    // Assumes this.overrides and this.dynamicOverrides have already been initialized.\n\n\n    OptionsManager.prototype.compute = function () {\n      // TODO: not a very efficient system\n      var locales = firstDefined( // explicit locale option given?\n      this.dynamicOverrides.locales, this.overrides.locales, globalDefaults.locales);\n      var locale = firstDefined( // explicit locales option given?\n      this.dynamicOverrides.locale, this.overrides.locale, globalDefaults.locale);\n      var available = parseRawLocales(locales);\n      var localeDefaults = buildLocale(locale || available.defaultCode, available.map).options;\n      var dir = firstDefined( // based on options computed so far, is direction RTL?\n      this.dynamicOverrides.dir, this.overrides.dir, localeDefaults.dir);\n      var dirDefaults = dir === 'rtl' ? rtlDefaults : {};\n      this.dirDefaults = dirDefaults;\n      this.localeDefaults = localeDefaults;\n      this.computed = mergeOptions([globalDefaults, dirDefaults, localeDefaults, this.overrides, this.dynamicOverrides]);\n    };\n\n    return OptionsManager;\n  }();\n\n  var calendarSystemClassMap = {};\n\n  function registerCalendarSystem(name, theClass) {\n    calendarSystemClassMap[name] = theClass;\n  }\n\n  function createCalendarSystem(name) {\n    return new calendarSystemClassMap[name]();\n  }\n\n  var GregorianCalendarSystem =\n  /** @class */\n  function () {\n    function GregorianCalendarSystem() {}\n\n    GregorianCalendarSystem.prototype.getMarkerYear = function (d) {\n      return d.getUTCFullYear();\n    };\n\n    GregorianCalendarSystem.prototype.getMarkerMonth = function (d) {\n      return d.getUTCMonth();\n    };\n\n    GregorianCalendarSystem.prototype.getMarkerDay = function (d) {\n      return d.getUTCDate();\n    };\n\n    GregorianCalendarSystem.prototype.arrayToMarker = function (arr) {\n      return arrayToUtcDate(arr);\n    };\n\n    GregorianCalendarSystem.prototype.markerToArray = function (marker) {\n      return dateToUtcArray(marker);\n    };\n\n    return GregorianCalendarSystem;\n  }();\n\n  registerCalendarSystem('gregory', GregorianCalendarSystem);\n  var ISO_START = /^\\s*\\d{4}-\\d\\d-\\d\\d([T ]\\d)?/;\n  var ISO_TZO_RE = /(?:(Z)|([-+])(\\d\\d)(?::(\\d\\d))?)$/;\n\n  function parse(str) {\n    var timeZoneOffset = null;\n    var isTimeUnspecified = false;\n    var m = ISO_START.exec(str);\n\n    if (m) {\n      isTimeUnspecified = !m[1];\n\n      if (isTimeUnspecified) {\n        str += 'T00:00:00Z';\n      } else {\n        str = str.replace(ISO_TZO_RE, function (whole, z, sign, minutes, seconds) {\n          if (z) {\n            timeZoneOffset = 0;\n          } else {\n            timeZoneOffset = (parseInt(minutes, 10) * 60 + parseInt(seconds || 0, 10)) * (sign === '-' ? -1 : 1);\n          }\n\n          return '';\n        }) + 'Z'; // otherwise will parse in local\n      }\n    }\n\n    var marker = new Date(str);\n\n    if (!isValidDate(marker)) {\n      return null;\n    }\n\n    return {\n      marker: marker,\n      isTimeUnspecified: isTimeUnspecified,\n      timeZoneOffset: timeZoneOffset\n    };\n  }\n\n  var DateEnv =\n  /** @class */\n  function () {\n    function DateEnv(settings) {\n      var timeZone = this.timeZone = settings.timeZone;\n      var isNamedTimeZone = timeZone !== 'local' && timeZone !== 'UTC';\n\n      if (settings.namedTimeZoneImpl && isNamedTimeZone) {\n        this.namedTimeZoneImpl = new settings.namedTimeZoneImpl(timeZone);\n      }\n\n      this.canComputeOffset = Boolean(!isNamedTimeZone || this.namedTimeZoneImpl);\n      this.calendarSystem = createCalendarSystem(settings.calendarSystem);\n      this.locale = settings.locale;\n      this.weekDow = settings.locale.week.dow;\n      this.weekDoy = settings.locale.week.doy;\n\n      if (settings.weekNumberCalculation === 'ISO') {\n        this.weekDow = 1;\n        this.weekDoy = 4;\n      } else if (typeof settings.firstDay === 'number') {\n        this.weekDow = settings.firstDay;\n      }\n\n      if (typeof settings.weekNumberCalculation === 'function') {\n        this.weekNumberFunc = settings.weekNumberCalculation;\n      }\n\n      this.weekLabel = settings.weekLabel != null ? settings.weekLabel : settings.locale.options.weekLabel;\n      this.cmdFormatter = settings.cmdFormatter;\n    } // Creating / Parsing\n\n\n    DateEnv.prototype.createMarker = function (input) {\n      var meta = this.createMarkerMeta(input);\n\n      if (meta === null) {\n        return null;\n      }\n\n      return meta.marker;\n    };\n\n    DateEnv.prototype.createNowMarker = function () {\n      if (this.canComputeOffset) {\n        return this.timestampToMarker(new Date().valueOf());\n      } else {\n        // if we can't compute the current date val for a timezone,\n        // better to give the current local date vals than UTC\n        return arrayToUtcDate(dateToLocalArray(new Date()));\n      }\n    };\n\n    DateEnv.prototype.createMarkerMeta = function (input) {\n      if (typeof input === 'string') {\n        return this.parse(input);\n      }\n\n      var marker = null;\n\n      if (typeof input === 'number') {\n        marker = this.timestampToMarker(input);\n      } else if (input instanceof Date) {\n        input = input.valueOf();\n\n        if (!isNaN(input)) {\n          marker = this.timestampToMarker(input);\n        }\n      } else if (Array.isArray(input)) {\n        marker = arrayToUtcDate(input);\n      }\n\n      if (marker === null || !isValidDate(marker)) {\n        return null;\n      }\n\n      return {\n        marker: marker,\n        isTimeUnspecified: false,\n        forcedTzo: null\n      };\n    };\n\n    DateEnv.prototype.parse = function (s) {\n      var parts = parse(s);\n\n      if (parts === null) {\n        return null;\n      }\n\n      var marker = parts.marker;\n      var forcedTzo = null;\n\n      if (parts.timeZoneOffset !== null) {\n        if (this.canComputeOffset) {\n          marker = this.timestampToMarker(marker.valueOf() - parts.timeZoneOffset * 60 * 1000);\n        } else {\n          forcedTzo = parts.timeZoneOffset;\n        }\n      }\n\n      return {\n        marker: marker,\n        isTimeUnspecified: parts.isTimeUnspecified,\n        forcedTzo: forcedTzo\n      };\n    }; // Accessors\n\n\n    DateEnv.prototype.getYear = function (marker) {\n      return this.calendarSystem.getMarkerYear(marker);\n    };\n\n    DateEnv.prototype.getMonth = function (marker) {\n      return this.calendarSystem.getMarkerMonth(marker);\n    }; // Adding / Subtracting\n\n\n    DateEnv.prototype.add = function (marker, dur) {\n      var a = this.calendarSystem.markerToArray(marker);\n      a[0] += dur.years;\n      a[1] += dur.months;\n      a[2] += dur.days;\n      a[6] += dur.milliseconds;\n      return this.calendarSystem.arrayToMarker(a);\n    };\n\n    DateEnv.prototype.subtract = function (marker, dur) {\n      var a = this.calendarSystem.markerToArray(marker);\n      a[0] -= dur.years;\n      a[1] -= dur.months;\n      a[2] -= dur.days;\n      a[6] -= dur.milliseconds;\n      return this.calendarSystem.arrayToMarker(a);\n    };\n\n    DateEnv.prototype.addYears = function (marker, n) {\n      var a = this.calendarSystem.markerToArray(marker);\n      a[0] += n;\n      return this.calendarSystem.arrayToMarker(a);\n    };\n\n    DateEnv.prototype.addMonths = function (marker, n) {\n      var a = this.calendarSystem.markerToArray(marker);\n      a[1] += n;\n      return this.calendarSystem.arrayToMarker(a);\n    }; // Diffing Whole Units\n\n\n    DateEnv.prototype.diffWholeYears = function (m0, m1) {\n      var calendarSystem = this.calendarSystem;\n\n      if (timeAsMs(m0) === timeAsMs(m1) && calendarSystem.getMarkerDay(m0) === calendarSystem.getMarkerDay(m1) && calendarSystem.getMarkerMonth(m0) === calendarSystem.getMarkerMonth(m1)) {\n        return calendarSystem.getMarkerYear(m1) - calendarSystem.getMarkerYear(m0);\n      }\n\n      return null;\n    };\n\n    DateEnv.prototype.diffWholeMonths = function (m0, m1) {\n      var calendarSystem = this.calendarSystem;\n\n      if (timeAsMs(m0) === timeAsMs(m1) && calendarSystem.getMarkerDay(m0) === calendarSystem.getMarkerDay(m1)) {\n        return calendarSystem.getMarkerMonth(m1) - calendarSystem.getMarkerMonth(m0) + (calendarSystem.getMarkerYear(m1) - calendarSystem.getMarkerYear(m0)) * 12;\n      }\n\n      return null;\n    }; // Range / Duration\n\n\n    DateEnv.prototype.greatestWholeUnit = function (m0, m1) {\n      var n = this.diffWholeYears(m0, m1);\n\n      if (n !== null) {\n        return {\n          unit: 'year',\n          value: n\n        };\n      }\n\n      n = this.diffWholeMonths(m0, m1);\n\n      if (n !== null) {\n        return {\n          unit: 'month',\n          value: n\n        };\n      }\n\n      n = diffWholeWeeks(m0, m1);\n\n      if (n !== null) {\n        return {\n          unit: 'week',\n          value: n\n        };\n      }\n\n      n = diffWholeDays(m0, m1);\n\n      if (n !== null) {\n        return {\n          unit: 'day',\n          value: n\n        };\n      }\n\n      n = diffHours(m0, m1);\n\n      if (isInt(n)) {\n        return {\n          unit: 'hour',\n          value: n\n        };\n      }\n\n      n = diffMinutes(m0, m1);\n\n      if (isInt(n)) {\n        return {\n          unit: 'minute',\n          value: n\n        };\n      }\n\n      n = diffSeconds(m0, m1);\n\n      if (isInt(n)) {\n        return {\n          unit: 'second',\n          value: n\n        };\n      }\n\n      return {\n        unit: 'millisecond',\n        value: m1.valueOf() - m0.valueOf()\n      };\n    };\n\n    DateEnv.prototype.countDurationsBetween = function (m0, m1, d) {\n      // TODO: can use greatestWholeUnit\n      var diff;\n\n      if (d.years) {\n        diff = this.diffWholeYears(m0, m1);\n\n        if (diff !== null) {\n          return diff / asRoughYears(d);\n        }\n      }\n\n      if (d.months) {\n        diff = this.diffWholeMonths(m0, m1);\n\n        if (diff !== null) {\n          return diff / asRoughMonths(d);\n        }\n      }\n\n      if (d.days) {\n        diff = diffWholeDays(m0, m1);\n\n        if (diff !== null) {\n          return diff / asRoughDays(d);\n        }\n      }\n\n      return (m1.valueOf() - m0.valueOf()) / asRoughMs(d);\n    }; // Start-Of\n\n\n    DateEnv.prototype.startOf = function (m, unit) {\n      if (unit === 'year') {\n        return this.startOfYear(m);\n      } else if (unit === 'month') {\n        return this.startOfMonth(m);\n      } else if (unit === 'week') {\n        return this.startOfWeek(m);\n      } else if (unit === 'day') {\n        return startOfDay(m);\n      } else if (unit === 'hour') {\n        return startOfHour(m);\n      } else if (unit === 'minute') {\n        return startOfMinute(m);\n      } else if (unit === 'second') {\n        return startOfSecond(m);\n      }\n    };\n\n    DateEnv.prototype.startOfYear = function (m) {\n      return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(m)]);\n    };\n\n    DateEnv.prototype.startOfMonth = function (m) {\n      return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(m), this.calendarSystem.getMarkerMonth(m)]);\n    };\n\n    DateEnv.prototype.startOfWeek = function (m) {\n      return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(m), this.calendarSystem.getMarkerMonth(m), m.getUTCDate() - (m.getUTCDay() - this.weekDow + 7) % 7]);\n    }; // Week Number\n\n\n    DateEnv.prototype.computeWeekNumber = function (marker) {\n      if (this.weekNumberFunc) {\n        return this.weekNumberFunc(this.toDate(marker));\n      } else {\n        return weekOfYear(marker, this.weekDow, this.weekDoy);\n      }\n    }; // TODO: choke on timeZoneName: long\n\n\n    DateEnv.prototype.format = function (marker, formatter, dateOptions) {\n      if (dateOptions === void 0) {\n        dateOptions = {};\n      }\n\n      return formatter.format({\n        marker: marker,\n        timeZoneOffset: dateOptions.forcedTzo != null ? dateOptions.forcedTzo : this.offsetForMarker(marker)\n      }, this);\n    };\n\n    DateEnv.prototype.formatRange = function (start, end, formatter, dateOptions) {\n      if (dateOptions === void 0) {\n        dateOptions = {};\n      }\n\n      if (dateOptions.isEndExclusive) {\n        end = addMs(end, -1);\n      }\n\n      return formatter.formatRange({\n        marker: start,\n        timeZoneOffset: dateOptions.forcedStartTzo != null ? dateOptions.forcedStartTzo : this.offsetForMarker(start)\n      }, {\n        marker: end,\n        timeZoneOffset: dateOptions.forcedEndTzo != null ? dateOptions.forcedEndTzo : this.offsetForMarker(end)\n      }, this);\n    };\n\n    DateEnv.prototype.formatIso = function (marker, extraOptions) {\n      if (extraOptions === void 0) {\n        extraOptions = {};\n      }\n\n      var timeZoneOffset = null;\n\n      if (!extraOptions.omitTimeZoneOffset) {\n        if (extraOptions.forcedTzo != null) {\n          timeZoneOffset = extraOptions.forcedTzo;\n        } else {\n          timeZoneOffset = this.offsetForMarker(marker);\n        }\n      }\n\n      return buildIsoString(marker, timeZoneOffset, extraOptions.omitTime);\n    }; // TimeZone\n\n\n    DateEnv.prototype.timestampToMarker = function (ms) {\n      if (this.timeZone === 'local') {\n        return arrayToUtcDate(dateToLocalArray(new Date(ms)));\n      } else if (this.timeZone === 'UTC' || !this.namedTimeZoneImpl) {\n        return new Date(ms);\n      } else {\n        return arrayToUtcDate(this.namedTimeZoneImpl.timestampToArray(ms));\n      }\n    };\n\n    DateEnv.prototype.offsetForMarker = function (m) {\n      if (this.timeZone === 'local') {\n        return -arrayToLocalDate(dateToUtcArray(m)).getTimezoneOffset(); // convert \"inverse\" offset to \"normal\" offset\n      } else if (this.timeZone === 'UTC') {\n        return 0;\n      } else if (this.namedTimeZoneImpl) {\n        return this.namedTimeZoneImpl.offsetForArray(dateToUtcArray(m));\n      }\n\n      return null;\n    }; // Conversion\n\n\n    DateEnv.prototype.toDate = function (m, forcedTzo) {\n      if (this.timeZone === 'local') {\n        return arrayToLocalDate(dateToUtcArray(m));\n      } else if (this.timeZone === 'UTC') {\n        return new Date(m.valueOf()); // make sure it's a copy\n      } else if (!this.namedTimeZoneImpl) {\n        return new Date(m.valueOf() - (forcedTzo || 0));\n      } else {\n        return new Date(m.valueOf() - this.namedTimeZoneImpl.offsetForArray(dateToUtcArray(m)) * 1000 * 60 // convert minutes -> ms\n        );\n      }\n    };\n\n    return DateEnv;\n  }();\n\n  var SIMPLE_SOURCE_PROPS = {\n    id: String,\n    allDayDefault: Boolean,\n    eventDataTransform: Function,\n    success: Function,\n    failure: Function\n  };\n  var uid$2 = 0;\n\n  function doesSourceNeedRange(eventSource, calendar) {\n    var defs = calendar.pluginSystem.hooks.eventSourceDefs;\n    return !defs[eventSource.sourceDefId].ignoreRange;\n  }\n\n  function parseEventSource(raw, calendar) {\n    var defs = calendar.pluginSystem.hooks.eventSourceDefs;\n\n    for (var i = defs.length - 1; i >= 0; i--) {\n      // later-added plugins take precedence\n      var def = defs[i];\n      var meta = def.parseMeta(raw);\n\n      if (meta) {\n        return parseEventSourceProps(typeof raw === 'object' ? raw : {}, meta, i, calendar);\n      }\n    }\n\n    return null;\n  }\n\n  function parseEventSourceProps(raw, meta, sourceDefId, calendar) {\n    var leftovers0 = {};\n    var props = refineProps(raw, SIMPLE_SOURCE_PROPS, {}, leftovers0);\n    var leftovers1 = {};\n    var ui = processUnscopedUiProps(leftovers0, calendar, leftovers1);\n    props.isFetching = false;\n    props.latestFetchId = '';\n    props.fetchRange = null;\n    props.publicId = String(raw.id || '');\n    props.sourceId = String(uid$2++);\n    props.sourceDefId = sourceDefId;\n    props.meta = meta;\n    props.ui = ui;\n    props.extendedProps = leftovers1;\n    return props;\n  }\n\n  function reduceEventSources(eventSources, action, dateProfile, calendar) {\n    switch (action.type) {\n      case 'ADD_EVENT_SOURCES':\n        // already parsed\n        return addSources(eventSources, action.sources, dateProfile ? dateProfile.activeRange : null, calendar);\n\n      case 'REMOVE_EVENT_SOURCE':\n        return removeSource(eventSources, action.sourceId);\n\n      case 'PREV': // TODO: how do we track all actions that affect dateProfile :(\n\n      case 'NEXT':\n      case 'SET_DATE':\n      case 'SET_VIEW_TYPE':\n        if (dateProfile) {\n          return fetchDirtySources(eventSources, dateProfile.activeRange, calendar);\n        } else {\n          return eventSources;\n        }\n\n      case 'FETCH_EVENT_SOURCES':\n      case 'CHANGE_TIMEZONE':\n        return fetchSourcesByIds(eventSources, action.sourceIds ? arrayToHash(action.sourceIds) : excludeStaticSources(eventSources, calendar), dateProfile ? dateProfile.activeRange : null, calendar);\n\n      case 'RECEIVE_EVENTS':\n      case 'RECEIVE_EVENT_ERROR':\n        return receiveResponse(eventSources, action.sourceId, action.fetchId, action.fetchRange);\n\n      case 'REMOVE_ALL_EVENT_SOURCES':\n        return {};\n\n      default:\n        return eventSources;\n    }\n  }\n\n  var uid$3 = 0;\n\n  function addSources(eventSourceHash, sources, fetchRange, calendar) {\n    var hash = {};\n\n    for (var _i = 0, sources_1 = sources; _i < sources_1.length; _i++) {\n      var source = sources_1[_i];\n      hash[source.sourceId] = source;\n    }\n\n    if (fetchRange) {\n      hash = fetchDirtySources(hash, fetchRange, calendar);\n    }\n\n    return _assign({}, eventSourceHash, hash);\n  }\n\n  function removeSource(eventSourceHash, sourceId) {\n    return filterHash(eventSourceHash, function (eventSource) {\n      return eventSource.sourceId !== sourceId;\n    });\n  }\n\n  function fetchDirtySources(sourceHash, fetchRange, calendar) {\n    return fetchSourcesByIds(sourceHash, filterHash(sourceHash, function (eventSource) {\n      return isSourceDirty(eventSource, fetchRange, calendar);\n    }), fetchRange, calendar);\n  }\n\n  function isSourceDirty(eventSource, fetchRange, calendar) {\n    if (!doesSourceNeedRange(eventSource, calendar)) {\n      return !eventSource.latestFetchId;\n    } else {\n      return !calendar.opt('lazyFetching') || !eventSource.fetchRange || fetchRange.start < eventSource.fetchRange.start || fetchRange.end > eventSource.fetchRange.end;\n    }\n  }\n\n  function fetchSourcesByIds(prevSources, sourceIdHash, fetchRange, calendar) {\n    var nextSources = {};\n\n    for (var sourceId in prevSources) {\n      var source = prevSources[sourceId];\n\n      if (sourceIdHash[sourceId]) {\n        nextSources[sourceId] = fetchSource(source, fetchRange, calendar);\n      } else {\n        nextSources[sourceId] = source;\n      }\n    }\n\n    return nextSources;\n  }\n\n  function fetchSource(eventSource, fetchRange, calendar) {\n    var sourceDef = calendar.pluginSystem.hooks.eventSourceDefs[eventSource.sourceDefId];\n    var fetchId = String(uid$3++);\n    sourceDef.fetch({\n      eventSource: eventSource,\n      calendar: calendar,\n      range: fetchRange\n    }, function (res) {\n      var rawEvents = res.rawEvents;\n      var calSuccess = calendar.opt('eventSourceSuccess');\n      var calSuccessRes;\n      var sourceSuccessRes;\n\n      if (eventSource.success) {\n        sourceSuccessRes = eventSource.success(rawEvents, res.xhr);\n      }\n\n      if (calSuccess) {\n        calSuccessRes = calSuccess(rawEvents, res.xhr);\n      }\n\n      rawEvents = sourceSuccessRes || calSuccessRes || rawEvents;\n      calendar.dispatch({\n        type: 'RECEIVE_EVENTS',\n        sourceId: eventSource.sourceId,\n        fetchId: fetchId,\n        fetchRange: fetchRange,\n        rawEvents: rawEvents\n      });\n    }, function (error) {\n      var callFailure = calendar.opt('eventSourceFailure');\n      console.warn(error.message, error);\n\n      if (eventSource.failure) {\n        eventSource.failure(error);\n      }\n\n      if (callFailure) {\n        callFailure(error);\n      }\n\n      calendar.dispatch({\n        type: 'RECEIVE_EVENT_ERROR',\n        sourceId: eventSource.sourceId,\n        fetchId: fetchId,\n        fetchRange: fetchRange,\n        error: error\n      });\n    });\n    return _assign({}, eventSource, {\n      isFetching: true,\n      latestFetchId: fetchId\n    });\n  }\n\n  function receiveResponse(sourceHash, sourceId, fetchId, fetchRange) {\n    var _a;\n\n    var eventSource = sourceHash[sourceId];\n\n    if (eventSource && // not already removed\n    fetchId === eventSource.latestFetchId) {\n      return _assign({}, sourceHash, (_a = {}, _a[sourceId] = _assign({}, eventSource, {\n        isFetching: false,\n        fetchRange: fetchRange\n      }), _a));\n    }\n\n    return sourceHash;\n  }\n\n  function excludeStaticSources(eventSources, calendar) {\n    return filterHash(eventSources, function (eventSource) {\n      return doesSourceNeedRange(eventSource, calendar);\n    });\n  }\n\n  var DateProfileGenerator =\n  /** @class */\n  function () {\n    function DateProfileGenerator(viewSpec, calendar) {\n      this.viewSpec = viewSpec;\n      this.options = viewSpec.options;\n      this.dateEnv = calendar.dateEnv;\n      this.calendar = calendar;\n      this.initHiddenDays();\n    }\n    /* Date Range Computation\n    ------------------------------------------------------------------------------------------------------------------*/\n    // Builds a structure with info about what the dates/ranges will be for the \"prev\" view.\n\n\n    DateProfileGenerator.prototype.buildPrev = function (currentDateProfile, currentDate) {\n      var dateEnv = this.dateEnv;\n      var prevDate = dateEnv.subtract(currentDate, currentDateProfile.dateIncrement);\n      return this.build(prevDate, -1);\n    }; // Builds a structure with info about what the dates/ranges will be for the \"next\" view.\n\n\n    DateProfileGenerator.prototype.buildNext = function (currentDateProfile, currentDate) {\n      var dateEnv = this.dateEnv;\n      var nextDate = dateEnv.add(currentDate, currentDateProfile.dateIncrement);\n      return this.build(nextDate, 1);\n    }; // Builds a structure holding dates/ranges for rendering around the given date.\n    // Optional direction param indicates whether the date is being incremented/decremented\n    // from its previous value. decremented = -1, incremented = 1 (default).\n\n\n    DateProfileGenerator.prototype.build = function (currentDate, direction, forceToValid) {\n      if (forceToValid === void 0) {\n        forceToValid = false;\n      }\n\n      var validRange;\n      var minTime = null;\n      var maxTime = null;\n      var currentInfo;\n      var isRangeAllDay;\n      var renderRange;\n      var activeRange;\n      var isValid;\n      validRange = this.buildValidRange();\n      validRange = this.trimHiddenDays(validRange);\n\n      if (forceToValid) {\n        currentDate = constrainMarkerToRange(currentDate, validRange);\n      }\n\n      currentInfo = this.buildCurrentRangeInfo(currentDate, direction);\n      isRangeAllDay = /^(year|month|week|day)$/.test(currentInfo.unit);\n      renderRange = this.buildRenderRange(this.trimHiddenDays(currentInfo.range), currentInfo.unit, isRangeAllDay);\n      renderRange = this.trimHiddenDays(renderRange);\n      activeRange = renderRange;\n\n      if (!this.options.showNonCurrentDates) {\n        activeRange = intersectRanges(activeRange, currentInfo.range);\n      }\n\n      minTime = createDuration(this.options.minTime);\n      maxTime = createDuration(this.options.maxTime);\n      activeRange = this.adjustActiveRange(activeRange, minTime, maxTime);\n      activeRange = intersectRanges(activeRange, validRange); // might return null\n      // it's invalid if the originally requested date is not contained,\n      // or if the range is completely outside of the valid range.\n\n      isValid = rangesIntersect(currentInfo.range, validRange);\n      return {\n        // constraint for where prev/next operations can go and where events can be dragged/resized to.\n        // an object with optional start and end properties.\n        validRange: validRange,\n        // range the view is formally responsible for.\n        // for example, a month view might have 1st-31st, excluding padded dates\n        currentRange: currentInfo.range,\n        // name of largest unit being displayed, like \"month\" or \"week\"\n        currentRangeUnit: currentInfo.unit,\n        isRangeAllDay: isRangeAllDay,\n        // dates that display events and accept drag-n-drop\n        // will be `null` if no dates accept events\n        activeRange: activeRange,\n        // date range with a rendered skeleton\n        // includes not-active days that need some sort of DOM\n        renderRange: renderRange,\n        // Duration object that denotes the first visible time of any given day\n        minTime: minTime,\n        // Duration object that denotes the exclusive visible end time of any given day\n        maxTime: maxTime,\n        isValid: isValid,\n        // how far the current date will move for a prev/next operation\n        dateIncrement: this.buildDateIncrement(currentInfo.duration) // pass a fallback (might be null) ^\n\n      };\n    }; // Builds an object with optional start/end properties.\n    // Indicates the minimum/maximum dates to display.\n    // not responsible for trimming hidden days.\n\n\n    DateProfileGenerator.prototype.buildValidRange = function () {\n      return this.getRangeOption('validRange', this.calendar.getNow()) || {\n        start: null,\n        end: null\n      }; // completely open-ended\n    }; // Builds a structure with info about the \"current\" range, the range that is\n    // highlighted as being the current month for example.\n    // See build() for a description of `direction`.\n    // Guaranteed to have `range` and `unit` properties. `duration` is optional.\n\n\n    DateProfileGenerator.prototype.buildCurrentRangeInfo = function (date, direction) {\n      var _a = this,\n          viewSpec = _a.viewSpec,\n          dateEnv = _a.dateEnv;\n\n      var duration = null;\n      var unit = null;\n      var range = null;\n      var dayCount;\n\n      if (viewSpec.duration) {\n        duration = viewSpec.duration;\n        unit = viewSpec.durationUnit;\n        range = this.buildRangeFromDuration(date, direction, duration, unit);\n      } else if (dayCount = this.options.dayCount) {\n        unit = 'day';\n        range = this.buildRangeFromDayCount(date, direction, dayCount);\n      } else if (range = this.buildCustomVisibleRange(date)) {\n        unit = dateEnv.greatestWholeUnit(range.start, range.end).unit;\n      } else {\n        duration = this.getFallbackDuration();\n        unit = greatestDurationDenominator(duration).unit;\n        range = this.buildRangeFromDuration(date, direction, duration, unit);\n      }\n\n      return {\n        duration: duration,\n        unit: unit,\n        range: range\n      };\n    };\n\n    DateProfileGenerator.prototype.getFallbackDuration = function () {\n      return createDuration({\n        day: 1\n      });\n    }; // Returns a new activeRange to have time values (un-ambiguate)\n    // minTime or maxTime causes the range to expand.\n\n\n    DateProfileGenerator.prototype.adjustActiveRange = function (range, minTime, maxTime) {\n      var dateEnv = this.dateEnv;\n      var start = range.start;\n      var end = range.end;\n\n      if (this.viewSpec.class.prototype.usesMinMaxTime) {\n        // expand active range if minTime is negative (why not when positive?)\n        if (asRoughDays(minTime) < 0) {\n          start = startOfDay(start); // necessary?\n\n          start = dateEnv.add(start, minTime);\n        } // expand active range if maxTime is beyond one day (why not when positive?)\n\n\n        if (asRoughDays(maxTime) > 1) {\n          end = startOfDay(end); // necessary?\n\n          end = addDays(end, -1);\n          end = dateEnv.add(end, maxTime);\n        }\n      }\n\n      return {\n        start: start,\n        end: end\n      };\n    }; // Builds the \"current\" range when it is specified as an explicit duration.\n    // `unit` is the already-computed greatestDurationDenominator unit of duration.\n\n\n    DateProfileGenerator.prototype.buildRangeFromDuration = function (date, direction, duration, unit) {\n      var dateEnv = this.dateEnv;\n      var alignment = this.options.dateAlignment;\n      var dateIncrementInput;\n      var dateIncrementDuration;\n      var start;\n      var end;\n      var res; // compute what the alignment should be\n\n      if (!alignment) {\n        dateIncrementInput = this.options.dateIncrement;\n\n        if (dateIncrementInput) {\n          dateIncrementDuration = createDuration(dateIncrementInput); // use the smaller of the two units\n\n          if (asRoughMs(dateIncrementDuration) < asRoughMs(duration)) {\n            alignment = greatestDurationDenominator(dateIncrementDuration, !getWeeksFromInput(dateIncrementInput)).unit;\n          } else {\n            alignment = unit;\n          }\n        } else {\n          alignment = unit;\n        }\n      } // if the view displays a single day or smaller\n\n\n      if (asRoughDays(duration) <= 1) {\n        if (this.isHiddenDay(start)) {\n          start = this.skipHiddenDays(start, direction);\n          start = startOfDay(start);\n        }\n      }\n\n      function computeRes() {\n        start = dateEnv.startOf(date, alignment);\n        end = dateEnv.add(start, duration);\n        res = {\n          start: start,\n          end: end\n        };\n      }\n\n      computeRes(); // if range is completely enveloped by hidden days, go past the hidden days\n\n      if (!this.trimHiddenDays(res)) {\n        date = this.skipHiddenDays(date, direction);\n        computeRes();\n      }\n\n      return res;\n    }; // Builds the \"current\" range when a dayCount is specified.\n\n\n    DateProfileGenerator.prototype.buildRangeFromDayCount = function (date, direction, dayCount) {\n      var dateEnv = this.dateEnv;\n      var customAlignment = this.options.dateAlignment;\n      var runningCount = 0;\n      var start = date;\n      var end;\n\n      if (customAlignment) {\n        start = dateEnv.startOf(start, customAlignment);\n      }\n\n      start = startOfDay(start);\n      start = this.skipHiddenDays(start, direction);\n      end = start;\n\n      do {\n        end = addDays(end, 1);\n\n        if (!this.isHiddenDay(end)) {\n          runningCount++;\n        }\n      } while (runningCount < dayCount);\n\n      return {\n        start: start,\n        end: end\n      };\n    }; // Builds a normalized range object for the \"visible\" range,\n    // which is a way to define the currentRange and activeRange at the same time.\n\n\n    DateProfileGenerator.prototype.buildCustomVisibleRange = function (date) {\n      var dateEnv = this.dateEnv;\n      var visibleRange = this.getRangeOption('visibleRange', dateEnv.toDate(date));\n\n      if (visibleRange && (visibleRange.start == null || visibleRange.end == null)) {\n        return null;\n      }\n\n      return visibleRange;\n    }; // Computes the range that will represent the element/cells for *rendering*,\n    // but which may have voided days/times.\n    // not responsible for trimming hidden days.\n\n\n    DateProfileGenerator.prototype.buildRenderRange = function (currentRange, currentRangeUnit, isRangeAllDay) {\n      return currentRange;\n    }; // Compute the duration value that should be added/substracted to the current date\n    // when a prev/next operation happens.\n\n\n    DateProfileGenerator.prototype.buildDateIncrement = function (fallback) {\n      var dateIncrementInput = this.options.dateIncrement;\n      var customAlignment;\n\n      if (dateIncrementInput) {\n        return createDuration(dateIncrementInput);\n      } else if (customAlignment = this.options.dateAlignment) {\n        return createDuration(1, customAlignment);\n      } else if (fallback) {\n        return fallback;\n      } else {\n        return createDuration({\n          days: 1\n        });\n      }\n    }; // Arguments after name will be forwarded to a hypothetical function value\n    // WARNING: passed-in arguments will be given to generator functions as-is and can cause side-effects.\n    // Always clone your objects if you fear mutation.\n\n\n    DateProfileGenerator.prototype.getRangeOption = function (name) {\n      var otherArgs = [];\n\n      for (var _i = 1; _i < arguments.length; _i++) {\n        otherArgs[_i - 1] = arguments[_i];\n      }\n\n      var val = this.options[name];\n\n      if (typeof val === 'function') {\n        val = val.apply(null, otherArgs);\n      }\n\n      if (val) {\n        val = parseRange(val, this.dateEnv);\n      }\n\n      if (val) {\n        val = computeVisibleDayRange(val);\n      }\n\n      return val;\n    };\n    /* Hidden Days\n    ------------------------------------------------------------------------------------------------------------------*/\n    // Initializes internal variables related to calculating hidden days-of-week\n\n\n    DateProfileGenerator.prototype.initHiddenDays = function () {\n      var hiddenDays = this.options.hiddenDays || []; // array of day-of-week indices that are hidden\n\n      var isHiddenDayHash = []; // is the day-of-week hidden? (hash with day-of-week-index -> bool)\n\n      var dayCnt = 0;\n      var i;\n\n      if (this.options.weekends === false) {\n        hiddenDays.push(0, 6); // 0=sunday, 6=saturday\n      }\n\n      for (i = 0; i < 7; i++) {\n        if (!(isHiddenDayHash[i] = hiddenDays.indexOf(i) !== -1)) {\n          dayCnt++;\n        }\n      }\n\n      if (!dayCnt) {\n        throw new Error('invalid hiddenDays'); // all days were hidden? bad.\n      }\n\n      this.isHiddenDayHash = isHiddenDayHash;\n    }; // Remove days from the beginning and end of the range that are computed as hidden.\n    // If the whole range is trimmed off, returns null\n\n\n    DateProfileGenerator.prototype.trimHiddenDays = function (range) {\n      var start = range.start;\n      var end = range.end;\n\n      if (start) {\n        start = this.skipHiddenDays(start);\n      }\n\n      if (end) {\n        end = this.skipHiddenDays(end, -1, true);\n      }\n\n      if (start == null || end == null || start < end) {\n        return {\n          start: start,\n          end: end\n        };\n      }\n\n      return null;\n    }; // Is the current day hidden?\n    // `day` is a day-of-week index (0-6), or a Date (used for UTC)\n\n\n    DateProfileGenerator.prototype.isHiddenDay = function (day) {\n      if (day instanceof Date) {\n        day = day.getUTCDay();\n      }\n\n      return this.isHiddenDayHash[day];\n    }; // Incrementing the current day until it is no longer a hidden day, returning a copy.\n    // DOES NOT CONSIDER validRange!\n    // If the initial value of `date` is not a hidden day, don't do anything.\n    // Pass `isExclusive` as `true` if you are dealing with an end date.\n    // `inc` defaults to `1` (increment one day forward each time)\n\n\n    DateProfileGenerator.prototype.skipHiddenDays = function (date, inc, isExclusive) {\n      if (inc === void 0) {\n        inc = 1;\n      }\n\n      if (isExclusive === void 0) {\n        isExclusive = false;\n      }\n\n      while (this.isHiddenDayHash[(date.getUTCDay() + (isExclusive ? inc : 0) + 7) % 7]) {\n        date = addDays(date, inc);\n      }\n\n      return date;\n    };\n\n    return DateProfileGenerator;\n  }(); // TODO: find a way to avoid comparing DateProfiles. it's tedious\n\n\n  function isDateProfilesEqual(p0, p1) {\n    return rangesEqual(p0.activeRange, p1.activeRange) && rangesEqual(p0.validRange, p1.validRange) && durationsEqual(p0.minTime, p1.minTime) && durationsEqual(p0.maxTime, p1.maxTime);\n  }\n\n  function reduce(state, action, calendar) {\n    var viewType = reduceViewType(state.viewType, action);\n    var dateProfile = reduceDateProfile(state.dateProfile, action, state.currentDate, viewType, calendar);\n    var eventSources = reduceEventSources(state.eventSources, action, dateProfile, calendar);\n\n    var nextState = _assign({}, state, {\n      viewType: viewType,\n      dateProfile: dateProfile,\n      currentDate: reduceCurrentDate(state.currentDate, action, dateProfile),\n      eventSources: eventSources,\n      eventStore: reduceEventStore(state.eventStore, action, eventSources, dateProfile, calendar),\n      dateSelection: reduceDateSelection(state.dateSelection, action, calendar),\n      eventSelection: reduceSelectedEvent(state.eventSelection, action),\n      eventDrag: reduceEventDrag(state.eventDrag, action, eventSources, calendar),\n      eventResize: reduceEventResize(state.eventResize, action, eventSources, calendar),\n      eventSourceLoadingLevel: computeLoadingLevel(eventSources),\n      loadingLevel: computeLoadingLevel(eventSources)\n    });\n\n    for (var _i = 0, _a = calendar.pluginSystem.hooks.reducers; _i < _a.length; _i++) {\n      var reducerFunc = _a[_i];\n      nextState = reducerFunc(nextState, action, calendar);\n    } // console.log(action.type, nextState)\n\n\n    return nextState;\n  }\n\n  function reduceViewType(currentViewType, action) {\n    switch (action.type) {\n      case 'SET_VIEW_TYPE':\n        return action.viewType;\n\n      default:\n        return currentViewType;\n    }\n  }\n\n  function reduceDateProfile(currentDateProfile, action, currentDate, viewType, calendar) {\n    var newDateProfile;\n\n    switch (action.type) {\n      case 'PREV':\n        newDateProfile = calendar.dateProfileGenerators[viewType].buildPrev(currentDateProfile, currentDate);\n        break;\n\n      case 'NEXT':\n        newDateProfile = calendar.dateProfileGenerators[viewType].buildNext(currentDateProfile, currentDate);\n        break;\n\n      case 'SET_DATE':\n        if (!currentDateProfile.activeRange || !rangeContainsMarker(currentDateProfile.currentRange, action.dateMarker)) {\n          newDateProfile = calendar.dateProfileGenerators[viewType].build(action.dateMarker, undefined, true // forceToValid\n          );\n        }\n\n        break;\n\n      case 'SET_VIEW_TYPE':\n        var generator = calendar.dateProfileGenerators[viewType];\n\n        if (!generator) {\n          throw new Error(viewType ? 'The FullCalendar view \"' + viewType + '\" does not exist. Make sure your plugins are loaded correctly.' : 'No available FullCalendar view plugins.');\n        }\n\n        newDateProfile = generator.build(action.dateMarker || currentDate, undefined, true // forceToValid\n        );\n        break;\n    }\n\n    if (newDateProfile && newDateProfile.isValid && !(currentDateProfile && isDateProfilesEqual(currentDateProfile, newDateProfile))) {\n      return newDateProfile;\n    } else {\n      return currentDateProfile;\n    }\n  }\n\n  function reduceCurrentDate(currentDate, action, dateProfile) {\n    switch (action.type) {\n      case 'PREV':\n      case 'NEXT':\n        if (!rangeContainsMarker(dateProfile.currentRange, currentDate)) {\n          return dateProfile.currentRange.start;\n        } else {\n          return currentDate;\n        }\n\n      case 'SET_DATE':\n      case 'SET_VIEW_TYPE':\n        var newDate = action.dateMarker || currentDate;\n\n        if (dateProfile.activeRange && !rangeContainsMarker(dateProfile.activeRange, newDate)) {\n          return dateProfile.currentRange.start;\n        } else {\n          return newDate;\n        }\n\n      default:\n        return currentDate;\n    }\n  }\n\n  function reduceDateSelection(currentSelection, action, calendar) {\n    switch (action.type) {\n      case 'SELECT_DATES':\n        return action.selection;\n\n      case 'UNSELECT_DATES':\n        return null;\n\n      default:\n        return currentSelection;\n    }\n  }\n\n  function reduceSelectedEvent(currentInstanceId, action) {\n    switch (action.type) {\n      case 'SELECT_EVENT':\n        return action.eventInstanceId;\n\n      case 'UNSELECT_EVENT':\n        return '';\n\n      default:\n        return currentInstanceId;\n    }\n  }\n\n  function reduceEventDrag(currentDrag, action, sources, calendar) {\n    switch (action.type) {\n      case 'SET_EVENT_DRAG':\n        var newDrag = action.state;\n        return {\n          affectedEvents: newDrag.affectedEvents,\n          mutatedEvents: newDrag.mutatedEvents,\n          isEvent: newDrag.isEvent,\n          origSeg: newDrag.origSeg\n        };\n\n      case 'UNSET_EVENT_DRAG':\n        return null;\n\n      default:\n        return currentDrag;\n    }\n  }\n\n  function reduceEventResize(currentResize, action, sources, calendar) {\n    switch (action.type) {\n      case 'SET_EVENT_RESIZE':\n        var newResize = action.state;\n        return {\n          affectedEvents: newResize.affectedEvents,\n          mutatedEvents: newResize.mutatedEvents,\n          isEvent: newResize.isEvent,\n          origSeg: newResize.origSeg\n        };\n\n      case 'UNSET_EVENT_RESIZE':\n        return null;\n\n      default:\n        return currentResize;\n    }\n  }\n\n  function computeLoadingLevel(eventSources) {\n    var cnt = 0;\n\n    for (var sourceId in eventSources) {\n      if (eventSources[sourceId].isFetching) {\n        cnt++;\n      }\n    }\n\n    return cnt;\n  }\n\n  var STANDARD_PROPS = {\n    start: null,\n    end: null,\n    allDay: Boolean\n  };\n\n  function parseDateSpan(raw, dateEnv, defaultDuration) {\n    var span = parseOpenDateSpan(raw, dateEnv);\n    var range = span.range;\n\n    if (!range.start) {\n      return null;\n    }\n\n    if (!range.end) {\n      if (defaultDuration == null) {\n        return null;\n      } else {\n        range.end = dateEnv.add(range.start, defaultDuration);\n      }\n    }\n\n    return span;\n  }\n  /*\n  TODO: somehow combine with parseRange?\n  Will return null if the start/end props were present but parsed invalidly.\n  */\n\n\n  function parseOpenDateSpan(raw, dateEnv) {\n    var leftovers = {};\n    var standardProps = refineProps(raw, STANDARD_PROPS, {}, leftovers);\n    var startMeta = standardProps.start ? dateEnv.createMarkerMeta(standardProps.start) : null;\n    var endMeta = standardProps.end ? dateEnv.createMarkerMeta(standardProps.end) : null;\n    var allDay = standardProps.allDay;\n\n    if (allDay == null) {\n      allDay = startMeta && startMeta.isTimeUnspecified && (!endMeta || endMeta.isTimeUnspecified);\n    } // use this leftover object as the selection object\n\n\n    leftovers.range = {\n      start: startMeta ? startMeta.marker : null,\n      end: endMeta ? endMeta.marker : null\n    };\n    leftovers.allDay = allDay;\n    return leftovers;\n  }\n\n  function isDateSpansEqual(span0, span1) {\n    return rangesEqual(span0.range, span1.range) && span0.allDay === span1.allDay && isSpanPropsEqual(span0, span1);\n  } // the NON-DATE-RELATED props\n\n\n  function isSpanPropsEqual(span0, span1) {\n    for (var propName in span1) {\n      if (propName !== 'range' && propName !== 'allDay') {\n        if (span0[propName] !== span1[propName]) {\n          return false;\n        }\n      }\n    } // are there any props that span0 has that span1 DOESN'T have?\n    // both have range/allDay, so no need to special-case.\n\n\n    for (var propName in span0) {\n      if (!(propName in span1)) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  function buildDateSpanApi(span, dateEnv) {\n    return {\n      start: dateEnv.toDate(span.range.start),\n      end: dateEnv.toDate(span.range.end),\n      startStr: dateEnv.formatIso(span.range.start, {\n        omitTime: span.allDay\n      }),\n      endStr: dateEnv.formatIso(span.range.end, {\n        omitTime: span.allDay\n      }),\n      allDay: span.allDay\n    };\n  }\n\n  function buildDatePointApi(span, dateEnv) {\n    return {\n      date: dateEnv.toDate(span.range.start),\n      dateStr: dateEnv.formatIso(span.range.start, {\n        omitTime: span.allDay\n      }),\n      allDay: span.allDay\n    };\n  }\n\n  function fabricateEventRange(dateSpan, eventUiBases, calendar) {\n    var def = parseEventDef({\n      editable: false\n    }, '', // sourceId\n    dateSpan.allDay, true, // hasEnd\n    calendar);\n    return {\n      def: def,\n      ui: compileEventUi(def, eventUiBases),\n      instance: createEventInstance(def.defId, dateSpan.range),\n      range: dateSpan.range,\n      isStart: true,\n      isEnd: true\n    };\n  }\n\n  function compileViewDefs(defaultConfigs, overrideConfigs) {\n    var hash = {};\n    var viewType;\n\n    for (viewType in defaultConfigs) {\n      ensureViewDef(viewType, hash, defaultConfigs, overrideConfigs);\n    }\n\n    for (viewType in overrideConfigs) {\n      ensureViewDef(viewType, hash, defaultConfigs, overrideConfigs);\n    }\n\n    return hash;\n  }\n\n  function ensureViewDef(viewType, hash, defaultConfigs, overrideConfigs) {\n    if (hash[viewType]) {\n      return hash[viewType];\n    }\n\n    var viewDef = buildViewDef(viewType, hash, defaultConfigs, overrideConfigs);\n\n    if (viewDef) {\n      hash[viewType] = viewDef;\n    }\n\n    return viewDef;\n  }\n\n  function buildViewDef(viewType, hash, defaultConfigs, overrideConfigs) {\n    var defaultConfig = defaultConfigs[viewType];\n    var overrideConfig = overrideConfigs[viewType];\n\n    var queryProp = function queryProp(name) {\n      return defaultConfig && defaultConfig[name] !== null ? defaultConfig[name] : overrideConfig && overrideConfig[name] !== null ? overrideConfig[name] : null;\n    };\n\n    var theClass = queryProp('class');\n    var superType = queryProp('superType');\n\n    if (!superType && theClass) {\n      superType = findViewNameBySubclass(theClass, overrideConfigs) || findViewNameBySubclass(theClass, defaultConfigs);\n    }\n\n    var superDef = superType ? ensureViewDef(superType, hash, defaultConfigs, overrideConfigs) : null;\n\n    if (!theClass && superDef) {\n      theClass = superDef.class;\n    }\n\n    if (!theClass) {\n      return null; // don't throw a warning, might be settings for a single-unit view\n    }\n\n    return {\n      type: viewType,\n      class: theClass,\n      defaults: _assign({}, superDef ? superDef.defaults : {}, defaultConfig ? defaultConfig.options : {}),\n      overrides: _assign({}, superDef ? superDef.overrides : {}, overrideConfig ? overrideConfig.options : {})\n    };\n  }\n\n  function findViewNameBySubclass(viewSubclass, configs) {\n    var superProto = Object.getPrototypeOf(viewSubclass.prototype);\n\n    for (var viewType in configs) {\n      var parsed = configs[viewType]; // need DIRECT subclass, so instanceof won't do it\n\n      if (parsed.class && parsed.class.prototype === superProto) {\n        return viewType;\n      }\n    }\n\n    return '';\n  }\n\n  function parseViewConfigs(inputs) {\n    return mapHash(inputs, parseViewConfig);\n  }\n\n  var VIEW_DEF_PROPS = {\n    type: String,\n    class: null\n  };\n\n  function parseViewConfig(input) {\n    if (typeof input === 'function') {\n      input = {\n        class: input\n      };\n    }\n\n    var options = {};\n    var props = refineProps(input, VIEW_DEF_PROPS, {}, options);\n    return {\n      superType: props.type,\n      class: props.class,\n      options: options\n    };\n  }\n\n  function buildViewSpecs(defaultInputs, optionsManager) {\n    var defaultConfigs = parseViewConfigs(defaultInputs);\n    var overrideConfigs = parseViewConfigs(optionsManager.overrides.views);\n    var viewDefs = compileViewDefs(defaultConfigs, overrideConfigs);\n    return mapHash(viewDefs, function (viewDef) {\n      return buildViewSpec(viewDef, overrideConfigs, optionsManager);\n    });\n  }\n\n  function buildViewSpec(viewDef, overrideConfigs, optionsManager) {\n    var durationInput = viewDef.overrides.duration || viewDef.defaults.duration || optionsManager.dynamicOverrides.duration || optionsManager.overrides.duration;\n    var duration = null;\n    var durationUnit = '';\n    var singleUnit = '';\n    var singleUnitOverrides = {};\n\n    if (durationInput) {\n      duration = createDuration(durationInput);\n\n      if (duration) {\n        // valid?\n        var denom = greatestDurationDenominator(duration, !getWeeksFromInput(durationInput));\n        durationUnit = denom.unit;\n\n        if (denom.value === 1) {\n          singleUnit = durationUnit;\n          singleUnitOverrides = overrideConfigs[durationUnit] ? overrideConfigs[durationUnit].options : {};\n        }\n      }\n    }\n\n    var queryButtonText = function queryButtonText(options) {\n      var buttonTextMap = options.buttonText || {};\n      var buttonTextKey = viewDef.defaults.buttonTextKey;\n\n      if (buttonTextKey != null && buttonTextMap[buttonTextKey] != null) {\n        return buttonTextMap[buttonTextKey];\n      }\n\n      if (buttonTextMap[viewDef.type] != null) {\n        return buttonTextMap[viewDef.type];\n      }\n\n      if (buttonTextMap[singleUnit] != null) {\n        return buttonTextMap[singleUnit];\n      }\n    };\n\n    return {\n      type: viewDef.type,\n      class: viewDef.class,\n      duration: duration,\n      durationUnit: durationUnit,\n      singleUnit: singleUnit,\n      options: _assign({}, globalDefaults, viewDef.defaults, optionsManager.dirDefaults, optionsManager.localeDefaults, optionsManager.overrides, singleUnitOverrides, viewDef.overrides, optionsManager.dynamicOverrides),\n      buttonTextOverride: queryButtonText(optionsManager.dynamicOverrides) || queryButtonText(optionsManager.overrides) || // constructor-specified buttonText lookup hash takes precedence\n      viewDef.overrides.buttonText,\n      buttonTextDefault: queryButtonText(optionsManager.localeDefaults) || queryButtonText(optionsManager.dirDefaults) || viewDef.defaults.buttonText || queryButtonText(globalDefaults) || viewDef.type // fall back to given view name\n\n    };\n  }\n\n  var Toolbar =\n  /** @class */\n  function (_super) {\n    __extends(Toolbar, _super);\n\n    function Toolbar(context, extraClassName) {\n      var _this = _super.call(this, context) || this;\n\n      _this._renderLayout = memoizeRendering(_this.renderLayout, _this.unrenderLayout);\n      _this._updateTitle = memoizeRendering(_this.updateTitle, null, [_this._renderLayout]);\n      _this._updateActiveButton = memoizeRendering(_this.updateActiveButton, null, [_this._renderLayout]);\n      _this._updateToday = memoizeRendering(_this.updateToday, null, [_this._renderLayout]);\n      _this._updatePrev = memoizeRendering(_this.updatePrev, null, [_this._renderLayout]);\n      _this._updateNext = memoizeRendering(_this.updateNext, null, [_this._renderLayout]);\n      _this.el = createElement('div', {\n        className: 'fc-toolbar ' + extraClassName\n      });\n      return _this;\n    }\n\n    Toolbar.prototype.destroy = function () {\n      _super.prototype.destroy.call(this);\n\n      this._renderLayout.unrender(); // should unrender everything else\n\n\n      removeElement(this.el);\n    };\n\n    Toolbar.prototype.render = function (props) {\n      this._renderLayout(props.layout);\n\n      this._updateTitle(props.title);\n\n      this._updateActiveButton(props.activeButton);\n\n      this._updateToday(props.isTodayEnabled);\n\n      this._updatePrev(props.isPrevEnabled);\n\n      this._updateNext(props.isNextEnabled);\n    };\n\n    Toolbar.prototype.renderLayout = function (layout) {\n      var el = this.el;\n      this.viewsWithButtons = [];\n      appendToElement(el, this.renderSection('left', layout.left));\n      appendToElement(el, this.renderSection('center', layout.center));\n      appendToElement(el, this.renderSection('right', layout.right));\n    };\n\n    Toolbar.prototype.unrenderLayout = function () {\n      this.el.innerHTML = '';\n    };\n\n    Toolbar.prototype.renderSection = function (position, buttonStr) {\n      var _this = this;\n\n      var _a = this,\n          theme = _a.theme,\n          calendar = _a.calendar;\n\n      var optionsManager = calendar.optionsManager;\n      var viewSpecs = calendar.viewSpecs;\n      var sectionEl = createElement('div', {\n        className: 'fc-' + position\n      });\n      var calendarCustomButtons = optionsManager.computed.customButtons || {};\n      var calendarButtonTextOverrides = optionsManager.overrides.buttonText || {};\n      var calendarButtonText = optionsManager.computed.buttonText || {};\n\n      if (buttonStr) {\n        buttonStr.split(' ').forEach(function (buttonGroupStr, i) {\n          var groupChildren = [];\n          var isOnlyButtons = true;\n          var groupEl;\n          buttonGroupStr.split(',').forEach(function (buttonName, j) {\n            var customButtonProps;\n            var viewSpec;\n            var buttonClick;\n            var buttonIcon; // only one of these will be set\n\n            var buttonText; // \"\n\n            var buttonInnerHtml;\n            var buttonClasses;\n            var buttonEl;\n            var buttonAriaAttr;\n\n            if (buttonName === 'title') {\n              groupChildren.push(htmlToElement('<h2>&nbsp;</h2>')); // we always want it to take up height\n\n              isOnlyButtons = false;\n            } else {\n              if (customButtonProps = calendarCustomButtons[buttonName]) {\n                buttonClick = function buttonClick(ev) {\n                  if (customButtonProps.click) {\n                    customButtonProps.click.call(buttonEl, ev);\n                  }\n                };\n\n                (buttonIcon = theme.getCustomButtonIconClass(customButtonProps)) || (buttonIcon = theme.getIconClass(buttonName)) || (buttonText = customButtonProps.text);\n              } else if (viewSpec = viewSpecs[buttonName]) {\n                _this.viewsWithButtons.push(buttonName);\n\n                buttonClick = function buttonClick() {\n                  calendar.changeView(buttonName);\n                };\n\n                (buttonText = viewSpec.buttonTextOverride) || (buttonIcon = theme.getIconClass(buttonName)) || (buttonText = viewSpec.buttonTextDefault);\n              } else if (calendar[buttonName]) {\n                // a calendar method\n                buttonClick = function buttonClick() {\n                  calendar[buttonName]();\n                };\n\n                (buttonText = calendarButtonTextOverrides[buttonName]) || (buttonIcon = theme.getIconClass(buttonName)) || (buttonText = calendarButtonText[buttonName]); //            ^ everything else is considered default\n              }\n\n              if (buttonClick) {\n                buttonClasses = ['fc-' + buttonName + '-button', theme.getClass('button')];\n\n                if (buttonText) {\n                  buttonInnerHtml = htmlEscape(buttonText);\n                  buttonAriaAttr = '';\n                } else if (buttonIcon) {\n                  buttonInnerHtml = \"<span class='\" + buttonIcon + \"'></span>\";\n                  buttonAriaAttr = ' aria-label=\"' + buttonName + '\"';\n                }\n\n                buttonEl = htmlToElement( // type=\"button\" so that it doesn't submit a form\n                '<button type=\"button\" class=\"' + buttonClasses.join(' ') + '\"' + buttonAriaAttr + '>' + buttonInnerHtml + '</button>');\n                buttonEl.addEventListener('click', buttonClick);\n                groupChildren.push(buttonEl);\n              }\n            }\n          });\n\n          if (groupChildren.length > 1) {\n            groupEl = document.createElement('div');\n            var buttonGroupClassName = theme.getClass('buttonGroup');\n\n            if (isOnlyButtons && buttonGroupClassName) {\n              groupEl.classList.add(buttonGroupClassName);\n            }\n\n            appendToElement(groupEl, groupChildren);\n            sectionEl.appendChild(groupEl);\n          } else {\n            appendToElement(sectionEl, groupChildren); // 1 or 0 children\n          }\n        });\n      }\n\n      return sectionEl;\n    };\n\n    Toolbar.prototype.updateToday = function (isTodayEnabled) {\n      this.toggleButtonEnabled('today', isTodayEnabled);\n    };\n\n    Toolbar.prototype.updatePrev = function (isPrevEnabled) {\n      this.toggleButtonEnabled('prev', isPrevEnabled);\n    };\n\n    Toolbar.prototype.updateNext = function (isNextEnabled) {\n      this.toggleButtonEnabled('next', isNextEnabled);\n    };\n\n    Toolbar.prototype.updateTitle = function (text) {\n      findElements(this.el, 'h2').forEach(function (titleEl) {\n        titleEl.innerText = text;\n      });\n    };\n\n    Toolbar.prototype.updateActiveButton = function (buttonName) {\n      var className = this.theme.getClass('buttonActive');\n      findElements(this.el, 'button').forEach(function (buttonEl) {\n        if (buttonName && buttonEl.classList.contains('fc-' + buttonName + '-button')) {\n          buttonEl.classList.add(className);\n        } else {\n          buttonEl.classList.remove(className);\n        }\n      });\n    };\n\n    Toolbar.prototype.toggleButtonEnabled = function (buttonName, bool) {\n      findElements(this.el, '.fc-' + buttonName + '-button').forEach(function (buttonEl) {\n        buttonEl.disabled = !bool;\n      });\n    };\n\n    return Toolbar;\n  }(Component);\n\n  var CalendarComponent =\n  /** @class */\n  function (_super) {\n    __extends(CalendarComponent, _super);\n\n    function CalendarComponent(context, el) {\n      var _this = _super.call(this, context) || this;\n\n      _this._renderToolbars = memoizeRendering(_this.renderToolbars);\n      _this.buildViewPropTransformers = memoize(buildViewPropTransformers);\n      _this.el = el;\n      prependToElement(el, _this.contentEl = createElement('div', {\n        className: 'fc-view-container'\n      }));\n      var calendar = _this.calendar;\n\n      for (var _i = 0, _a = calendar.pluginSystem.hooks.viewContainerModifiers; _i < _a.length; _i++) {\n        var modifyViewContainer = _a[_i];\n        modifyViewContainer(_this.contentEl, calendar);\n      }\n\n      _this.toggleElClassNames(true);\n\n      _this.computeTitle = memoize(computeTitle);\n      _this.parseBusinessHours = memoize(function (input) {\n        return parseBusinessHours(input, _this.calendar);\n      });\n      return _this;\n    }\n\n    CalendarComponent.prototype.destroy = function () {\n      if (this.header) {\n        this.header.destroy();\n      }\n\n      if (this.footer) {\n        this.footer.destroy();\n      }\n\n      if (this.view) {\n        this.view.destroy();\n      }\n\n      removeElement(this.contentEl);\n      this.toggleElClassNames(false);\n\n      _super.prototype.destroy.call(this);\n    };\n\n    CalendarComponent.prototype.toggleElClassNames = function (bool) {\n      var classList = this.el.classList;\n      var dirClassName = 'fc-' + this.opt('dir');\n      var themeClassName = this.theme.getClass('widget');\n\n      if (bool) {\n        classList.add('fc');\n        classList.add(dirClassName);\n        classList.add(themeClassName);\n      } else {\n        classList.remove('fc');\n        classList.remove(dirClassName);\n        classList.remove(themeClassName);\n      }\n    };\n\n    CalendarComponent.prototype.render = function (props) {\n      this.freezeHeight();\n      var title = this.computeTitle(props.dateProfile, props.viewSpec.options);\n\n      this._renderToolbars(props.viewSpec, props.dateProfile, props.currentDate, props.dateProfileGenerator, title);\n\n      this.renderView(props, title);\n      this.updateSize();\n      this.thawHeight();\n    };\n\n    CalendarComponent.prototype.renderToolbars = function (viewSpec, dateProfile, currentDate, dateProfileGenerator, title) {\n      var headerLayout = this.opt('header');\n      var footerLayout = this.opt('footer');\n      var now = this.calendar.getNow();\n      var todayInfo = dateProfileGenerator.build(now);\n      var prevInfo = dateProfileGenerator.buildPrev(dateProfile, currentDate);\n      var nextInfo = dateProfileGenerator.buildNext(dateProfile, currentDate);\n      var toolbarProps = {\n        title: title,\n        activeButton: viewSpec.type,\n        isTodayEnabled: todayInfo.isValid && !rangeContainsMarker(dateProfile.currentRange, now),\n        isPrevEnabled: prevInfo.isValid,\n        isNextEnabled: nextInfo.isValid\n      };\n\n      if (headerLayout) {\n        if (!this.header) {\n          this.header = new Toolbar(this.context, 'fc-header-toolbar');\n          prependToElement(this.el, this.header.el);\n        }\n\n        this.header.receiveProps(_assign({\n          layout: headerLayout\n        }, toolbarProps));\n      } else if (this.header) {\n        this.header.destroy();\n        this.header = null;\n      }\n\n      if (footerLayout) {\n        if (!this.footer) {\n          this.footer = new Toolbar(this.context, 'fc-footer-toolbar');\n          appendToElement(this.el, this.footer.el);\n        }\n\n        this.footer.receiveProps(_assign({\n          layout: footerLayout\n        }, toolbarProps));\n      } else if (this.footer) {\n        this.footer.destroy();\n        this.footer = null;\n      }\n    };\n\n    CalendarComponent.prototype.renderView = function (props, title) {\n      var view = this.view;\n      var viewSpec = props.viewSpec,\n          dateProfileGenerator = props.dateProfileGenerator;\n\n      if (!view || view.viewSpec !== viewSpec) {\n        if (view) {\n          view.destroy();\n        }\n\n        view = this.view = new viewSpec['class']({\n          calendar: this.calendar,\n          view: null,\n          dateEnv: this.dateEnv,\n          theme: this.theme,\n          options: viewSpec.options\n        }, viewSpec, dateProfileGenerator, this.contentEl);\n      } else {\n        view.addScroll(view.queryScroll());\n      }\n\n      view.title = title; // for the API\n\n      var viewProps = {\n        dateProfile: props.dateProfile,\n        businessHours: this.parseBusinessHours(viewSpec.options.businessHours),\n        eventStore: props.eventStore,\n        eventUiBases: props.eventUiBases,\n        dateSelection: props.dateSelection,\n        eventSelection: props.eventSelection,\n        eventDrag: props.eventDrag,\n        eventResize: props.eventResize\n      };\n      var transformers = this.buildViewPropTransformers(this.calendar.pluginSystem.hooks.viewPropsTransformers);\n\n      for (var _i = 0, transformers_1 = transformers; _i < transformers_1.length; _i++) {\n        var transformer = transformers_1[_i];\n\n        _assign(viewProps, transformer.transform(viewProps, viewSpec, props, view));\n      }\n\n      view.receiveProps(viewProps);\n    }; // Sizing\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    CalendarComponent.prototype.updateSize = function (isResize) {\n      if (isResize === void 0) {\n        isResize = false;\n      }\n\n      var view = this.view;\n\n      if (isResize) {\n        view.addScroll(view.queryScroll());\n      }\n\n      if (isResize || this.isHeightAuto == null) {\n        this.computeHeightVars();\n      }\n\n      view.updateSize(isResize, this.viewHeight, this.isHeightAuto);\n      view.updateNowIndicator(); // we need to guarantee this will run after updateSize\n\n      view.popScroll(isResize);\n    };\n\n    CalendarComponent.prototype.computeHeightVars = function () {\n      var calendar = this.calendar; // yuck. need to handle dynamic options\n\n      var heightInput = calendar.opt('height');\n      var contentHeightInput = calendar.opt('contentHeight');\n      this.isHeightAuto = heightInput === 'auto' || contentHeightInput === 'auto';\n\n      if (typeof contentHeightInput === 'number') {\n        // exists and not 'auto'\n        this.viewHeight = contentHeightInput;\n      } else if (typeof contentHeightInput === 'function') {\n        // exists and is a function\n        this.viewHeight = contentHeightInput();\n      } else if (typeof heightInput === 'number') {\n        // exists and not 'auto'\n        this.viewHeight = heightInput - this.queryToolbarsHeight();\n      } else if (typeof heightInput === 'function') {\n        // exists and is a function\n        this.viewHeight = heightInput() - this.queryToolbarsHeight();\n      } else if (heightInput === 'parent') {\n        // set to height of parent element\n        this.viewHeight = this.el.parentNode.offsetHeight - this.queryToolbarsHeight();\n      } else {\n        this.viewHeight = Math.round(this.contentEl.offsetWidth / Math.max(calendar.opt('aspectRatio'), .5));\n      }\n    };\n\n    CalendarComponent.prototype.queryToolbarsHeight = function () {\n      var height = 0;\n\n      if (this.header) {\n        height += computeHeightAndMargins(this.header.el);\n      }\n\n      if (this.footer) {\n        height += computeHeightAndMargins(this.footer.el);\n      }\n\n      return height;\n    }; // Height \"Freezing\"\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    CalendarComponent.prototype.freezeHeight = function () {\n      applyStyle(this.el, {\n        height: this.el.offsetHeight,\n        overflow: 'hidden'\n      });\n    };\n\n    CalendarComponent.prototype.thawHeight = function () {\n      applyStyle(this.el, {\n        height: '',\n        overflow: ''\n      });\n    };\n\n    return CalendarComponent;\n  }(Component); // Title and Date Formatting\n  // -----------------------------------------------------------------------------------------------------------------\n  // Computes what the title at the top of the calendar should be for this view\n\n\n  function computeTitle(dateProfile, viewOptions) {\n    var range; // for views that span a large unit of time, show the proper interval, ignoring stray days before and after\n\n    if (/^(year|month)$/.test(dateProfile.currentRangeUnit)) {\n      range = dateProfile.currentRange;\n    } else {\n      // for day units or smaller, use the actual day range\n      range = dateProfile.activeRange;\n    }\n\n    return this.dateEnv.formatRange(range.start, range.end, createFormatter(viewOptions.titleFormat || computeTitleFormat(dateProfile), viewOptions.titleRangeSeparator), {\n      isEndExclusive: dateProfile.isRangeAllDay\n    });\n  } // Generates the format string that should be used to generate the title for the current date range.\n  // Attempts to compute the most appropriate format if not explicitly specified with `titleFormat`.\n\n\n  function computeTitleFormat(dateProfile) {\n    var currentRangeUnit = dateProfile.currentRangeUnit;\n\n    if (currentRangeUnit === 'year') {\n      return {\n        year: 'numeric'\n      };\n    } else if (currentRangeUnit === 'month') {\n      return {\n        year: 'numeric',\n        month: 'long'\n      }; // like \"September 2014\"\n    } else {\n      var days = diffWholeDays(dateProfile.currentRange.start, dateProfile.currentRange.end);\n\n      if (days !== null && days > 1) {\n        // multi-day range. shorter, like \"Sep 9 - 10 2014\"\n        return {\n          year: 'numeric',\n          month: 'short',\n          day: 'numeric'\n        };\n      } else {\n        // one day. longer, like \"September 9 2014\"\n        return {\n          year: 'numeric',\n          month: 'long',\n          day: 'numeric'\n        };\n      }\n    }\n  } // Plugin\n  // -----------------------------------------------------------------------------------------------------------------\n\n\n  function buildViewPropTransformers(theClasses) {\n    return theClasses.map(function (theClass) {\n      return new theClass();\n    });\n  }\n\n  var Interaction =\n  /** @class */\n  function () {\n    function Interaction(settings) {\n      this.component = settings.component;\n    }\n\n    Interaction.prototype.destroy = function () {};\n\n    return Interaction;\n  }();\n\n  function parseInteractionSettings(component, input) {\n    return {\n      component: component,\n      el: input.el,\n      useEventCenter: input.useEventCenter != null ? input.useEventCenter : true\n    };\n  }\n\n  function interactionSettingsToStore(settings) {\n    var _a;\n\n    return _a = {}, _a[settings.component.uid] = settings, _a;\n  } // global state\n\n\n  var interactionSettingsStore = {};\n  /*\n  Detects when the user clicks on an event within a DateComponent\n  */\n\n  var EventClicking =\n  /** @class */\n  function (_super) {\n    __extends(EventClicking, _super);\n\n    function EventClicking(settings) {\n      var _this = _super.call(this, settings) || this;\n\n      _this.handleSegClick = function (ev, segEl) {\n        var component = _this.component;\n        var seg = getElSeg(segEl);\n\n        if (seg && // might be the <div> surrounding the more link\n        component.isValidSegDownEl(ev.target)) {\n          // our way to simulate a link click for elements that can't be <a> tags\n          // grab before trigger fired in case trigger trashes DOM thru rerendering\n          var hasUrlContainer = elementClosest(ev.target, '.fc-has-url');\n          var url = hasUrlContainer ? hasUrlContainer.querySelector('a[href]').href : '';\n          component.publiclyTrigger('eventClick', [{\n            el: segEl,\n            event: new EventApi(component.calendar, seg.eventRange.def, seg.eventRange.instance),\n            jsEvent: ev,\n            view: component.view\n          }]);\n\n          if (url && !ev.defaultPrevented) {\n            window.location.href = url;\n          }\n        }\n      };\n\n      var component = settings.component;\n      _this.destroy = listenBySelector(component.el, 'click', component.fgSegSelector + ',' + component.bgSegSelector, _this.handleSegClick);\n      return _this;\n    }\n\n    return EventClicking;\n  }(Interaction);\n  /*\n  Triggers events and adds/removes core classNames when the user's pointer\n  enters/leaves event-elements of a component.\n  */\n\n\n  var EventHovering =\n  /** @class */\n  function (_super) {\n    __extends(EventHovering, _super);\n\n    function EventHovering(settings) {\n      var _this = _super.call(this, settings) || this; // for simulating an eventMouseLeave when the event el is destroyed while mouse is over it\n\n\n      _this.handleEventElRemove = function (el) {\n        if (el === _this.currentSegEl) {\n          _this.handleSegLeave(null, _this.currentSegEl);\n        }\n      };\n\n      _this.handleSegEnter = function (ev, segEl) {\n        if (getElSeg(segEl)) {\n          // TODO: better way to make sure not hovering over more+ link or its wrapper\n          segEl.classList.add('fc-allow-mouse-resize');\n          _this.currentSegEl = segEl;\n\n          _this.triggerEvent('eventMouseEnter', ev, segEl);\n        }\n      };\n\n      _this.handleSegLeave = function (ev, segEl) {\n        if (_this.currentSegEl) {\n          segEl.classList.remove('fc-allow-mouse-resize');\n          _this.currentSegEl = null;\n\n          _this.triggerEvent('eventMouseLeave', ev, segEl);\n        }\n      };\n\n      var component = settings.component;\n      _this.removeHoverListeners = listenToHoverBySelector(component.el, component.fgSegSelector + ',' + component.bgSegSelector, _this.handleSegEnter, _this.handleSegLeave);\n      component.calendar.on('eventElRemove', _this.handleEventElRemove);\n      return _this;\n    }\n\n    EventHovering.prototype.destroy = function () {\n      this.removeHoverListeners();\n      this.component.calendar.off('eventElRemove', this.handleEventElRemove);\n    };\n\n    EventHovering.prototype.triggerEvent = function (publicEvName, ev, segEl) {\n      var component = this.component;\n      var seg = getElSeg(segEl);\n\n      if (!ev || component.isValidSegDownEl(ev.target)) {\n        component.publiclyTrigger(publicEvName, [{\n          el: segEl,\n          event: new EventApi(this.component.calendar, seg.eventRange.def, seg.eventRange.instance),\n          jsEvent: ev,\n          view: component.view\n        }]);\n      }\n    };\n\n    return EventHovering;\n  }(Interaction);\n\n  var StandardTheme =\n  /** @class */\n  function (_super) {\n    __extends(StandardTheme, _super);\n\n    function StandardTheme() {\n      return _super !== null && _super.apply(this, arguments) || this;\n    }\n\n    return StandardTheme;\n  }(Theme);\n\n  StandardTheme.prototype.classes = {\n    widget: 'fc-unthemed',\n    widgetHeader: 'fc-widget-header',\n    widgetContent: 'fc-widget-content',\n    buttonGroup: 'fc-button-group',\n    button: 'fc-button fc-button-primary',\n    buttonActive: 'fc-button-active',\n    popoverHeader: 'fc-widget-header',\n    popoverContent: 'fc-widget-content',\n    // day grid\n    headerRow: 'fc-widget-header',\n    dayRow: 'fc-widget-content',\n    // list view\n    listView: 'fc-widget-content'\n  };\n  StandardTheme.prototype.baseIconClass = 'fc-icon';\n  StandardTheme.prototype.iconClasses = {\n    close: 'fc-icon-x',\n    prev: 'fc-icon-chevron-left',\n    next: 'fc-icon-chevron-right',\n    prevYear: 'fc-icon-chevrons-left',\n    nextYear: 'fc-icon-chevrons-right'\n  };\n  StandardTheme.prototype.iconOverrideOption = 'buttonIcons';\n  StandardTheme.prototype.iconOverrideCustomButtonOption = 'icon';\n  StandardTheme.prototype.iconOverridePrefix = 'fc-icon-';\n\n  var Calendar =\n  /** @class */\n  function () {\n    function Calendar(el, overrides) {\n      var _this = this;\n\n      this.parseRawLocales = memoize(parseRawLocales);\n      this.buildLocale = memoize(buildLocale);\n      this.buildDateEnv = memoize(buildDateEnv);\n      this.buildTheme = memoize(buildTheme);\n      this.buildEventUiSingleBase = memoize(this._buildEventUiSingleBase);\n      this.buildSelectionConfig = memoize(this._buildSelectionConfig);\n      this.buildEventUiBySource = memoizeOutput(buildEventUiBySource, isPropsEqual);\n      this.buildEventUiBases = memoize(buildEventUiBases);\n      this.interactionsStore = {};\n      this.actionQueue = [];\n      this.isReducing = false; // isDisplaying: boolean = false // installed in DOM? accepting renders?\n\n      this.needsRerender = false; // needs a render?\n\n      this.needsFullRerender = false;\n      this.isRendering = false; // currently in the executeRender function?\n\n      this.renderingPauseDepth = 0;\n      this.buildDelayedRerender = memoize(buildDelayedRerender);\n      this.afterSizingTriggers = {};\n      this.isViewUpdated = false;\n      this.isDatesUpdated = false;\n      this.isEventsUpdated = false;\n      this.el = el;\n      this.optionsManager = new OptionsManager(overrides || {});\n      this.pluginSystem = new PluginSystem(); // only do once. don't do in handleOptions. because can't remove plugins\n\n      var pluginDefs = refinePluginDefs(this.optionsManager.computed.plugins || []);\n\n      for (var _i = 0, pluginDefs_1 = pluginDefs; _i < pluginDefs_1.length; _i++) {\n        var pluginDef = pluginDefs_1[_i];\n        this.pluginSystem.add(pluginDef);\n      }\n\n      this.handleOptions(this.optionsManager.computed);\n      this.publiclyTrigger('_init'); // for tests\n\n      this.hydrate();\n      this.calendarInteractions = this.pluginSystem.hooks.calendarInteractions.map(function (calendarInteractionClass) {\n        return new calendarInteractionClass(_this);\n      });\n    }\n\n    Object.defineProperty(Calendar.prototype, \"view\", {\n      // public API\n      get: function get() {\n        return this.component ? this.component.view : null;\n      },\n      enumerable: true,\n      configurable: true\n    }); // Public API for rendering\n    // -----------------------------------------------------------------------------------------------------------------\n\n    Calendar.prototype.render = function () {\n      if (!this.component) {\n        this.renderableEventStore = createEmptyEventStore();\n        this.bindHandlers();\n        this.executeRender();\n      } else {\n        this.requestRerender(true);\n      }\n    };\n\n    Calendar.prototype.destroy = function () {\n      if (this.component) {\n        this.unbindHandlers();\n        this.component.destroy(); // don't null-out. in case API needs access\n\n        this.component = null;\n\n        for (var _i = 0, _a = this.calendarInteractions; _i < _a.length; _i++) {\n          var interaction = _a[_i];\n          interaction.destroy();\n        }\n      }\n    }; // Handlers\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    Calendar.prototype.bindHandlers = function () {\n      var _this = this; // event delegation for nav links\n\n\n      this.removeNavLinkListener = listenBySelector(this.el, 'click', 'a[data-goto]', function (ev, anchorEl) {\n        var gotoOptions = anchorEl.getAttribute('data-goto');\n        gotoOptions = gotoOptions ? JSON.parse(gotoOptions) : {};\n        var dateEnv = _this.dateEnv;\n        var dateMarker = dateEnv.createMarker(gotoOptions.date);\n        var viewType = gotoOptions.type; // property like \"navLinkDayClick\". might be a string or a function\n\n        var customAction = _this.viewOpt('navLink' + capitaliseFirstLetter(viewType) + 'Click');\n\n        if (typeof customAction === 'function') {\n          customAction(dateEnv.toDate(dateMarker), ev);\n        } else {\n          if (typeof customAction === 'string') {\n            viewType = customAction;\n          }\n\n          _this.zoomTo(dateMarker, viewType);\n        }\n      });\n\n      if (this.opt('handleWindowResize')) {\n        window.addEventListener('resize', this.windowResizeProxy = debounce( // prevents rapid calls\n        this.windowResize.bind(this), this.opt('windowResizeDelay')));\n      }\n    };\n\n    Calendar.prototype.unbindHandlers = function () {\n      this.removeNavLinkListener();\n\n      if (this.windowResizeProxy) {\n        window.removeEventListener('resize', this.windowResizeProxy);\n        this.windowResizeProxy = null;\n      }\n    }; // Dispatcher\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    Calendar.prototype.hydrate = function () {\n      var _this = this;\n\n      this.state = this.buildInitialState();\n      var rawSources = this.opt('eventSources') || [];\n      var singleRawSource = this.opt('events');\n      var sources = []; // parsed\n\n      if (singleRawSource) {\n        rawSources.unshift(singleRawSource);\n      }\n\n      for (var _i = 0, rawSources_1 = rawSources; _i < rawSources_1.length; _i++) {\n        var rawSource = rawSources_1[_i];\n        var source = parseEventSource(rawSource, this);\n\n        if (source) {\n          sources.push(source);\n        }\n      }\n\n      this.batchRendering(function () {\n        _this.dispatch({\n          type: 'INIT'\n        }); // pass in sources here?\n\n\n        _this.dispatch({\n          type: 'ADD_EVENT_SOURCES',\n          sources: sources\n        });\n\n        _this.dispatch({\n          type: 'SET_VIEW_TYPE',\n          viewType: _this.opt('defaultView') || _this.pluginSystem.hooks.defaultView\n        });\n      });\n    };\n\n    Calendar.prototype.buildInitialState = function () {\n      return {\n        viewType: null,\n        loadingLevel: 0,\n        eventSourceLoadingLevel: 0,\n        currentDate: this.getInitialDate(),\n        dateProfile: null,\n        eventSources: {},\n        eventStore: createEmptyEventStore(),\n        dateSelection: null,\n        eventSelection: '',\n        eventDrag: null,\n        eventResize: null\n      };\n    };\n\n    Calendar.prototype.dispatch = function (action) {\n      this.actionQueue.push(action);\n\n      if (!this.isReducing) {\n        this.isReducing = true;\n        var oldState = this.state;\n\n        while (this.actionQueue.length) {\n          this.state = this.reduce(this.state, this.actionQueue.shift(), this);\n        }\n\n        var newState = this.state;\n        this.isReducing = false;\n\n        if (!oldState.loadingLevel && newState.loadingLevel) {\n          this.publiclyTrigger('loading', [true]);\n        } else if (oldState.loadingLevel && !newState.loadingLevel) {\n          this.publiclyTrigger('loading', [false]);\n        }\n\n        var view = this.component && this.component.view;\n\n        if (oldState.eventStore !== newState.eventStore || this.needsFullRerender) {\n          if (oldState.eventStore) {\n            this.isEventsUpdated = true;\n          }\n        }\n\n        if (oldState.dateProfile !== newState.dateProfile || this.needsFullRerender) {\n          if (oldState.dateProfile && view) {\n            // why would view be null!?\n            this.publiclyTrigger('datesDestroy', [{\n              view: view,\n              el: view.el\n            }]);\n          }\n\n          this.isDatesUpdated = true;\n        }\n\n        if (oldState.viewType !== newState.viewType || this.needsFullRerender) {\n          if (oldState.viewType && view) {\n            // why would view be null!?\n            this.publiclyTrigger('viewSkeletonDestroy', [{\n              view: view,\n              el: view.el\n            }]);\n          }\n\n          this.isViewUpdated = true;\n        }\n\n        this.requestRerender();\n      }\n    };\n\n    Calendar.prototype.reduce = function (state, action, calendar) {\n      return reduce(state, action, calendar);\n    }; // Render Queue\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    Calendar.prototype.requestRerender = function (needsFull) {\n      if (needsFull === void 0) {\n        needsFull = false;\n      }\n\n      this.needsRerender = true;\n      this.needsFullRerender = this.needsFullRerender || needsFull;\n      this.delayedRerender(); // will call a debounced-version of tryRerender\n    };\n\n    Calendar.prototype.tryRerender = function () {\n      if (this.component && // must be accepting renders\n      this.needsRerender && // indicates that a rerender was requested\n      !this.renderingPauseDepth && // not paused\n      !this.isRendering // not currently in the render loop\n      ) {\n          this.executeRender();\n        }\n    };\n\n    Calendar.prototype.batchRendering = function (func) {\n      this.renderingPauseDepth++;\n      func();\n      this.renderingPauseDepth--;\n      this.requestRerender();\n    }; // Rendering\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    Calendar.prototype.executeRender = function () {\n      var needsFullRerender = this.needsFullRerender; // save before clearing\n      // clear these BEFORE the render so that new values will accumulate during render\n\n      this.needsRerender = false;\n      this.needsFullRerender = false;\n      this.isRendering = true;\n      this.renderComponent(needsFullRerender);\n      this.isRendering = false; // received a rerender request while rendering\n\n      if (this.needsRerender) {\n        this.delayedRerender();\n      }\n    };\n    /*\n    don't call this directly. use executeRender instead\n    */\n\n\n    Calendar.prototype.renderComponent = function (needsFull) {\n      var _a = this,\n          state = _a.state,\n          component = _a.component;\n\n      var viewType = state.viewType;\n      var viewSpec = this.viewSpecs[viewType];\n      var savedScroll = needsFull && component ? component.view.queryScroll() : null;\n\n      if (!viewSpec) {\n        throw new Error(\"View type \\\"\" + viewType + \"\\\" is not valid\");\n      } // if event sources are still loading and progressive rendering hasn't been enabled,\n      // keep rendering the last fully loaded set of events\n\n\n      var renderableEventStore = this.renderableEventStore = state.eventSourceLoadingLevel && !this.opt('progressiveEventRendering') ? this.renderableEventStore : state.eventStore;\n      var eventUiSingleBase = this.buildEventUiSingleBase(viewSpec.options);\n      var eventUiBySource = this.buildEventUiBySource(state.eventSources);\n      var eventUiBases = this.eventUiBases = this.buildEventUiBases(renderableEventStore.defs, eventUiSingleBase, eventUiBySource);\n\n      if (needsFull || !component) {\n        if (component) {\n          component.freezeHeight(); // next component will unfreeze it\n\n          component.destroy();\n        }\n\n        component = this.component = new CalendarComponent({\n          calendar: this,\n          view: null,\n          dateEnv: this.dateEnv,\n          theme: this.theme,\n          options: this.optionsManager.computed\n        }, this.el);\n      }\n\n      component.receiveProps(_assign({}, state, {\n        viewSpec: viewSpec,\n        dateProfile: state.dateProfile,\n        dateProfileGenerator: this.dateProfileGenerators[viewType],\n        eventStore: renderableEventStore,\n        eventUiBases: eventUiBases,\n        dateSelection: state.dateSelection,\n        eventSelection: state.eventSelection,\n        eventDrag: state.eventDrag,\n        eventResize: state.eventResize\n      }));\n\n      if (savedScroll) {\n        component.view.applyScroll(savedScroll, false);\n      }\n\n      if (this.isViewUpdated) {\n        this.isViewUpdated = false;\n        this.publiclyTrigger('viewSkeletonRender', [{\n          view: component.view,\n          el: component.view.el\n        }]);\n      }\n\n      if (this.isDatesUpdated) {\n        this.isDatesUpdated = false;\n        this.publiclyTrigger('datesRender', [{\n          view: component.view,\n          el: component.view.el\n        }]);\n      }\n\n      if (this.isEventsUpdated) {\n        this.isEventsUpdated = false;\n      }\n\n      this.releaseAfterSizingTriggers();\n    }; // Options\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    Calendar.prototype.setOption = function (name, value) {\n      var _this = this;\n\n      var oldDateEnv = this.dateEnv;\n      this.optionsManager.add(name, value);\n      this.handleOptions(this.optionsManager.computed);\n\n      if (name === 'height' || name === 'contentHeight' || name === 'aspectRatio') {\n        this.updateSize();\n      } else if (name === 'defaultDate' || name === 'defaultView') ;else if (/^(event|select)(Overlap|Constraint|Allow)$/.test(name)) ;else {\n        this.needsFullRerender = true;\n        this.batchRendering(function () {\n          if (name === 'timeZone') {\n            _this.dispatch({\n              type: 'CHANGE_TIMEZONE',\n              oldDateEnv: oldDateEnv\n            });\n          }\n          /* HACK\n          has the same effect as calling this.requestRerender(true)\n          but recomputes the state's dateProfile\n          */\n\n\n          _this.dispatch({\n            type: 'SET_VIEW_TYPE',\n            viewType: _this.state.viewType\n          });\n        });\n      }\n    };\n\n    Calendar.prototype.getOption = function (name) {\n      return this.optionsManager.computed[name];\n    };\n\n    Calendar.prototype.opt = function (name) {\n      return this.optionsManager.computed[name];\n    };\n\n    Calendar.prototype.viewOpt = function (name) {\n      return this.viewOpts()[name];\n    };\n\n    Calendar.prototype.viewOpts = function () {\n      return this.viewSpecs[this.state.viewType].options;\n    };\n\n    Calendar.prototype.handleOptions = function (options) {\n      var _this = this;\n\n      var pluginHooks = this.pluginSystem.hooks;\n      this.defaultAllDayEventDuration = createDuration(options.defaultAllDayEventDuration);\n      this.defaultTimedEventDuration = createDuration(options.defaultTimedEventDuration);\n      this.delayedRerender = this.buildDelayedRerender(options.rerenderDelay);\n      this.theme = this.buildTheme(options);\n      var available = this.parseRawLocales(options.locales);\n      this.availableRawLocales = available.map;\n      var locale = this.buildLocale(options.locale || available.defaultCode, available.map);\n      this.dateEnv = this.buildDateEnv(locale, options.timeZone, pluginHooks.namedTimeZonedImpl, options.firstDay, options.weekNumberCalculation, options.weekLabel, pluginHooks.cmdFormatter);\n      this.selectionConfig = this.buildSelectionConfig(options); // needs dateEnv. do after :(\n      // ineffecient to do every time?\n\n      this.viewSpecs = buildViewSpecs(pluginHooks.views, this.optionsManager); // ineffecient to do every time?\n\n      this.dateProfileGenerators = mapHash(this.viewSpecs, function (viewSpec) {\n        return new viewSpec.class.prototype.dateProfileGeneratorClass(viewSpec, _this);\n      });\n    };\n\n    Calendar.prototype.getAvailableLocaleCodes = function () {\n      return Object.keys(this.availableRawLocales);\n    };\n\n    Calendar.prototype._buildSelectionConfig = function (rawOpts) {\n      return processScopedUiProps('select', rawOpts, this);\n    };\n\n    Calendar.prototype._buildEventUiSingleBase = function (rawOpts) {\n      if (rawOpts.editable) {\n        // so 'editable' affected events\n        rawOpts = _assign({}, rawOpts, {\n          eventEditable: true\n        });\n      }\n\n      return processScopedUiProps('event', rawOpts, this);\n    }; // Trigger\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    Calendar.prototype.hasPublicHandlers = function (name) {\n      return this.hasHandlers(name) || this.opt(name); // handler specified in options\n    };\n\n    Calendar.prototype.publiclyTrigger = function (name, args) {\n      var optHandler = this.opt(name);\n      this.triggerWith(name, this, args);\n\n      if (optHandler) {\n        return optHandler.apply(this, args);\n      }\n    };\n\n    Calendar.prototype.publiclyTriggerAfterSizing = function (name, args) {\n      var afterSizingTriggers = this.afterSizingTriggers;\n      (afterSizingTriggers[name] || (afterSizingTriggers[name] = [])).push(args);\n    };\n\n    Calendar.prototype.releaseAfterSizingTriggers = function () {\n      var afterSizingTriggers = this.afterSizingTriggers;\n\n      for (var name_1 in afterSizingTriggers) {\n        for (var _i = 0, _a = afterSizingTriggers[name_1]; _i < _a.length; _i++) {\n          var args = _a[_i];\n          this.publiclyTrigger(name_1, args);\n        }\n      }\n\n      this.afterSizingTriggers = {};\n    }; // View\n    // -----------------------------------------------------------------------------------------------------------------\n    // Returns a boolean about whether the view is okay to instantiate at some point\n\n\n    Calendar.prototype.isValidViewType = function (viewType) {\n      return Boolean(this.viewSpecs[viewType]);\n    };\n\n    Calendar.prototype.changeView = function (viewType, dateOrRange) {\n      var dateMarker = null;\n\n      if (dateOrRange) {\n        if (dateOrRange.start && dateOrRange.end) {\n          // a range\n          this.optionsManager.add('visibleRange', dateOrRange); // will not rerender\n\n          this.handleOptions(this.optionsManager.computed); // ...but yuck\n        } else {\n          // a date\n          dateMarker = this.dateEnv.createMarker(dateOrRange); // just like gotoDate\n        }\n      }\n\n      this.unselect();\n      this.dispatch({\n        type: 'SET_VIEW_TYPE',\n        viewType: viewType,\n        dateMarker: dateMarker\n      });\n    }; // Forces navigation to a view for the given date.\n    // `viewType` can be a specific view name or a generic one like \"week\" or \"day\".\n    // needs to change\n\n\n    Calendar.prototype.zoomTo = function (dateMarker, viewType) {\n      var spec;\n      viewType = viewType || 'day'; // day is default zoom\n\n      spec = this.viewSpecs[viewType] || this.getUnitViewSpec(viewType);\n      this.unselect();\n\n      if (spec) {\n        this.dispatch({\n          type: 'SET_VIEW_TYPE',\n          viewType: spec.type,\n          dateMarker: dateMarker\n        });\n      } else {\n        this.dispatch({\n          type: 'SET_DATE',\n          dateMarker: dateMarker\n        });\n      }\n    }; // Given a duration singular unit, like \"week\" or \"day\", finds a matching view spec.\n    // Preference is given to views that have corresponding buttons.\n\n\n    Calendar.prototype.getUnitViewSpec = function (unit) {\n      var viewTypes;\n      var i;\n      var spec; // put views that have buttons first. there will be duplicates, but oh well\n\n      viewTypes = this.component.header.viewsWithButtons; // TODO: include footer as well?\n\n      for (var viewType in this.viewSpecs) {\n        viewTypes.push(viewType);\n      }\n\n      for (i = 0; i < viewTypes.length; i++) {\n        spec = this.viewSpecs[viewTypes[i]];\n\n        if (spec) {\n          if (spec.singleUnit === unit) {\n            return spec;\n          }\n        }\n      }\n    }; // Current Date\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    Calendar.prototype.getInitialDate = function () {\n      var defaultDateInput = this.opt('defaultDate'); // compute the initial ambig-timezone date\n\n      if (defaultDateInput != null) {\n        return this.dateEnv.createMarker(defaultDateInput);\n      } else {\n        return this.getNow(); // getNow already returns unzoned\n      }\n    };\n\n    Calendar.prototype.prev = function () {\n      this.unselect();\n      this.dispatch({\n        type: 'PREV'\n      });\n    };\n\n    Calendar.prototype.next = function () {\n      this.unselect();\n      this.dispatch({\n        type: 'NEXT'\n      });\n    };\n\n    Calendar.prototype.prevYear = function () {\n      this.unselect();\n      this.dispatch({\n        type: 'SET_DATE',\n        dateMarker: this.dateEnv.addYears(this.state.currentDate, -1)\n      });\n    };\n\n    Calendar.prototype.nextYear = function () {\n      this.unselect();\n      this.dispatch({\n        type: 'SET_DATE',\n        dateMarker: this.dateEnv.addYears(this.state.currentDate, 1)\n      });\n    };\n\n    Calendar.prototype.today = function () {\n      this.unselect();\n      this.dispatch({\n        type: 'SET_DATE',\n        dateMarker: this.getNow()\n      });\n    };\n\n    Calendar.prototype.gotoDate = function (zonedDateInput) {\n      this.unselect();\n      this.dispatch({\n        type: 'SET_DATE',\n        dateMarker: this.dateEnv.createMarker(zonedDateInput)\n      });\n    };\n\n    Calendar.prototype.incrementDate = function (deltaInput) {\n      var delta = createDuration(deltaInput);\n\n      if (delta) {\n        // else, warn about invalid input?\n        this.unselect();\n        this.dispatch({\n          type: 'SET_DATE',\n          dateMarker: this.dateEnv.add(this.state.currentDate, delta)\n        });\n      }\n    }; // for external API\n\n\n    Calendar.prototype.getDate = function () {\n      return this.dateEnv.toDate(this.state.currentDate);\n    }; // Date Formatting Utils\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    Calendar.prototype.formatDate = function (d, formatter) {\n      var dateEnv = this.dateEnv;\n      return dateEnv.format(dateEnv.createMarker(d), createFormatter(formatter));\n    }; // `settings` is for formatter AND isEndExclusive\n\n\n    Calendar.prototype.formatRange = function (d0, d1, settings) {\n      var dateEnv = this.dateEnv;\n      return dateEnv.formatRange(dateEnv.createMarker(d0), dateEnv.createMarker(d1), createFormatter(settings, this.opt('defaultRangeSeparator')), settings);\n    };\n\n    Calendar.prototype.formatIso = function (d, omitTime) {\n      var dateEnv = this.dateEnv;\n      return dateEnv.formatIso(dateEnv.createMarker(d), {\n        omitTime: omitTime\n      });\n    }; // Sizing\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    Calendar.prototype.windowResize = function (ev) {\n      if (!this.isHandlingWindowResize && this.component && // why?\n      ev.target === window // not a jqui resize event\n      ) {\n          this.isHandlingWindowResize = true;\n          this.updateSize();\n          this.publiclyTrigger('windowResize', [this.view]);\n          this.isHandlingWindowResize = false;\n        }\n    };\n\n    Calendar.prototype.updateSize = function () {\n      this.component.updateSize(true);\n    }; // Component Registration\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    Calendar.prototype.registerInteractiveComponent = function (component, settingsInput) {\n      var settings = parseInteractionSettings(component, settingsInput);\n      var DEFAULT_INTERACTIONS = [EventClicking, EventHovering];\n      var interactionClasses = DEFAULT_INTERACTIONS.concat(this.pluginSystem.hooks.componentInteractions);\n      var interactions = interactionClasses.map(function (interactionClass) {\n        return new interactionClass(settings);\n      });\n      this.interactionsStore[component.uid] = interactions;\n      interactionSettingsStore[component.uid] = settings;\n    };\n\n    Calendar.prototype.unregisterInteractiveComponent = function (component) {\n      for (var _i = 0, _a = this.interactionsStore[component.uid]; _i < _a.length; _i++) {\n        var listener = _a[_i];\n        listener.destroy();\n      }\n\n      delete this.interactionsStore[component.uid];\n      delete interactionSettingsStore[component.uid];\n    }; // Date Selection / Event Selection / DayClick\n    // -----------------------------------------------------------------------------------------------------------------\n    // this public method receives start/end dates in any format, with any timezone\n    // NOTE: args were changed from v3\n\n\n    Calendar.prototype.select = function (dateOrObj, endDate) {\n      var selectionInput;\n\n      if (endDate == null) {\n        if (dateOrObj.start != null) {\n          selectionInput = dateOrObj;\n        } else {\n          selectionInput = {\n            start: dateOrObj,\n            end: null\n          };\n        }\n      } else {\n        selectionInput = {\n          start: dateOrObj,\n          end: endDate\n        };\n      }\n\n      var selection = parseDateSpan(selectionInput, this.dateEnv, createDuration({\n        days: 1\n      }) // TODO: cache this?\n      );\n\n      if (selection) {\n        // throw parse error otherwise?\n        this.dispatch({\n          type: 'SELECT_DATES',\n          selection: selection\n        });\n        this.triggerDateSelect(selection);\n      }\n    }; // public method\n\n\n    Calendar.prototype.unselect = function (pev) {\n      if (this.state.dateSelection) {\n        this.dispatch({\n          type: 'UNSELECT_DATES'\n        });\n        this.triggerDateUnselect(pev);\n      }\n    };\n\n    Calendar.prototype.triggerDateSelect = function (selection, pev) {\n      var arg = this.buildDateSpanApi(selection);\n      arg.jsEvent = pev ? pev.origEvent : null;\n      arg.view = this.view;\n      this.publiclyTrigger('select', [arg]);\n    };\n\n    Calendar.prototype.triggerDateUnselect = function (pev) {\n      this.publiclyTrigger('unselect', [{\n        jsEvent: pev ? pev.origEvent : null,\n        view: this.view\n      }]);\n    }; // TODO: receive pev?\n\n\n    Calendar.prototype.triggerDateClick = function (dateSpan, dayEl, view, ev) {\n      var arg = this.buildDatePointApi(dateSpan);\n      arg.dayEl = dayEl;\n      arg.jsEvent = ev;\n      arg.view = view;\n      this.publiclyTrigger('dateClick', [arg]);\n    };\n\n    Calendar.prototype.buildDatePointApi = function (dateSpan) {\n      var props = {};\n\n      for (var _i = 0, _a = this.pluginSystem.hooks.datePointTransforms; _i < _a.length; _i++) {\n        var transform = _a[_i];\n\n        _assign(props, transform(dateSpan, this));\n      }\n\n      _assign(props, buildDatePointApi(dateSpan, this.dateEnv));\n\n      return props;\n    };\n\n    Calendar.prototype.buildDateSpanApi = function (dateSpan) {\n      var props = {};\n\n      for (var _i = 0, _a = this.pluginSystem.hooks.dateSpanTransforms; _i < _a.length; _i++) {\n        var transform = _a[_i];\n\n        _assign(props, transform(dateSpan, this));\n      }\n\n      _assign(props, buildDateSpanApi(dateSpan, this.dateEnv));\n\n      return props;\n    }; // Date Utils\n    // -----------------------------------------------------------------------------------------------------------------\n    // Returns a DateMarker for the current date, as defined by the client's computer or from the `now` option\n\n\n    Calendar.prototype.getNow = function () {\n      var now = this.opt('now');\n\n      if (typeof now === 'function') {\n        now = now();\n      }\n\n      if (now == null) {\n        return this.dateEnv.createNowMarker();\n      }\n\n      return this.dateEnv.createMarker(now);\n    }; // Event-Date Utilities\n    // -----------------------------------------------------------------------------------------------------------------\n    // Given an event's allDay status and start date, return what its fallback end date should be.\n    // TODO: rename to computeDefaultEventEnd\n\n\n    Calendar.prototype.getDefaultEventEnd = function (allDay, marker) {\n      var end = marker;\n\n      if (allDay) {\n        end = startOfDay(end);\n        end = this.dateEnv.add(end, this.defaultAllDayEventDuration);\n      } else {\n        end = this.dateEnv.add(end, this.defaultTimedEventDuration);\n      }\n\n      return end;\n    }; // Public Events API\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    Calendar.prototype.addEvent = function (eventInput, sourceInput) {\n      if (eventInput instanceof EventApi) {\n        var def = eventInput._def;\n        var instance = eventInput._instance; // not already present? don't want to add an old snapshot\n\n        if (!this.state.eventStore.defs[def.defId]) {\n          this.dispatch({\n            type: 'ADD_EVENTS',\n            eventStore: eventTupleToStore({\n              def: def,\n              instance: instance\n            }) // TODO: better util for two args?\n\n          });\n        }\n\n        return eventInput;\n      }\n\n      var sourceId;\n\n      if (sourceInput instanceof EventSourceApi) {\n        sourceId = sourceInput.internalEventSource.sourceId;\n      } else if (sourceInput != null) {\n        var sourceApi = this.getEventSourceById(sourceInput); // TODO: use an internal function\n\n        if (!sourceApi) {\n          console.warn('Could not find an event source with ID \"' + sourceInput + '\"'); // TODO: test\n\n          return null;\n        } else {\n          sourceId = sourceApi.internalEventSource.sourceId;\n        }\n      }\n\n      var tuple = parseEvent(eventInput, sourceId, this);\n\n      if (tuple) {\n        this.dispatch({\n          type: 'ADD_EVENTS',\n          eventStore: eventTupleToStore(tuple)\n        });\n        return new EventApi(this, tuple.def, tuple.def.recurringDef ? null : tuple.instance);\n      }\n\n      return null;\n    }; // TODO: optimize\n\n\n    Calendar.prototype.getEventById = function (id) {\n      var _a = this.state.eventStore,\n          defs = _a.defs,\n          instances = _a.instances;\n      id = String(id);\n\n      for (var defId in defs) {\n        var def = defs[defId];\n\n        if (def.publicId === id) {\n          if (def.recurringDef) {\n            return new EventApi(this, def, null);\n          } else {\n            for (var instanceId in instances) {\n              var instance = instances[instanceId];\n\n              if (instance.defId === def.defId) {\n                return new EventApi(this, def, instance);\n              }\n            }\n          }\n        }\n      }\n\n      return null;\n    };\n\n    Calendar.prototype.getEvents = function () {\n      var _a = this.state.eventStore,\n          defs = _a.defs,\n          instances = _a.instances;\n      var eventApis = [];\n\n      for (var id in instances) {\n        var instance = instances[id];\n        var def = defs[instance.defId];\n        eventApis.push(new EventApi(this, def, instance));\n      }\n\n      return eventApis;\n    };\n\n    Calendar.prototype.removeAllEvents = function () {\n      this.dispatch({\n        type: 'REMOVE_ALL_EVENTS'\n      });\n    };\n\n    Calendar.prototype.rerenderEvents = function () {\n      this.dispatch({\n        type: 'RESET_EVENTS'\n      });\n    }; // Public Event Sources API\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    Calendar.prototype.getEventSources = function () {\n      var sourceHash = this.state.eventSources;\n      var sourceApis = [];\n\n      for (var internalId in sourceHash) {\n        sourceApis.push(new EventSourceApi(this, sourceHash[internalId]));\n      }\n\n      return sourceApis;\n    };\n\n    Calendar.prototype.getEventSourceById = function (id) {\n      var sourceHash = this.state.eventSources;\n      id = String(id);\n\n      for (var sourceId in sourceHash) {\n        if (sourceHash[sourceId].publicId === id) {\n          return new EventSourceApi(this, sourceHash[sourceId]);\n        }\n      }\n\n      return null;\n    };\n\n    Calendar.prototype.addEventSource = function (sourceInput) {\n      if (sourceInput instanceof EventSourceApi) {\n        // not already present? don't want to add an old snapshot\n        if (!this.state.eventSources[sourceInput.internalEventSource.sourceId]) {\n          this.dispatch({\n            type: 'ADD_EVENT_SOURCES',\n            sources: [sourceInput.internalEventSource]\n          });\n        }\n\n        return sourceInput;\n      }\n\n      var eventSource = parseEventSource(sourceInput, this);\n\n      if (eventSource) {\n        // TODO: error otherwise?\n        this.dispatch({\n          type: 'ADD_EVENT_SOURCES',\n          sources: [eventSource]\n        });\n        return new EventSourceApi(this, eventSource);\n      }\n\n      return null;\n    };\n\n    Calendar.prototype.removeAllEventSources = function () {\n      this.dispatch({\n        type: 'REMOVE_ALL_EVENT_SOURCES'\n      });\n    };\n\n    Calendar.prototype.refetchEvents = function () {\n      this.dispatch({\n        type: 'FETCH_EVENT_SOURCES'\n      });\n    };\n\n    return Calendar;\n  }();\n\n  EmitterMixin.mixInto(Calendar); // for memoizers\n  // -----------------------------------------------------------------------------------------------------------------\n\n  function buildDateEnv(locale, timeZone, namedTimeZoneImpl, firstDay, weekNumberCalculation, weekLabel, cmdFormatter) {\n    return new DateEnv({\n      calendarSystem: 'gregory',\n      timeZone: timeZone,\n      namedTimeZoneImpl: namedTimeZoneImpl,\n      locale: locale,\n      weekNumberCalculation: weekNumberCalculation,\n      firstDay: firstDay,\n      weekLabel: weekLabel,\n      cmdFormatter: cmdFormatter\n    });\n  }\n\n  function buildTheme(calendarOptions) {\n    var themeClass = this.pluginSystem.hooks.themeClasses[calendarOptions.themeSystem] || StandardTheme;\n    return new themeClass(calendarOptions);\n  }\n\n  function buildDelayedRerender(wait) {\n    var func = this.tryRerender.bind(this);\n\n    if (wait != null) {\n      func = debounce(func, wait);\n    }\n\n    return func;\n  }\n\n  function buildEventUiBySource(eventSources) {\n    return mapHash(eventSources, function (eventSource) {\n      return eventSource.ui;\n    });\n  }\n\n  function buildEventUiBases(eventDefs, eventUiSingleBase, eventUiBySource) {\n    var eventUiBases = {\n      '': eventUiSingleBase\n    };\n\n    for (var defId in eventDefs) {\n      var def = eventDefs[defId];\n\n      if (def.sourceId && eventUiBySource[def.sourceId]) {\n        eventUiBases[defId] = eventUiBySource[def.sourceId];\n      }\n    }\n\n    return eventUiBases;\n  }\n\n  var View =\n  /** @class */\n  function (_super) {\n    __extends(View, _super);\n\n    function View(context, viewSpec, dateProfileGenerator, parentEl) {\n      var _this = _super.call(this, context, createElement('div', {\n        className: 'fc-view fc-' + viewSpec.type + '-view'\n      }), true // isView (HACK)\n      ) || this;\n\n      _this.renderDatesMem = memoizeRendering(_this.renderDatesWrap, _this.unrenderDatesWrap);\n      _this.renderBusinessHoursMem = memoizeRendering(_this.renderBusinessHours, _this.unrenderBusinessHours, [_this.renderDatesMem]);\n      _this.renderDateSelectionMem = memoizeRendering(_this.renderDateSelectionWrap, _this.unrenderDateSelectionWrap, [_this.renderDatesMem]);\n      _this.renderEventsMem = memoizeRendering(_this.renderEvents, _this.unrenderEvents, [_this.renderDatesMem]);\n      _this.renderEventSelectionMem = memoizeRendering(_this.renderEventSelectionWrap, _this.unrenderEventSelectionWrap, [_this.renderEventsMem]);\n      _this.renderEventDragMem = memoizeRendering(_this.renderEventDragWrap, _this.unrenderEventDragWrap, [_this.renderDatesMem]);\n      _this.renderEventResizeMem = memoizeRendering(_this.renderEventResizeWrap, _this.unrenderEventResizeWrap, [_this.renderDatesMem]);\n      _this.viewSpec = viewSpec;\n      _this.dateProfileGenerator = dateProfileGenerator;\n      _this.type = viewSpec.type;\n      _this.eventOrderSpecs = parseFieldSpecs(_this.opt('eventOrder'));\n      _this.nextDayThreshold = createDuration(_this.opt('nextDayThreshold'));\n      parentEl.appendChild(_this.el);\n\n      _this.initialize();\n\n      return _this;\n    }\n\n    View.prototype.initialize = function () {};\n\n    Object.defineProperty(View.prototype, \"activeStart\", {\n      // Date Setting/Unsetting\n      // -----------------------------------------------------------------------------------------------------------------\n      get: function get() {\n        return this.dateEnv.toDate(this.props.dateProfile.activeRange.start);\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(View.prototype, \"activeEnd\", {\n      get: function get() {\n        return this.dateEnv.toDate(this.props.dateProfile.activeRange.end);\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(View.prototype, \"currentStart\", {\n      get: function get() {\n        return this.dateEnv.toDate(this.props.dateProfile.currentRange.start);\n      },\n      enumerable: true,\n      configurable: true\n    });\n    Object.defineProperty(View.prototype, \"currentEnd\", {\n      get: function get() {\n        return this.dateEnv.toDate(this.props.dateProfile.currentRange.end);\n      },\n      enumerable: true,\n      configurable: true\n    }); // General Rendering\n    // -----------------------------------------------------------------------------------------------------------------\n\n    View.prototype.render = function (props) {\n      this.renderDatesMem(props.dateProfile);\n      this.renderBusinessHoursMem(props.businessHours);\n      this.renderDateSelectionMem(props.dateSelection);\n      this.renderEventsMem(props.eventStore);\n      this.renderEventSelectionMem(props.eventSelection);\n      this.renderEventDragMem(props.eventDrag);\n      this.renderEventResizeMem(props.eventResize);\n    };\n\n    View.prototype.destroy = function () {\n      _super.prototype.destroy.call(this);\n\n      this.renderDatesMem.unrender(); // should unrender everything else\n    }; // Sizing\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    View.prototype.updateSize = function (isResize, viewHeight, isAuto) {\n      var calendar = this.calendar;\n\n      if (isResize || calendar.isViewUpdated || calendar.isDatesUpdated || calendar.isEventsUpdated) {\n        // sort of the catch-all sizing\n        // anything that might cause dimension changes\n        this.updateBaseSize(isResize, viewHeight, isAuto);\n      }\n    };\n\n    View.prototype.updateBaseSize = function (isResize, viewHeight, isAuto) {}; // Date Rendering\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    View.prototype.renderDatesWrap = function (dateProfile) {\n      this.renderDates(dateProfile);\n      this.addScroll({\n        isDateInit: true\n      });\n      this.startNowIndicator(dateProfile); // shouldn't render yet because updateSize will be called soon\n    };\n\n    View.prototype.unrenderDatesWrap = function () {\n      this.stopNowIndicator();\n      this.unrenderDates();\n    };\n\n    View.prototype.renderDates = function (dateProfile) {};\n\n    View.prototype.unrenderDates = function () {}; // Business Hours\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    View.prototype.renderBusinessHours = function (businessHours) {};\n\n    View.prototype.unrenderBusinessHours = function () {}; // Date Selection\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    View.prototype.renderDateSelectionWrap = function (selection) {\n      if (selection) {\n        this.renderDateSelection(selection);\n      }\n    };\n\n    View.prototype.unrenderDateSelectionWrap = function (selection) {\n      if (selection) {\n        this.unrenderDateSelection(selection);\n      }\n    };\n\n    View.prototype.renderDateSelection = function (selection) {};\n\n    View.prototype.unrenderDateSelection = function (selection) {}; // Event Rendering\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    View.prototype.renderEvents = function (eventStore) {};\n\n    View.prototype.unrenderEvents = function () {}; // util for subclasses\n\n\n    View.prototype.sliceEvents = function (eventStore, allDay) {\n      var props = this.props;\n      return sliceEventStore(eventStore, props.eventUiBases, props.dateProfile.activeRange, allDay ? this.nextDayThreshold : null).fg;\n    }; // Event Selection\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    View.prototype.renderEventSelectionWrap = function (instanceId) {\n      if (instanceId) {\n        this.renderEventSelection(instanceId);\n      }\n    };\n\n    View.prototype.unrenderEventSelectionWrap = function (instanceId) {\n      if (instanceId) {\n        this.unrenderEventSelection(instanceId);\n      }\n    };\n\n    View.prototype.renderEventSelection = function (instanceId) {};\n\n    View.prototype.unrenderEventSelection = function (instanceId) {}; // Event Drag\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    View.prototype.renderEventDragWrap = function (state) {\n      if (state) {\n        this.renderEventDrag(state);\n      }\n    };\n\n    View.prototype.unrenderEventDragWrap = function (state) {\n      if (state) {\n        this.unrenderEventDrag(state);\n      }\n    };\n\n    View.prototype.renderEventDrag = function (state) {};\n\n    View.prototype.unrenderEventDrag = function (state) {}; // Event Resize\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    View.prototype.renderEventResizeWrap = function (state) {\n      if (state) {\n        this.renderEventResize(state);\n      }\n    };\n\n    View.prototype.unrenderEventResizeWrap = function (state) {\n      if (state) {\n        this.unrenderEventResize(state);\n      }\n    };\n\n    View.prototype.renderEventResize = function (state) {};\n\n    View.prototype.unrenderEventResize = function (state) {};\n    /* Now Indicator\n    ------------------------------------------------------------------------------------------------------------------*/\n    // Immediately render the current time indicator and begins re-rendering it at an interval,\n    // which is defined by this.getNowIndicatorUnit().\n    // TODO: somehow do this for the current whole day's background too\n\n\n    View.prototype.startNowIndicator = function (dateProfile) {\n      var _this = this;\n\n      var dateEnv = this.dateEnv;\n      var unit;\n      var update;\n      var delay; // ms wait value\n\n      if (this.opt('nowIndicator')) {\n        unit = this.getNowIndicatorUnit(dateProfile);\n\n        if (unit) {\n          update = this.updateNowIndicator.bind(this);\n          this.initialNowDate = this.calendar.getNow();\n          this.initialNowQueriedMs = new Date().valueOf(); // wait until the beginning of the next interval\n\n          delay = dateEnv.add(dateEnv.startOf(this.initialNowDate, unit), createDuration(1, unit)).valueOf() - this.initialNowDate.valueOf(); // TODO: maybe always use setTimeout, waiting until start of next unit\n\n          this.nowIndicatorTimeoutID = setTimeout(function () {\n            _this.nowIndicatorTimeoutID = null;\n            update();\n\n            if (unit === 'second') {\n              delay = 1000; // every second\n            } else {\n              delay = 1000 * 60; // otherwise, every minute\n            }\n\n            _this.nowIndicatorIntervalID = setInterval(update, delay); // update every interval\n          }, delay);\n        } // rendering will be initiated in updateSize\n\n      }\n    }; // rerenders the now indicator, computing the new current time from the amount of time that has passed\n    // since the initial getNow call.\n\n\n    View.prototype.updateNowIndicator = function () {\n      if (this.props.dateProfile && // a way to determine if dates were rendered yet\n      this.initialNowDate // activated before?\n      ) {\n          this.unrenderNowIndicator(); // won't unrender if unnecessary\n\n          this.renderNowIndicator(addMs(this.initialNowDate, new Date().valueOf() - this.initialNowQueriedMs));\n          this.isNowIndicatorRendered = true;\n        }\n    }; // Immediately unrenders the view's current time indicator and stops any re-rendering timers.\n    // Won't cause side effects if indicator isn't rendered.\n\n\n    View.prototype.stopNowIndicator = function () {\n      if (this.isNowIndicatorRendered) {\n        if (this.nowIndicatorTimeoutID) {\n          clearTimeout(this.nowIndicatorTimeoutID);\n          this.nowIndicatorTimeoutID = null;\n        }\n\n        if (this.nowIndicatorIntervalID) {\n          clearInterval(this.nowIndicatorIntervalID);\n          this.nowIndicatorIntervalID = null;\n        }\n\n        this.unrenderNowIndicator();\n        this.isNowIndicatorRendered = false;\n      }\n    };\n\n    View.prototype.getNowIndicatorUnit = function (dateProfile) {// subclasses should implement\n    }; // Renders a current time indicator at the given datetime\n\n\n    View.prototype.renderNowIndicator = function (date) {// SUBCLASSES MUST PASS TO CHILDREN!\n    }; // Undoes the rendering actions from renderNowIndicator\n\n\n    View.prototype.unrenderNowIndicator = function () {// SUBCLASSES MUST PASS TO CHILDREN!\n    };\n    /* Scroller\n    ------------------------------------------------------------------------------------------------------------------*/\n\n\n    View.prototype.addScroll = function (scroll) {\n      var queuedScroll = this.queuedScroll || (this.queuedScroll = {});\n\n      _assign(queuedScroll, scroll);\n    };\n\n    View.prototype.popScroll = function (isResize) {\n      this.applyQueuedScroll(isResize);\n      this.queuedScroll = null;\n    };\n\n    View.prototype.applyQueuedScroll = function (isResize) {\n      this.applyScroll(this.queuedScroll || {}, isResize);\n    };\n\n    View.prototype.queryScroll = function () {\n      var scroll = {};\n\n      if (this.props.dateProfile) {\n        // dates rendered yet?\n        _assign(scroll, this.queryDateScroll());\n      }\n\n      return scroll;\n    };\n\n    View.prototype.applyScroll = function (scroll, isResize) {\n      if (scroll.isDateInit) {\n        delete scroll.isDateInit;\n\n        if (this.props.dateProfile) {\n          // dates rendered yet?\n          _assign(scroll, this.computeInitialDateScroll());\n        }\n      }\n\n      if (this.props.dateProfile) {\n        // dates rendered yet?\n        this.applyDateScroll(scroll);\n      }\n    };\n\n    View.prototype.computeInitialDateScroll = function () {\n      return {}; // subclasses must implement\n    };\n\n    View.prototype.queryDateScroll = function () {\n      return {}; // subclasses must implement\n    };\n\n    View.prototype.applyDateScroll = function (scroll) {// subclasses must implement\n    };\n\n    return View;\n  }(DateComponent);\n\n  EmitterMixin.mixInto(View);\n  View.prototype.usesMinMaxTime = false;\n  View.prototype.dateProfileGeneratorClass = DateProfileGenerator;\n\n  var FgEventRenderer =\n  /** @class */\n  function () {\n    function FgEventRenderer(context) {\n      this.segs = [];\n      this.isSizeDirty = false;\n      this.context = context;\n    }\n\n    FgEventRenderer.prototype.renderSegs = function (segs, mirrorInfo) {\n      this.rangeUpdated(); // called too frequently :(\n      // render an `.el` on each seg\n      // returns a subset of the segs. segs that were actually rendered\n\n      segs = this.renderSegEls(segs, mirrorInfo);\n      this.segs = segs;\n      this.attachSegs(segs, mirrorInfo);\n      this.isSizeDirty = true;\n      this.context.view.triggerRenderedSegs(this.segs, Boolean(mirrorInfo));\n    };\n\n    FgEventRenderer.prototype.unrender = function (_segs, mirrorInfo) {\n      this.context.view.triggerWillRemoveSegs(this.segs, Boolean(mirrorInfo));\n      this.detachSegs(this.segs);\n      this.segs = [];\n    }; // Updates values that rely on options and also relate to range\n\n\n    FgEventRenderer.prototype.rangeUpdated = function () {\n      var options = this.context.options;\n      var displayEventTime;\n      var displayEventEnd;\n      this.eventTimeFormat = createFormatter(options.eventTimeFormat || this.computeEventTimeFormat(), options.defaultRangeSeparator);\n      displayEventTime = options.displayEventTime;\n\n      if (displayEventTime == null) {\n        displayEventTime = this.computeDisplayEventTime(); // might be based off of range\n      }\n\n      displayEventEnd = options.displayEventEnd;\n\n      if (displayEventEnd == null) {\n        displayEventEnd = this.computeDisplayEventEnd(); // might be based off of range\n      }\n\n      this.displayEventTime = displayEventTime;\n      this.displayEventEnd = displayEventEnd;\n    }; // Renders and assigns an `el` property for each foreground event segment.\n    // Only returns segments that successfully rendered.\n\n\n    FgEventRenderer.prototype.renderSegEls = function (segs, mirrorInfo) {\n      var html = '';\n      var i;\n\n      if (segs.length) {\n        // don't build an empty html string\n        // build a large concatenation of event segment HTML\n        for (i = 0; i < segs.length; i++) {\n          html += this.renderSegHtml(segs[i], mirrorInfo);\n        } // Grab individual elements from the combined HTML string. Use each as the default rendering.\n        // Then, compute the 'el' for each segment. An el might be null if the eventRender callback returned false.\n\n\n        htmlToElements(html).forEach(function (el, i) {\n          var seg = segs[i];\n\n          if (el) {\n            seg.el = el;\n          }\n        });\n        segs = filterSegsViaEls(this.context.view, segs, Boolean(mirrorInfo));\n      }\n\n      return segs;\n    }; // Generic utility for generating the HTML classNames for an event segment's element\n\n\n    FgEventRenderer.prototype.getSegClasses = function (seg, isDraggable, isResizable, mirrorInfo) {\n      var classes = ['fc-event', seg.isStart ? 'fc-start' : 'fc-not-start', seg.isEnd ? 'fc-end' : 'fc-not-end'].concat(seg.eventRange.ui.classNames);\n\n      if (isDraggable) {\n        classes.push('fc-draggable');\n      }\n\n      if (isResizable) {\n        classes.push('fc-resizable');\n      }\n\n      if (mirrorInfo) {\n        classes.push('fc-mirror');\n\n        if (mirrorInfo.isDragging) {\n          classes.push('fc-dragging');\n        }\n\n        if (mirrorInfo.isResizing) {\n          classes.push('fc-resizing');\n        }\n      }\n\n      return classes;\n    }; // Compute the text that should be displayed on an event's element.\n    // `range` can be the Event object itself, or something range-like, with at least a `start`.\n    // If event times are disabled, or the event has no time, will return a blank string.\n    // If not specified, formatter will default to the eventTimeFormat setting,\n    // and displayEnd will default to the displayEventEnd setting.\n\n\n    FgEventRenderer.prototype.getTimeText = function (eventRange, formatter, displayEnd) {\n      var def = eventRange.def,\n          instance = eventRange.instance;\n      return this._getTimeText(instance.range.start, def.hasEnd ? instance.range.end : null, def.allDay, formatter, displayEnd, instance.forcedStartTzo, instance.forcedEndTzo);\n    };\n\n    FgEventRenderer.prototype._getTimeText = function (start, end, allDay, formatter, displayEnd, forcedStartTzo, forcedEndTzo) {\n      var dateEnv = this.context.dateEnv;\n\n      if (formatter == null) {\n        formatter = this.eventTimeFormat;\n      }\n\n      if (displayEnd == null) {\n        displayEnd = this.displayEventEnd;\n      }\n\n      if (this.displayEventTime && !allDay) {\n        if (displayEnd && end) {\n          return dateEnv.formatRange(start, end, formatter, {\n            forcedStartTzo: forcedStartTzo,\n            forcedEndTzo: forcedEndTzo\n          });\n        } else {\n          return dateEnv.format(start, formatter, {\n            forcedTzo: forcedStartTzo\n          });\n        }\n      }\n\n      return '';\n    };\n\n    FgEventRenderer.prototype.computeEventTimeFormat = function () {\n      return {\n        hour: 'numeric',\n        minute: '2-digit',\n        omitZeroMinute: true\n      };\n    };\n\n    FgEventRenderer.prototype.computeDisplayEventTime = function () {\n      return true;\n    };\n\n    FgEventRenderer.prototype.computeDisplayEventEnd = function () {\n      return true;\n    }; // Utility for generating event skin-related CSS properties\n\n\n    FgEventRenderer.prototype.getSkinCss = function (ui) {\n      return {\n        'background-color': ui.backgroundColor,\n        'border-color': ui.borderColor,\n        color: ui.textColor\n      };\n    };\n\n    FgEventRenderer.prototype.sortEventSegs = function (segs) {\n      var specs = this.context.view.eventOrderSpecs;\n      var objs = segs.map(buildSegCompareObj);\n      objs.sort(function (obj0, obj1) {\n        return compareByFieldSpecs(obj0, obj1, specs);\n      });\n      return objs.map(function (c) {\n        return c._seg;\n      });\n    };\n\n    FgEventRenderer.prototype.computeSizes = function (force) {\n      if (force || this.isSizeDirty) {\n        this.computeSegSizes(this.segs);\n      }\n    };\n\n    FgEventRenderer.prototype.assignSizes = function (force) {\n      if (force || this.isSizeDirty) {\n        this.assignSegSizes(this.segs);\n        this.isSizeDirty = false;\n      }\n    };\n\n    FgEventRenderer.prototype.computeSegSizes = function (segs) {};\n\n    FgEventRenderer.prototype.assignSegSizes = function (segs) {}; // Manipulation on rendered segs\n\n\n    FgEventRenderer.prototype.hideByHash = function (hash) {\n      if (hash) {\n        for (var _i = 0, _a = this.segs; _i < _a.length; _i++) {\n          var seg = _a[_i];\n\n          if (hash[seg.eventRange.instance.instanceId]) {\n            seg.el.style.visibility = 'hidden';\n          }\n        }\n      }\n    };\n\n    FgEventRenderer.prototype.showByHash = function (hash) {\n      if (hash) {\n        for (var _i = 0, _a = this.segs; _i < _a.length; _i++) {\n          var seg = _a[_i];\n\n          if (hash[seg.eventRange.instance.instanceId]) {\n            seg.el.style.visibility = '';\n          }\n        }\n      }\n    };\n\n    FgEventRenderer.prototype.selectByInstanceId = function (instanceId) {\n      if (instanceId) {\n        for (var _i = 0, _a = this.segs; _i < _a.length; _i++) {\n          var seg = _a[_i];\n          var eventInstance = seg.eventRange.instance;\n\n          if (eventInstance && eventInstance.instanceId === instanceId && seg.el // necessary?\n          ) {\n              seg.el.classList.add('fc-selected');\n            }\n        }\n      }\n    };\n\n    FgEventRenderer.prototype.unselectByInstanceId = function (instanceId) {\n      if (instanceId) {\n        for (var _i = 0, _a = this.segs; _i < _a.length; _i++) {\n          var seg = _a[_i];\n\n          if (seg.el) {\n            // necessary?\n            seg.el.classList.remove('fc-selected');\n          }\n        }\n      }\n    };\n\n    return FgEventRenderer;\n  }(); // returns a object with all primitive props that can be compared\n\n\n  function buildSegCompareObj(seg) {\n    var eventDef = seg.eventRange.def;\n    var range = seg.eventRange.instance.range;\n    var start = range.start ? range.start.valueOf() : 0; // TODO: better support for open-range events\n\n    var end = range.end ? range.end.valueOf() : 0; // \"\n\n    return _assign({}, eventDef.extendedProps, eventDef, {\n      id: eventDef.publicId,\n      start: start,\n      end: end,\n      duration: end - start,\n      allDay: Number(eventDef.allDay),\n      _seg: seg // for later retrieval\n\n    });\n  }\n\n  var FillRenderer =\n  /** @class */\n  function () {\n    function FillRenderer(context) {\n      this.fillSegTag = 'div';\n      this.dirtySizeFlags = {};\n      this.context = context;\n      this.containerElsByType = {};\n      this.segsByType = {};\n    }\n\n    FillRenderer.prototype.getSegsByType = function (type) {\n      return this.segsByType[type] || [];\n    };\n\n    FillRenderer.prototype.renderSegs = function (type, segs) {\n      var _a;\n\n      var renderedSegs = this.renderSegEls(type, segs); // assignes `.el` to each seg. returns successfully rendered segs\n\n      var containerEls = this.attachSegs(type, renderedSegs);\n\n      if (containerEls) {\n        (_a = this.containerElsByType[type] || (this.containerElsByType[type] = [])).push.apply(_a, containerEls);\n      }\n\n      this.segsByType[type] = renderedSegs;\n\n      if (type === 'bgEvent') {\n        this.context.view.triggerRenderedSegs(renderedSegs, false); // isMirror=false\n      }\n\n      this.dirtySizeFlags[type] = true;\n    }; // Unrenders a specific type of fill that is currently rendered on the grid\n\n\n    FillRenderer.prototype.unrender = function (type) {\n      var segs = this.segsByType[type];\n\n      if (segs) {\n        if (type === 'bgEvent') {\n          this.context.view.triggerWillRemoveSegs(segs, false); // isMirror=false\n        }\n\n        this.detachSegs(type, segs);\n      }\n    }; // Renders and assigns an `el` property for each fill segment. Generic enough to work with different types.\n    // Only returns segments that successfully rendered.\n\n\n    FillRenderer.prototype.renderSegEls = function (type, segs) {\n      var _this = this;\n\n      var html = '';\n      var i;\n\n      if (segs.length) {\n        // build a large concatenation of segment HTML\n        for (i = 0; i < segs.length; i++) {\n          html += this.renderSegHtml(type, segs[i]);\n        } // Grab individual elements from the combined HTML string. Use each as the default rendering.\n        // Then, compute the 'el' for each segment.\n\n\n        htmlToElements(html).forEach(function (el, i) {\n          var seg = segs[i];\n\n          if (el) {\n            seg.el = el;\n          }\n        });\n\n        if (type === 'bgEvent') {\n          segs = filterSegsViaEls(this.context.view, segs, false // isMirror. background events can never be mirror elements\n          );\n        } // correct element type? (would be bad if a non-TD were inserted into a table for example)\n\n\n        segs = segs.filter(function (seg) {\n          return elementMatches(seg.el, _this.fillSegTag);\n        });\n      }\n\n      return segs;\n    }; // Builds the HTML needed for one fill segment. Generic enough to work with different types.\n\n\n    FillRenderer.prototype.renderSegHtml = function (type, seg) {\n      var css = null;\n      var classNames = [];\n\n      if (type !== 'highlight' && type !== 'businessHours') {\n        css = {\n          'background-color': seg.eventRange.ui.backgroundColor\n        };\n      }\n\n      if (type !== 'highlight') {\n        classNames = classNames.concat(seg.eventRange.ui.classNames);\n      }\n\n      if (type === 'businessHours') {\n        classNames.push('fc-bgevent');\n      } else {\n        classNames.push('fc-' + type.toLowerCase());\n      }\n\n      return '<' + this.fillSegTag + (classNames.length ? ' class=\"' + classNames.join(' ') + '\"' : '') + (css ? ' style=\"' + cssToStr(css) + '\"' : '') + '></' + this.fillSegTag + '>';\n    };\n\n    FillRenderer.prototype.detachSegs = function (type, segs) {\n      var containerEls = this.containerElsByType[type];\n\n      if (containerEls) {\n        containerEls.forEach(removeElement);\n        delete this.containerElsByType[type];\n      }\n    };\n\n    FillRenderer.prototype.computeSizes = function (force) {\n      for (var type in this.segsByType) {\n        if (force || this.dirtySizeFlags[type]) {\n          this.computeSegSizes(this.segsByType[type]);\n        }\n      }\n    };\n\n    FillRenderer.prototype.assignSizes = function (force) {\n      for (var type in this.segsByType) {\n        if (force || this.dirtySizeFlags[type]) {\n          this.assignSegSizes(this.segsByType[type]);\n        }\n      }\n\n      this.dirtySizeFlags = {};\n    };\n\n    FillRenderer.prototype.computeSegSizes = function (segs) {};\n\n    FillRenderer.prototype.assignSegSizes = function (segs) {};\n\n    return FillRenderer;\n  }();\n\n  var NamedTimeZoneImpl =\n  /** @class */\n  function () {\n    function NamedTimeZoneImpl(timeZoneName) {\n      this.timeZoneName = timeZoneName;\n    }\n\n    return NamedTimeZoneImpl;\n  }();\n  /*\n  An abstraction for a dragging interaction originating on an event.\n  Does higher-level things than PointerDragger, such as possibly:\n  - a \"mirror\" that moves with the pointer\n  - a minimum number of pixels or other criteria for a true drag to begin\n   subclasses must emit:\n  - pointerdown\n  - dragstart\n  - dragmove\n  - pointerup\n  - dragend\n  */\n\n\n  var ElementDragging =\n  /** @class */\n  function () {\n    function ElementDragging(el) {\n      this.emitter = new EmitterMixin();\n    }\n\n    ElementDragging.prototype.destroy = function () {};\n\n    ElementDragging.prototype.setMirrorIsVisible = function (bool) {// optional if subclass doesn't want to support a mirror\n    };\n\n    ElementDragging.prototype.setMirrorNeedsRevert = function (bool) {// optional if subclass doesn't want to support a mirror\n    };\n\n    ElementDragging.prototype.setAutoScrollEnabled = function (bool) {// optional\n    };\n\n    return ElementDragging;\n  }();\n\n  function formatDate(dateInput, settings) {\n    if (settings === void 0) {\n      settings = {};\n    }\n\n    var dateEnv = buildDateEnv$1(settings);\n    var formatter = createFormatter(settings);\n    var dateMeta = dateEnv.createMarkerMeta(dateInput);\n\n    if (!dateMeta) {\n      // TODO: warning?\n      return '';\n    }\n\n    return dateEnv.format(dateMeta.marker, formatter, {\n      forcedTzo: dateMeta.forcedTzo\n    });\n  }\n\n  function formatRange(startInput, endInput, settings // mixture of env and formatter settings\n  ) {\n    var dateEnv = buildDateEnv$1(typeof settings === 'object' && settings ? settings : {}); // pass in if non-null object\n\n    var formatter = createFormatter(settings, globalDefaults.defaultRangeSeparator);\n    var startMeta = dateEnv.createMarkerMeta(startInput);\n    var endMeta = dateEnv.createMarkerMeta(endInput);\n\n    if (!startMeta || !endMeta) {\n      // TODO: warning?\n      return '';\n    }\n\n    return dateEnv.formatRange(startMeta.marker, endMeta.marker, formatter, {\n      forcedStartTzo: startMeta.forcedTzo,\n      forcedEndTzo: endMeta.forcedTzo,\n      isEndExclusive: settings.isEndExclusive\n    });\n  } // TODO: more DRY and optimized\n\n\n  function buildDateEnv$1(settings) {\n    var locale = buildLocale(settings.locale || 'en', parseRawLocales([]).map); // TODO: don't hardcode 'en' everywhere\n    // ensure required settings\n\n    settings = _assign({\n      timeZone: globalDefaults.timeZone,\n      calendarSystem: 'gregory'\n    }, settings, {\n      locale: locale\n    });\n    return new DateEnv(settings);\n  }\n\n  var DRAG_META_PROPS = {\n    startTime: createDuration,\n    duration: createDuration,\n    create: Boolean,\n    sourceId: String\n  };\n  var DRAG_META_DEFAULTS = {\n    create: true\n  };\n\n  function parseDragMeta(raw) {\n    var leftoverProps = {};\n    var refined = refineProps(raw, DRAG_META_PROPS, DRAG_META_DEFAULTS, leftoverProps);\n    refined.leftoverProps = leftoverProps;\n    return refined;\n  } // Computes a default column header formatting string if `colFormat` is not explicitly defined\n\n\n  function computeFallbackHeaderFormat(datesRepDistinctDays, dayCnt) {\n    // if more than one week row, or if there are a lot of columns with not much space,\n    // put just the day numbers will be in each cell\n    if (!datesRepDistinctDays || dayCnt > 10) {\n      return {\n        weekday: 'short'\n      }; // \"Sat\"\n    } else if (dayCnt > 1) {\n      return {\n        weekday: 'short',\n        month: 'numeric',\n        day: 'numeric',\n        omitCommas: true\n      }; // \"Sat 11/12\"\n    } else {\n      return {\n        weekday: 'long'\n      }; // \"Saturday\"\n    }\n  }\n\n  function renderDateCell(dateMarker, dateProfile, datesRepDistinctDays, colCnt, colHeadFormat, context, colspan, otherAttrs) {\n    var view = context.view,\n        dateEnv = context.dateEnv,\n        theme = context.theme,\n        options = context.options;\n    var isDateValid = rangeContainsMarker(dateProfile.activeRange, dateMarker); // TODO: called too frequently. cache somehow.\n\n    var classNames = ['fc-day-header', theme.getClass('widgetHeader')];\n    var innerHtml;\n\n    if (typeof options.columnHeaderHtml === 'function') {\n      innerHtml = options.columnHeaderHtml(dateEnv.toDate(dateMarker));\n    } else if (typeof options.columnHeaderText === 'function') {\n      innerHtml = htmlEscape(options.columnHeaderText(dateEnv.toDate(dateMarker)));\n    } else {\n      innerHtml = htmlEscape(dateEnv.format(dateMarker, colHeadFormat));\n    } // if only one row of days, the classNames on the header can represent the specific days beneath\n\n\n    if (datesRepDistinctDays) {\n      classNames = classNames.concat( // includes the day-of-week class\n      // noThemeHighlight=true (don't highlight the header)\n      getDayClasses(dateMarker, dateProfile, context, true));\n    } else {\n      classNames.push('fc-' + DAY_IDS[dateMarker.getUTCDay()]); // only add the day-of-week class\n    }\n\n    return '' + '<th class=\"' + classNames.join(' ') + '\"' + (isDateValid && datesRepDistinctDays ? ' data-date=\"' + dateEnv.formatIso(dateMarker, {\n      omitTime: true\n    }) + '\"' : '') + (colspan > 1 ? ' colspan=\"' + colspan + '\"' : '') + (otherAttrs ? ' ' + otherAttrs : '') + '>' + (isDateValid ? // don't make a link if the heading could represent multiple days, or if there's only one day (forceOff)\n    buildGotoAnchorHtml(view, {\n      date: dateMarker,\n      forceOff: !datesRepDistinctDays || colCnt === 1\n    }, innerHtml) : // if not valid, display text, but no link\n    innerHtml) + '</th>';\n  }\n\n  var DayHeader =\n  /** @class */\n  function (_super) {\n    __extends(DayHeader, _super);\n\n    function DayHeader(context, parentEl) {\n      var _this = _super.call(this, context) || this;\n\n      parentEl.innerHTML = ''; // because might be nbsp\n\n      parentEl.appendChild(_this.el = htmlToElement('<div class=\"fc-row ' + _this.theme.getClass('headerRow') + '\">' + '<table class=\"' + _this.theme.getClass('tableGrid') + '\">' + '<thead></thead>' + '</table>' + '</div>'));\n      _this.thead = _this.el.querySelector('thead');\n      return _this;\n    }\n\n    DayHeader.prototype.destroy = function () {\n      removeElement(this.el);\n    };\n\n    DayHeader.prototype.render = function (props) {\n      var dates = props.dates,\n          datesRepDistinctDays = props.datesRepDistinctDays;\n      var parts = [];\n\n      if (props.renderIntroHtml) {\n        parts.push(props.renderIntroHtml());\n      }\n\n      var colHeadFormat = createFormatter(this.opt('columnHeaderFormat') || computeFallbackHeaderFormat(datesRepDistinctDays, dates.length));\n\n      for (var _i = 0, dates_1 = dates; _i < dates_1.length; _i++) {\n        var date = dates_1[_i];\n        parts.push(renderDateCell(date, props.dateProfile, datesRepDistinctDays, dates.length, colHeadFormat, this.context));\n      }\n\n      if (this.isRtl) {\n        parts.reverse();\n      }\n\n      this.thead.innerHTML = '<tr>' + parts.join('') + '</tr>';\n    };\n\n    return DayHeader;\n  }(Component);\n\n  var DaySeries =\n  /** @class */\n  function () {\n    function DaySeries(range, dateProfileGenerator) {\n      var date = range.start;\n      var end = range.end;\n      var indices = [];\n      var dates = [];\n      var dayIndex = -1;\n\n      while (date < end) {\n        // loop each day from start to end\n        if (dateProfileGenerator.isHiddenDay(date)) {\n          indices.push(dayIndex + 0.5); // mark that it's between indices\n        } else {\n          dayIndex++;\n          indices.push(dayIndex);\n          dates.push(date);\n        }\n\n        date = addDays(date, 1);\n      }\n\n      this.dates = dates;\n      this.indices = indices;\n      this.cnt = dates.length;\n    }\n\n    DaySeries.prototype.sliceRange = function (range) {\n      var firstIndex = this.getDateDayIndex(range.start); // inclusive first index\n\n      var lastIndex = this.getDateDayIndex(addDays(range.end, -1)); // inclusive last index\n\n      var clippedFirstIndex = Math.max(0, firstIndex);\n      var clippedLastIndex = Math.min(this.cnt - 1, lastIndex); // deal with in-between indices\n\n      clippedFirstIndex = Math.ceil(clippedFirstIndex); // in-between starts round to next cell\n\n      clippedLastIndex = Math.floor(clippedLastIndex); // in-between ends round to prev cell\n\n      if (clippedFirstIndex <= clippedLastIndex) {\n        return {\n          firstIndex: clippedFirstIndex,\n          lastIndex: clippedLastIndex,\n          isStart: firstIndex === clippedFirstIndex,\n          isEnd: lastIndex === clippedLastIndex\n        };\n      } else {\n        return null;\n      }\n    }; // Given a date, returns its chronolocial cell-index from the first cell of the grid.\n    // If the date lies between cells (because of hiddenDays), returns a floating-point value between offsets.\n    // If before the first offset, returns a negative number.\n    // If after the last offset, returns an offset past the last cell offset.\n    // Only works for *start* dates of cells. Will not work for exclusive end dates for cells.\n\n\n    DaySeries.prototype.getDateDayIndex = function (date) {\n      var indices = this.indices;\n      var dayOffset = Math.floor(diffDays(this.dates[0], date));\n\n      if (dayOffset < 0) {\n        return indices[0] - 1;\n      } else if (dayOffset >= indices.length) {\n        return indices[indices.length - 1] + 1;\n      } else {\n        return indices[dayOffset];\n      }\n    };\n\n    return DaySeries;\n  }();\n\n  var DayTable =\n  /** @class */\n  function () {\n    function DayTable(daySeries, breakOnWeeks) {\n      var dates = daySeries.dates;\n      var daysPerRow;\n      var firstDay;\n      var rowCnt;\n\n      if (breakOnWeeks) {\n        // count columns until the day-of-week repeats\n        firstDay = dates[0].getUTCDay();\n\n        for (daysPerRow = 1; daysPerRow < dates.length; daysPerRow++) {\n          if (dates[daysPerRow].getUTCDay() === firstDay) {\n            break;\n          }\n        }\n\n        rowCnt = Math.ceil(dates.length / daysPerRow);\n      } else {\n        rowCnt = 1;\n        daysPerRow = dates.length;\n      }\n\n      this.rowCnt = rowCnt;\n      this.colCnt = daysPerRow;\n      this.daySeries = daySeries;\n      this.cells = this.buildCells();\n      this.headerDates = this.buildHeaderDates();\n    }\n\n    DayTable.prototype.buildCells = function () {\n      var rows = [];\n\n      for (var row = 0; row < this.rowCnt; row++) {\n        var cells = [];\n\n        for (var col = 0; col < this.colCnt; col++) {\n          cells.push(this.buildCell(row, col));\n        }\n\n        rows.push(cells);\n      }\n\n      return rows;\n    };\n\n    DayTable.prototype.buildCell = function (row, col) {\n      return {\n        date: this.daySeries.dates[row * this.colCnt + col]\n      };\n    };\n\n    DayTable.prototype.buildHeaderDates = function () {\n      var dates = [];\n\n      for (var col = 0; col < this.colCnt; col++) {\n        dates.push(this.cells[0][col].date);\n      }\n\n      return dates;\n    };\n\n    DayTable.prototype.sliceRange = function (range) {\n      var colCnt = this.colCnt;\n      var seriesSeg = this.daySeries.sliceRange(range);\n      var segs = [];\n\n      if (seriesSeg) {\n        var firstIndex = seriesSeg.firstIndex,\n            lastIndex = seriesSeg.lastIndex;\n        var index = firstIndex;\n\n        while (index <= lastIndex) {\n          var row = Math.floor(index / colCnt);\n          var nextIndex = Math.min((row + 1) * colCnt, lastIndex + 1);\n          segs.push({\n            row: row,\n            firstCol: index % colCnt,\n            lastCol: (nextIndex - 1) % colCnt,\n            isStart: seriesSeg.isStart && index === firstIndex,\n            isEnd: seriesSeg.isEnd && nextIndex - 1 === lastIndex\n          });\n          index = nextIndex;\n        }\n      }\n\n      return segs;\n    };\n\n    return DayTable;\n  }();\n\n  var Slicer =\n  /** @class */\n  function () {\n    function Slicer() {\n      this.sliceBusinessHours = memoize(this._sliceBusinessHours);\n      this.sliceDateSelection = memoize(this._sliceDateSpan);\n      this.sliceEventStore = memoize(this._sliceEventStore);\n      this.sliceEventDrag = memoize(this._sliceInteraction);\n      this.sliceEventResize = memoize(this._sliceInteraction);\n    }\n\n    Slicer.prototype.sliceProps = function (props, dateProfile, nextDayThreshold, component) {\n      var extraArgs = [];\n\n      for (var _i = 4; _i < arguments.length; _i++) {\n        extraArgs[_i - 4] = arguments[_i];\n      }\n\n      var eventUiBases = props.eventUiBases;\n      var eventSegs = this.sliceEventStore.apply(this, [props.eventStore, eventUiBases, dateProfile, nextDayThreshold, component].concat(extraArgs));\n      return {\n        dateSelectionSegs: this.sliceDateSelection.apply(this, [props.dateSelection, eventUiBases, component].concat(extraArgs)),\n        businessHourSegs: this.sliceBusinessHours.apply(this, [props.businessHours, dateProfile, nextDayThreshold, component].concat(extraArgs)),\n        fgEventSegs: eventSegs.fg,\n        bgEventSegs: eventSegs.bg,\n        eventDrag: this.sliceEventDrag.apply(this, [props.eventDrag, eventUiBases, dateProfile, nextDayThreshold, component].concat(extraArgs)),\n        eventResize: this.sliceEventResize.apply(this, [props.eventResize, eventUiBases, dateProfile, nextDayThreshold, component].concat(extraArgs)),\n        eventSelection: props.eventSelection\n      }; // TODO: give interactionSegs?\n    };\n\n    Slicer.prototype.sliceNowDate = function ( // does not memoize\n    date, component) {\n      var extraArgs = [];\n\n      for (var _i = 2; _i < arguments.length; _i++) {\n        extraArgs[_i - 2] = arguments[_i];\n      }\n\n      return this._sliceDateSpan.apply(this, [{\n        range: {\n          start: date,\n          end: addMs(date, 1)\n        },\n        allDay: false\n      }, {}, component].concat(extraArgs));\n    };\n\n    Slicer.prototype._sliceBusinessHours = function (businessHours, dateProfile, nextDayThreshold, component) {\n      var extraArgs = [];\n\n      for (var _i = 4; _i < arguments.length; _i++) {\n        extraArgs[_i - 4] = arguments[_i];\n      }\n\n      if (!businessHours) {\n        return [];\n      }\n\n      return this._sliceEventStore.apply(this, [expandRecurring(businessHours, computeActiveRange(dateProfile, Boolean(nextDayThreshold)), component.calendar), {}, dateProfile, nextDayThreshold, component].concat(extraArgs)).bg;\n    };\n\n    Slicer.prototype._sliceEventStore = function (eventStore, eventUiBases, dateProfile, nextDayThreshold, component) {\n      var extraArgs = [];\n\n      for (var _i = 5; _i < arguments.length; _i++) {\n        extraArgs[_i - 5] = arguments[_i];\n      }\n\n      if (eventStore) {\n        var rangeRes = sliceEventStore(eventStore, eventUiBases, computeActiveRange(dateProfile, Boolean(nextDayThreshold)), nextDayThreshold);\n        return {\n          bg: this.sliceEventRanges(rangeRes.bg, component, extraArgs),\n          fg: this.sliceEventRanges(rangeRes.fg, component, extraArgs)\n        };\n      } else {\n        return {\n          bg: [],\n          fg: []\n        };\n      }\n    };\n\n    Slicer.prototype._sliceInteraction = function (interaction, eventUiBases, dateProfile, nextDayThreshold, component) {\n      var extraArgs = [];\n\n      for (var _i = 5; _i < arguments.length; _i++) {\n        extraArgs[_i - 5] = arguments[_i];\n      }\n\n      if (!interaction) {\n        return null;\n      }\n\n      var rangeRes = sliceEventStore(interaction.mutatedEvents, eventUiBases, computeActiveRange(dateProfile, Boolean(nextDayThreshold)), nextDayThreshold);\n      return {\n        segs: this.sliceEventRanges(rangeRes.fg, component, extraArgs),\n        affectedInstances: interaction.affectedEvents.instances,\n        isEvent: interaction.isEvent,\n        sourceSeg: interaction.origSeg\n      };\n    };\n\n    Slicer.prototype._sliceDateSpan = function (dateSpan, eventUiBases, component) {\n      var extraArgs = [];\n\n      for (var _i = 3; _i < arguments.length; _i++) {\n        extraArgs[_i - 3] = arguments[_i];\n      }\n\n      if (!dateSpan) {\n        return [];\n      }\n\n      var eventRange = fabricateEventRange(dateSpan, eventUiBases, component.calendar);\n      var segs = this.sliceRange.apply(this, [dateSpan.range].concat(extraArgs));\n\n      for (var _a = 0, segs_1 = segs; _a < segs_1.length; _a++) {\n        var seg = segs_1[_a];\n        seg.component = component;\n        seg.eventRange = eventRange;\n      }\n\n      return segs;\n    };\n    /*\n    \"complete\" seg means it has component and eventRange\n    */\n\n\n    Slicer.prototype.sliceEventRanges = function (eventRanges, component, // TODO: kill\n    extraArgs) {\n      var segs = [];\n\n      for (var _i = 0, eventRanges_1 = eventRanges; _i < eventRanges_1.length; _i++) {\n        var eventRange = eventRanges_1[_i];\n        segs.push.apply(segs, this.sliceEventRange(eventRange, component, extraArgs));\n      }\n\n      return segs;\n    };\n    /*\n    \"complete\" seg means it has component and eventRange\n    */\n\n\n    Slicer.prototype.sliceEventRange = function (eventRange, component, // TODO: kill\n    extraArgs) {\n      var segs = this.sliceRange.apply(this, [eventRange.range].concat(extraArgs));\n\n      for (var _i = 0, segs_2 = segs; _i < segs_2.length; _i++) {\n        var seg = segs_2[_i];\n        seg.component = component;\n        seg.eventRange = eventRange;\n        seg.isStart = eventRange.isStart && seg.isStart;\n        seg.isEnd = eventRange.isEnd && seg.isEnd;\n      }\n\n      return segs;\n    };\n\n    return Slicer;\n  }();\n  /*\n  for incorporating minTime/maxTime if appropriate\n  TODO: should be part of DateProfile!\n  TimelineDateProfile already does this btw\n  */\n\n\n  function computeActiveRange(dateProfile, isComponentAllDay) {\n    var range = dateProfile.activeRange;\n\n    if (isComponentAllDay) {\n      return range;\n    }\n\n    return {\n      start: addMs(range.start, dateProfile.minTime.milliseconds),\n      end: addMs(range.end, dateProfile.maxTime.milliseconds - 864e5) // 864e5 = ms in a day\n\n    };\n  } // exports\n  // --------------------------------------------------------------------------------------------------\n\n\n  var version = '4.0.1';\n  exports.version = version;\n  exports.parseEventDef = parseEventDef;\n  exports.createEventInstance = createEventInstance;\n  exports.parseBusinessHours = parseBusinessHours;\n  exports.applyAll = applyAll;\n  exports.debounce = debounce;\n  exports.padStart = padStart;\n  exports.isInt = isInt;\n  exports.capitaliseFirstLetter = capitaliseFirstLetter;\n  exports.parseFieldSpecs = parseFieldSpecs;\n  exports.compareByFieldSpecs = compareByFieldSpecs;\n  exports.compareByFieldSpec = compareByFieldSpec;\n  exports.flexibleCompare = flexibleCompare;\n  exports.computeVisibleDayRange = computeVisibleDayRange;\n  exports.refineProps = refineProps;\n  exports.matchCellWidths = matchCellWidths;\n  exports.uncompensateScroll = uncompensateScroll;\n  exports.compensateScroll = compensateScroll;\n  exports.subtractInnerElHeight = subtractInnerElHeight;\n  exports.isMultiDayRange = isMultiDayRange;\n  exports.distributeHeight = distributeHeight;\n  exports.undistributeHeight = undistributeHeight;\n  exports.preventSelection = preventSelection;\n  exports.allowSelection = allowSelection;\n  exports.preventContextMenu = preventContextMenu;\n  exports.allowContextMenu = allowContextMenu;\n  exports.compareNumbers = compareNumbers;\n  exports.enableCursor = enableCursor;\n  exports.disableCursor = disableCursor;\n  exports.diffDates = diffDates;\n  exports.htmlEscape = htmlEscape;\n  exports.cssToStr = cssToStr;\n  exports.removeExact = removeExact;\n  exports.isArraysEqual = isArraysEqual;\n  exports.memoize = memoize;\n  exports.memoizeOutput = memoizeOutput;\n  exports.memoizeRendering = memoizeRendering;\n  exports.intersectRects = intersectRects;\n  exports.pointInsideRect = pointInsideRect;\n  exports.constrainPoint = constrainPoint;\n  exports.getRectCenter = getRectCenter;\n  exports.diffPoints = diffPoints;\n  exports.translateRect = translateRect;\n  exports.isPropsEqual = isPropsEqual;\n  exports.mapHash = mapHash;\n  exports.filterHash = filterHash;\n  exports.findElements = findElements;\n  exports.findChildren = findChildren;\n  exports.htmlToElement = htmlToElement;\n  exports.createElement = createElement;\n  exports.insertAfterElement = insertAfterElement;\n  exports.prependToElement = prependToElement;\n  exports.removeElement = removeElement;\n  exports.appendToElement = appendToElement;\n  exports.applyStyle = applyStyle;\n  exports.applyStyleProp = applyStyleProp;\n  exports.elementMatches = elementMatches;\n  exports.elementClosest = elementClosest;\n  exports.forceClassName = forceClassName;\n  exports.filterEventStoreDefs = filterEventStoreDefs;\n  exports.createEmptyEventStore = createEmptyEventStore;\n  exports.mergeEventStores = mergeEventStores;\n  exports.getRelevantEvents = getRelevantEvents;\n  exports.eventTupleToStore = eventTupleToStore;\n  exports.processScopedUiProps = processScopedUiProps;\n  exports.combineEventUis = combineEventUis;\n  exports.Splitter = Splitter;\n  exports.buildGotoAnchorHtml = buildGotoAnchorHtml;\n  exports.getAllDayHtml = getAllDayHtml;\n  exports.getDayClasses = getDayClasses;\n  exports.preventDefault = preventDefault;\n  exports.listenBySelector = listenBySelector;\n  exports.whenTransitionDone = whenTransitionDone;\n  exports.computeInnerRect = computeInnerRect;\n  exports.computeEdges = computeEdges;\n  exports.computeHeightAndMargins = computeHeightAndMargins;\n  exports.getClippingParents = getClippingParents;\n  exports.computeClippingRect = computeClippingRect;\n  exports.computeRect = computeRect;\n  exports.unpromisify = unpromisify;\n  exports.EmitterMixin = EmitterMixin;\n  exports.rangeContainsMarker = rangeContainsMarker;\n  exports.intersectRanges = intersectRanges;\n  exports.rangesEqual = rangesEqual;\n  exports.rangesIntersect = rangesIntersect;\n  exports.rangeContainsRange = rangeContainsRange;\n  exports.Mixin = Mixin;\n  exports.PositionCache = PositionCache;\n  exports.ScrollComponent = ScrollComponent;\n  exports.ScrollController = ScrollController;\n  exports.ElementScrollController = ElementScrollController;\n  exports.WindowScrollController = WindowScrollController;\n  exports.Theme = Theme;\n  exports.Component = Component;\n  exports.DateComponent = DateComponent;\n  exports.Calendar = Calendar;\n  exports.View = View;\n  exports.FgEventRenderer = FgEventRenderer;\n  exports.buildSegCompareObj = buildSegCompareObj;\n  exports.FillRenderer = FillRenderer;\n  exports.DateProfileGenerator = DateProfileGenerator;\n  exports.isDateSpansEqual = isDateSpansEqual;\n  exports.addDays = addDays;\n  exports.startOfDay = startOfDay;\n  exports.addMs = addMs;\n  exports.addWeeks = addWeeks;\n  exports.diffWeeks = diffWeeks;\n  exports.diffWholeWeeks = diffWholeWeeks;\n  exports.diffWholeDays = diffWholeDays;\n  exports.diffDayAndTime = diffDayAndTime;\n  exports.diffDays = diffDays;\n  exports.isValidDate = isValidDate;\n  exports.createDuration = createDuration;\n  exports.isSingleDay = isSingleDay;\n  exports.multiplyDuration = multiplyDuration;\n  exports.addDurations = addDurations;\n  exports.asRoughMinutes = asRoughMinutes;\n  exports.asRoughSeconds = asRoughSeconds;\n  exports.asRoughMs = asRoughMs;\n  exports.wholeDivideDurations = wholeDivideDurations;\n  exports.greatestDurationDenominator = greatestDurationDenominator;\n  exports.DateEnv = DateEnv;\n  exports.createFormatter = createFormatter;\n  exports.formatIsoTimeString = formatIsoTimeString;\n  exports.NamedTimeZoneImpl = NamedTimeZoneImpl;\n  exports.parseMarker = parse;\n  exports.Interaction = Interaction;\n  exports.interactionSettingsToStore = interactionSettingsToStore;\n  exports.interactionSettingsStore = interactionSettingsStore;\n  exports.ElementDragging = ElementDragging;\n  exports.formatDate = formatDate;\n  exports.formatRange = formatRange;\n  exports.globalDefaults = globalDefaults;\n  exports.config = config;\n  exports.parseDragMeta = parseDragMeta;\n  exports.createPlugin = createPlugin;\n  exports.DayHeader = DayHeader;\n  exports.computeFallbackHeaderFormat = computeFallbackHeaderFormat;\n  exports.renderDateCell = renderDateCell;\n  exports.DaySeries = DaySeries;\n  exports.sliceEventStore = sliceEventStore;\n  exports.hasBgRendering = hasBgRendering;\n  exports.getElSeg = getElSeg;\n  exports.DayTable = DayTable;\n  exports.Slicer = Slicer;\n  exports.applyMutationToEventStore = applyMutationToEventStore;\n  exports.isPropsValid = isPropsValid;\n  exports.isInteractionValid = isInteractionValid;\n  exports.EventApi = EventApi;\n  exports.requestJson = requestJson;\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n});","map":{"version":3,"sources":["C:/Users/zura.ph/WebstormProjects/zloto/node_modules/@fullcalendar/core/main.js"],"names":["global","factory","exports","module","define","amd","self","FullCalendar","elementPropHash","className","colSpan","rowSpan","containerTagHash","createElement","tagName","attrs","content","el","document","attrName","applyStyle","setAttribute","innerHTML","appendToElement","htmlToElement","html","trim","container","computeContainerTag","firstChild","htmlToElements","Array","prototype","slice","call","htmlToNodeList","childNodes","substr","normalizeContent","i","length","appendChild","prependToElement","parent","newEls","afterEl","insertBefore","insertAfterElement","refEl","nextSibling","parentNode","els","Node","removeElement","removeChild","matchesMethod","Element","matches","matchesSelector","msMatchesSelector","closestMethod","closest","selector","documentElement","contains","elementMatches","parentElement","nodeType","elementClosest","findElements","containers","HTMLElement","allMatches","querySelectorAll","j","push","findChildren","parents","children","childNode","forceClassName","bool","classList","add","remove","PIXEL_PROP_RE","props","propName","applyStyleProp","name","val","style","test","pointInsideRect","point","rect","left","right","top","bottom","intersectRects","rect1","rect2","res","Math","max","min","translateRect","deltaX","deltaY","constrainPoint","getRectCenter","diffPoints","point1","point2","isRtlScrollbarOnLeft","getIsRtlScrollbarOnLeft","computeIsRtlScrollbarOnLeft","outerEl","position","border","padding","overflow","direction","body","innerEl","getBoundingClientRect","sanitizeScrollbarWidth","width","round","computeEdges","getPadding","computedStyle","window","getComputedStyle","borderLeft","parseInt","borderLeftWidth","borderRight","borderRightWidth","borderTop","borderTopWidth","borderBottom","borderBottomWidth","scrollbarLeftRight","offsetWidth","clientWidth","scrollbarBottom","offsetHeight","clientHeight","scrollbarLeft","scrollbarRight","paddingLeft","paddingRight","paddingTop","paddingBottom","computeInnerRect","goWithinPadding","outerRect","computeRect","edges","pageXOffset","pageYOffset","computeViewportRect","computeHeightAndMargins","computed","height","marginTop","marginBottom","getClippingParents","overflowY","overflowX","computeClippingRect","map","concat","reduce","rect0","preventDefault","ev","listenBySelector","eventType","handler","realHandler","matchedChild","target","addEventListener","removeEventListener","listenToHoverBySelector","onMouseEnter","onMouseLeave","currentMatchedChild","realOnMouseLeave_1","transitionEventNames","whenTransitionDone","callback","realCallback","forEach","eventName","DAY_IDS","addWeeks","m","n","a","dateToUtcArray","arrayToUtcDate","addDays","addMs","diffWeeks","m0","m1","diffDays","valueOf","diffHours","diffMinutes","diffSeconds","diffDayAndTime","m0day","startOfDay","m1day","years","months","days","milliseconds","diffWholeWeeks","d","diffWholeDays","timeAsMs","getUTCFullYear","getUTCMonth","getUTCDate","startOfHour","getUTCHours","startOfMinute","getUTCMinutes","startOfSecond","getUTCSeconds","weekOfYear","marker","dow","doy","y","w","weekOfGivenYear","nextW","year","firstWeekStart","firstWeekOffset","dayStart","floor","fwd","fwdlw","getUTCDay","dateToLocalArray","date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","getMilliseconds","arrayToLocalDate","Date","getUTCMilliseconds","UTC","apply","isValidDate","isNaN","INTERNAL_UNITS","PARSE_RE","createDuration","input","unit","_a","parseString","normalizeObject","s","exec","sign","obj","month","day","getWeeksFromInput","hours","hour","minutes","minute","seconds","second","millisecond","ms","weeks","week","durationsEqual","d0","d1","isSingleDay","dur","addDurations","subtractDurations","multiplyDuration","asRoughYears","asRoughDays","asRoughMonths","asRoughMs","asRoughMinutes","asRoughSeconds","wholeDivideDurations","numerator","denominator","localRes","isInt","greatestDurationDenominator","dontReturnWeeks","value","compensateScroll","rowEl","scrollbarWidths","marginLeft","marginRight","uncompensateScroll","disableCursor","enableCursor","distributeHeight","availableHeight","shouldRedistribute","minOffset1","minOffset2","flexEls","flexOffsets","flexHeights","usedHeight","undistributeHeight","minOffset","naturalOffset","naturalHeight","newHeight","matchCellWidths","maxInnerWidth","innerWidth_1","subtractInnerElHeight","reflowStyleProps","diff","resetStyleProps","preventSelection","allowSelection","preventContextMenu","allowContextMenu","parseFieldSpecs","specs","tokens","token","split","isArray","charAt","field","substring","order","func","compareByFieldSpecs","obj0","obj1","fieldSpecs","cmp","compareByFieldSpec","fieldSpec","flexibleCompare","b","String","localeCompare","capitaliseFirstLetter","str","toUpperCase","padStart","len","compareNumbers","applyAll","functions","thisObj","args","ret","firstDefined","_i","arguments","undefined","debounce","wait","timeout","context","timestamp","result","later","last","setTimeout","refineProps","rawProps","processors","defaults","leftoverProps","refined","key","processor","Function","Number","Boolean","computeAlignedDayRange","timedRange","dayCnt","start","end","computeVisibleDayRange","nextDayThreshold","startDay","endDay","endTimeMS","isMultiDayRange","range","visibleRange","diffDates","date0","date1","dateEnv","largeUnit","diffWholeYears","diffWholeMonths","parseRecurring","eventInput","allDayDefault","recurringTypes","leftovers","parsed","parse","allDay","duration","typeData","typeId","expandRecurringRanges","eventDef","framingRange","typeDef","recurringDef","markers","expand","extendStatics","Object","setPrototypeOf","__proto__","p","hasOwnProperty","__extends","__","constructor","create","__assign","assign","t","mergeProps","propObjs","complexProps","dest","complexObjs","unshift","filterHash","hash","filtered","mapHash","newHash","arrayToHash","a_1","item","isPropsEqual","parseEvents","rawEvents","sourceId","calendar","allowOpenRange","eventStore","createEmptyEventStore","rawEvents_1","rawEvent","tuple","parseEvent","eventTupleToStore","defs","def","defId","instance","instances","instanceId","expandRecurring","starts","pluginSystem","hooks","defaultAllDayEventDuration","defaultTimedEventDuration","starts_1","createEventInstance","getRelevantEvents","def_1","newStore","filterEventStoreDefs","lookDef","isEventDefsGrouped","def0","def1","groupId","transformRawEvents","eventSource","calEachTransform","opt","sourceEachTransform","eventDataTransform","transformEachRawEvent","refinedEvents","rawEvents_2","refinedEvent","mergeEventStores","store0","store1","filterFunc","parseRange","createMarker","invertRanges","ranges","constraintRange","invertedRanges","dateRange","sort","compareRanges","range0","range1","intersectRanges","newRange","rangesEqual","rangesIntersect","rangeContainsRange","outerRange","innerRange","rangeContainsMarker","constrainMarkerToRange","removeExact","array","exactVal","removeCnt","splice","isArraysEqual","a0","a1","memoize","workerFunc","memoizeOutput","equalityFunc","cachedRes","newRes","EXTENDED_SETTINGS_AND_SEVERITIES","separator","omitZeroMinute","meridiem","omitCommas","STANDARD_DATE_PROP_SEVERITIES","timeZoneName","era","weekday","MERIDIEM_RE","COMMA_RE","MULTI_SPACE_RE","LTR_RE","UTC_RE","NativeFormatter","formatSettings","standardDateProps","extendedSettings","severity","name_1","buildFormattingFunc","format","formatRange","diffSeverity","computeMarkerDiffSeverity","calendarSystem","biggestUnitForPartial","full0","full1","partialDateProps","computePartialFormattingOptions","partialFormattingFunc","partial0","partial1","insertion","findCommonInsertion","before","after","getLargestUnit","standardDatePropCnt","keys","formatTimeZoneOffset","timeZoneOffset","formatWeekNumber","computeWeekNumber","weekLabel","locale","buildNativeFormattingFunc","sanitizeSettings","timeZone","normalFormat","Intl","DateTimeFormat","codes","zeroFormat","zeroProps","postProcess","replace","injectTzoStr","toLocaleLowerCase","tzoStr","replaced","num","display","parts","simpleNumberFormat","options","isRtl","reverse","join","ca","getMarkerYear","getMarkerMonth","getMarkerDay","biggestUnit","partialOptions","name_2","i0","found0","indexOf","before0","after0","i1","found1","before1","after1","CmdFormatter","cmdStr","cmdFormatter","createVerboseFormattingArg","FuncFormatter","createFormatter","defaultSeparator","buildIsoString","stripZeroTime","toISOString","formatIsoTimeString","doIso","abs","mins","startInfo","expandZonedMarker","endInfo","localeCodes","dateInfo","markerToArray","EventSourceApi","internalEventSource","dispatch","type","refetch","sourceIds","defineProperty","get","publicId","enumerable","configurable","meta","url","EventApi","_calendar","_def","_instance","setProp","_b","DATE_PROPS","NON_DATE_PROPS","mutate","standardProps","UNSCOPED_EVENT_UI_PROPS","ui","backgroundColor","borderColor","startEditable","durationEditable","setExtendedProp","extendedProps","setStart","startInput","instanceRange","startDelta","granularity","endDelta","maintainDuration","origDuration","newDuration","setEnd","endInput","hasEnd","setDates","moveStart","deltaInput","delta","moveEnd","moveDates","setAllDay","formatInput","formatter","forcedStartTzo","forcedEndTzo","forcedTzo","mutation","fromApi","state","eventSources","toDate","title","rendering","constraints","overlap","allows","textColor","classNames","sliceEventStore","eventUiBases","inverseBgByGroupId","inverseBgByDefId","defByGroupId","bgRanges","fgRanges","eventUis","compileEventUis","origRange","normalRange","slicedRange","isStart","isEnd","invertedRanges_1","invertedRange","invertedRanges_2","bg","fg","hasBgRendering","filterSegsViaEls","view","segs","isMirror","hasPublicHandlers","filter","seg","custom","publiclyTrigger","event","eventRange","segs_1","setElSeg","fcSeg","getElSeg","eventDefs","compileEventUi","uis","combineEventUis","applyMutationToEventStore","eventConfigBase","eventConfigs","applyMutationToEventDef","eventDefMutationAppliers","applyMutationToEventInstance","eventConfig","appliers","willDeltasAffectDuration","copy","appliers_1","applier","eventInstance","forceAllDay","clearEnd","getDefaultEventEnd","reduceEventStore","action","dateProfile","receiveRawEvents","fetchId","fetchRange","addEvent","activeRange","rezoneDates","oldDateEnv","applyMutationToRelated","excludeInstances","excludeEventsBySourceId","latestFetchId","subset","expandRange","newDateEnv","canComputeOffset","relevant","removals","isInteractionValid","interaction","isNewPropsValid","eventDrag","isDateSelectionValid","dateSelection","newProps","businessHours","eventSelection","eventResize","isPropsValid","dateSpanMeta","filterConfig","isInteractionPropsValid","isDateSelectionPropsValid","subjectEventStore","mutatedEvents","subjectDefs","subjectInstances","subjectConfigs","isEvent","selectionConfig","otherEventStore","affectedEvents","otherDefs","otherInstances","otherConfigs","subjectInstanceId","subjectInstance","subjectRange","subjectConfig","subjectDef","allConstraintsPass","overlapFunc","otherInstanceId","otherInstance","otherOverlap","subjectAllow","origDef","origInstance","subjectDateSpan","buildDateSpanApi","relevantEventStore","relevantDefs","relevantInstances","selection","selectionRange","relevantInstanceId","relevantInstance","selectionAllow","fullDateSpan","businessHoursUnexpanded","constraints_1","constraint","anyRangesContainRange","constraintToRanges","eventStoreToRanges","outerRanges","outerRanges_1","normalizeConstraint","htmlEscape","cssToStr","cssProps","statements","attrsToStr","parseClassName","raw","editable","allow","color","processUnscopedUiProps","processScopedUiProps","prefix","rawScoped","rawUnscoped","wasFound","scopedKey","EMPTY_EVENT_UI","combineTwoEventUis","item0","item1","id","uid","computeIsAllDayDefault","leftovers0","recurringRes","parseEventDef","leftovers1","singleRes","parseSingle","pluckNonDateProps","eventDefParsers","eventDefParser","newLeftovers","freeze","pluckDateProps","startMeta","startMarker","endMeta","endMarker","createMarkerMeta","isTimeUnspecified","preLeftovers","source","DEF_DEFAULTS","startTime","endTime","daysOfWeek","parseBusinessHours","refineInputs","rawDefs","rawDef","memoizeRendering","renderFunc","unrenderFunc","dependencies","dependents","thisContext","prevArgs","unrender","dependents_1","dependent","dependencies_1","dependency","EMPTY_EVENT_STORE","Splitter","getKeysForEventDefs","_getKeysForEventDefs","splitDateSelection","_splitDateSpan","splitEventStore","_splitEventStore","splitIndividualUi","_splitIndividualUi","splitEventDrag","_splitInteraction","splitEventResize","eventUiBuilders","splitProps","_this","keyInfos","getKeyInfo","defKeys","dateSelections","individualUi","eventStores","eventDrags","eventResizes","info","buildEventUiForKey","keyInfo","buildEventUi","dateSpan","dateSpans","getKeysForDateSpan","keys_1","getKeysForEventDef","splitStores","_c","splitHashes","splitStates","affectedStores_1","mutatedKeysByDefId","mutatedStores_1","populate","origSeg","allUi","eventUiForKey","baseParts","stuff","buildGotoAnchorHtml","component","gotoOptions","innerHtml","forceOff","finalOptions","formatIso","omitTime","JSON","stringify","getAllDayHtml","getDayClasses","noThemeHighlight","theme","classes","todayStart","todayEnd","currentRange","getNow","getClass","unpromisify","success","failure","isResolved","wrappedSuccess","wrappedFailure","then","Mixin","mixInto","destClass","mixIntoObj","destObj","getOwnPropertyNames","mixOver","EmitterMixin","_super","on","addToHash","_handlers","one","_oneHandlers","off","removeFromHash","trigger","triggerWith","hasHandlers","PositionCache","originEl","isHorizontal","isVertical","build","originClientRect","buildElHorizontals","buildElVerticals","originClientLeft","lefts","rights","originClientTop","tops","bottoms","leftToIndex","leftPosition","topToIndex","topPosition","getWidth","leftIndex","getHeight","topIndex","ScrollController","getMaxScrollTop","getScrollHeight","getClientHeight","getMaxScrollLeft","getScrollWidth","getClientWidth","canScrollVertically","canScrollHorizontally","canScrollUp","getScrollTop","canScrollDown","canScrollLeft","getScrollLeft","canScrollRight","ElementScrollController","scrollTop","scrollLeft","setScrollTop","setScrollLeft","scrollWidth","scrollHeight","WindowScrollController","scroll","ScrollComponent","applyOverflow","clear","setHeight","destroy","lockOverflow","getScrollbarWidths","Theme","calendarOptions","processIconOverride","iconOverrideOption","setIconOverride","iconOverrideHash","iconClassesCopy","buttonName","iconClasses","applyIconOverridePrefix","iconOverridePrefix","getIconClass","baseIconClass","getCustomButtonIconClass","customButtonProps","iconOverrideCustomButtonOption","guid","Component","isView","addEqualityFuncs","newFuncs","equalityFuncs","receiveProps","recycleProps","anyChanges","comboProps","render","oldProps","DateComponent","queryHit","positionLeft","positionTop","elWidth","elHeight","validRange","publiclyTriggerAfterSizing","triggerRenderedSegs","isMirrors","loadingLevel","afterSizingTriggers","_eventsPositioned","triggerWillRemoveSegs","segs_2","segs_3","isValidSegDownEl","isInPopover","isValidDateDownEl","segEl","fgSegSelector","popoverEl","bgSegSelector","uid$1","createPlugin","deps","reducers","eventDragMutationMassagers","dateSelectionTransformers","datePointTransforms","dateSpanTransforms","views","viewPropsTransformers","externalDefTransforms","eventResizeJoinTransforms","viewContainerModifiers","eventDropTransformers","componentInteractions","calendarInteractions","themeClasses","eventSourceDefs","namedTimeZonedImpl","defaultView","elementDraggingImpl","PluginSystem","addedHash","plugin","dep","combineHooks","hooks0","hooks1","eventSourceDef","ignoreRange","parseMeta","events","fetch","arg","ArrayEventSourcePlugin","eventSourceDef$1","bind","startStr","endStr","FuncEventSourcePlugin","requestJson","method","params","successCallback","failureCallback","injectQueryStringParams","encodeParams","xhr","XMLHttpRequest","open","setRequestHeader","onload","status","responseText","err","onerror","send","encodeURIComponent","eventSourceDef$2","extraParams","startParam","endParam","timeZoneParam","requestParams","buildRequestParams","errorMessage","message","JsonFeedEventSourcePlugin","customRequestParams","recurring","startRecur","endRecur","anyValid","clippedFramingRange","expandRanges","SimpleRecurrencePlugin","dowHash","dayMarker","instanceStarts","instanceStart","config","globalDefaults","defaultRangeSeparator","titleRangeSeparator","forceEventDuration","columnHeader","aspectRatio","header","center","weekends","weekNumbers","weekNumberCalculation","scrollTime","minTime","maxTime","showNonCurrentDates","lazyFetching","locales","timeGridEventMinHeight","themeSystem","dragRevertDuration","dragScroll","allDayMaintainDuration","unselectAuto","dropAccept","eventOrder","eventLimit","eventLimitClick","dayPopoverFormat","handleWindowResize","windowResizeDelay","longPressDelay","eventDragMinDistance","rtlDefaults","buttonIcons","prev","next","prevYear","nextYear","complexOptions","mergeOptions","optionObjs","INTERNAL_PLUGINS","refinePluginDefs","pluginInputs","plugins","pluginInputs_1","pluginInput","globalName","console","warn","default","RAW_EN_LOCALE","code","dir","buttonText","today","list","allDayText","eventLimitText","noEventsMessage","parseRawLocales","inputPlural","globalArray","globalMap","rawLocaleArray","inputPlural_1","inputItem","defaultCode","rawLocaleMap","en","rawLocale","buildLocale","inputSingular","available","parseLocale","queryLocale","codeArg","queryRawLocale","simpleId","merged","NumberFormat","OptionsManager","overrides","dynamicOverrides","compute","localeDefaults","dirDefaults","calendarSystemClassMap","registerCalendarSystem","theClass","createCalendarSystem","GregorianCalendarSystem","arrayToMarker","arr","ISO_START","ISO_TZO_RE","whole","z","DateEnv","settings","isNamedTimeZone","namedTimeZoneImpl","weekDow","weekDoy","firstDay","weekNumberFunc","createNowMarker","timestampToMarker","getYear","subtract","addYears","addMonths","greatestWholeUnit","countDurationsBetween","startOf","startOfYear","startOfMonth","startOfWeek","dateOptions","offsetForMarker","isEndExclusive","extraOptions","omitTimeZoneOffset","timestampToArray","getTimezoneOffset","offsetForArray","SIMPLE_SOURCE_PROPS","uid$2","doesSourceNeedRange","sourceDefId","parseEventSource","parseEventSourceProps","isFetching","reduceEventSources","addSources","sources","removeSource","fetchDirtySources","fetchSourcesByIds","excludeStaticSources","receiveResponse","uid$3","eventSourceHash","sources_1","sourceHash","isSourceDirty","prevSources","sourceIdHash","nextSources","fetchSource","sourceDef","calSuccess","calSuccessRes","sourceSuccessRes","error","callFailure","DateProfileGenerator","viewSpec","initHiddenDays","buildPrev","currentDateProfile","currentDate","prevDate","dateIncrement","buildNext","nextDate","forceToValid","currentInfo","isRangeAllDay","renderRange","isValid","buildValidRange","trimHiddenDays","buildCurrentRangeInfo","buildRenderRange","adjustActiveRange","currentRangeUnit","buildDateIncrement","getRangeOption","dayCount","durationUnit","buildRangeFromDuration","buildRangeFromDayCount","buildCustomVisibleRange","getFallbackDuration","class","usesMinMaxTime","alignment","dateAlignment","dateIncrementInput","dateIncrementDuration","isHiddenDay","skipHiddenDays","computeRes","customAlignment","runningCount","fallback","otherArgs","hiddenDays","isHiddenDayHash","Error","inc","isExclusive","isDateProfilesEqual","p0","p1","viewType","reduceViewType","reduceDateProfile","nextState","reduceCurrentDate","reduceDateSelection","reduceSelectedEvent","reduceEventDrag","reduceEventResize","eventSourceLoadingLevel","computeLoadingLevel","reducerFunc","currentViewType","newDateProfile","dateProfileGenerators","dateMarker","generator","newDate","currentSelection","currentInstanceId","eventInstanceId","currentDrag","newDrag","currentResize","newResize","cnt","STANDARD_PROPS","parseDateSpan","defaultDuration","span","parseOpenDateSpan","isDateSpansEqual","span0","span1","isSpanPropsEqual","buildDatePointApi","dateStr","fabricateEventRange","compileViewDefs","defaultConfigs","overrideConfigs","ensureViewDef","viewDef","buildViewDef","defaultConfig","overrideConfig","queryProp","superType","findViewNameBySubclass","superDef","viewSubclass","configs","superProto","getPrototypeOf","parseViewConfigs","inputs","parseViewConfig","VIEW_DEF_PROPS","buildViewSpecs","defaultInputs","optionsManager","viewDefs","buildViewSpec","durationInput","singleUnit","singleUnitOverrides","denom","queryButtonText","buttonTextMap","buttonTextKey","buttonTextOverride","buttonTextDefault","Toolbar","extraClassName","_renderLayout","renderLayout","unrenderLayout","_updateTitle","updateTitle","_updateActiveButton","updateActiveButton","_updateToday","updateToday","_updatePrev","updatePrev","_updateNext","updateNext","layout","activeButton","isTodayEnabled","isPrevEnabled","isNextEnabled","viewsWithButtons","renderSection","buttonStr","viewSpecs","sectionEl","calendarCustomButtons","customButtons","calendarButtonTextOverrides","calendarButtonText","buttonGroupStr","groupChildren","isOnlyButtons","groupEl","buttonClick","buttonIcon","buttonInnerHtml","buttonClasses","buttonEl","buttonAriaAttr","click","text","changeView","buttonGroupClassName","toggleButtonEnabled","titleEl","innerText","disabled","CalendarComponent","_renderToolbars","renderToolbars","buildViewPropTransformers","contentEl","modifyViewContainer","toggleElClassNames","computeTitle","footer","dirClassName","themeClassName","freezeHeight","dateProfileGenerator","renderView","updateSize","thawHeight","headerLayout","footerLayout","now","todayInfo","prevInfo","nextInfo","toolbarProps","addScroll","queryScroll","viewProps","transformers","transformers_1","transformer","transform","isResize","isHeightAuto","computeHeightVars","viewHeight","updateNowIndicator","popScroll","heightInput","contentHeightInput","queryToolbarsHeight","viewOptions","titleFormat","computeTitleFormat","theClasses","Interaction","parseInteractionSettings","useEventCenter","interactionSettingsToStore","interactionSettingsStore","EventClicking","handleSegClick","hasUrlContainer","querySelector","href","jsEvent","defaultPrevented","location","EventHovering","handleEventElRemove","currentSegEl","handleSegLeave","handleSegEnter","triggerEvent","removeHoverListeners","publicEvName","StandardTheme","widget","widgetHeader","widgetContent","buttonGroup","button","buttonActive","popoverHeader","popoverContent","headerRow","dayRow","listView","close","Calendar","buildDateEnv","buildTheme","buildEventUiSingleBase","_buildEventUiSingleBase","buildSelectionConfig","_buildSelectionConfig","buildEventUiBySource","buildEventUiBases","interactionsStore","actionQueue","isReducing","needsRerender","needsFullRerender","isRendering","renderingPauseDepth","buildDelayedRerender","isViewUpdated","isDatesUpdated","isEventsUpdated","pluginDefs","pluginDefs_1","pluginDef","handleOptions","hydrate","calendarInteractionClass","renderableEventStore","bindHandlers","executeRender","requestRerender","unbindHandlers","removeNavLinkListener","anchorEl","getAttribute","customAction","viewOpt","zoomTo","windowResizeProxy","windowResize","buildInitialState","rawSources","singleRawSource","rawSources_1","rawSource","batchRendering","getInitialDate","oldState","shift","newState","needsFull","delayedRerender","tryRerender","renderComponent","savedScroll","eventUiSingleBase","eventUiBySource","applyScroll","releaseAfterSizingTriggers","setOption","getOption","viewOpts","pluginHooks","rerenderDelay","availableRawLocales","dateProfileGeneratorClass","getAvailableLocaleCodes","rawOpts","eventEditable","optHandler","isValidViewType","dateOrRange","unselect","spec","getUnitViewSpec","viewTypes","defaultDateInput","gotoDate","zonedDateInput","incrementDate","formatDate","isHandlingWindowResize","registerInteractiveComponent","settingsInput","DEFAULT_INTERACTIONS","interactionClasses","interactions","interactionClass","unregisterInteractiveComponent","listener","select","dateOrObj","endDate","selectionInput","triggerDateSelect","pev","triggerDateUnselect","origEvent","triggerDateClick","dayEl","sourceInput","sourceApi","getEventSourceById","getEventById","getEvents","eventApis","removeAllEvents","rerenderEvents","getEventSources","sourceApis","internalId","addEventSource","removeAllEventSources","refetchEvents","themeClass","View","parentEl","renderDatesMem","renderDatesWrap","unrenderDatesWrap","renderBusinessHoursMem","renderBusinessHours","unrenderBusinessHours","renderDateSelectionMem","renderDateSelectionWrap","unrenderDateSelectionWrap","renderEventsMem","renderEvents","unrenderEvents","renderEventSelectionMem","renderEventSelectionWrap","unrenderEventSelectionWrap","renderEventDragMem","renderEventDragWrap","unrenderEventDragWrap","renderEventResizeMem","renderEventResizeWrap","unrenderEventResizeWrap","eventOrderSpecs","initialize","isAuto","updateBaseSize","renderDates","isDateInit","startNowIndicator","stopNowIndicator","unrenderDates","renderDateSelection","unrenderDateSelection","sliceEvents","renderEventSelection","unrenderEventSelection","renderEventDrag","unrenderEventDrag","renderEventResize","unrenderEventResize","update","delay","getNowIndicatorUnit","initialNowDate","initialNowQueriedMs","nowIndicatorTimeoutID","nowIndicatorIntervalID","setInterval","unrenderNowIndicator","renderNowIndicator","isNowIndicatorRendered","clearTimeout","clearInterval","queuedScroll","applyQueuedScroll","queryDateScroll","computeInitialDateScroll","applyDateScroll","FgEventRenderer","isSizeDirty","renderSegs","mirrorInfo","rangeUpdated","renderSegEls","attachSegs","_segs","detachSegs","displayEventTime","displayEventEnd","eventTimeFormat","computeEventTimeFormat","computeDisplayEventTime","computeDisplayEventEnd","renderSegHtml","getSegClasses","isDraggable","isResizable","isDragging","isResizing","getTimeText","displayEnd","_getTimeText","getSkinCss","sortEventSegs","objs","buildSegCompareObj","c","_seg","computeSizes","force","computeSegSizes","assignSizes","assignSegSizes","hideByHash","visibility","showByHash","selectByInstanceId","unselectByInstanceId","FillRenderer","fillSegTag","dirtySizeFlags","containerElsByType","segsByType","getSegsByType","renderedSegs","containerEls","css","toLowerCase","NamedTimeZoneImpl","ElementDragging","emitter","setMirrorIsVisible","setMirrorNeedsRevert","setAutoScrollEnabled","dateInput","buildDateEnv$1","dateMeta","DRAG_META_PROPS","DRAG_META_DEFAULTS","parseDragMeta","computeFallbackHeaderFormat","datesRepDistinctDays","renderDateCell","colCnt","colHeadFormat","colspan","otherAttrs","isDateValid","columnHeaderHtml","columnHeaderText","DayHeader","thead","dates","renderIntroHtml","dates_1","DaySeries","indices","dayIndex","sliceRange","firstIndex","getDateDayIndex","lastIndex","clippedFirstIndex","clippedLastIndex","ceil","dayOffset","DayTable","daySeries","breakOnWeeks","daysPerRow","rowCnt","cells","buildCells","headerDates","buildHeaderDates","rows","row","col","buildCell","seriesSeg","index","nextIndex","firstCol","lastCol","Slicer","sliceBusinessHours","_sliceBusinessHours","sliceDateSelection","_sliceDateSpan","_sliceEventStore","sliceEventDrag","_sliceInteraction","sliceEventResize","sliceProps","extraArgs","eventSegs","dateSelectionSegs","businessHourSegs","fgEventSegs","bgEventSegs","sliceNowDate","computeActiveRange","rangeRes","sliceEventRanges","affectedInstances","sourceSeg","eventRanges","eventRanges_1","sliceEventRange","isComponentAllDay","version","parseMarker"],"mappings":"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","sourcesContent":["/*!\n@fullcalendar/core v4.0.1\nDocs & License: https://fullcalendar.io/\n(c) 2019 Adam Shaw\n*/\n(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n    typeof define === 'function' && define.amd ? define(['exports'], factory) :\n    (global = global || self, factory(global.FullCalendar = {}));\n}(this, function (exports) { 'use strict';\n\n    // Creating\n    // ----------------------------------------------------------------------------------------------------------------\n    var elementPropHash = {\n        className: true,\n        colSpan: true,\n        rowSpan: true\n    };\n    var containerTagHash = {\n        '<tr': 'tbody',\n        '<td': 'tr'\n    };\n    function createElement(tagName, attrs, content) {\n        var el = document.createElement(tagName);\n        if (attrs) {\n            for (var attrName in attrs) {\n                if (attrName === 'style') {\n                    applyStyle(el, attrs[attrName]);\n                }\n                else if (elementPropHash[attrName]) {\n                    el[attrName] = attrs[attrName];\n                }\n                else {\n                    el.setAttribute(attrName, attrs[attrName]);\n                }\n            }\n        }\n        if (typeof content === 'string') {\n            el.innerHTML = content; // shortcut. no need to process HTML in any way\n        }\n        else if (content != null) {\n            appendToElement(el, content);\n        }\n        return el;\n    }\n    function htmlToElement(html) {\n        html = html.trim();\n        var container = document.createElement(computeContainerTag(html));\n        container.innerHTML = html;\n        return container.firstChild;\n    }\n    function htmlToElements(html) {\n        return Array.prototype.slice.call(htmlToNodeList(html));\n    }\n    function htmlToNodeList(html) {\n        html = html.trim();\n        var container = document.createElement(computeContainerTag(html));\n        container.innerHTML = html;\n        return container.childNodes;\n    }\n    // assumes html already trimmed and tag names are lowercase\n    function computeContainerTag(html) {\n        return containerTagHash[html.substr(0, 3) // faster than using regex\n        ] || 'div';\n    }\n    function appendToElement(el, content) {\n        var childNodes = normalizeContent(content);\n        for (var i = 0; i < childNodes.length; i++) {\n            el.appendChild(childNodes[i]);\n        }\n    }\n    function prependToElement(parent, content) {\n        var newEls = normalizeContent(content);\n        var afterEl = parent.firstChild || null; // if no firstChild, will append to end, but that's okay, b/c there were no children\n        for (var i = 0; i < newEls.length; i++) {\n            parent.insertBefore(newEls[i], afterEl);\n        }\n    }\n    function insertAfterElement(refEl, content) {\n        var newEls = normalizeContent(content);\n        var afterEl = refEl.nextSibling || null;\n        for (var i = 0; i < newEls.length; i++) {\n            refEl.parentNode.insertBefore(newEls[i], afterEl);\n        }\n    }\n    function normalizeContent(content) {\n        var els;\n        if (typeof content === 'string') {\n            els = htmlToElements(content);\n        }\n        else if (content instanceof Node) {\n            els = [content];\n        }\n        else { // Node[] or NodeList\n            els = Array.prototype.slice.call(content);\n        }\n        return els;\n    }\n    function removeElement(el) {\n        if (el.parentNode) {\n            el.parentNode.removeChild(el);\n        }\n    }\n    // Querying\n    // ----------------------------------------------------------------------------------------------------------------\n    // from https://developer.mozilla.org/en-US/docs/Web/API/Element/closest\n    var matchesMethod = Element.prototype.matches ||\n        Element.prototype.matchesSelector ||\n        Element.prototype.msMatchesSelector;\n    var closestMethod = Element.prototype.closest || function (selector) {\n        // polyfill\n        var el = this;\n        if (!document.documentElement.contains(el)) {\n            return null;\n        }\n        do {\n            if (elementMatches(el, selector)) {\n                return el;\n            }\n            el = el.parentElement || el.parentNode;\n        } while (el !== null && el.nodeType === 1);\n        return null;\n    };\n    function elementClosest(el, selector) {\n        return closestMethod.call(el, selector);\n    }\n    function elementMatches(el, selector) {\n        return matchesMethod.call(el, selector);\n    }\n    // accepts multiple subject els\n    // returns a real array. good for methods like forEach\n    function findElements(container, selector) {\n        var containers = container instanceof HTMLElement ? [container] : container;\n        var allMatches = [];\n        for (var i = 0; i < containers.length; i++) {\n            var matches = containers[i].querySelectorAll(selector);\n            for (var j = 0; j < matches.length; j++) {\n                allMatches.push(matches[j]);\n            }\n        }\n        return allMatches;\n    }\n    // accepts multiple subject els\n    // only queries direct child elements\n    function findChildren(parent, selector) {\n        var parents = parent instanceof HTMLElement ? [parent] : parent;\n        var allMatches = [];\n        for (var i = 0; i < parents.length; i++) {\n            var childNodes = parents[i].children; // only ever elements\n            for (var j = 0; j < childNodes.length; j++) {\n                var childNode = childNodes[j];\n                if (!selector || elementMatches(childNode, selector)) {\n                    allMatches.push(childNode);\n                }\n            }\n        }\n        return allMatches;\n    }\n    // Attributes\n    // ----------------------------------------------------------------------------------------------------------------\n    function forceClassName(el, className, bool) {\n        if (bool) {\n            el.classList.add(className);\n        }\n        else {\n            el.classList.remove(className);\n        }\n    }\n    // Style\n    // ----------------------------------------------------------------------------------------------------------------\n    var PIXEL_PROP_RE = /(top|left|right|bottom|width|height)$/i;\n    function applyStyle(el, props) {\n        for (var propName in props) {\n            applyStyleProp(el, propName, props[propName]);\n        }\n    }\n    function applyStyleProp(el, name, val) {\n        if (val == null) {\n            el.style[name] = '';\n        }\n        else if (typeof val === 'number' && PIXEL_PROP_RE.test(name)) {\n            el.style[name] = val + 'px';\n        }\n        else {\n            el.style[name] = val;\n        }\n    }\n\n    function pointInsideRect(point, rect) {\n        return point.left >= rect.left &&\n            point.left < rect.right &&\n            point.top >= rect.top &&\n            point.top < rect.bottom;\n    }\n    // Returns a new rectangle that is the intersection of the two rectangles. If they don't intersect, returns false\n    function intersectRects(rect1, rect2) {\n        var res = {\n            left: Math.max(rect1.left, rect2.left),\n            right: Math.min(rect1.right, rect2.right),\n            top: Math.max(rect1.top, rect2.top),\n            bottom: Math.min(rect1.bottom, rect2.bottom)\n        };\n        if (res.left < res.right && res.top < res.bottom) {\n            return res;\n        }\n        return false;\n    }\n    function translateRect(rect, deltaX, deltaY) {\n        return {\n            left: rect.left + deltaX,\n            right: rect.right + deltaX,\n            top: rect.top + deltaY,\n            bottom: rect.bottom + deltaY\n        };\n    }\n    // Returns a new point that will have been moved to reside within the given rectangle\n    function constrainPoint(point, rect) {\n        return {\n            left: Math.min(Math.max(point.left, rect.left), rect.right),\n            top: Math.min(Math.max(point.top, rect.top), rect.bottom)\n        };\n    }\n    // Returns a point that is the center of the given rectangle\n    function getRectCenter(rect) {\n        return {\n            left: (rect.left + rect.right) / 2,\n            top: (rect.top + rect.bottom) / 2\n        };\n    }\n    // Subtracts point2's coordinates from point1's coordinates, returning a delta\n    function diffPoints(point1, point2) {\n        return {\n            left: point1.left - point2.left,\n            top: point1.top - point2.top\n        };\n    }\n\n    // Logic for determining if, when the element is right-to-left, the scrollbar appears on the left side\n    var isRtlScrollbarOnLeft = null;\n    function getIsRtlScrollbarOnLeft() {\n        if (isRtlScrollbarOnLeft === null) {\n            isRtlScrollbarOnLeft = computeIsRtlScrollbarOnLeft();\n        }\n        return isRtlScrollbarOnLeft;\n    }\n    function computeIsRtlScrollbarOnLeft() {\n        var outerEl = createElement('div', {\n            style: {\n                position: 'absolute',\n                top: -1000,\n                left: 0,\n                border: 0,\n                padding: 0,\n                overflow: 'scroll',\n                direction: 'rtl'\n            }\n        }, '<div></div>');\n        document.body.appendChild(outerEl);\n        var innerEl = outerEl.firstChild;\n        var res = innerEl.getBoundingClientRect().left > outerEl.getBoundingClientRect().left;\n        removeElement(outerEl);\n        return res;\n    }\n    // The scrollbar width computations in computeEdges are sometimes flawed when it comes to\n    // retina displays, rounding, and IE11. Massage them into a usable value.\n    function sanitizeScrollbarWidth(width) {\n        width = Math.max(0, width); // no negatives\n        width = Math.round(width);\n        return width;\n    }\n\n    function computeEdges(el, getPadding) {\n        if (getPadding === void 0) { getPadding = false; }\n        var computedStyle = window.getComputedStyle(el);\n        var borderLeft = parseInt(computedStyle.borderLeftWidth, 10) || 0;\n        var borderRight = parseInt(computedStyle.borderRightWidth, 10) || 0;\n        var borderTop = parseInt(computedStyle.borderTopWidth, 10) || 0;\n        var borderBottom = parseInt(computedStyle.borderBottomWidth, 10) || 0;\n        var scrollbarLeftRight = sanitizeScrollbarWidth(el.offsetWidth - el.clientWidth - borderLeft - borderRight);\n        var scrollbarBottom = sanitizeScrollbarWidth(el.offsetHeight - el.clientHeight - borderTop - borderBottom);\n        var res = {\n            borderLeft: borderLeft,\n            borderRight: borderRight,\n            borderTop: borderTop,\n            borderBottom: borderBottom,\n            scrollbarBottom: scrollbarBottom,\n            scrollbarLeft: 0,\n            scrollbarRight: 0\n        };\n        if (getIsRtlScrollbarOnLeft() && computedStyle.direction === 'rtl') { // is the scrollbar on the left side?\n            res.scrollbarLeft = scrollbarLeftRight;\n        }\n        else {\n            res.scrollbarRight = scrollbarLeftRight;\n        }\n        if (getPadding) {\n            res.paddingLeft = parseInt(computedStyle.paddingLeft, 10) || 0;\n            res.paddingRight = parseInt(computedStyle.paddingRight, 10) || 0;\n            res.paddingTop = parseInt(computedStyle.paddingTop, 10) || 0;\n            res.paddingBottom = parseInt(computedStyle.paddingBottom, 10) || 0;\n        }\n        return res;\n    }\n    function computeInnerRect(el, goWithinPadding) {\n        if (goWithinPadding === void 0) { goWithinPadding = false; }\n        var outerRect = computeRect(el);\n        var edges = computeEdges(el, goWithinPadding);\n        var res = {\n            left: outerRect.left + edges.borderLeft + edges.scrollbarLeft,\n            right: outerRect.right - edges.borderRight - edges.scrollbarRight,\n            top: outerRect.top + edges.borderTop,\n            bottom: outerRect.bottom - edges.borderBottom - edges.scrollbarBottom\n        };\n        if (goWithinPadding) {\n            res.left += edges.paddingLeft;\n            res.right -= edges.paddingRight;\n            res.top += edges.paddingTop;\n            res.bottom -= edges.paddingBottom;\n        }\n        return res;\n    }\n    function computeRect(el) {\n        var rect = el.getBoundingClientRect();\n        return {\n            left: rect.left + window.pageXOffset,\n            top: rect.top + window.pageYOffset,\n            right: rect.right + window.pageXOffset,\n            bottom: rect.bottom + window.pageYOffset\n        };\n    }\n    function computeViewportRect() {\n        return {\n            left: window.pageXOffset,\n            right: window.pageXOffset + document.documentElement.clientWidth,\n            top: window.pageYOffset,\n            bottom: window.pageYOffset + document.documentElement.clientHeight\n        };\n    }\n    function computeHeightAndMargins(el) {\n        var computed = window.getComputedStyle(el);\n        return el.getBoundingClientRect().height +\n            parseInt(computed.marginTop, 10) +\n            parseInt(computed.marginBottom, 10);\n    }\n    // does not return window\n    function getClippingParents(el) {\n        var parents = [];\n        while (el instanceof HTMLElement) { // will stop when gets to document or null\n            var computedStyle = window.getComputedStyle(el);\n            if (computedStyle.position === 'fixed') {\n                break;\n            }\n            if ((/(auto|scroll)/).test(computedStyle.overflow + computedStyle.overflowY + computedStyle.overflowX)) {\n                parents.push(el);\n            }\n            el = el.parentNode;\n        }\n        return parents;\n    }\n    function computeClippingRect(el) {\n        return getClippingParents(el)\n            .map(function (el) {\n            return computeInnerRect(el);\n        })\n            .concat(computeViewportRect())\n            .reduce(function (rect0, rect1) {\n            return intersectRects(rect0, rect1) || rect1; // should always intersect\n        });\n    }\n\n    // Stops a mouse/touch event from doing it's native browser action\n    function preventDefault(ev) {\n        ev.preventDefault();\n    }\n    // Event Delegation\n    // ----------------------------------------------------------------------------------------------------------------\n    function listenBySelector(container, eventType, selector, handler) {\n        function realHandler(ev) {\n            var matchedChild = elementClosest(ev.target, selector);\n            if (matchedChild) {\n                handler.call(matchedChild, ev, matchedChild);\n            }\n        }\n        container.addEventListener(eventType, realHandler);\n        return function () {\n            container.removeEventListener(eventType, realHandler);\n        };\n    }\n    function listenToHoverBySelector(container, selector, onMouseEnter, onMouseLeave) {\n        var currentMatchedChild;\n        return listenBySelector(container, 'mouseover', selector, function (ev, matchedChild) {\n            if (matchedChild !== currentMatchedChild) {\n                currentMatchedChild = matchedChild;\n                onMouseEnter(ev, matchedChild);\n                var realOnMouseLeave_1 = function (ev) {\n                    currentMatchedChild = null;\n                    onMouseLeave(ev, matchedChild);\n                    matchedChild.removeEventListener('mouseleave', realOnMouseLeave_1);\n                };\n                // listen to the next mouseleave, and then unattach\n                matchedChild.addEventListener('mouseleave', realOnMouseLeave_1);\n            }\n        });\n    }\n    // Animation\n    // ----------------------------------------------------------------------------------------------------------------\n    var transitionEventNames = [\n        'webkitTransitionEnd',\n        'otransitionend',\n        'oTransitionEnd',\n        'msTransitionEnd',\n        'transitionend'\n    ];\n    // triggered only when the next single subsequent transition finishes\n    function whenTransitionDone(el, callback) {\n        var realCallback = function (ev) {\n            callback(ev);\n            transitionEventNames.forEach(function (eventName) {\n                el.removeEventListener(eventName, realCallback);\n            });\n        };\n        transitionEventNames.forEach(function (eventName) {\n            el.addEventListener(eventName, realCallback); // cross-browser way to determine when the transition finishes\n        });\n    }\n\n    var DAY_IDS = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'];\n    // Adding\n    function addWeeks(m, n) {\n        var a = dateToUtcArray(m);\n        a[2] += n * 7;\n        return arrayToUtcDate(a);\n    }\n    function addDays(m, n) {\n        var a = dateToUtcArray(m);\n        a[2] += n;\n        return arrayToUtcDate(a);\n    }\n    function addMs(m, n) {\n        var a = dateToUtcArray(m);\n        a[6] += n;\n        return arrayToUtcDate(a);\n    }\n    // Diffing (all return floats)\n    function diffWeeks(m0, m1) {\n        return diffDays(m0, m1) / 7;\n    }\n    function diffDays(m0, m1) {\n        return (m1.valueOf() - m0.valueOf()) / (1000 * 60 * 60 * 24);\n    }\n    function diffHours(m0, m1) {\n        return (m1.valueOf() - m0.valueOf()) / (1000 * 60 * 60);\n    }\n    function diffMinutes(m0, m1) {\n        return (m1.valueOf() - m0.valueOf()) / (1000 * 60);\n    }\n    function diffSeconds(m0, m1) {\n        return (m1.valueOf() - m0.valueOf()) / 1000;\n    }\n    function diffDayAndTime(m0, m1) {\n        var m0day = startOfDay(m0);\n        var m1day = startOfDay(m1);\n        return {\n            years: 0,\n            months: 0,\n            days: Math.round(diffDays(m0day, m1day)),\n            milliseconds: (m1.valueOf() - m1day.valueOf()) - (m0.valueOf() - m0day.valueOf())\n        };\n    }\n    // Diffing Whole Units\n    function diffWholeWeeks(m0, m1) {\n        var d = diffWholeDays(m0, m1);\n        if (d !== null && d % 7 === 0) {\n            return d / 7;\n        }\n        return null;\n    }\n    function diffWholeDays(m0, m1) {\n        if (timeAsMs(m0) === timeAsMs(m1)) {\n            return Math.round(diffDays(m0, m1));\n        }\n        return null;\n    }\n    // Start-Of\n    function startOfDay(m) {\n        return arrayToUtcDate([\n            m.getUTCFullYear(),\n            m.getUTCMonth(),\n            m.getUTCDate()\n        ]);\n    }\n    function startOfHour(m) {\n        return arrayToUtcDate([\n            m.getUTCFullYear(),\n            m.getUTCMonth(),\n            m.getUTCDate(),\n            m.getUTCHours()\n        ]);\n    }\n    function startOfMinute(m) {\n        return arrayToUtcDate([\n            m.getUTCFullYear(),\n            m.getUTCMonth(),\n            m.getUTCDate(),\n            m.getUTCHours(),\n            m.getUTCMinutes()\n        ]);\n    }\n    function startOfSecond(m) {\n        return arrayToUtcDate([\n            m.getUTCFullYear(),\n            m.getUTCMonth(),\n            m.getUTCDate(),\n            m.getUTCHours(),\n            m.getUTCMinutes(),\n            m.getUTCSeconds()\n        ]);\n    }\n    // Week Computation\n    function weekOfYear(marker, dow, doy) {\n        var y = marker.getUTCFullYear();\n        var w = weekOfGivenYear(marker, y, dow, doy);\n        if (w < 1) {\n            return weekOfGivenYear(marker, y - 1, dow, doy);\n        }\n        var nextW = weekOfGivenYear(marker, y + 1, dow, doy);\n        if (nextW >= 1) {\n            return Math.min(w, nextW);\n        }\n        return w;\n    }\n    function weekOfGivenYear(marker, year, dow, doy) {\n        var firstWeekStart = arrayToUtcDate([year, 0, 1 + firstWeekOffset(year, dow, doy)]);\n        var dayStart = startOfDay(marker);\n        var days = Math.round(diffDays(firstWeekStart, dayStart));\n        return Math.floor(days / 7) + 1; // zero-indexed\n    }\n    // start-of-first-week - start-of-year\n    function firstWeekOffset(year, dow, doy) {\n        // first-week day -- which january is always in the first week (4 for iso, 1 for other)\n        var fwd = 7 + dow - doy;\n        // first-week day local weekday -- which local weekday is fwd\n        var fwdlw = (7 + arrayToUtcDate([year, 0, fwd]).getUTCDay() - dow) % 7;\n        return -fwdlw + fwd - 1;\n    }\n    // Array Conversion\n    function dateToLocalArray(date) {\n        return [\n            date.getFullYear(),\n            date.getMonth(),\n            date.getDate(),\n            date.getHours(),\n            date.getMinutes(),\n            date.getSeconds(),\n            date.getMilliseconds()\n        ];\n    }\n    function arrayToLocalDate(a) {\n        return new Date(a[0], a[1] || 0, a[2] == null ? 1 : a[2], // day of month\n        a[3] || 0, a[4] || 0, a[5] || 0);\n    }\n    function dateToUtcArray(date) {\n        return [\n            date.getUTCFullYear(),\n            date.getUTCMonth(),\n            date.getUTCDate(),\n            date.getUTCHours(),\n            date.getUTCMinutes(),\n            date.getUTCSeconds(),\n            date.getUTCMilliseconds()\n        ];\n    }\n    function arrayToUtcDate(a) {\n        // according to web standards (and Safari), a month index is required.\n        // massage if only given a year.\n        if (a.length === 1) {\n            a = a.concat([0]);\n        }\n        return new Date(Date.UTC.apply(Date, a));\n    }\n    // Other Utils\n    function isValidDate(m) {\n        return !isNaN(m.valueOf());\n    }\n    function timeAsMs(m) {\n        return m.getUTCHours() * 1000 * 60 * 60 +\n            m.getUTCMinutes() * 1000 * 60 +\n            m.getUTCSeconds() * 1000 +\n            m.getUTCMilliseconds();\n    }\n\n    var INTERNAL_UNITS = ['years', 'months', 'days', 'milliseconds'];\n    var PARSE_RE = /^(-?)(?:(\\d+)\\.)?(\\d+):(\\d\\d)(?::(\\d\\d)(?:\\.(\\d\\d\\d))?)?/;\n    // Parsing and Creation\n    function createDuration(input, unit) {\n        var _a;\n        if (typeof input === 'string') {\n            return parseString(input);\n        }\n        else if (typeof input === 'object' && input) { // non-null object\n            return normalizeObject(input);\n        }\n        else if (typeof input === 'number') {\n            return normalizeObject((_a = {}, _a[unit || 'milliseconds'] = input, _a));\n        }\n        else {\n            return null;\n        }\n    }\n    function parseString(s) {\n        var m = PARSE_RE.exec(s);\n        if (m) {\n            var sign = m[1] ? -1 : 1;\n            return {\n                years: 0,\n                months: 0,\n                days: sign * (m[2] ? parseInt(m[2], 10) : 0),\n                milliseconds: sign * ((m[3] ? parseInt(m[3], 10) : 0) * 60 * 60 * 1000 + // hours\n                    (m[4] ? parseInt(m[4], 10) : 0) * 60 * 1000 + // minutes\n                    (m[5] ? parseInt(m[5], 10) : 0) * 1000 + // seconds\n                    (m[6] ? parseInt(m[6], 10) : 0) // ms\n                )\n            };\n        }\n        return null;\n    }\n    function normalizeObject(obj) {\n        return {\n            years: obj.years || obj.year || 0,\n            months: obj.months || obj.month || 0,\n            days: (obj.days || obj.day || 0) +\n                getWeeksFromInput(obj) * 7,\n            milliseconds: (obj.hours || obj.hour || 0) * 60 * 60 * 1000 + // hours\n                (obj.minutes || obj.minute || 0) * 60 * 1000 + // minutes\n                (obj.seconds || obj.second || 0) * 1000 + // seconds\n                (obj.milliseconds || obj.millisecond || obj.ms || 0) // ms\n        };\n    }\n    function getWeeksFromInput(obj) {\n        return obj.weeks || obj.week || 0;\n    }\n    // Equality\n    function durationsEqual(d0, d1) {\n        return d0.years === d1.years &&\n            d0.months === d1.months &&\n            d0.days === d1.days &&\n            d0.milliseconds === d1.milliseconds;\n    }\n    function isSingleDay(dur) {\n        return dur.years === 0 && dur.months === 0 && dur.days === 1 && dur.milliseconds === 0;\n    }\n    // Simple Math\n    function addDurations(d0, d1) {\n        return {\n            years: d0.years + d1.years,\n            months: d0.months + d1.months,\n            days: d0.days + d1.days,\n            milliseconds: d0.milliseconds + d1.milliseconds\n        };\n    }\n    function subtractDurations(d1, d0) {\n        return {\n            years: d1.years - d0.years,\n            months: d1.months - d0.months,\n            days: d1.days - d0.days,\n            milliseconds: d1.milliseconds - d0.milliseconds\n        };\n    }\n    function multiplyDuration(d, n) {\n        return {\n            years: d.years * n,\n            months: d.months * n,\n            days: d.days * n,\n            milliseconds: d.milliseconds * n\n        };\n    }\n    // Conversions\n    // \"Rough\" because they are based on average-case Gregorian months/years\n    function asRoughYears(dur) {\n        return asRoughDays(dur) / 365;\n    }\n    function asRoughMonths(dur) {\n        return asRoughDays(dur) / 30;\n    }\n    function asRoughDays(dur) {\n        return asRoughMs(dur) / 864e5;\n    }\n    function asRoughMinutes(dur) {\n        return asRoughMs(dur) / (1000 * 60);\n    }\n    function asRoughSeconds(dur) {\n        return asRoughMs(dur) / 1000;\n    }\n    function asRoughMs(dur) {\n        return dur.years * (365 * 864e5) +\n            dur.months * (30 * 864e5) +\n            dur.days * 864e5 +\n            dur.milliseconds;\n    }\n    // Advanced Math\n    function wholeDivideDurations(numerator, denominator) {\n        var res = null;\n        for (var i = 0; i < INTERNAL_UNITS.length; i++) {\n            var unit = INTERNAL_UNITS[i];\n            if (denominator[unit]) {\n                var localRes = numerator[unit] / denominator[unit];\n                if (!isInt(localRes) || (res !== null && res !== localRes)) {\n                    return null;\n                }\n                res = localRes;\n            }\n            else if (numerator[unit]) {\n                // needs to divide by something but can't!\n                return null;\n            }\n        }\n        return res;\n    }\n    function greatestDurationDenominator(dur, dontReturnWeeks) {\n        var ms = dur.milliseconds;\n        if (ms) {\n            if (ms % 1000 !== 0) {\n                return { unit: 'millisecond', value: ms };\n            }\n            if (ms % (1000 * 60) !== 0) {\n                return { unit: 'second', value: ms / 1000 };\n            }\n            if (ms % (1000 * 60 * 60) !== 0) {\n                return { unit: 'minute', value: ms / (1000 * 60) };\n            }\n            if (ms) {\n                return { unit: 'hour', value: ms / (1000 * 60 * 60) };\n            }\n        }\n        if (dur.days) {\n            if (!dontReturnWeeks && dur.days % 7 === 0) {\n                return { unit: 'week', value: dur.days / 7 };\n            }\n            return { unit: 'day', value: dur.days };\n        }\n        if (dur.months) {\n            return { unit: 'month', value: dur.months };\n        }\n        if (dur.years) {\n            return { unit: 'year', value: dur.years };\n        }\n        return { unit: 'millisecond', value: 0 };\n    }\n\n    /* FullCalendar-specific DOM Utilities\n    ----------------------------------------------------------------------------------------------------------------------*/\n    // Given the scrollbar widths of some other container, create borders/margins on rowEls in order to match the left\n    // and right space that was offset by the scrollbars. A 1-pixel border first, then margin beyond that.\n    function compensateScroll(rowEl, scrollbarWidths) {\n        if (scrollbarWidths.left) {\n            applyStyle(rowEl, {\n                borderLeftWidth: 1,\n                marginLeft: scrollbarWidths.left - 1\n            });\n        }\n        if (scrollbarWidths.right) {\n            applyStyle(rowEl, {\n                borderRightWidth: 1,\n                marginRight: scrollbarWidths.right - 1\n            });\n        }\n    }\n    // Undoes compensateScroll and restores all borders/margins\n    function uncompensateScroll(rowEl) {\n        applyStyle(rowEl, {\n            marginLeft: '',\n            marginRight: '',\n            borderLeftWidth: '',\n            borderRightWidth: ''\n        });\n    }\n    // Make the mouse cursor express that an event is not allowed in the current area\n    function disableCursor() {\n        document.body.classList.add('fc-not-allowed');\n    }\n    // Returns the mouse cursor to its original look\n    function enableCursor() {\n        document.body.classList.remove('fc-not-allowed');\n    }\n    // Given a total available height to fill, have `els` (essentially child rows) expand to accomodate.\n    // By default, all elements that are shorter than the recommended height are expanded uniformly, not considering\n    // any other els that are already too tall. if `shouldRedistribute` is on, it considers these tall rows and\n    // reduces the available height.\n    function distributeHeight(els, availableHeight, shouldRedistribute) {\n        // *FLOORING NOTE*: we floor in certain places because zoom can give inaccurate floating-point dimensions,\n        // and it is better to be shorter than taller, to avoid creating unnecessary scrollbars.\n        var minOffset1 = Math.floor(availableHeight / els.length); // for non-last element\n        var minOffset2 = Math.floor(availableHeight - minOffset1 * (els.length - 1)); // for last element *FLOORING NOTE*\n        var flexEls = []; // elements that are allowed to expand. array of DOM nodes\n        var flexOffsets = []; // amount of vertical space it takes up\n        var flexHeights = []; // actual css height\n        var usedHeight = 0;\n        undistributeHeight(els); // give all elements their natural height\n        // find elements that are below the recommended height (expandable).\n        // important to query for heights in a single first pass (to avoid reflow oscillation).\n        els.forEach(function (el, i) {\n            var minOffset = i === els.length - 1 ? minOffset2 : minOffset1;\n            var naturalOffset = computeHeightAndMargins(el);\n            if (naturalOffset < minOffset) {\n                flexEls.push(el);\n                flexOffsets.push(naturalOffset);\n                flexHeights.push(el.offsetHeight);\n            }\n            else {\n                // this element stretches past recommended height (non-expandable). mark the space as occupied.\n                usedHeight += naturalOffset;\n            }\n        });\n        // readjust the recommended height to only consider the height available to non-maxed-out rows.\n        if (shouldRedistribute) {\n            availableHeight -= usedHeight;\n            minOffset1 = Math.floor(availableHeight / flexEls.length);\n            minOffset2 = Math.floor(availableHeight - minOffset1 * (flexEls.length - 1)); // *FLOORING NOTE*\n        }\n        // assign heights to all expandable elements\n        flexEls.forEach(function (el, i) {\n            var minOffset = i === flexEls.length - 1 ? minOffset2 : minOffset1;\n            var naturalOffset = flexOffsets[i];\n            var naturalHeight = flexHeights[i];\n            var newHeight = minOffset - (naturalOffset - naturalHeight); // subtract the margin/padding\n            if (naturalOffset < minOffset) { // we check this again because redistribution might have changed things\n                el.style.height = newHeight + 'px';\n            }\n        });\n    }\n    // Undoes distrubuteHeight, restoring all els to their natural height\n    function undistributeHeight(els) {\n        els.forEach(function (el) {\n            el.style.height = '';\n        });\n    }\n    // Given `els`, a set of <td> cells, find the cell with the largest natural width and set the widths of all the\n    // cells to be that width.\n    // PREREQUISITE: if you want a cell to take up width, it needs to have a single inner element w/ display:inline\n    function matchCellWidths(els) {\n        var maxInnerWidth = 0;\n        els.forEach(function (el) {\n            var innerEl = el.firstChild; // hopefully an element\n            if (innerEl instanceof HTMLElement) {\n                var innerWidth_1 = innerEl.offsetWidth;\n                if (innerWidth_1 > maxInnerWidth) {\n                    maxInnerWidth = innerWidth_1;\n                }\n            }\n        });\n        maxInnerWidth++; // sometimes not accurate of width the text needs to stay on one line. insurance\n        els.forEach(function (el) {\n            el.style.width = maxInnerWidth + 'px';\n        });\n        return maxInnerWidth;\n    }\n    // Given one element that resides inside another,\n    // Subtracts the height of the inner element from the outer element.\n    function subtractInnerElHeight(outerEl, innerEl) {\n        // effin' IE8/9/10/11 sometimes returns 0 for dimensions. this weird hack was the only thing that worked\n        var reflowStyleProps = {\n            position: 'relative',\n            left: -1 // ensure reflow in case the el was already relative. negative is less likely to cause new scroll\n        };\n        applyStyle(outerEl, reflowStyleProps);\n        applyStyle(innerEl, reflowStyleProps);\n        var diff = outerEl.offsetHeight - innerEl.offsetHeight; // grab the dimensions\n        // undo hack\n        var resetStyleProps = { position: '', left: '' };\n        applyStyle(outerEl, resetStyleProps);\n        applyStyle(innerEl, resetStyleProps);\n        return diff;\n    }\n    /* Selection\n    ----------------------------------------------------------------------------------------------------------------------*/\n    function preventSelection(el) {\n        el.classList.add('fc-unselectable');\n        el.addEventListener('selectstart', preventDefault);\n    }\n    function allowSelection(el) {\n        el.classList.remove('fc-unselectable');\n        el.removeEventListener('selectstart', preventDefault);\n    }\n    /* Context Menu\n    ----------------------------------------------------------------------------------------------------------------------*/\n    function preventContextMenu(el) {\n        el.addEventListener('contextmenu', preventDefault);\n    }\n    function allowContextMenu(el) {\n        el.removeEventListener('contextmenu', preventDefault);\n    }\n    /* Object Ordering by Field\n    ----------------------------------------------------------------------------------------------------------------------*/\n    function parseFieldSpecs(input) {\n        var specs = [];\n        var tokens = [];\n        var i;\n        var token;\n        if (typeof input === 'string') {\n            tokens = input.split(/\\s*,\\s*/);\n        }\n        else if (typeof input === 'function') {\n            tokens = [input];\n        }\n        else if (Array.isArray(input)) {\n            tokens = input;\n        }\n        for (i = 0; i < tokens.length; i++) {\n            token = tokens[i];\n            if (typeof token === 'string') {\n                specs.push(token.charAt(0) === '-' ?\n                    { field: token.substring(1), order: -1 } :\n                    { field: token, order: 1 });\n            }\n            else if (typeof token === 'function') {\n                specs.push({ func: token });\n            }\n        }\n        return specs;\n    }\n    function compareByFieldSpecs(obj0, obj1, fieldSpecs) {\n        var i;\n        var cmp;\n        for (i = 0; i < fieldSpecs.length; i++) {\n            cmp = compareByFieldSpec(obj0, obj1, fieldSpecs[i]);\n            if (cmp) {\n                return cmp;\n            }\n        }\n        return 0;\n    }\n    function compareByFieldSpec(obj0, obj1, fieldSpec) {\n        if (fieldSpec.func) {\n            return fieldSpec.func(obj0, obj1);\n        }\n        return flexibleCompare(obj0[fieldSpec.field], obj1[fieldSpec.field])\n            * (fieldSpec.order || 1);\n    }\n    function flexibleCompare(a, b) {\n        if (!a && !b) {\n            return 0;\n        }\n        if (b == null) {\n            return -1;\n        }\n        if (a == null) {\n            return 1;\n        }\n        if (typeof a === 'string' || typeof b === 'string') {\n            return String(a).localeCompare(String(b));\n        }\n        return a - b;\n    }\n    /* String Utilities\n    ----------------------------------------------------------------------------------------------------------------------*/\n    function capitaliseFirstLetter(str) {\n        return str.charAt(0).toUpperCase() + str.slice(1);\n    }\n    function padStart(val, len) {\n        var s = String(val);\n        return '000'.substr(0, len - s.length) + s;\n    }\n    /* Number Utilities\n    ----------------------------------------------------------------------------------------------------------------------*/\n    function compareNumbers(a, b) {\n        return a - b;\n    }\n    function isInt(n) {\n        return n % 1 === 0;\n    }\n    /* Weird Utilities\n    ----------------------------------------------------------------------------------------------------------------------*/\n    function applyAll(functions, thisObj, args) {\n        if (typeof functions === 'function') { // supplied a single function\n            functions = [functions];\n        }\n        if (functions) {\n            var i = void 0;\n            var ret = void 0;\n            for (i = 0; i < functions.length; i++) {\n                ret = functions[i].apply(thisObj, args) || ret;\n            }\n            return ret;\n        }\n    }\n    function firstDefined() {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        for (var i = 0; i < args.length; i++) {\n            if (args[i] !== undefined) {\n                return args[i];\n            }\n        }\n    }\n    // Returns a function, that, as long as it continues to be invoked, will not\n    // be triggered. The function will be called after it stops being called for\n    // N milliseconds. If `immediate` is passed, trigger the function on the\n    // leading edge, instead of the trailing.\n    // https://github.com/jashkenas/underscore/blob/1.6.0/underscore.js#L714\n    function debounce(func, wait) {\n        var timeout;\n        var args;\n        var context;\n        var timestamp;\n        var result;\n        var later = function () {\n            var last = new Date().valueOf() - timestamp;\n            if (last < wait) {\n                timeout = setTimeout(later, wait - last);\n            }\n            else {\n                timeout = null;\n                result = func.apply(context, args);\n                context = args = null;\n            }\n        };\n        return function () {\n            context = this;\n            args = arguments;\n            timestamp = new Date().valueOf();\n            if (!timeout) {\n                timeout = setTimeout(later, wait);\n            }\n            return result;\n        };\n    }\n    // Number and Boolean are only types that defaults or not computed for\n    // TODO: write more comments\n    function refineProps(rawProps, processors, defaults, leftoverProps) {\n        if (defaults === void 0) { defaults = {}; }\n        var refined = {};\n        for (var key in processors) {\n            var processor = processors[key];\n            if (rawProps[key] !== undefined) {\n                // found\n                if (processor === Function) {\n                    refined[key] = typeof rawProps[key] === 'function' ? rawProps[key] : null;\n                }\n                else if (processor) { // a refining function?\n                    refined[key] = processor(rawProps[key]);\n                }\n                else {\n                    refined[key] = rawProps[key];\n                }\n            }\n            else if (defaults[key] !== undefined) {\n                // there's an explicit default\n                refined[key] = defaults[key];\n            }\n            else {\n                // must compute a default\n                if (processor === String) {\n                    refined[key] = ''; // empty string is default for String\n                }\n                else if (!processor || processor === Number || processor === Boolean || processor === Function) {\n                    refined[key] = null; // assign null for other non-custom processor funcs\n                }\n                else {\n                    refined[key] = processor(null); // run the custom processor func\n                }\n            }\n        }\n        if (leftoverProps) {\n            for (var key in rawProps) {\n                if (processors[key] === undefined) {\n                    leftoverProps[key] = rawProps[key];\n                }\n            }\n        }\n        return refined;\n    }\n    /* Date stuff that doesn't belong in datelib core\n    ----------------------------------------------------------------------------------------------------------------------*/\n    // given a timed range, computes an all-day range that has the same exact duration,\n    // but whose start time is aligned with the start of the day.\n    function computeAlignedDayRange(timedRange) {\n        var dayCnt = Math.floor(diffDays(timedRange.start, timedRange.end)) || 1;\n        var start = startOfDay(timedRange.start);\n        var end = addDays(start, dayCnt);\n        return { start: start, end: end };\n    }\n    // given a timed range, computes an all-day range based on how for the end date bleeds into the next day\n    // TODO: give nextDayThreshold a default arg\n    function computeVisibleDayRange(timedRange, nextDayThreshold) {\n        if (nextDayThreshold === void 0) { nextDayThreshold = createDuration(0); }\n        var startDay = null;\n        var endDay = null;\n        if (timedRange.end) {\n            endDay = startOfDay(timedRange.end);\n            var endTimeMS = timedRange.end.valueOf() - endDay.valueOf(); // # of milliseconds into `endDay`\n            // If the end time is actually inclusively part of the next day and is equal to or\n            // beyond the next day threshold, adjust the end to be the exclusive end of `endDay`.\n            // Otherwise, leaving it as inclusive will cause it to exclude `endDay`.\n            if (endTimeMS && endTimeMS >= asRoughMs(nextDayThreshold)) {\n                endDay = addDays(endDay, 1);\n            }\n        }\n        if (timedRange.start) {\n            startDay = startOfDay(timedRange.start); // the beginning of the day the range starts\n            // If end is within `startDay` but not past nextDayThreshold, assign the default duration of one day.\n            if (endDay && endDay <= startDay) {\n                endDay = addDays(startDay, 1);\n            }\n        }\n        return { start: startDay, end: endDay };\n    }\n    // spans from one day into another?\n    function isMultiDayRange(range) {\n        var visibleRange = computeVisibleDayRange(range);\n        return diffDays(visibleRange.start, visibleRange.end) > 1;\n    }\n    function diffDates(date0, date1, dateEnv, largeUnit) {\n        if (largeUnit === 'year') {\n            return createDuration(dateEnv.diffWholeYears(date0, date1), 'year');\n        }\n        else if (largeUnit === 'month') {\n            return createDuration(dateEnv.diffWholeMonths(date0, date1), 'month');\n        }\n        else {\n            return diffDayAndTime(date0, date1); // returns a duration\n        }\n    }\n\n    /*\n    KNOWN BUG: will populate lefovers only up until a recurring type works\n    */\n    function parseRecurring(eventInput, allDayDefault, dateEnv, recurringTypes, leftovers) {\n        for (var i = 0; i < recurringTypes.length; i++) {\n            var parsed = recurringTypes[i].parse(eventInput, allDayDefault, leftovers, dateEnv);\n            if (parsed) {\n                return {\n                    allDay: parsed.allDay,\n                    duration: parsed.duration,\n                    typeData: parsed.typeData,\n                    typeId: i\n                };\n            }\n        }\n        return null;\n    }\n    /*\n    Event MUST have a recurringDef\n    */\n    function expandRecurringRanges(eventDef, framingRange, dateEnv, recurringTypes) {\n        var typeDef = recurringTypes[eventDef.recurringDef.typeId];\n        var markers = typeDef.expand(eventDef.recurringDef.typeData, eventDef, framingRange, dateEnv);\n        // the recurrence plugins don't guarantee that all-day events are start-of-day, so we have to\n        if (eventDef.allDay) {\n            markers = markers.map(startOfDay);\n        }\n        return markers;\n    }\n\n    /*! *****************************************************************************\r\n    Copyright (c) Microsoft Corporation. All rights reserved.\r\n    Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\n    this file except in compliance with the License. You may obtain a copy of the\r\n    License at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\n    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\n    MERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\n    See the Apache Version 2.0 License for specific language governing permissions\r\n    and limitations under the License.\r\n    ***************************************************************************** */\r\n    /* global Reflect, Promise */\r\n\r\n    var extendStatics = function(d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n\r\n    function __extends(d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    }\r\n\r\n    var __assign = function() {\r\n        __assign = Object.assign || function __assign(t) {\r\n            for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n                s = arguments[i];\r\n                for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n            }\r\n            return t;\r\n        };\r\n        return __assign.apply(this, arguments);\r\n    };\n\n    // Merges an array of objects into a single object.\n    // The second argument allows for an array of property names who's object values will be merged together.\n    function mergeProps(propObjs, complexProps) {\n        var dest = {};\n        var i;\n        var name;\n        var complexObjs;\n        var j;\n        var val;\n        var props;\n        if (complexProps) {\n            for (i = 0; i < complexProps.length; i++) {\n                name = complexProps[i];\n                complexObjs = [];\n                // collect the trailing object values, stopping when a non-object is discovered\n                for (j = propObjs.length - 1; j >= 0; j--) {\n                    val = propObjs[j][name];\n                    if (typeof val === 'object' && val) { // non-null object\n                        complexObjs.unshift(val);\n                    }\n                    else if (val !== undefined) {\n                        dest[name] = val; // if there were no objects, this value will be used\n                        break;\n                    }\n                }\n                // if the trailing values were objects, use the merged value\n                if (complexObjs.length) {\n                    dest[name] = mergeProps(complexObjs);\n                }\n            }\n        }\n        // copy values into the destination, going from last to first\n        for (i = propObjs.length - 1; i >= 0; i--) {\n            props = propObjs[i];\n            for (name in props) {\n                if (!(name in dest)) { // if already assigned by previous props or complex props, don't reassign\n                    dest[name] = props[name];\n                }\n            }\n        }\n        return dest;\n    }\n    function filterHash(hash, func) {\n        var filtered = {};\n        for (var key in hash) {\n            if (func(hash[key], key)) {\n                filtered[key] = hash[key];\n            }\n        }\n        return filtered;\n    }\n    function mapHash(hash, func) {\n        var newHash = {};\n        for (var key in hash) {\n            newHash[key] = func(hash[key], key);\n        }\n        return newHash;\n    }\n    function arrayToHash(a) {\n        var hash = {};\n        for (var _i = 0, a_1 = a; _i < a_1.length; _i++) {\n            var item = a_1[_i];\n            hash[item] = true;\n        }\n        return hash;\n    }\n    function isPropsEqual(obj0, obj1) {\n        for (var key in obj0) {\n            if (obj0[key] !== obj1[key]) {\n                return false;\n            }\n        }\n        for (var key in obj1) {\n            if (!(key in obj0)) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    function parseEvents(rawEvents, sourceId, calendar, allowOpenRange) {\n        var eventStore = createEmptyEventStore();\n        for (var _i = 0, rawEvents_1 = rawEvents; _i < rawEvents_1.length; _i++) {\n            var rawEvent = rawEvents_1[_i];\n            var tuple = parseEvent(rawEvent, sourceId, calendar, allowOpenRange);\n            if (tuple) {\n                eventTupleToStore(tuple, eventStore);\n            }\n        }\n        return eventStore;\n    }\n    function eventTupleToStore(tuple, eventStore) {\n        if (eventStore === void 0) { eventStore = createEmptyEventStore(); }\n        eventStore.defs[tuple.def.defId] = tuple.def;\n        if (tuple.instance) {\n            eventStore.instances[tuple.instance.instanceId] = tuple.instance;\n        }\n        return eventStore;\n    }\n    function expandRecurring(eventStore, framingRange, calendar) {\n        var dateEnv = calendar.dateEnv;\n        var defs = eventStore.defs, instances = eventStore.instances;\n        // remove existing recurring instances\n        instances = filterHash(instances, function (instance) {\n            return !defs[instance.defId].recurringDef;\n        });\n        for (var defId in defs) {\n            var def = defs[defId];\n            if (def.recurringDef) {\n                var starts = expandRecurringRanges(def, framingRange, calendar.dateEnv, calendar.pluginSystem.hooks.recurringTypes);\n                var duration = def.recurringDef.duration;\n                if (!duration) {\n                    duration = def.allDay ?\n                        calendar.defaultAllDayEventDuration :\n                        calendar.defaultTimedEventDuration;\n                }\n                for (var _i = 0, starts_1 = starts; _i < starts_1.length; _i++) {\n                    var start = starts_1[_i];\n                    var instance = createEventInstance(defId, {\n                        start: start,\n                        end: dateEnv.add(start, duration)\n                    });\n                    instances[instance.instanceId] = instance;\n                }\n            }\n        }\n        return { defs: defs, instances: instances };\n    }\n    // retrieves events that have the same groupId as the instance specified by `instanceId`\n    // or they are the same as the instance.\n    // why might instanceId not be in the store? an event from another calendar?\n    function getRelevantEvents(eventStore, instanceId) {\n        var instance = eventStore.instances[instanceId];\n        if (instance) {\n            var def_1 = eventStore.defs[instance.defId];\n            // get events/instances with same group\n            var newStore = filterEventStoreDefs(eventStore, function (lookDef) {\n                return isEventDefsGrouped(def_1, lookDef);\n            });\n            // add the original\n            // TODO: wish we could use eventTupleToStore or something like it\n            newStore.defs[def_1.defId] = def_1;\n            newStore.instances[instance.instanceId] = instance;\n            return newStore;\n        }\n        return createEmptyEventStore();\n    }\n    function isEventDefsGrouped(def0, def1) {\n        return Boolean(def0.groupId && def0.groupId === def1.groupId);\n    }\n    function transformRawEvents(rawEvents, eventSource, calendar) {\n        var calEachTransform = calendar.opt('eventDataTransform');\n        var sourceEachTransform = eventSource ? eventSource.eventDataTransform : null;\n        if (sourceEachTransform) {\n            rawEvents = transformEachRawEvent(rawEvents, sourceEachTransform);\n        }\n        if (calEachTransform) {\n            rawEvents = transformEachRawEvent(rawEvents, calEachTransform);\n        }\n        return rawEvents;\n    }\n    function transformEachRawEvent(rawEvents, func) {\n        var refinedEvents;\n        if (!func) {\n            refinedEvents = rawEvents;\n        }\n        else {\n            refinedEvents = [];\n            for (var _i = 0, rawEvents_2 = rawEvents; _i < rawEvents_2.length; _i++) {\n                var rawEvent = rawEvents_2[_i];\n                var refinedEvent = func(rawEvent);\n                if (refinedEvent) {\n                    refinedEvents.push(refinedEvent);\n                }\n                else if (refinedEvent == null) {\n                    refinedEvents.push(rawEvent);\n                } // if a different falsy value, do nothing\n            }\n        }\n        return refinedEvents;\n    }\n    function createEmptyEventStore() {\n        return { defs: {}, instances: {} };\n    }\n    function mergeEventStores(store0, store1) {\n        return {\n            defs: __assign({}, store0.defs, store1.defs),\n            instances: __assign({}, store0.instances, store1.instances)\n        };\n    }\n    function filterEventStoreDefs(eventStore, filterFunc) {\n        var defs = filterHash(eventStore.defs, filterFunc);\n        var instances = filterHash(eventStore.instances, function (instance) {\n            return defs[instance.defId]; // still exists?\n        });\n        return { defs: defs, instances: instances };\n    }\n\n    function parseRange(input, dateEnv) {\n        var start = null;\n        var end = null;\n        if (input.start) {\n            start = dateEnv.createMarker(input.start);\n        }\n        if (input.end) {\n            end = dateEnv.createMarker(input.end);\n        }\n        if (!start && !end) {\n            return null;\n        }\n        if (start && end && end < start) {\n            return null;\n        }\n        return { start: start, end: end };\n    }\n    // SIDE-EFFECT: will mutate ranges.\n    // Will return a new array result.\n    function invertRanges(ranges, constraintRange) {\n        var invertedRanges = [];\n        var start = constraintRange.start; // the end of the previous range. the start of the new range\n        var i;\n        var dateRange;\n        // ranges need to be in order. required for our date-walking algorithm\n        ranges.sort(compareRanges);\n        for (i = 0; i < ranges.length; i++) {\n            dateRange = ranges[i];\n            // add the span of time before the event (if there is any)\n            if (dateRange.start > start) { // compare millisecond time (skip any ambig logic)\n                invertedRanges.push({ start: start, end: dateRange.start });\n            }\n            if (dateRange.end > start) {\n                start = dateRange.end;\n            }\n        }\n        // add the span of time after the last event (if there is any)\n        if (start < constraintRange.end) { // compare millisecond time (skip any ambig logic)\n            invertedRanges.push({ start: start, end: constraintRange.end });\n        }\n        return invertedRanges;\n    }\n    function compareRanges(range0, range1) {\n        return range0.start.valueOf() - range1.start.valueOf(); // earlier ranges go first\n    }\n    function intersectRanges(range0, range1) {\n        var start = range0.start;\n        var end = range0.end;\n        var newRange = null;\n        if (range1.start !== null) {\n            if (start === null) {\n                start = range1.start;\n            }\n            else {\n                start = new Date(Math.max(start.valueOf(), range1.start.valueOf()));\n            }\n        }\n        if (range1.end != null) {\n            if (end === null) {\n                end = range1.end;\n            }\n            else {\n                end = new Date(Math.min(end.valueOf(), range1.end.valueOf()));\n            }\n        }\n        if (start === null || end === null || start < end) {\n            newRange = { start: start, end: end };\n        }\n        return newRange;\n    }\n    function rangesEqual(range0, range1) {\n        return (range0.start === null ? null : range0.start.valueOf()) === (range1.start === null ? null : range1.start.valueOf()) &&\n            (range0.end === null ? null : range0.end.valueOf()) === (range1.end === null ? null : range1.end.valueOf());\n    }\n    function rangesIntersect(range0, range1) {\n        return (range0.end === null || range1.start === null || range0.end > range1.start) &&\n            (range0.start === null || range1.end === null || range0.start < range1.end);\n    }\n    function rangeContainsRange(outerRange, innerRange) {\n        return (outerRange.start === null || (innerRange.start !== null && innerRange.start >= outerRange.start)) &&\n            (outerRange.end === null || (innerRange.end !== null && innerRange.end <= outerRange.end));\n    }\n    function rangeContainsMarker(range, date) {\n        return (range.start === null || date >= range.start) &&\n            (range.end === null || date < range.end);\n    }\n    // If the given date is not within the given range, move it inside.\n    // (If it's past the end, make it one millisecond before the end).\n    function constrainMarkerToRange(date, range) {\n        if (range.start != null && date < range.start) {\n            return range.start;\n        }\n        if (range.end != null && date >= range.end) {\n            return new Date(range.end.valueOf() - 1);\n        }\n        return date;\n    }\n\n    function removeExact(array, exactVal) {\n        var removeCnt = 0;\n        var i = 0;\n        while (i < array.length) {\n            if (array[i] === exactVal) {\n                array.splice(i, 1);\n                removeCnt++;\n            }\n            else {\n                i++;\n            }\n        }\n        return removeCnt;\n    }\n    function isArraysEqual(a0, a1) {\n        var len = a0.length;\n        var i;\n        if (len !== a1.length) { // not array? or not same length?\n            return false;\n        }\n        for (i = 0; i < len; i++) {\n            if (a0[i] !== a1[i]) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    function memoize(workerFunc) {\n        var args;\n        var res;\n        return function () {\n            if (!args || !isArraysEqual(args, arguments)) {\n                args = arguments;\n                res = workerFunc.apply(this, arguments);\n            }\n            return res;\n        };\n    }\n    /*\n    always executes the workerFunc, but if the result is equal to the previous result,\n    return the previous result instead.\n    */\n    function memoizeOutput(workerFunc, equalityFunc) {\n        var cachedRes = null;\n        return function () {\n            var newRes = workerFunc.apply(this, arguments);\n            if (cachedRes === null || !(cachedRes === newRes || equalityFunc(cachedRes, newRes))) {\n                cachedRes = newRes;\n            }\n            return cachedRes;\n        };\n    }\n\n    var EXTENDED_SETTINGS_AND_SEVERITIES = {\n        week: 3,\n        separator: 0,\n        omitZeroMinute: 0,\n        meridiem: 0,\n        omitCommas: 0\n    };\n    var STANDARD_DATE_PROP_SEVERITIES = {\n        timeZoneName: 7,\n        era: 6,\n        year: 5,\n        month: 4,\n        day: 2,\n        weekday: 2,\n        hour: 1,\n        minute: 1,\n        second: 1\n    };\n    var MERIDIEM_RE = /\\s*([ap])\\.?m\\.?/i; // eats up leading spaces too\n    var COMMA_RE = /,/g; // we need re for globalness\n    var MULTI_SPACE_RE = /\\s+/g;\n    var LTR_RE = /\\u200e/g; // control character\n    var UTC_RE = /UTC|GMT/;\n    var NativeFormatter = /** @class */ (function () {\n        function NativeFormatter(formatSettings) {\n            var standardDateProps = {};\n            var extendedSettings = {};\n            var severity = 0;\n            for (var name_1 in formatSettings) {\n                if (name_1 in EXTENDED_SETTINGS_AND_SEVERITIES) {\n                    extendedSettings[name_1] = formatSettings[name_1];\n                    severity = Math.max(EXTENDED_SETTINGS_AND_SEVERITIES[name_1], severity);\n                }\n                else {\n                    standardDateProps[name_1] = formatSettings[name_1];\n                    if (name_1 in STANDARD_DATE_PROP_SEVERITIES) {\n                        severity = Math.max(STANDARD_DATE_PROP_SEVERITIES[name_1], severity);\n                    }\n                }\n            }\n            this.standardDateProps = standardDateProps;\n            this.extendedSettings = extendedSettings;\n            this.severity = severity;\n            this.buildFormattingFunc = memoize(buildFormattingFunc);\n        }\n        NativeFormatter.prototype.format = function (date, context) {\n            return this.buildFormattingFunc(this.standardDateProps, this.extendedSettings, context)(date);\n        };\n        NativeFormatter.prototype.formatRange = function (start, end, context) {\n            var _a = this, standardDateProps = _a.standardDateProps, extendedSettings = _a.extendedSettings;\n            var diffSeverity = computeMarkerDiffSeverity(start.marker, end.marker, context.calendarSystem);\n            if (!diffSeverity) {\n                return this.format(start, context);\n            }\n            var biggestUnitForPartial = diffSeverity;\n            if (biggestUnitForPartial > 1 && // the two dates are different in a way that's larger scale than time\n                (standardDateProps.year === 'numeric' || standardDateProps.year === '2-digit') &&\n                (standardDateProps.month === 'numeric' || standardDateProps.month === '2-digit') &&\n                (standardDateProps.day === 'numeric' || standardDateProps.day === '2-digit')) {\n                biggestUnitForPartial = 1; // make it look like the dates are only different in terms of time\n            }\n            var full0 = this.format(start, context);\n            var full1 = this.format(end, context);\n            if (full0 === full1) {\n                return full0;\n            }\n            var partialDateProps = computePartialFormattingOptions(standardDateProps, biggestUnitForPartial);\n            var partialFormattingFunc = buildFormattingFunc(partialDateProps, extendedSettings, context);\n            var partial0 = partialFormattingFunc(start);\n            var partial1 = partialFormattingFunc(end);\n            var insertion = findCommonInsertion(full0, partial0, full1, partial1);\n            var separator = extendedSettings.separator || '';\n            if (insertion) {\n                return insertion.before + partial0 + separator + partial1 + insertion.after;\n            }\n            return full0 + separator + full1;\n        };\n        NativeFormatter.prototype.getLargestUnit = function () {\n            switch (this.severity) {\n                case 7:\n                case 6:\n                case 5:\n                    return 'year';\n                case 4:\n                    return 'month';\n                case 3:\n                    return 'week';\n                default:\n                    return 'day';\n            }\n        };\n        return NativeFormatter;\n    }());\n    function buildFormattingFunc(standardDateProps, extendedSettings, context) {\n        var standardDatePropCnt = Object.keys(standardDateProps).length;\n        if (standardDatePropCnt === 1 && standardDateProps.timeZoneName === 'short') {\n            return function (date) {\n                return formatTimeZoneOffset(date.timeZoneOffset);\n            };\n        }\n        if (standardDatePropCnt === 0 && extendedSettings.week) {\n            return function (date) {\n                return formatWeekNumber(context.computeWeekNumber(date.marker), context.weekLabel, context.locale, extendedSettings.week);\n            };\n        }\n        return buildNativeFormattingFunc(standardDateProps, extendedSettings, context);\n    }\n    function buildNativeFormattingFunc(standardDateProps, extendedSettings, context) {\n        standardDateProps = __assign({}, standardDateProps); // copy\n        extendedSettings = __assign({}, extendedSettings); // copy\n        sanitizeSettings(standardDateProps, extendedSettings);\n        standardDateProps.timeZone = 'UTC'; // we leverage the only guaranteed timeZone for our UTC markers\n        var normalFormat = new Intl.DateTimeFormat(context.locale.codes, standardDateProps);\n        var zeroFormat; // needed?\n        if (extendedSettings.omitZeroMinute) {\n            var zeroProps = __assign({}, standardDateProps);\n            delete zeroProps.minute; // seconds and ms were already considered in sanitizeSettings\n            zeroFormat = new Intl.DateTimeFormat(context.locale.codes, zeroProps);\n        }\n        return function (date) {\n            var marker = date.marker;\n            var format;\n            if (zeroFormat && !marker.getUTCMinutes()) {\n                format = zeroFormat;\n            }\n            else {\n                format = normalFormat;\n            }\n            var s = format.format(marker);\n            return postProcess(s, date, standardDateProps, extendedSettings, context);\n        };\n    }\n    function sanitizeSettings(standardDateProps, extendedSettings) {\n        // deal with a browser inconsistency where formatting the timezone\n        // requires that the hour/minute be present.\n        if (standardDateProps.timeZoneName) {\n            if (!standardDateProps.hour) {\n                standardDateProps.hour = '2-digit';\n            }\n            if (!standardDateProps.minute) {\n                standardDateProps.minute = '2-digit';\n            }\n        }\n        // only support short timezone names\n        if (standardDateProps.timeZoneName === 'long') {\n            standardDateProps.timeZoneName = 'short';\n        }\n        // if requesting to display seconds, MUST display minutes\n        if (extendedSettings.omitZeroMinute && (standardDateProps.second || standardDateProps.millisecond)) {\n            delete extendedSettings.omitZeroMinute;\n        }\n    }\n    function postProcess(s, date, standardDateProps, extendedSettings, context) {\n        s = s.replace(LTR_RE, ''); // remove left-to-right control chars. do first. good for other regexes\n        if (standardDateProps.timeZoneName === 'short') {\n            s = injectTzoStr(s, (context.timeZone === 'UTC' || date.timeZoneOffset == null) ?\n                'UTC' : // important to normalize for IE, which does \"GMT\"\n                formatTimeZoneOffset(date.timeZoneOffset));\n        }\n        if (extendedSettings.omitCommas) {\n            s = s.replace(COMMA_RE, '').trim();\n        }\n        if (extendedSettings.omitZeroMinute) {\n            s = s.replace(':00', ''); // zeroFormat doesn't always achieve this\n        }\n        // ^ do anything that might create adjacent spaces before this point,\n        // because MERIDIEM_RE likes to eat up loading spaces\n        if (extendedSettings.meridiem === false) {\n            s = s.replace(MERIDIEM_RE, '').trim();\n        }\n        else if (extendedSettings.meridiem === 'narrow') { // a/p\n            s = s.replace(MERIDIEM_RE, function (m0, m1) {\n                return m1.toLocaleLowerCase();\n            });\n        }\n        else if (extendedSettings.meridiem === 'short') { // am/pm\n            s = s.replace(MERIDIEM_RE, function (m0, m1) {\n                return m1.toLocaleLowerCase() + 'm';\n            });\n        }\n        else if (extendedSettings.meridiem === 'lowercase') { // other meridiem transformers already converted to lowercase\n            s = s.replace(MERIDIEM_RE, function (m0) {\n                return m0.toLocaleLowerCase();\n            });\n        }\n        s = s.replace(MULTI_SPACE_RE, ' ');\n        s = s.trim();\n        return s;\n    }\n    function injectTzoStr(s, tzoStr) {\n        var replaced = false;\n        s = s.replace(UTC_RE, function () {\n            replaced = true;\n            return tzoStr;\n        });\n        // IE11 doesn't include UTC/GMT in the original string, so append to end\n        if (!replaced) {\n            s += ' ' + tzoStr;\n        }\n        return s;\n    }\n    function formatWeekNumber(num, weekLabel, locale, display) {\n        var parts = [];\n        if (display === 'narrow') {\n            parts.push(weekLabel);\n        }\n        else if (display === 'short') {\n            parts.push(weekLabel, ' ');\n        }\n        // otherwise, considered 'numeric'\n        parts.push(locale.simpleNumberFormat.format(num));\n        if (locale.options.isRtl) { // TODO: use control characters instead?\n            parts.reverse();\n        }\n        return parts.join('');\n    }\n    // Range Formatting Utils\n    // 0 = exactly the same\n    // 1 = different by time\n    // and bigger\n    function computeMarkerDiffSeverity(d0, d1, ca) {\n        if (ca.getMarkerYear(d0) !== ca.getMarkerYear(d1)) {\n            return 5;\n        }\n        if (ca.getMarkerMonth(d0) !== ca.getMarkerMonth(d1)) {\n            return 4;\n        }\n        if (ca.getMarkerDay(d0) !== ca.getMarkerDay(d1)) {\n            return 2;\n        }\n        if (timeAsMs(d0) !== timeAsMs(d1)) {\n            return 1;\n        }\n        return 0;\n    }\n    function computePartialFormattingOptions(options, biggestUnit) {\n        var partialOptions = {};\n        for (var name_2 in options) {\n            if (!(name_2 in STANDARD_DATE_PROP_SEVERITIES) || // not a date part prop (like timeZone)\n                STANDARD_DATE_PROP_SEVERITIES[name_2] <= biggestUnit) {\n                partialOptions[name_2] = options[name_2];\n            }\n        }\n        return partialOptions;\n    }\n    function findCommonInsertion(full0, partial0, full1, partial1) {\n        var i0 = 0;\n        while (i0 < full0.length) {\n            var found0 = full0.indexOf(partial0, i0);\n            if (found0 === -1) {\n                break;\n            }\n            var before0 = full0.substr(0, found0);\n            i0 = found0 + partial0.length;\n            var after0 = full0.substr(i0);\n            var i1 = 0;\n            while (i1 < full1.length) {\n                var found1 = full1.indexOf(partial1, i1);\n                if (found1 === -1) {\n                    break;\n                }\n                var before1 = full1.substr(0, found1);\n                i1 = found1 + partial1.length;\n                var after1 = full1.substr(i1);\n                if (before0 === before1 && after0 === after1) {\n                    return {\n                        before: before0,\n                        after: after0\n                    };\n                }\n            }\n        }\n        return null;\n    }\n\n    /*\n    TODO: fix the terminology of \"formatter\" vs \"formatting func\"\n    */\n    /*\n    At the time of instantiation, this object does not know which cmd-formatting system it will use.\n    It receives this at the time of formatting, as a setting.\n    */\n    var CmdFormatter = /** @class */ (function () {\n        function CmdFormatter(cmdStr, separator) {\n            this.cmdStr = cmdStr;\n            this.separator = separator;\n        }\n        CmdFormatter.prototype.format = function (date, context) {\n            return context.cmdFormatter(this.cmdStr, createVerboseFormattingArg(date, null, context, this.separator));\n        };\n        CmdFormatter.prototype.formatRange = function (start, end, context) {\n            return context.cmdFormatter(this.cmdStr, createVerboseFormattingArg(start, end, context, this.separator));\n        };\n        return CmdFormatter;\n    }());\n\n    var FuncFormatter = /** @class */ (function () {\n        function FuncFormatter(func) {\n            this.func = func;\n        }\n        FuncFormatter.prototype.format = function (date, context) {\n            return this.func(createVerboseFormattingArg(date, null, context));\n        };\n        FuncFormatter.prototype.formatRange = function (start, end, context) {\n            return this.func(createVerboseFormattingArg(start, end, context));\n        };\n        return FuncFormatter;\n    }());\n\n    // Formatter Object Creation\n    function createFormatter(input, defaultSeparator) {\n        if (typeof input === 'object' && input) { // non-null object\n            if (typeof defaultSeparator === 'string') {\n                input = __assign({ separator: defaultSeparator }, input);\n            }\n            return new NativeFormatter(input);\n        }\n        else if (typeof input === 'string') {\n            return new CmdFormatter(input, defaultSeparator);\n        }\n        else if (typeof input === 'function') {\n            return new FuncFormatter(input);\n        }\n    }\n    // String Utils\n    // timeZoneOffset is in minutes\n    function buildIsoString(marker, timeZoneOffset, stripZeroTime) {\n        if (stripZeroTime === void 0) { stripZeroTime = false; }\n        var s = marker.toISOString();\n        s = s.replace('.000', '');\n        if (stripZeroTime) {\n            s = s.replace('T00:00:00Z', '');\n        }\n        if (s.length > 10) { // time part wasn't stripped, can add timezone info\n            if (timeZoneOffset == null) {\n                s = s.replace('Z', '');\n            }\n            else if (timeZoneOffset !== 0) {\n                s = s.replace('Z', formatTimeZoneOffset(timeZoneOffset, true));\n            }\n            // otherwise, its UTC-0 and we want to keep the Z\n        }\n        return s;\n    }\n    function formatIsoTimeString(marker) {\n        return padStart(marker.getUTCHours(), 2) + ':' +\n            padStart(marker.getUTCMinutes(), 2) + ':' +\n            padStart(marker.getUTCSeconds(), 2);\n    }\n    function formatTimeZoneOffset(minutes, doIso) {\n        if (doIso === void 0) { doIso = false; }\n        var sign = minutes < 0 ? '-' : '+';\n        var abs = Math.abs(minutes);\n        var hours = Math.floor(abs / 60);\n        var mins = Math.round(abs % 60);\n        if (doIso) {\n            return sign + padStart(hours, 2) + ':' + padStart(mins, 2);\n        }\n        else {\n            return 'GMT' + sign + hours + (mins ? ':' + padStart(mins, 2) : '');\n        }\n    }\n    // Arg Utils\n    function createVerboseFormattingArg(start, end, context, separator) {\n        var startInfo = expandZonedMarker(start, context.calendarSystem);\n        var endInfo = end ? expandZonedMarker(end, context.calendarSystem) : null;\n        return {\n            date: startInfo,\n            start: startInfo,\n            end: endInfo,\n            timeZone: context.timeZone,\n            localeCodes: context.locale.codes,\n            separator: separator\n        };\n    }\n    function expandZonedMarker(dateInfo, calendarSystem) {\n        var a = calendarSystem.markerToArray(dateInfo.marker);\n        return {\n            marker: dateInfo.marker,\n            timeZoneOffset: dateInfo.timeZoneOffset,\n            array: a,\n            year: a[0],\n            month: a[1],\n            day: a[2],\n            hour: a[3],\n            minute: a[4],\n            second: a[5],\n            millisecond: a[6]\n        };\n    }\n\n    var EventSourceApi = /** @class */ (function () {\n        function EventSourceApi(calendar, internalEventSource) {\n            this.calendar = calendar;\n            this.internalEventSource = internalEventSource;\n        }\n        EventSourceApi.prototype.remove = function () {\n            this.calendar.dispatch({\n                type: 'REMOVE_EVENT_SOURCE',\n                sourceId: this.internalEventSource.sourceId\n            });\n        };\n        EventSourceApi.prototype.refetch = function () {\n            this.calendar.dispatch({\n                type: 'FETCH_EVENT_SOURCES',\n                sourceIds: [this.internalEventSource.sourceId]\n            });\n        };\n        Object.defineProperty(EventSourceApi.prototype, \"id\", {\n            get: function () {\n                return this.internalEventSource.publicId;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(EventSourceApi.prototype, \"url\", {\n            // only relevant to json-feed event sources\n            get: function () {\n                return this.internalEventSource.meta.url;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        return EventSourceApi;\n    }());\n\n    var EventApi = /** @class */ (function () {\n        function EventApi(calendar, def, instance) {\n            this._calendar = calendar;\n            this._def = def;\n            this._instance = instance || null;\n        }\n        /*\n        TODO: make event struct more responsible for this\n        */\n        EventApi.prototype.setProp = function (name, val) {\n            var _a, _b;\n            if (name in DATE_PROPS) ;\n            else if (name in NON_DATE_PROPS) {\n                if (typeof NON_DATE_PROPS[name] === 'function') {\n                    val = NON_DATE_PROPS[name](val);\n                }\n                this.mutate({\n                    standardProps: (_a = {}, _a[name] = val, _a)\n                });\n            }\n            else if (name in UNSCOPED_EVENT_UI_PROPS) {\n                var ui = void 0;\n                if (typeof UNSCOPED_EVENT_UI_PROPS[name] === 'function') {\n                    val = UNSCOPED_EVENT_UI_PROPS[name](val);\n                }\n                if (name === 'color') {\n                    ui = { backgroundColor: val, borderColor: val };\n                }\n                else if (name === 'editable') {\n                    ui = { startEditable: val, durationEditable: val };\n                }\n                else {\n                    ui = (_b = {}, _b[name] = val, _b);\n                }\n                this.mutate({\n                    standardProps: { ui: ui }\n                });\n            }\n        };\n        EventApi.prototype.setExtendedProp = function (name, val) {\n            var _a;\n            this.mutate({\n                extendedProps: (_a = {}, _a[name] = val, _a)\n            });\n        };\n        EventApi.prototype.setStart = function (startInput, options) {\n            if (options === void 0) { options = {}; }\n            var dateEnv = this._calendar.dateEnv;\n            var start = dateEnv.createMarker(startInput);\n            if (start && this._instance) { // TODO: warning if parsed bad\n                var instanceRange = this._instance.range;\n                var startDelta = diffDates(instanceRange.start, start, dateEnv, options.granularity); // what if parsed bad!?\n                var endDelta = null;\n                if (options.maintainDuration) {\n                    var origDuration = diffDates(instanceRange.start, instanceRange.end, dateEnv, options.granularity);\n                    var newDuration = diffDates(start, instanceRange.end, dateEnv, options.granularity);\n                    endDelta = subtractDurations(origDuration, newDuration);\n                }\n                this.mutate({ startDelta: startDelta, endDelta: endDelta });\n            }\n        };\n        EventApi.prototype.setEnd = function (endInput, options) {\n            if (options === void 0) { options = {}; }\n            var dateEnv = this._calendar.dateEnv;\n            var end;\n            if (endInput != null) {\n                end = dateEnv.createMarker(endInput);\n                if (!end) {\n                    return; // TODO: warning if parsed bad\n                }\n            }\n            if (this._instance) {\n                if (end) {\n                    var endDelta = diffDates(this._instance.range.end, end, dateEnv, options.granularity);\n                    this.mutate({ endDelta: endDelta });\n                }\n                else {\n                    this.mutate({ standardProps: { hasEnd: false } });\n                }\n            }\n        };\n        EventApi.prototype.setDates = function (startInput, endInput, options) {\n            if (options === void 0) { options = {}; }\n            var dateEnv = this._calendar.dateEnv;\n            var standardProps = { allDay: options.allDay };\n            var start = dateEnv.createMarker(startInput);\n            var end;\n            if (!start) {\n                return; // TODO: warning if parsed bad\n            }\n            if (endInput != null) {\n                end = dateEnv.createMarker(endInput);\n                if (!end) { // TODO: warning if parsed bad\n                    return;\n                }\n            }\n            if (this._instance) {\n                var instanceRange = this._instance.range;\n                // when computing the diff for an event being converted to all-day,\n                // compute diff off of the all-day values the way event-mutation does.\n                if (options.allDay === true) {\n                    instanceRange = computeAlignedDayRange(instanceRange);\n                }\n                var startDelta = diffDates(instanceRange.start, start, dateEnv, options.granularity);\n                if (end) {\n                    var endDelta = diffDates(instanceRange.end, end, dateEnv, options.granularity);\n                    this.mutate({ startDelta: startDelta, endDelta: endDelta, standardProps: standardProps });\n                }\n                else {\n                    standardProps.hasEnd = false;\n                    this.mutate({ startDelta: startDelta, standardProps: standardProps });\n                }\n            }\n        };\n        EventApi.prototype.moveStart = function (deltaInput) {\n            var delta = createDuration(deltaInput);\n            if (delta) { // TODO: warning if parsed bad\n                this.mutate({ startDelta: delta });\n            }\n        };\n        EventApi.prototype.moveEnd = function (deltaInput) {\n            var delta = createDuration(deltaInput);\n            if (delta) { // TODO: warning if parsed bad\n                this.mutate({ endDelta: delta });\n            }\n        };\n        EventApi.prototype.moveDates = function (deltaInput) {\n            var delta = createDuration(deltaInput);\n            if (delta) { // TODO: warning if parsed bad\n                this.mutate({ startDelta: delta, endDelta: delta });\n            }\n        };\n        EventApi.prototype.setAllDay = function (allDay, options) {\n            if (options === void 0) { options = {}; }\n            var standardProps = { allDay: allDay };\n            var maintainDuration = options.maintainDuration;\n            if (maintainDuration == null) {\n                maintainDuration = this._calendar.opt('allDayMaintainDuration');\n            }\n            if (this._def.allDay !== allDay) {\n                standardProps.hasEnd = maintainDuration;\n            }\n            this.mutate({ standardProps: standardProps });\n        };\n        EventApi.prototype.formatRange = function (formatInput) {\n            var dateEnv = this._calendar.dateEnv;\n            var instance = this._instance;\n            var formatter = createFormatter(formatInput, this._calendar.opt('defaultRangeSeparator'));\n            if (this._def.hasEnd) {\n                return dateEnv.formatRange(instance.range.start, instance.range.end, formatter, {\n                    forcedStartTzo: instance.forcedStartTzo,\n                    forcedEndTzo: instance.forcedEndTzo\n                });\n            }\n            else {\n                return dateEnv.format(instance.range.start, formatter, {\n                    forcedTzo: instance.forcedStartTzo\n                });\n            }\n        };\n        EventApi.prototype.mutate = function (mutation) {\n            var def = this._def;\n            var instance = this._instance;\n            if (instance) {\n                this._calendar.dispatch({\n                    type: 'MUTATE_EVENTS',\n                    instanceId: instance.instanceId,\n                    mutation: mutation,\n                    fromApi: true\n                });\n                var eventStore = this._calendar.state.eventStore;\n                this._def = eventStore.defs[def.defId];\n                this._instance = eventStore.instances[instance.instanceId];\n            }\n        };\n        EventApi.prototype.remove = function () {\n            this._calendar.dispatch({\n                type: 'REMOVE_EVENT_DEF',\n                defId: this._def.defId\n            });\n        };\n        Object.defineProperty(EventApi.prototype, \"source\", {\n            get: function () {\n                var sourceId = this._def.sourceId;\n                if (sourceId) {\n                    return new EventSourceApi(this._calendar, this._calendar.state.eventSources[sourceId]);\n                }\n                return null;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(EventApi.prototype, \"start\", {\n            get: function () {\n                return this._instance ?\n                    this._calendar.dateEnv.toDate(this._instance.range.start) :\n                    null;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(EventApi.prototype, \"end\", {\n            get: function () {\n                return (this._instance && this._def.hasEnd) ?\n                    this._calendar.dateEnv.toDate(this._instance.range.end) :\n                    null;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(EventApi.prototype, \"id\", {\n            // computable props that all access the def\n            // TODO: find a TypeScript-compatible way to do this at scale\n            get: function () { return this._def.publicId; },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(EventApi.prototype, \"groupId\", {\n            get: function () { return this._def.groupId; },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(EventApi.prototype, \"allDay\", {\n            get: function () { return this._def.allDay; },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(EventApi.prototype, \"title\", {\n            get: function () { return this._def.title; },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(EventApi.prototype, \"url\", {\n            get: function () { return this._def.url; },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(EventApi.prototype, \"rendering\", {\n            get: function () { return this._def.rendering; },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(EventApi.prototype, \"startEditable\", {\n            get: function () { return this._def.ui.startEditable; },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(EventApi.prototype, \"durationEditable\", {\n            get: function () { return this._def.ui.durationEditable; },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(EventApi.prototype, \"constraint\", {\n            get: function () { return this._def.ui.constraints[0] || null; },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(EventApi.prototype, \"overlap\", {\n            get: function () { return this._def.ui.overlap; },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(EventApi.prototype, \"allow\", {\n            get: function () { return this._def.ui.allows[0] || null; },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(EventApi.prototype, \"backgroundColor\", {\n            get: function () { return this._def.ui.backgroundColor; },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(EventApi.prototype, \"borderColor\", {\n            get: function () { return this._def.ui.borderColor; },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(EventApi.prototype, \"textColor\", {\n            get: function () { return this._def.ui.textColor; },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(EventApi.prototype, \"classNames\", {\n            // NOTE: user can't modify these because Object.freeze was called in event-def parsing\n            get: function () { return this._def.ui.classNames; },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(EventApi.prototype, \"extendedProps\", {\n            get: function () { return this._def.extendedProps; },\n            enumerable: true,\n            configurable: true\n        });\n        return EventApi;\n    }());\n\n    /*\n    Specifying nextDayThreshold signals that all-day ranges should be sliced.\n    */\n    function sliceEventStore(eventStore, eventUiBases, framingRange, nextDayThreshold) {\n        var inverseBgByGroupId = {};\n        var inverseBgByDefId = {};\n        var defByGroupId = {};\n        var bgRanges = [];\n        var fgRanges = [];\n        var eventUis = compileEventUis(eventStore.defs, eventUiBases);\n        for (var defId in eventStore.defs) {\n            var def = eventStore.defs[defId];\n            if (def.rendering === 'inverse-background') {\n                if (def.groupId) {\n                    inverseBgByGroupId[def.groupId] = [];\n                    if (!defByGroupId[def.groupId]) {\n                        defByGroupId[def.groupId] = def;\n                    }\n                }\n                else {\n                    inverseBgByDefId[defId] = [];\n                }\n            }\n        }\n        for (var instanceId in eventStore.instances) {\n            var instance = eventStore.instances[instanceId];\n            var def = eventStore.defs[instance.defId];\n            var ui = eventUis[def.defId];\n            var origRange = instance.range;\n            var normalRange = (!def.allDay && nextDayThreshold) ?\n                computeVisibleDayRange(origRange, nextDayThreshold) :\n                origRange;\n            var slicedRange = intersectRanges(normalRange, framingRange);\n            if (slicedRange) {\n                if (def.rendering === 'inverse-background') {\n                    if (def.groupId) {\n                        inverseBgByGroupId[def.groupId].push(slicedRange);\n                    }\n                    else {\n                        inverseBgByDefId[instance.defId].push(slicedRange);\n                    }\n                }\n                else {\n                    (def.rendering === 'background' ? bgRanges : fgRanges).push({\n                        def: def,\n                        ui: ui,\n                        instance: instance,\n                        range: slicedRange,\n                        isStart: normalRange.start && normalRange.start.valueOf() === slicedRange.start.valueOf(),\n                        isEnd: normalRange.end && normalRange.end.valueOf() === slicedRange.end.valueOf()\n                    });\n                }\n            }\n        }\n        for (var groupId in inverseBgByGroupId) { // BY GROUP\n            var ranges = inverseBgByGroupId[groupId];\n            var invertedRanges = invertRanges(ranges, framingRange);\n            for (var _i = 0, invertedRanges_1 = invertedRanges; _i < invertedRanges_1.length; _i++) {\n                var invertedRange = invertedRanges_1[_i];\n                var def = defByGroupId[groupId];\n                var ui = eventUis[def.defId];\n                bgRanges.push({\n                    def: def,\n                    ui: ui,\n                    instance: null,\n                    range: invertedRange,\n                    isStart: false,\n                    isEnd: false\n                });\n            }\n        }\n        for (var defId in inverseBgByDefId) {\n            var ranges = inverseBgByDefId[defId];\n            var invertedRanges = invertRanges(ranges, framingRange);\n            for (var _a = 0, invertedRanges_2 = invertedRanges; _a < invertedRanges_2.length; _a++) {\n                var invertedRange = invertedRanges_2[_a];\n                bgRanges.push({\n                    def: eventStore.defs[defId],\n                    ui: eventUis[defId],\n                    instance: null,\n                    range: invertedRange,\n                    isStart: false,\n                    isEnd: false\n                });\n            }\n        }\n        return { bg: bgRanges, fg: fgRanges };\n    }\n    function hasBgRendering(def) {\n        return def.rendering === 'background' || def.rendering === 'inverse-background';\n    }\n    function filterSegsViaEls(view, segs, isMirror) {\n        if (view.hasPublicHandlers('eventRender')) {\n            segs = segs.filter(function (seg) {\n                var custom = view.publiclyTrigger('eventRender', [\n                    {\n                        event: new EventApi(view.calendar, seg.eventRange.def, seg.eventRange.instance),\n                        isMirror: isMirror,\n                        isStart: seg.isStart,\n                        isEnd: seg.isEnd,\n                        // TODO: include seg.range once all components consistently generate it\n                        el: seg.el,\n                        view: view\n                    }\n                ]);\n                if (custom === false) { // means don't render at all\n                    return false;\n                }\n                else if (custom && custom !== true) {\n                    seg.el = custom;\n                }\n                return true;\n            });\n        }\n        for (var _i = 0, segs_1 = segs; _i < segs_1.length; _i++) {\n            var seg = segs_1[_i];\n            setElSeg(seg.el, seg);\n        }\n        return segs;\n    }\n    function setElSeg(el, seg) {\n        el.fcSeg = seg;\n    }\n    function getElSeg(el) {\n        return el.fcSeg || null;\n    }\n    // event ui computation\n    function compileEventUis(eventDefs, eventUiBases) {\n        return mapHash(eventDefs, function (eventDef) {\n            return compileEventUi(eventDef, eventUiBases);\n        });\n    }\n    function compileEventUi(eventDef, eventUiBases) {\n        var uis = [];\n        if (eventUiBases['']) {\n            uis.push(eventUiBases['']);\n        }\n        if (eventUiBases[eventDef.defId]) {\n            uis.push(eventUiBases[eventDef.defId]);\n        }\n        uis.push(eventDef.ui);\n        return combineEventUis(uis);\n    }\n\n    // applies the mutation to ALL defs/instances within the event store\n    function applyMutationToEventStore(eventStore, eventConfigBase, mutation, calendar) {\n        var eventConfigs = compileEventUis(eventStore.defs, eventConfigBase);\n        var dest = createEmptyEventStore();\n        for (var defId in eventStore.defs) {\n            var def = eventStore.defs[defId];\n            dest.defs[defId] = applyMutationToEventDef(def, eventConfigs[defId], mutation, calendar.pluginSystem.hooks.eventDefMutationAppliers, calendar);\n        }\n        for (var instanceId in eventStore.instances) {\n            var instance = eventStore.instances[instanceId];\n            var def = dest.defs[instance.defId]; // important to grab the newly modified def\n            dest.instances[instanceId] = applyMutationToEventInstance(instance, def, eventConfigs[instance.defId], mutation, calendar);\n        }\n        return dest;\n    }\n    function applyMutationToEventDef(eventDef, eventConfig, mutation, appliers, calendar) {\n        var standardProps = mutation.standardProps || {};\n        // if hasEnd has not been specified, guess a good value based on deltas.\n        // if duration will change, there's no way the default duration will persist,\n        // and thus, we need to mark the event as having a real end\n        if (standardProps.hasEnd == null &&\n            eventConfig.durationEditable &&\n            willDeltasAffectDuration(eventConfig.startEditable ? mutation.startDelta : null, mutation.endDelta || null)) {\n            standardProps.hasEnd = true; // TODO: is this mutation okay?\n        }\n        var copy = __assign({}, eventDef, standardProps, { ui: __assign({}, eventDef.ui, standardProps.ui) });\n        if (mutation.extendedProps) {\n            copy.extendedProps = __assign({}, copy.extendedProps, mutation.extendedProps);\n        }\n        for (var _i = 0, appliers_1 = appliers; _i < appliers_1.length; _i++) {\n            var applier = appliers_1[_i];\n            applier(copy, mutation, calendar);\n        }\n        if (!copy.hasEnd && calendar.opt('forceEventDuration')) {\n            copy.hasEnd = true;\n        }\n        return copy;\n    }\n    function willDeltasAffectDuration(startDelta, endDelta) {\n        if (startDelta && !asRoughMs(startDelta)) {\n            startDelta = null;\n        }\n        if (endDelta && !asRoughMs(endDelta)) {\n            endDelta = null;\n        }\n        if (!startDelta && !endDelta) {\n            return false;\n        }\n        if (Boolean(startDelta) !== Boolean(endDelta)) {\n            return true;\n        }\n        return !durationsEqual(startDelta, endDelta);\n    }\n    function applyMutationToEventInstance(eventInstance, eventDef, // must first be modified by applyMutationToEventDef\n    eventConfig, mutation, calendar) {\n        var dateEnv = calendar.dateEnv;\n        var forceAllDay = mutation.standardProps && mutation.standardProps.allDay === true;\n        var clearEnd = mutation.standardProps && mutation.standardProps.hasEnd === false;\n        var copy = __assign({}, eventInstance);\n        if (forceAllDay) {\n            copy.range = computeAlignedDayRange(copy.range);\n        }\n        if (mutation.startDelta && eventConfig.startEditable) {\n            copy.range = {\n                start: dateEnv.add(copy.range.start, mutation.startDelta),\n                end: copy.range.end\n            };\n        }\n        if (clearEnd) {\n            copy.range = {\n                start: copy.range.start,\n                end: calendar.getDefaultEventEnd(eventDef.allDay, copy.range.start)\n            };\n        }\n        else if (mutation.endDelta &&\n            (eventConfig.durationEditable ||\n                !willDeltasAffectDuration(// TODO: nonDRY logic above\n                eventConfig.startEditable ? mutation.startDelta : null, mutation.endDelta))) {\n            copy.range = {\n                start: copy.range.start,\n                end: dateEnv.add(copy.range.end, mutation.endDelta)\n            };\n        }\n        // in case event was all-day but the supplied deltas were not\n        // better util for this?\n        if (eventDef.allDay) {\n            copy.range = {\n                start: startOfDay(copy.range.start),\n                end: startOfDay(copy.range.end)\n            };\n        }\n        // handle invalid durations\n        if (copy.range.end < copy.range.start) {\n            copy.range.end = calendar.getDefaultEventEnd(eventDef.allDay, copy.range.start);\n        }\n        return copy;\n    }\n\n    function reduceEventStore (eventStore, action, eventSources, dateProfile, calendar) {\n        switch (action.type) {\n            case 'RECEIVE_EVENTS': // raw\n                return receiveRawEvents(eventStore, eventSources[action.sourceId], action.fetchId, action.fetchRange, action.rawEvents, calendar);\n            case 'ADD_EVENTS': // already parsed, but not expanded\n                return addEvent(eventStore, action.eventStore, // new ones\n                dateProfile ? dateProfile.activeRange : null, calendar);\n            case 'MERGE_EVENTS': // already parsed and expanded\n                return mergeEventStores(eventStore, action.eventStore);\n            case 'PREV': // TODO: how do we track all actions that affect dateProfile :(\n            case 'NEXT':\n            case 'SET_DATE':\n            case 'SET_VIEW_TYPE':\n                if (dateProfile) {\n                    return expandRecurring(eventStore, dateProfile.activeRange, calendar);\n                }\n                else {\n                    return eventStore;\n                }\n            case 'CHANGE_TIMEZONE':\n                return rezoneDates(eventStore, action.oldDateEnv, calendar.dateEnv);\n            case 'MUTATE_EVENTS':\n                return applyMutationToRelated(eventStore, action.instanceId, action.mutation, action.fromApi, calendar);\n            case 'REMOVE_EVENT_INSTANCES':\n                return excludeInstances(eventStore, action.instances);\n            case 'REMOVE_EVENT_DEF':\n                return filterEventStoreDefs(eventStore, function (eventDef) {\n                    return eventDef.defId !== action.defId;\n                });\n            case 'REMOVE_EVENT_SOURCE':\n                return excludeEventsBySourceId(eventStore, action.sourceId);\n            case 'REMOVE_ALL_EVENT_SOURCES':\n                return filterEventStoreDefs(eventStore, function (eventDef) {\n                    return !eventDef.sourceId; // only keep events with no source id\n                });\n            case 'REMOVE_ALL_EVENTS':\n                return createEmptyEventStore();\n            case 'RESET_EVENTS':\n                return {\n                    defs: eventStore.defs,\n                    instances: eventStore.instances\n                };\n            default:\n                return eventStore;\n        }\n    }\n    function receiveRawEvents(eventStore, eventSource, fetchId, fetchRange, rawEvents, calendar) {\n        if (eventSource && // not already removed\n            fetchId === eventSource.latestFetchId // TODO: wish this logic was always in event-sources\n        ) {\n            var subset = parseEvents(transformRawEvents(rawEvents, eventSource, calendar), eventSource.sourceId, calendar);\n            if (fetchRange) {\n                subset = expandRecurring(subset, fetchRange, calendar);\n            }\n            return mergeEventStores(excludeEventsBySourceId(eventStore, eventSource.sourceId), subset);\n        }\n        return eventStore;\n    }\n    function addEvent(eventStore, subset, expandRange, calendar) {\n        if (expandRange) {\n            subset = expandRecurring(subset, expandRange, calendar);\n        }\n        return mergeEventStores(eventStore, subset);\n    }\n    function rezoneDates(eventStore, oldDateEnv, newDateEnv) {\n        var defs = eventStore.defs;\n        var instances = mapHash(eventStore.instances, function (instance) {\n            var def = defs[instance.defId];\n            if (def.allDay || def.recurringDef) {\n                return instance; // isn't dependent on timezone\n            }\n            else {\n                return __assign({}, instance, { range: {\n                        start: newDateEnv.createMarker(oldDateEnv.toDate(instance.range.start, instance.forcedStartTzo)),\n                        end: newDateEnv.createMarker(oldDateEnv.toDate(instance.range.end, instance.forcedEndTzo))\n                    }, forcedStartTzo: newDateEnv.canComputeOffset ? null : instance.forcedStartTzo, forcedEndTzo: newDateEnv.canComputeOffset ? null : instance.forcedEndTzo });\n            }\n        });\n        return { defs: defs, instances: instances };\n    }\n    function applyMutationToRelated(eventStore, instanceId, mutation, fromApi, calendar) {\n        var relevant = getRelevantEvents(eventStore, instanceId);\n        var eventConfigBase = fromApi ?\n            { '': {\n                    startEditable: true,\n                    durationEditable: true,\n                    constraints: [],\n                    overlap: null,\n                    allows: [],\n                    backgroundColor: '',\n                    borderColor: '',\n                    textColor: '',\n                    classNames: []\n                } } :\n            calendar.eventUiBases;\n        relevant = applyMutationToEventStore(relevant, eventConfigBase, mutation, calendar);\n        return mergeEventStores(eventStore, relevant);\n    }\n    function excludeEventsBySourceId(eventStore, sourceId) {\n        return filterEventStoreDefs(eventStore, function (eventDef) {\n            return eventDef.sourceId !== sourceId;\n        });\n    }\n    // QUESTION: why not just return instances? do a general object-property-exclusion util\n    function excludeInstances(eventStore, removals) {\n        return {\n            defs: eventStore.defs,\n            instances: filterHash(eventStore.instances, function (instance) {\n                return !removals[instance.instanceId];\n            })\n        };\n    }\n\n    // high-level segmenting-aware tester functions\n    // ------------------------------------------------------------------------------------------------------------------------\n    function isInteractionValid(interaction, calendar) {\n        return isNewPropsValid({ eventDrag: interaction }, calendar); // HACK: the eventDrag props is used for ALL interactions\n    }\n    function isDateSelectionValid(dateSelection, calendar) {\n        return isNewPropsValid({ dateSelection: dateSelection }, calendar);\n    }\n    function isNewPropsValid(newProps, calendar) {\n        var view = calendar.view;\n        var props = __assign({ businessHours: view ? view.props.businessHours : createEmptyEventStore(), dateSelection: '', eventStore: calendar.state.eventStore, eventUiBases: calendar.eventUiBases, eventSelection: '', eventDrag: null, eventResize: null }, newProps);\n        return (calendar.pluginSystem.hooks.isPropsValid || isPropsValid)(props, calendar);\n    }\n    function isPropsValid(state, calendar, dateSpanMeta, filterConfig) {\n        if (dateSpanMeta === void 0) { dateSpanMeta = {}; }\n        if (state.eventDrag && !isInteractionPropsValid(state, calendar, dateSpanMeta, filterConfig)) {\n            return false;\n        }\n        if (state.dateSelection && !isDateSelectionPropsValid(state, calendar, dateSpanMeta, filterConfig)) {\n            return false;\n        }\n        return true;\n    }\n    // Moving Event Validation\n    // ------------------------------------------------------------------------------------------------------------------------\n    function isInteractionPropsValid(state, calendar, dateSpanMeta, filterConfig) {\n        var interaction = state.eventDrag; // HACK: the eventDrag props is used for ALL interactions\n        var subjectEventStore = interaction.mutatedEvents;\n        var subjectDefs = subjectEventStore.defs;\n        var subjectInstances = subjectEventStore.instances;\n        var subjectConfigs = compileEventUis(subjectDefs, interaction.isEvent ?\n            state.eventUiBases :\n            { '': calendar.selectionConfig } // if not a real event, validate as a selection\n        );\n        if (filterConfig) {\n            subjectConfigs = mapHash(subjectConfigs, filterConfig);\n        }\n        var otherEventStore = excludeInstances(state.eventStore, interaction.affectedEvents.instances); // exclude the subject events. TODO: exclude defs too?\n        var otherDefs = otherEventStore.defs;\n        var otherInstances = otherEventStore.instances;\n        var otherConfigs = compileEventUis(otherDefs, state.eventUiBases);\n        for (var subjectInstanceId in subjectInstances) {\n            var subjectInstance = subjectInstances[subjectInstanceId];\n            var subjectRange = subjectInstance.range;\n            var subjectConfig = subjectConfigs[subjectInstance.defId];\n            var subjectDef = subjectDefs[subjectInstance.defId];\n            // constraint\n            if (!allConstraintsPass(subjectConfig.constraints, subjectRange, otherEventStore, state.businessHours, calendar)) {\n                return false;\n            }\n            // overlap\n            var overlapFunc = calendar.opt('eventOverlap');\n            if (typeof overlapFunc !== 'function') {\n                overlapFunc = null;\n            }\n            for (var otherInstanceId in otherInstances) {\n                var otherInstance = otherInstances[otherInstanceId];\n                // intersect! evaluate\n                if (rangesIntersect(subjectRange, otherInstance.range)) {\n                    var otherOverlap = otherConfigs[otherInstance.defId].overlap;\n                    // consider the other event's overlap. only do this if the subject event is a \"real\" event\n                    if (otherOverlap === false && interaction.isEvent) {\n                        return false;\n                    }\n                    if (subjectConfig.overlap === false) {\n                        return false;\n                    }\n                    if (overlapFunc && !overlapFunc(new EventApi(calendar, otherDefs[otherInstance.defId], otherInstance), // still event\n                    new EventApi(calendar, subjectDef, subjectInstance) // moving event\n                    )) {\n                        return false;\n                    }\n                }\n            }\n            // allow (a function)\n            for (var _i = 0, _a = subjectConfig.allows; _i < _a.length; _i++) {\n                var subjectAllow = _a[_i];\n                var origDef = state.eventStore.defs[subjectDef.defId];\n                var origInstance = state.eventStore.instances[subjectInstanceId];\n                var subjectDateSpan = __assign({}, dateSpanMeta, { range: subjectInstance.range, allDay: subjectDef.allDay });\n                if (!subjectAllow(calendar.buildDateSpanApi(subjectDateSpan), new EventApi(calendar, origDef, origInstance))) {\n                    return false;\n                }\n            }\n        }\n        return true;\n    }\n    // Date Selection Validation\n    // ------------------------------------------------------------------------------------------------------------------------\n    function isDateSelectionPropsValid(state, calendar, dateSpanMeta, filterConfig) {\n        var relevantEventStore = state.eventStore;\n        var relevantDefs = relevantEventStore.defs;\n        var relevantInstances = relevantEventStore.instances;\n        var selection = state.dateSelection;\n        var selectionRange = selection.range;\n        var selectionConfig = calendar.selectionConfig;\n        if (filterConfig) {\n            selectionConfig = filterConfig(selectionConfig);\n        }\n        // constraint\n        if (!allConstraintsPass(selectionConfig.constraints, selectionRange, relevantEventStore, state.businessHours, calendar)) {\n            return false;\n        }\n        // overlap\n        var overlapFunc = calendar.opt('selectOverlap');\n        if (typeof overlapFunc !== 'function') {\n            overlapFunc = null;\n        }\n        for (var relevantInstanceId in relevantInstances) {\n            var relevantInstance = relevantInstances[relevantInstanceId];\n            // intersect! evaluate\n            if (rangesIntersect(selectionRange, relevantInstance.range)) {\n                if (selectionConfig.overlap === false) {\n                    return false;\n                }\n                if (overlapFunc && !overlapFunc(new EventApi(calendar, relevantDefs[relevantInstance.defId], relevantInstance))) {\n                    return false;\n                }\n            }\n        }\n        // allow (a function)\n        for (var _i = 0, _a = selectionConfig.allows; _i < _a.length; _i++) {\n            var selectionAllow = _a[_i];\n            var fullDateSpan = __assign({}, dateSpanMeta, selection);\n            if (!selectionAllow(calendar.buildDateSpanApi(fullDateSpan), null)) {\n                return false;\n            }\n        }\n        return true;\n    }\n    // Constraint Utils\n    // ------------------------------------------------------------------------------------------------------------------------\n    function allConstraintsPass(constraints, subjectRange, otherEventStore, businessHoursUnexpanded, calendar) {\n        for (var _i = 0, constraints_1 = constraints; _i < constraints_1.length; _i++) {\n            var constraint = constraints_1[_i];\n            if (!anyRangesContainRange(constraintToRanges(constraint, subjectRange, otherEventStore, businessHoursUnexpanded, calendar), subjectRange)) {\n                return false;\n            }\n        }\n        return true;\n    }\n    function constraintToRanges(constraint, subjectRange, // for expanding a recurring constraint, or expanding business hours\n    otherEventStore, // for if constraint is an even group ID\n    businessHoursUnexpanded, // for if constraint is 'businessHours'\n    calendar // for expanding businesshours\n    ) {\n        if (constraint === 'businessHours') {\n            return eventStoreToRanges(expandRecurring(businessHoursUnexpanded, subjectRange, calendar));\n        }\n        else if (typeof constraint === 'string') { // an group ID\n            return eventStoreToRanges(filterEventStoreDefs(otherEventStore, function (eventDef) {\n                return eventDef.groupId === constraint;\n            }));\n        }\n        else if (typeof constraint === 'object' && constraint) { // non-null object\n            return eventStoreToRanges(expandRecurring(constraint, subjectRange, calendar));\n        }\n        return []; // if it's false\n    }\n    // TODO: move to event-store file?\n    function eventStoreToRanges(eventStore) {\n        var instances = eventStore.instances;\n        var ranges = [];\n        for (var instanceId in instances) {\n            ranges.push(instances[instanceId].range);\n        }\n        return ranges;\n    }\n    // TODO: move to geom file?\n    function anyRangesContainRange(outerRanges, innerRange) {\n        for (var _i = 0, outerRanges_1 = outerRanges; _i < outerRanges_1.length; _i++) {\n            var outerRange = outerRanges_1[_i];\n            if (rangeContainsRange(outerRange, innerRange)) {\n                return true;\n            }\n        }\n        return false;\n    }\n    // Parsing\n    // ------------------------------------------------------------------------------------------------------------------------\n    function normalizeConstraint(input, calendar) {\n        if (Array.isArray(input)) {\n            return parseEvents(input, '', calendar, true); // allowOpenRange=true\n        }\n        else if (typeof input === 'object' && input) { // non-null object\n            return parseEvents([input], '', calendar, true); // allowOpenRange=true\n        }\n        else if (input != null) {\n            return String(input);\n        }\n        else {\n            return null;\n        }\n    }\n\n    function htmlEscape(s) {\n        return (s + '').replace(/&/g, '&amp;')\n            .replace(/</g, '&lt;')\n            .replace(/>/g, '&gt;')\n            .replace(/'/g, '&#039;')\n            .replace(/\"/g, '&quot;')\n            .replace(/\\n/g, '<br />');\n    }\n    // Given a hash of CSS properties, returns a string of CSS.\n    // Uses property names as-is (no camel-case conversion). Will not make statements for null/undefined values.\n    function cssToStr(cssProps) {\n        var statements = [];\n        for (var name_1 in cssProps) {\n            var val = cssProps[name_1];\n            if (val != null && val !== '') {\n                statements.push(name_1 + ':' + val);\n            }\n        }\n        return statements.join(';');\n    }\n    // Given an object hash of HTML attribute names to values,\n    // generates a string that can be injected between < > in HTML\n    function attrsToStr(attrs) {\n        var parts = [];\n        for (var name_2 in attrs) {\n            var val = attrs[name_2];\n            if (val != null) {\n                parts.push(name_2 + '=\"' + htmlEscape(val) + '\"');\n            }\n        }\n        return parts.join(' ');\n    }\n    function parseClassName(raw) {\n        if (Array.isArray(raw)) {\n            return raw;\n        }\n        else if (typeof raw === 'string') {\n            return raw.split(/\\s+/);\n        }\n        else {\n            return [];\n        }\n    }\n\n    var UNSCOPED_EVENT_UI_PROPS = {\n        editable: Boolean,\n        startEditable: Boolean,\n        durationEditable: Boolean,\n        constraint: null,\n        overlap: null,\n        allow: null,\n        className: parseClassName,\n        classNames: parseClassName,\n        color: String,\n        backgroundColor: String,\n        borderColor: String,\n        textColor: String\n    };\n    function processUnscopedUiProps(rawProps, calendar, leftovers) {\n        var props = refineProps(rawProps, UNSCOPED_EVENT_UI_PROPS, {}, leftovers);\n        var constraint = normalizeConstraint(props.constraint, calendar);\n        return {\n            startEditable: props.startEditable != null ? props.startEditable : props.editable,\n            durationEditable: props.durationEditable != null ? props.durationEditable : props.editable,\n            constraints: constraint != null ? [constraint] : [],\n            overlap: props.overlap,\n            allows: props.allow != null ? [props.allow] : [],\n            backgroundColor: props.backgroundColor || props.color,\n            borderColor: props.borderColor || props.color,\n            textColor: props.textColor,\n            classNames: props.classNames.concat(props.className)\n        };\n    }\n    function processScopedUiProps(prefix, rawScoped, calendar, leftovers) {\n        var rawUnscoped = {};\n        var wasFound = {};\n        for (var key in UNSCOPED_EVENT_UI_PROPS) {\n            var scopedKey = prefix + capitaliseFirstLetter(key);\n            rawUnscoped[key] = rawScoped[scopedKey];\n            wasFound[scopedKey] = true;\n        }\n        if (prefix === 'event') {\n            rawUnscoped.editable = rawScoped.editable; // special case. there is no 'eventEditable', just 'editable'\n        }\n        if (leftovers) {\n            for (var key in rawScoped) {\n                if (!wasFound[key]) {\n                    leftovers[key] = rawScoped[key];\n                }\n            }\n        }\n        return processUnscopedUiProps(rawUnscoped, calendar);\n    }\n    var EMPTY_EVENT_UI = {\n        startEditable: null,\n        durationEditable: null,\n        constraints: [],\n        overlap: null,\n        allows: [],\n        backgroundColor: '',\n        borderColor: '',\n        textColor: '',\n        classNames: []\n    };\n    // prevent against problems with <2 args!\n    function combineEventUis(uis) {\n        return uis.reduce(combineTwoEventUis, EMPTY_EVENT_UI);\n    }\n    function combineTwoEventUis(item0, item1) {\n        return {\n            startEditable: item1.startEditable != null ? item1.startEditable : item0.startEditable,\n            durationEditable: item1.durationEditable != null ? item1.durationEditable : item0.durationEditable,\n            constraints: item0.constraints.concat(item1.constraints),\n            overlap: typeof item1.overlap === 'boolean' ? item1.overlap : item0.overlap,\n            allows: item0.allows.concat(item1.allows),\n            backgroundColor: item1.backgroundColor || item0.backgroundColor,\n            borderColor: item1.borderColor || item0.borderColor,\n            textColor: item1.textColor || item0.textColor,\n            classNames: item0.classNames.concat(item1.classNames)\n        };\n    }\n\n    var NON_DATE_PROPS = {\n        id: String,\n        groupId: String,\n        title: String,\n        url: String,\n        rendering: String,\n        extendedProps: null\n    };\n    var DATE_PROPS = {\n        start: null,\n        date: null,\n        end: null,\n        allDay: null\n    };\n    var uid = 0;\n    function parseEvent(raw, sourceId, calendar, allowOpenRange) {\n        var allDayDefault = computeIsAllDayDefault(sourceId, calendar);\n        var leftovers0 = {};\n        var recurringRes = parseRecurring(raw, // raw, but with single-event stuff stripped out\n        allDayDefault, calendar.dateEnv, calendar.pluginSystem.hooks.recurringTypes, leftovers0 // will populate with non-recurring props\n        );\n        if (recurringRes) {\n            var def = parseEventDef(leftovers0, sourceId, recurringRes.allDay, Boolean(recurringRes.duration), calendar);\n            def.recurringDef = {\n                typeId: recurringRes.typeId,\n                typeData: recurringRes.typeData,\n                duration: recurringRes.duration\n            };\n            return { def: def, instance: null };\n        }\n        else {\n            var leftovers1 = {};\n            var singleRes = parseSingle(raw, allDayDefault, calendar, leftovers1, allowOpenRange);\n            if (singleRes) {\n                var def = parseEventDef(leftovers1, sourceId, singleRes.allDay, singleRes.hasEnd, calendar);\n                var instance = createEventInstance(def.defId, singleRes.range, singleRes.forcedStartTzo, singleRes.forcedEndTzo);\n                return { def: def, instance: instance };\n            }\n        }\n        return null;\n    }\n    /*\n    Will NOT populate extendedProps with the leftover properties.\n    Will NOT populate date-related props.\n    The EventNonDateInput has been normalized (id => publicId, etc).\n    */\n    function parseEventDef(raw, sourceId, allDay, hasEnd, calendar) {\n        var leftovers = {};\n        var def = pluckNonDateProps(raw, calendar, leftovers);\n        def.defId = String(uid++);\n        def.sourceId = sourceId;\n        def.allDay = allDay;\n        def.hasEnd = hasEnd;\n        for (var _i = 0, _a = calendar.pluginSystem.hooks.eventDefParsers; _i < _a.length; _i++) {\n            var eventDefParser = _a[_i];\n            var newLeftovers = {};\n            eventDefParser(def, leftovers, newLeftovers);\n            leftovers = newLeftovers;\n        }\n        def.extendedProps = __assign(leftovers, def.extendedProps || {});\n        // help out EventApi from having user modify props\n        Object.freeze(def.ui.classNames);\n        Object.freeze(def.extendedProps);\n        return def;\n    }\n    function createEventInstance(defId, range, forcedStartTzo, forcedEndTzo) {\n        return {\n            instanceId: String(uid++),\n            defId: defId,\n            range: range,\n            forcedStartTzo: forcedStartTzo == null ? null : forcedStartTzo,\n            forcedEndTzo: forcedEndTzo == null ? null : forcedEndTzo\n        };\n    }\n    function parseSingle(raw, allDayDefault, calendar, leftovers, allowOpenRange) {\n        var props = pluckDateProps(raw, leftovers);\n        var allDay = props.allDay;\n        var startMeta;\n        var startMarker = null;\n        var hasEnd = false;\n        var endMeta;\n        var endMarker = null;\n        startMeta = calendar.dateEnv.createMarkerMeta(props.start);\n        if (startMeta) {\n            startMarker = startMeta.marker;\n        }\n        else if (!allowOpenRange) {\n            return null;\n        }\n        if (props.end != null) {\n            endMeta = calendar.dateEnv.createMarkerMeta(props.end);\n        }\n        if (allDay == null) {\n            if (allDayDefault != null) {\n                allDay = allDayDefault;\n            }\n            else {\n                // fall back to the date props LAST\n                allDay = (!startMeta || startMeta.isTimeUnspecified) &&\n                    (!endMeta || endMeta.isTimeUnspecified);\n            }\n        }\n        if (allDay && startMarker) {\n            startMarker = startOfDay(startMarker);\n        }\n        if (endMeta) {\n            endMarker = endMeta.marker;\n            if (allDay) {\n                endMarker = startOfDay(endMarker);\n            }\n            if (startMarker && endMarker <= startMarker) {\n                endMarker = null;\n            }\n        }\n        if (endMarker) {\n            hasEnd = true;\n        }\n        else if (!allowOpenRange) {\n            hasEnd = calendar.opt('forceEventDuration') || false;\n            endMarker = calendar.dateEnv.add(startMarker, allDay ?\n                calendar.defaultAllDayEventDuration :\n                calendar.defaultTimedEventDuration);\n        }\n        return {\n            allDay: allDay,\n            hasEnd: hasEnd,\n            range: { start: startMarker, end: endMarker },\n            forcedStartTzo: startMeta ? startMeta.forcedTzo : null,\n            forcedEndTzo: endMeta ? endMeta.forcedTzo : null\n        };\n    }\n    function pluckDateProps(raw, leftovers) {\n        var props = refineProps(raw, DATE_PROPS, {}, leftovers);\n        props.start = (props.start !== null) ? props.start : props.date;\n        delete props.date;\n        return props;\n    }\n    function pluckNonDateProps(raw, calendar, leftovers) {\n        var preLeftovers = {};\n        var props = refineProps(raw, NON_DATE_PROPS, {}, preLeftovers);\n        var ui = processUnscopedUiProps(preLeftovers, calendar, leftovers);\n        props.publicId = props.id;\n        delete props.id;\n        props.ui = ui;\n        return props;\n    }\n    function computeIsAllDayDefault(sourceId, calendar) {\n        var res = null;\n        if (sourceId) {\n            var source = calendar.state.eventSources[sourceId];\n            res = source.allDayDefault;\n        }\n        if (res == null) {\n            res = calendar.opt('allDayDefault');\n        }\n        return res;\n    }\n\n    var DEF_DEFAULTS = {\n        startTime: '09:00',\n        endTime: '17:00',\n        daysOfWeek: [1, 2, 3, 4, 5],\n        rendering: 'inverse-background',\n        classNames: 'fc-nonbusiness',\n        groupId: '_businessHours' // so multiple defs get grouped\n    };\n    /*\n    TODO: pass around as EventDefHash!!!\n    */\n    function parseBusinessHours(input, calendar) {\n        return parseEvents(refineInputs(input), '', calendar);\n    }\n    function refineInputs(input) {\n        var rawDefs;\n        if (input === true) {\n            rawDefs = [{}]; // will get DEF_DEFAULTS verbatim\n        }\n        else if (Array.isArray(input)) {\n            // if specifying an array, every sub-definition NEEDS a day-of-week\n            rawDefs = input.filter(function (rawDef) {\n                return rawDef.daysOfWeek;\n            });\n        }\n        else if (typeof input === 'object' && input) { // non-null object\n            rawDefs = [input];\n        }\n        else { // is probably false\n            rawDefs = [];\n        }\n        rawDefs = rawDefs.map(function (rawDef) {\n            return __assign({}, DEF_DEFAULTS, rawDef);\n        });\n        return rawDefs;\n    }\n\n    function memoizeRendering(renderFunc, unrenderFunc, dependencies) {\n        if (dependencies === void 0) { dependencies = []; }\n        var dependents = [];\n        var thisContext;\n        var prevArgs;\n        function unrender() {\n            if (prevArgs) {\n                for (var _i = 0, dependents_1 = dependents; _i < dependents_1.length; _i++) {\n                    var dependent = dependents_1[_i];\n                    dependent.unrender();\n                }\n                if (unrenderFunc) {\n                    unrenderFunc.apply(thisContext, prevArgs);\n                }\n                prevArgs = null;\n            }\n        }\n        function res() {\n            if (!prevArgs || !isArraysEqual(prevArgs, arguments)) {\n                unrender();\n                thisContext = this;\n                prevArgs = arguments;\n                renderFunc.apply(this, arguments);\n            }\n        }\n        res.dependents = dependents;\n        res.unrender = unrender;\n        for (var _i = 0, dependencies_1 = dependencies; _i < dependencies_1.length; _i++) {\n            var dependency = dependencies_1[_i];\n            dependency.dependents.push(res);\n        }\n        return res;\n    }\n\n    var EMPTY_EVENT_STORE = createEmptyEventStore(); // for purecomponents. TODO: keep elsewhere\n    var Splitter = /** @class */ (function () {\n        function Splitter() {\n            this.getKeysForEventDefs = memoize(this._getKeysForEventDefs);\n            this.splitDateSelection = memoize(this._splitDateSpan);\n            this.splitEventStore = memoize(this._splitEventStore);\n            this.splitIndividualUi = memoize(this._splitIndividualUi);\n            this.splitEventDrag = memoize(this._splitInteraction);\n            this.splitEventResize = memoize(this._splitInteraction);\n            this.eventUiBuilders = {}; // TODO: typescript protection\n        }\n        Splitter.prototype.splitProps = function (props) {\n            var _this = this;\n            var keyInfos = this.getKeyInfo(props);\n            var defKeys = this.getKeysForEventDefs(props.eventStore);\n            var dateSelections = this.splitDateSelection(props.dateSelection);\n            var individualUi = this.splitIndividualUi(props.eventUiBases, defKeys); // the individual *bases*\n            var eventStores = this.splitEventStore(props.eventStore, defKeys);\n            var eventDrags = this.splitEventDrag(props.eventDrag);\n            var eventResizes = this.splitEventResize(props.eventResize);\n            var splitProps = {};\n            this.eventUiBuilders = mapHash(keyInfos, function (info, key) {\n                return _this.eventUiBuilders[key] || memoize(buildEventUiForKey);\n            });\n            for (var key in keyInfos) {\n                var keyInfo = keyInfos[key];\n                var eventStore = eventStores[key] || EMPTY_EVENT_STORE;\n                var buildEventUi = this.eventUiBuilders[key];\n                splitProps[key] = {\n                    businessHours: keyInfo.businessHours || props.businessHours,\n                    dateSelection: dateSelections[key] || null,\n                    eventStore: eventStore,\n                    eventUiBases: buildEventUi(props.eventUiBases[''], keyInfo.ui, individualUi[key]),\n                    eventSelection: eventStore.instances[props.eventSelection] ? props.eventSelection : '',\n                    eventDrag: eventDrags[key] || null,\n                    eventResize: eventResizes[key] || null\n                };\n            }\n            return splitProps;\n        };\n        Splitter.prototype._splitDateSpan = function (dateSpan) {\n            var dateSpans = {};\n            if (dateSpan) {\n                var keys = this.getKeysForDateSpan(dateSpan);\n                for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n                    var key = keys_1[_i];\n                    dateSpans[key] = dateSpan;\n                }\n            }\n            return dateSpans;\n        };\n        Splitter.prototype._getKeysForEventDefs = function (eventStore) {\n            var _this = this;\n            return mapHash(eventStore.defs, function (eventDef) {\n                return _this.getKeysForEventDef(eventDef);\n            });\n        };\n        Splitter.prototype._splitEventStore = function (eventStore, defKeys) {\n            var defs = eventStore.defs, instances = eventStore.instances;\n            var splitStores = {};\n            for (var defId in defs) {\n                for (var _i = 0, _a = defKeys[defId]; _i < _a.length; _i++) {\n                    var key = _a[_i];\n                    if (!splitStores[key]) {\n                        splitStores[key] = createEmptyEventStore();\n                    }\n                    splitStores[key].defs[defId] = defs[defId];\n                }\n            }\n            for (var instanceId in instances) {\n                var instance = instances[instanceId];\n                for (var _b = 0, _c = defKeys[instance.defId]; _b < _c.length; _b++) {\n                    var key = _c[_b];\n                    if (splitStores[key]) { // must have already been created\n                        splitStores[key].instances[instanceId] = instance;\n                    }\n                }\n            }\n            return splitStores;\n        };\n        Splitter.prototype._splitIndividualUi = function (eventUiBases, defKeys) {\n            var splitHashes = {};\n            for (var defId in eventUiBases) {\n                if (defId) { // not the '' key\n                    for (var _i = 0, _a = defKeys[defId]; _i < _a.length; _i++) {\n                        var key = _a[_i];\n                        if (!splitHashes[key]) {\n                            splitHashes[key] = {};\n                        }\n                        splitHashes[key][defId] = eventUiBases[defId];\n                    }\n                }\n            }\n            return splitHashes;\n        };\n        Splitter.prototype._splitInteraction = function (interaction) {\n            var splitStates = {};\n            if (interaction) {\n                var affectedStores_1 = this._splitEventStore(interaction.affectedEvents, this._getKeysForEventDefs(interaction.affectedEvents) // can't use cached. might be events from other calendar\n                );\n                // can't rely on defKeys because event data is mutated\n                var mutatedKeysByDefId = this._getKeysForEventDefs(interaction.mutatedEvents);\n                var mutatedStores_1 = this._splitEventStore(interaction.mutatedEvents, mutatedKeysByDefId);\n                var populate = function (key) {\n                    if (!splitStates[key]) {\n                        splitStates[key] = {\n                            affectedEvents: affectedStores_1[key] || EMPTY_EVENT_STORE,\n                            mutatedEvents: mutatedStores_1[key] || EMPTY_EVENT_STORE,\n                            isEvent: interaction.isEvent,\n                            origSeg: interaction.origSeg\n                        };\n                    }\n                };\n                for (var key in affectedStores_1) {\n                    populate(key);\n                }\n                for (var key in mutatedStores_1) {\n                    populate(key);\n                }\n            }\n            return splitStates;\n        };\n        return Splitter;\n    }());\n    function buildEventUiForKey(allUi, eventUiForKey, individualUi) {\n        var baseParts = [];\n        if (allUi) {\n            baseParts.push(allUi);\n        }\n        if (eventUiForKey) {\n            baseParts.push(eventUiForKey);\n        }\n        var stuff = {\n            '': combineEventUis(baseParts)\n        };\n        if (individualUi) {\n            __assign(stuff, individualUi);\n        }\n        return stuff;\n    }\n\n    // Generates HTML for an anchor to another view into the calendar.\n    // Will either generate an <a> tag or a non-clickable <span> tag, depending on enabled settings.\n    // `gotoOptions` can either be a DateMarker, or an object with the form:\n    // { date, type, forceOff }\n    // `type` is a view-type like \"day\" or \"week\". default value is \"day\".\n    // `attrs` and `innerHtml` are use to generate the rest of the HTML tag.\n    function buildGotoAnchorHtml(component, gotoOptions, attrs, innerHtml) {\n        var dateEnv = component.dateEnv;\n        var date;\n        var type;\n        var forceOff;\n        var finalOptions;\n        if (gotoOptions instanceof Date) {\n            date = gotoOptions; // a single date-like input\n        }\n        else {\n            date = gotoOptions.date;\n            type = gotoOptions.type;\n            forceOff = gotoOptions.forceOff;\n        }\n        finalOptions = {\n            date: dateEnv.formatIso(date, { omitTime: true }),\n            type: type || 'day'\n        };\n        if (typeof attrs === 'string') {\n            innerHtml = attrs;\n            attrs = null;\n        }\n        attrs = attrs ? ' ' + attrsToStr(attrs) : ''; // will have a leading space\n        innerHtml = innerHtml || '';\n        if (!forceOff && component.opt('navLinks')) {\n            return '<a' + attrs +\n                ' data-goto=\"' + htmlEscape(JSON.stringify(finalOptions)) + '\">' +\n                innerHtml +\n                '</a>';\n        }\n        else {\n            return '<span' + attrs + '>' +\n                innerHtml +\n                '</span>';\n        }\n    }\n    function getAllDayHtml(component) {\n        return component.opt('allDayHtml') || htmlEscape(component.opt('allDayText'));\n    }\n    // Computes HTML classNames for a single-day element\n    function getDayClasses(date, dateProfile, context, noThemeHighlight) {\n        var calendar = context.calendar, view = context.view, theme = context.theme, dateEnv = context.dateEnv;\n        var classes = [];\n        var todayStart;\n        var todayEnd;\n        if (!rangeContainsMarker(dateProfile.activeRange, date)) {\n            classes.push('fc-disabled-day');\n        }\n        else {\n            classes.push('fc-' + DAY_IDS[date.getUTCDay()]);\n            if (view.opt('monthMode') &&\n                dateEnv.getMonth(date) !== dateEnv.getMonth(dateProfile.currentRange.start)) {\n                classes.push('fc-other-month');\n            }\n            todayStart = startOfDay(calendar.getNow());\n            todayEnd = addDays(todayStart, 1);\n            if (date < todayStart) {\n                classes.push('fc-past');\n            }\n            else if (date >= todayEnd) {\n                classes.push('fc-future');\n            }\n            else {\n                classes.push('fc-today');\n                if (noThemeHighlight !== true) {\n                    classes.push(theme.getClass('today'));\n                }\n            }\n        }\n        return classes;\n    }\n\n    // given a function that resolves a result asynchronously.\n    // the function can either call passed-in success and failure callbacks,\n    // or it can return a promise.\n    // if you need to pass additional params to func, bind them first.\n    function unpromisify(func, success, failure) {\n        // guard against success/failure callbacks being called more than once\n        // and guard against a promise AND callback being used together.\n        var isResolved = false;\n        var wrappedSuccess = function () {\n            if (!isResolved) {\n                isResolved = true;\n                success.apply(this, arguments);\n            }\n        };\n        var wrappedFailure = function () {\n            if (!isResolved) {\n                isResolved = true;\n                if (failure) {\n                    failure.apply(this, arguments);\n                }\n            }\n        };\n        var res = func(wrappedSuccess, wrappedFailure);\n        if (res && typeof res.then === 'function') {\n            res.then(wrappedSuccess, wrappedFailure);\n        }\n    }\n\n    var Mixin = /** @class */ (function () {\n        function Mixin() {\n        }\n        // mix into a CLASS\n        Mixin.mixInto = function (destClass) {\n            this.mixIntoObj(destClass.prototype);\n        };\n        // mix into ANY object\n        Mixin.mixIntoObj = function (destObj) {\n            var _this = this;\n            Object.getOwnPropertyNames(this.prototype).forEach(function (name) {\n                if (!destObj[name]) { // if destination doesn't already define it\n                    destObj[name] = _this.prototype[name];\n                }\n            });\n        };\n        /*\n        will override existing methods\n        TODO: remove! not used anymore\n        */\n        Mixin.mixOver = function (destClass) {\n            var _this = this;\n            Object.getOwnPropertyNames(this.prototype).forEach(function (name) {\n                destClass.prototype[name] = _this.prototype[name];\n            });\n        };\n        return Mixin;\n    }());\n\n    /*\n    USAGE:\n      import { default as EmitterMixin, EmitterInterface } from './EmitterMixin'\n    in class:\n      on: EmitterInterface['on']\n      one: EmitterInterface['one']\n      off: EmitterInterface['off']\n      trigger: EmitterInterface['trigger']\n      triggerWith: EmitterInterface['triggerWith']\n      hasHandlers: EmitterInterface['hasHandlers']\n    after class:\n      EmitterMixin.mixInto(TheClass)\n    */\n    var EmitterMixin = /** @class */ (function (_super) {\n        __extends(EmitterMixin, _super);\n        function EmitterMixin() {\n            return _super !== null && _super.apply(this, arguments) || this;\n        }\n        EmitterMixin.prototype.on = function (type, handler) {\n            addToHash(this._handlers || (this._handlers = {}), type, handler);\n            return this; // for chaining\n        };\n        // todo: add comments\n        EmitterMixin.prototype.one = function (type, handler) {\n            addToHash(this._oneHandlers || (this._oneHandlers = {}), type, handler);\n            return this; // for chaining\n        };\n        EmitterMixin.prototype.off = function (type, handler) {\n            if (this._handlers) {\n                removeFromHash(this._handlers, type, handler);\n            }\n            if (this._oneHandlers) {\n                removeFromHash(this._oneHandlers, type, handler);\n            }\n            return this; // for chaining\n        };\n        EmitterMixin.prototype.trigger = function (type) {\n            var args = [];\n            for (var _i = 1; _i < arguments.length; _i++) {\n                args[_i - 1] = arguments[_i];\n            }\n            this.triggerWith(type, this, args);\n            return this; // for chaining\n        };\n        EmitterMixin.prototype.triggerWith = function (type, context, args) {\n            if (this._handlers) {\n                applyAll(this._handlers[type], context, args);\n            }\n            if (this._oneHandlers) {\n                applyAll(this._oneHandlers[type], context, args);\n                delete this._oneHandlers[type]; // will never fire again\n            }\n            return this; // for chaining\n        };\n        EmitterMixin.prototype.hasHandlers = function (type) {\n            return (this._handlers && this._handlers[type] && this._handlers[type].length) ||\n                (this._oneHandlers && this._oneHandlers[type] && this._oneHandlers[type].length);\n        };\n        return EmitterMixin;\n    }(Mixin));\n    function addToHash(hash, type, handler) {\n        (hash[type] || (hash[type] = []))\n            .push(handler);\n    }\n    function removeFromHash(hash, type, handler) {\n        if (handler) {\n            if (hash[type]) {\n                hash[type] = hash[type].filter(function (func) {\n                    return func !== handler;\n                });\n            }\n        }\n        else {\n            delete hash[type]; // remove all handler funcs for this type\n        }\n    }\n\n    /*\n    Records offset information for a set of elements, relative to an origin element.\n    Can record the left/right OR the top/bottom OR both.\n    Provides methods for querying the cache by position.\n    */\n    var PositionCache = /** @class */ (function () {\n        function PositionCache(originEl, els, isHorizontal, isVertical) {\n            this.originEl = originEl;\n            this.els = els;\n            this.isHorizontal = isHorizontal;\n            this.isVertical = isVertical;\n        }\n        // Queries the els for coordinates and stores them.\n        // Call this method before using and of the get* methods below.\n        PositionCache.prototype.build = function () {\n            var originEl = this.originEl;\n            var originClientRect = this.originClientRect =\n                originEl.getBoundingClientRect(); // relative to viewport top-left\n            if (this.isHorizontal) {\n                this.buildElHorizontals(originClientRect.left);\n            }\n            if (this.isVertical) {\n                this.buildElVerticals(originClientRect.top);\n            }\n        };\n        // Populates the left/right internal coordinate arrays\n        PositionCache.prototype.buildElHorizontals = function (originClientLeft) {\n            var lefts = [];\n            var rights = [];\n            for (var _i = 0, _a = this.els; _i < _a.length; _i++) {\n                var el = _a[_i];\n                var rect = el.getBoundingClientRect();\n                lefts.push(rect.left - originClientLeft);\n                rights.push(rect.right - originClientLeft);\n            }\n            this.lefts = lefts;\n            this.rights = rights;\n        };\n        // Populates the top/bottom internal coordinate arrays\n        PositionCache.prototype.buildElVerticals = function (originClientTop) {\n            var tops = [];\n            var bottoms = [];\n            for (var _i = 0, _a = this.els; _i < _a.length; _i++) {\n                var el = _a[_i];\n                var rect = el.getBoundingClientRect();\n                tops.push(rect.top - originClientTop);\n                bottoms.push(rect.bottom - originClientTop);\n            }\n            this.tops = tops;\n            this.bottoms = bottoms;\n        };\n        // Given a left offset (from document left), returns the index of the el that it horizontally intersects.\n        // If no intersection is made, returns undefined.\n        PositionCache.prototype.leftToIndex = function (leftPosition) {\n            var lefts = this.lefts;\n            var rights = this.rights;\n            var len = lefts.length;\n            var i;\n            for (i = 0; i < len; i++) {\n                if (leftPosition >= lefts[i] && leftPosition < rights[i]) {\n                    return i;\n                }\n            }\n        };\n        // Given a top offset (from document top), returns the index of the el that it vertically intersects.\n        // If no intersection is made, returns undefined.\n        PositionCache.prototype.topToIndex = function (topPosition) {\n            var tops = this.tops;\n            var bottoms = this.bottoms;\n            var len = tops.length;\n            var i;\n            for (i = 0; i < len; i++) {\n                if (topPosition >= tops[i] && topPosition < bottoms[i]) {\n                    return i;\n                }\n            }\n        };\n        // Gets the width of the element at the given index\n        PositionCache.prototype.getWidth = function (leftIndex) {\n            return this.rights[leftIndex] - this.lefts[leftIndex];\n        };\n        // Gets the height of the element at the given index\n        PositionCache.prototype.getHeight = function (topIndex) {\n            return this.bottoms[topIndex] - this.tops[topIndex];\n        };\n        return PositionCache;\n    }());\n\n    /*\n    An object for getting/setting scroll-related information for an element.\n    Internally, this is done very differently for window versus DOM element,\n    so this object serves as a common interface.\n    */\n    var ScrollController = /** @class */ (function () {\n        function ScrollController() {\n        }\n        ScrollController.prototype.getMaxScrollTop = function () {\n            return this.getScrollHeight() - this.getClientHeight();\n        };\n        ScrollController.prototype.getMaxScrollLeft = function () {\n            return this.getScrollWidth() - this.getClientWidth();\n        };\n        ScrollController.prototype.canScrollVertically = function () {\n            return this.getMaxScrollTop() > 0;\n        };\n        ScrollController.prototype.canScrollHorizontally = function () {\n            return this.getMaxScrollLeft() > 0;\n        };\n        ScrollController.prototype.canScrollUp = function () {\n            return this.getScrollTop() > 0;\n        };\n        ScrollController.prototype.canScrollDown = function () {\n            return this.getScrollTop() < this.getMaxScrollTop();\n        };\n        ScrollController.prototype.canScrollLeft = function () {\n            return this.getScrollLeft() > 0;\n        };\n        ScrollController.prototype.canScrollRight = function () {\n            return this.getScrollLeft() < this.getMaxScrollLeft();\n        };\n        return ScrollController;\n    }());\n    var ElementScrollController = /** @class */ (function (_super) {\n        __extends(ElementScrollController, _super);\n        function ElementScrollController(el) {\n            var _this = _super.call(this) || this;\n            _this.el = el;\n            return _this;\n        }\n        ElementScrollController.prototype.getScrollTop = function () {\n            return this.el.scrollTop;\n        };\n        ElementScrollController.prototype.getScrollLeft = function () {\n            return this.el.scrollLeft;\n        };\n        ElementScrollController.prototype.setScrollTop = function (top) {\n            this.el.scrollTop = top;\n        };\n        ElementScrollController.prototype.setScrollLeft = function (left) {\n            this.el.scrollLeft = left;\n        };\n        ElementScrollController.prototype.getScrollWidth = function () {\n            return this.el.scrollWidth;\n        };\n        ElementScrollController.prototype.getScrollHeight = function () {\n            return this.el.scrollHeight;\n        };\n        ElementScrollController.prototype.getClientHeight = function () {\n            return this.el.clientHeight;\n        };\n        ElementScrollController.prototype.getClientWidth = function () {\n            return this.el.clientWidth;\n        };\n        return ElementScrollController;\n    }(ScrollController));\n    var WindowScrollController = /** @class */ (function (_super) {\n        __extends(WindowScrollController, _super);\n        function WindowScrollController() {\n            return _super !== null && _super.apply(this, arguments) || this;\n        }\n        WindowScrollController.prototype.getScrollTop = function () {\n            return window.pageYOffset;\n        };\n        WindowScrollController.prototype.getScrollLeft = function () {\n            return window.pageXOffset;\n        };\n        WindowScrollController.prototype.setScrollTop = function (n) {\n            window.scroll(window.pageXOffset, n);\n        };\n        WindowScrollController.prototype.setScrollLeft = function (n) {\n            window.scroll(n, window.pageYOffset);\n        };\n        WindowScrollController.prototype.getScrollWidth = function () {\n            return document.documentElement.scrollWidth;\n        };\n        WindowScrollController.prototype.getScrollHeight = function () {\n            return document.documentElement.scrollHeight;\n        };\n        WindowScrollController.prototype.getClientHeight = function () {\n            return document.documentElement.clientHeight;\n        };\n        WindowScrollController.prototype.getClientWidth = function () {\n            return document.documentElement.clientWidth;\n        };\n        return WindowScrollController;\n    }(ScrollController));\n\n    /*\n    Embodies a div that has potential scrollbars\n    */\n    var ScrollComponent = /** @class */ (function (_super) {\n        __extends(ScrollComponent, _super);\n        function ScrollComponent(overflowX, overflowY) {\n            var _this = _super.call(this, createElement('div', {\n                className: 'fc-scroller'\n            })) || this;\n            _this.overflowX = overflowX;\n            _this.overflowY = overflowY;\n            _this.applyOverflow();\n            return _this;\n        }\n        // sets to natural height, unlocks overflow\n        ScrollComponent.prototype.clear = function () {\n            this.setHeight('auto');\n            this.applyOverflow();\n        };\n        ScrollComponent.prototype.destroy = function () {\n            removeElement(this.el);\n        };\n        // Overflow\n        // -----------------------------------------------------------------------------------------------------------------\n        ScrollComponent.prototype.applyOverflow = function () {\n            applyStyle(this.el, {\n                overflowX: this.overflowX,\n                overflowY: this.overflowY\n            });\n        };\n        // Causes any 'auto' overflow values to resolves to 'scroll' or 'hidden'.\n        // Useful for preserving scrollbar widths regardless of future resizes.\n        // Can pass in scrollbarWidths for optimization.\n        ScrollComponent.prototype.lockOverflow = function (scrollbarWidths) {\n            var overflowX = this.overflowX;\n            var overflowY = this.overflowY;\n            scrollbarWidths = scrollbarWidths || this.getScrollbarWidths();\n            if (overflowX === 'auto') {\n                overflowX = (scrollbarWidths.bottom || // horizontal scrollbars?\n                    this.canScrollHorizontally() // OR scrolling pane with massless scrollbars?\n                ) ? 'scroll' : 'hidden';\n            }\n            if (overflowY === 'auto') {\n                overflowY = (scrollbarWidths.left || scrollbarWidths.right || // horizontal scrollbars?\n                    this.canScrollVertically() // OR scrolling pane with massless scrollbars?\n                ) ? 'scroll' : 'hidden';\n            }\n            applyStyle(this.el, { overflowX: overflowX, overflowY: overflowY });\n        };\n        ScrollComponent.prototype.setHeight = function (height) {\n            applyStyleProp(this.el, 'height', height);\n        };\n        ScrollComponent.prototype.getScrollbarWidths = function () {\n            var edges = computeEdges(this.el);\n            return {\n                left: edges.scrollbarLeft,\n                right: edges.scrollbarRight,\n                bottom: edges.scrollbarBottom\n            };\n        };\n        return ScrollComponent;\n    }(ElementScrollController));\n\n    var Theme = /** @class */ (function () {\n        function Theme(calendarOptions) {\n            this.calendarOptions = calendarOptions;\n            this.processIconOverride();\n        }\n        Theme.prototype.processIconOverride = function () {\n            if (this.iconOverrideOption) {\n                this.setIconOverride(this.calendarOptions[this.iconOverrideOption]);\n            }\n        };\n        Theme.prototype.setIconOverride = function (iconOverrideHash) {\n            var iconClassesCopy;\n            var buttonName;\n            if (typeof iconOverrideHash === 'object' && iconOverrideHash) { // non-null object\n                iconClassesCopy = __assign({}, this.iconClasses);\n                for (buttonName in iconOverrideHash) {\n                    iconClassesCopy[buttonName] = this.applyIconOverridePrefix(iconOverrideHash[buttonName]);\n                }\n                this.iconClasses = iconClassesCopy;\n            }\n            else if (iconOverrideHash === false) {\n                this.iconClasses = {};\n            }\n        };\n        Theme.prototype.applyIconOverridePrefix = function (className) {\n            var prefix = this.iconOverridePrefix;\n            if (prefix && className.indexOf(prefix) !== 0) { // if not already present\n                className = prefix + className;\n            }\n            return className;\n        };\n        Theme.prototype.getClass = function (key) {\n            return this.classes[key] || '';\n        };\n        Theme.prototype.getIconClass = function (buttonName) {\n            var className = this.iconClasses[buttonName];\n            if (className) {\n                return this.baseIconClass + ' ' + className;\n            }\n            return '';\n        };\n        Theme.prototype.getCustomButtonIconClass = function (customButtonProps) {\n            var className;\n            if (this.iconOverrideCustomButtonOption) {\n                className = customButtonProps[this.iconOverrideCustomButtonOption];\n                if (className) {\n                    return this.baseIconClass + ' ' + this.applyIconOverridePrefix(className);\n                }\n            }\n            return '';\n        };\n        return Theme;\n    }());\n    Theme.prototype.classes = {};\n    Theme.prototype.iconClasses = {};\n    Theme.prototype.baseIconClass = '';\n    Theme.prototype.iconOverridePrefix = '';\n\n    var guid = 0;\n    var Component = /** @class */ (function () {\n        function Component(context, isView) {\n            // HACK to populate view at top of component instantiation call chain\n            if (isView) {\n                context.view = this;\n            }\n            this.uid = String(guid++);\n            this.context = context;\n            this.dateEnv = context.dateEnv;\n            this.theme = context.theme;\n            this.view = context.view;\n            this.calendar = context.calendar;\n            this.isRtl = this.opt('dir') === 'rtl';\n        }\n        Component.addEqualityFuncs = function (newFuncs) {\n            this.prototype.equalityFuncs = __assign({}, this.prototype.equalityFuncs, newFuncs);\n        };\n        Component.prototype.opt = function (name) {\n            return this.context.options[name];\n        };\n        Component.prototype.receiveProps = function (props) {\n            var _a = recycleProps(this.props || {}, props, this.equalityFuncs), anyChanges = _a.anyChanges, comboProps = _a.comboProps;\n            this.props = comboProps;\n            if (anyChanges) {\n                this.render(comboProps);\n            }\n        };\n        Component.prototype.render = function (props) {\n        };\n        // after destroy is called, this component won't ever be used again\n        Component.prototype.destroy = function () {\n        };\n        return Component;\n    }());\n    Component.prototype.equalityFuncs = {};\n    /*\n    Reuses old values when equal. If anything is unequal, returns newProps as-is.\n    Great for PureComponent, but won't be feasible with React, so just eliminate and use React's DOM diffing.\n    */\n    function recycleProps(oldProps, newProps, equalityFuncs) {\n        var comboProps = {}; // some old, some new\n        var anyChanges = false;\n        for (var key in newProps) {\n            if (key in oldProps && (oldProps[key] === newProps[key] ||\n                (equalityFuncs[key] && equalityFuncs[key](oldProps[key], newProps[key])))) {\n                // equal to old? use old prop\n                comboProps[key] = oldProps[key];\n            }\n            else {\n                comboProps[key] = newProps[key];\n                anyChanges = true;\n            }\n        }\n        for (var key in oldProps) {\n            if (!(key in newProps)) {\n                anyChanges = true;\n                break;\n            }\n        }\n        return { anyChanges: anyChanges, comboProps: comboProps };\n    }\n\n    /*\n    PURPOSES:\n    - hook up to fg, fill, and mirror renderers\n    - interface for dragging and hits\n    */\n    var DateComponent = /** @class */ (function (_super) {\n        __extends(DateComponent, _super);\n        function DateComponent(context, el, isView) {\n            var _this = _super.call(this, context, isView) || this;\n            _this.el = el;\n            return _this;\n        }\n        DateComponent.prototype.destroy = function () {\n            _super.prototype.destroy.call(this);\n            removeElement(this.el);\n        };\n        // TODO: WHAT ABOUT (sourceSeg && sourceSeg.component.doesDragMirror)\n        //\n        // Event Drag-n-Drop Rendering (for both events and external elements)\n        // ---------------------------------------------------------------------------------------------------------------\n        /*\n        renderEventDragSegs(state: EventSegUiInteractionState) {\n          if (state) {\n            let { isEvent, segs, sourceSeg } = state\n      \n            if (this.eventRenderer) {\n              this.eventRenderer.hideByHash(state.affectedInstances)\n            }\n      \n            // if the user is dragging something that is considered an event with real event data,\n            // and this component likes to do drag mirrors OR the component where the seg came from\n            // likes to do drag mirrors, then render a drag mirror.\n            if (isEvent && (this.doesDragMirror || sourceSeg && sourceSeg.component.doesDragMirror)) {\n              if (this.mirrorRenderer) {\n                this.mirrorRenderer.renderSegs(segs, { isDragging: true, sourceSeg })\n              }\n            }\n      \n            // if it would be impossible to render a drag mirror OR this component likes to render\n            // highlights, then render a highlight.\n            if (!isEvent || this.doesDragHighlight) {\n              if (this.fillRenderer) {\n                this.fillRenderer.renderSegs('highlight', segs)\n              }\n            }\n          }\n        }\n        */\n        // Hit System\n        // -----------------------------------------------------------------------------------------------------------------\n        DateComponent.prototype.queryHit = function (positionLeft, positionTop, elWidth, elHeight) {\n            return null; // this should be abstract\n        };\n        // Validation\n        // -----------------------------------------------------------------------------------------------------------------\n        DateComponent.prototype.isInteractionValid = function (interaction) {\n            var calendar = this.calendar;\n            var dateProfile = this.props.dateProfile; // HACK\n            var instances = interaction.mutatedEvents.instances;\n            if (dateProfile) { // HACK for DayTile\n                for (var instanceId in instances) {\n                    if (!rangeContainsRange(dateProfile.validRange, instances[instanceId].range)) {\n                        return false;\n                    }\n                }\n            }\n            return isInteractionValid(interaction, calendar);\n        };\n        DateComponent.prototype.isDateSelectionValid = function (selection) {\n            var dateProfile = this.props.dateProfile; // HACK\n            if (dateProfile && // HACK for DayTile\n                !rangeContainsRange(dateProfile.validRange, selection.range)) {\n                return false;\n            }\n            return isDateSelectionValid(selection, this.calendar);\n        };\n        // Triggering\n        // -----------------------------------------------------------------------------------------------------------------\n        // TODO: move to Calendar\n        DateComponent.prototype.publiclyTrigger = function (name, args) {\n            var calendar = this.calendar;\n            return calendar.publiclyTrigger(name, args);\n        };\n        DateComponent.prototype.publiclyTriggerAfterSizing = function (name, args) {\n            var calendar = this.calendar;\n            return calendar.publiclyTriggerAfterSizing(name, args);\n        };\n        DateComponent.prototype.hasPublicHandlers = function (name) {\n            var calendar = this.calendar;\n            return calendar.hasPublicHandlers(name);\n        };\n        DateComponent.prototype.triggerRenderedSegs = function (segs, isMirrors) {\n            var calendar = this.calendar;\n            if (this.hasPublicHandlers('eventPositioned')) {\n                for (var _i = 0, segs_1 = segs; _i < segs_1.length; _i++) {\n                    var seg = segs_1[_i];\n                    this.publiclyTriggerAfterSizing('eventPositioned', [\n                        {\n                            event: new EventApi(calendar, seg.eventRange.def, seg.eventRange.instance),\n                            isMirror: isMirrors,\n                            isStart: seg.isStart,\n                            isEnd: seg.isEnd,\n                            el: seg.el,\n                            view: this // ?\n                        }\n                    ]);\n                }\n            }\n            if (!calendar.state.loadingLevel) { // avoid initial empty state while pending\n                calendar.afterSizingTriggers._eventsPositioned = [null]; // fire once\n            }\n        };\n        DateComponent.prototype.triggerWillRemoveSegs = function (segs, isMirrors) {\n            var calendar = this.calendar;\n            for (var _i = 0, segs_2 = segs; _i < segs_2.length; _i++) {\n                var seg = segs_2[_i];\n                calendar.trigger('eventElRemove', seg.el);\n            }\n            if (this.hasPublicHandlers('eventDestroy')) {\n                for (var _a = 0, segs_3 = segs; _a < segs_3.length; _a++) {\n                    var seg = segs_3[_a];\n                    this.publiclyTrigger('eventDestroy', [\n                        {\n                            event: new EventApi(calendar, seg.eventRange.def, seg.eventRange.instance),\n                            isMirror: isMirrors,\n                            el: seg.el,\n                            view: this // ?\n                        }\n                    ]);\n                }\n            }\n        };\n        // Pointer Interaction Utils\n        // -----------------------------------------------------------------------------------------------------------------\n        DateComponent.prototype.isValidSegDownEl = function (el) {\n            return !this.props.eventDrag && // HACK\n                !this.props.eventResize && // HACK\n                !elementClosest(el, '.fc-mirror') &&\n                !this.isInPopover(el); // how to determine if not in a sub-component???\n        };\n        DateComponent.prototype.isValidDateDownEl = function (el) {\n            var segEl = elementClosest(el, this.fgSegSelector);\n            return (!segEl || segEl.classList.contains('fc-mirror')) &&\n                !elementClosest(el, '.fc-more') && // a \"more..\" link\n                !elementClosest(el, 'a[data-goto]') && // a clickable nav link\n                !this.isInPopover(el);\n        };\n        // is the element inside of an inner popover?\n        DateComponent.prototype.isInPopover = function (el) {\n            var popoverEl = elementClosest(el, '.fc-popover');\n            return popoverEl && popoverEl !== this.el; // if the current component IS a popover, okay\n        };\n        return DateComponent;\n    }(Component));\n    DateComponent.prototype.fgSegSelector = '.fc-event-container > *';\n    DateComponent.prototype.bgSegSelector = '.fc-bgevent:not(.fc-nonbusiness)';\n\n    var uid$1 = 0;\n    function createPlugin(input) {\n        return {\n            id: String(uid$1++),\n            deps: input.deps || [],\n            reducers: input.reducers || [],\n            eventDefParsers: input.eventDefParsers || [],\n            eventDragMutationMassagers: input.eventDragMutationMassagers || [],\n            eventDefMutationAppliers: input.eventDefMutationAppliers || [],\n            dateSelectionTransformers: input.dateSelectionTransformers || [],\n            datePointTransforms: input.datePointTransforms || [],\n            dateSpanTransforms: input.dateSpanTransforms || [],\n            views: input.views || {},\n            viewPropsTransformers: input.viewPropsTransformers || [],\n            isPropsValid: input.isPropsValid || null,\n            externalDefTransforms: input.externalDefTransforms || [],\n            eventResizeJoinTransforms: input.eventResizeJoinTransforms || [],\n            viewContainerModifiers: input.viewContainerModifiers || [],\n            eventDropTransformers: input.eventDropTransformers || [],\n            componentInteractions: input.componentInteractions || [],\n            calendarInteractions: input.calendarInteractions || [],\n            themeClasses: input.themeClasses || {},\n            eventSourceDefs: input.eventSourceDefs || [],\n            cmdFormatter: input.cmdFormatter,\n            recurringTypes: input.recurringTypes || [],\n            namedTimeZonedImpl: input.namedTimeZonedImpl,\n            defaultView: input.defaultView || '',\n            elementDraggingImpl: input.elementDraggingImpl\n        };\n    }\n    var PluginSystem = /** @class */ (function () {\n        function PluginSystem() {\n            this.hooks = {\n                reducers: [],\n                eventDefParsers: [],\n                eventDragMutationMassagers: [],\n                eventDefMutationAppliers: [],\n                dateSelectionTransformers: [],\n                datePointTransforms: [],\n                dateSpanTransforms: [],\n                views: {},\n                viewPropsTransformers: [],\n                isPropsValid: null,\n                externalDefTransforms: [],\n                eventResizeJoinTransforms: [],\n                viewContainerModifiers: [],\n                eventDropTransformers: [],\n                componentInteractions: [],\n                calendarInteractions: [],\n                themeClasses: {},\n                eventSourceDefs: [],\n                cmdFormatter: null,\n                recurringTypes: [],\n                namedTimeZonedImpl: null,\n                defaultView: '',\n                elementDraggingImpl: null\n            };\n            this.addedHash = {};\n        }\n        PluginSystem.prototype.add = function (plugin) {\n            if (!this.addedHash[plugin.id]) {\n                this.addedHash[plugin.id] = true;\n                for (var _i = 0, _a = plugin.deps; _i < _a.length; _i++) {\n                    var dep = _a[_i];\n                    this.add(dep);\n                }\n                this.hooks = combineHooks(this.hooks, plugin);\n            }\n        };\n        return PluginSystem;\n    }());\n    function combineHooks(hooks0, hooks1) {\n        return {\n            reducers: hooks0.reducers.concat(hooks1.reducers),\n            eventDefParsers: hooks0.eventDefParsers.concat(hooks1.eventDefParsers),\n            eventDragMutationMassagers: hooks0.eventDragMutationMassagers.concat(hooks1.eventDragMutationMassagers),\n            eventDefMutationAppliers: hooks0.eventDefMutationAppliers.concat(hooks1.eventDefMutationAppliers),\n            dateSelectionTransformers: hooks0.dateSelectionTransformers.concat(hooks1.dateSelectionTransformers),\n            datePointTransforms: hooks0.datePointTransforms.concat(hooks1.datePointTransforms),\n            dateSpanTransforms: hooks0.dateSpanTransforms.concat(hooks1.dateSpanTransforms),\n            views: __assign({}, hooks0.views, hooks1.views),\n            viewPropsTransformers: hooks0.viewPropsTransformers.concat(hooks1.viewPropsTransformers),\n            isPropsValid: hooks1.isPropsValid || hooks0.isPropsValid,\n            externalDefTransforms: hooks0.externalDefTransforms.concat(hooks1.externalDefTransforms),\n            eventResizeJoinTransforms: hooks0.eventResizeJoinTransforms.concat(hooks1.eventResizeJoinTransforms),\n            viewContainerModifiers: hooks0.viewContainerModifiers.concat(hooks1.viewContainerModifiers),\n            eventDropTransformers: hooks0.eventDropTransformers.concat(hooks1.eventDropTransformers),\n            calendarInteractions: hooks0.calendarInteractions.concat(hooks1.calendarInteractions),\n            componentInteractions: hooks0.componentInteractions.concat(hooks1.componentInteractions),\n            themeClasses: __assign({}, hooks0.themeClasses, hooks1.themeClasses),\n            eventSourceDefs: hooks0.eventSourceDefs.concat(hooks1.eventSourceDefs),\n            cmdFormatter: hooks1.cmdFormatter || hooks0.cmdFormatter,\n            recurringTypes: hooks0.recurringTypes.concat(hooks1.recurringTypes),\n            namedTimeZonedImpl: hooks1.namedTimeZonedImpl || hooks0.namedTimeZonedImpl,\n            defaultView: hooks0.defaultView || hooks1.defaultView,\n            elementDraggingImpl: hooks0.elementDraggingImpl || hooks1.elementDraggingImpl // \"\n        };\n    }\n\n    var eventSourceDef = {\n        ignoreRange: true,\n        parseMeta: function (raw) {\n            if (Array.isArray(raw)) { // short form\n                return raw;\n            }\n            else if (Array.isArray(raw.events)) {\n                return raw.events;\n            }\n            return null;\n        },\n        fetch: function (arg, success) {\n            success({\n                rawEvents: arg.eventSource.meta\n            });\n        }\n    };\n    var ArrayEventSourcePlugin = createPlugin({\n        eventSourceDefs: [eventSourceDef]\n    });\n\n    var eventSourceDef$1 = {\n        parseMeta: function (raw) {\n            if (typeof raw === 'function') { // short form\n                return raw;\n            }\n            else if (typeof raw.events === 'function') {\n                return raw.events;\n            }\n            return null;\n        },\n        fetch: function (arg, success, failure) {\n            var dateEnv = arg.calendar.dateEnv;\n            var func = arg.eventSource.meta;\n            unpromisify(func.bind(null, {\n                start: dateEnv.toDate(arg.range.start),\n                end: dateEnv.toDate(arg.range.end),\n                startStr: dateEnv.formatIso(arg.range.start),\n                endStr: dateEnv.formatIso(arg.range.end),\n                timeZone: dateEnv.timeZone\n            }), function (rawEvents) {\n                success({ rawEvents: rawEvents }); // needs an object response\n            }, failure // send errorObj directly to failure callback\n            );\n        }\n    };\n    var FuncEventSourcePlugin = createPlugin({\n        eventSourceDefs: [eventSourceDef$1]\n    });\n\n    function requestJson(method, url, params, successCallback, failureCallback) {\n        method = method.toUpperCase();\n        var body = null;\n        if (method === 'GET') {\n            url = injectQueryStringParams(url, params);\n        }\n        else {\n            body = encodeParams(params);\n        }\n        var xhr = new XMLHttpRequest();\n        xhr.open(method, url, true);\n        if (method !== 'GET') {\n            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n        }\n        xhr.onload = function () {\n            if (xhr.status >= 200 && xhr.status < 400) {\n                try {\n                    var res = JSON.parse(xhr.responseText);\n                    successCallback(res, xhr);\n                }\n                catch (err) {\n                    failureCallback('Failure parsing JSON', xhr);\n                }\n            }\n            else {\n                failureCallback('Request failed', xhr);\n            }\n        };\n        xhr.onerror = function () {\n            failureCallback('Request failed', xhr);\n        };\n        xhr.send(body);\n    }\n    function injectQueryStringParams(url, params) {\n        return url +\n            (url.indexOf('?') === -1 ? '?' : '&') +\n            encodeParams(params);\n    }\n    function encodeParams(params) {\n        var parts = [];\n        for (var key in params) {\n            parts.push(encodeURIComponent(key) + '=' + encodeURIComponent(params[key]));\n        }\n        return parts.join('&');\n    }\n\n    var eventSourceDef$2 = {\n        parseMeta: function (raw) {\n            if (typeof raw === 'string') { // short form\n                raw = { url: raw };\n            }\n            else if (!raw || typeof raw !== 'object' || !raw.url) {\n                return null;\n            }\n            return {\n                url: raw.url,\n                method: (raw.method || 'GET').toUpperCase(),\n                extraParams: raw.extraParams,\n                startParam: raw.startParam,\n                endParam: raw.endParam,\n                timeZoneParam: raw.timeZoneParam\n            };\n        },\n        fetch: function (arg, success, failure) {\n            var meta = arg.eventSource.meta;\n            var requestParams = buildRequestParams(meta, arg.range, arg.calendar);\n            requestJson(meta.method, meta.url, requestParams, function (rawEvents, xhr) {\n                success({ rawEvents: rawEvents, xhr: xhr });\n            }, function (errorMessage, xhr) {\n                failure({ message: errorMessage, xhr: xhr });\n            });\n        }\n    };\n    var JsonFeedEventSourcePlugin = createPlugin({\n        eventSourceDefs: [eventSourceDef$2]\n    });\n    function buildRequestParams(meta, range, calendar) {\n        var dateEnv = calendar.dateEnv;\n        var startParam;\n        var endParam;\n        var timeZoneParam;\n        var customRequestParams;\n        var params = {};\n        startParam = meta.startParam;\n        if (startParam == null) {\n            startParam = calendar.opt('startParam');\n        }\n        endParam = meta.endParam;\n        if (endParam == null) {\n            endParam = calendar.opt('endParam');\n        }\n        timeZoneParam = meta.timeZoneParam;\n        if (timeZoneParam == null) {\n            timeZoneParam = calendar.opt('timeZoneParam');\n        }\n        // retrieve any outbound GET/POST data from the options\n        if (typeof meta.extraParams === 'function') {\n            // supplied as a function that returns a key/value object\n            customRequestParams = meta.extraParams();\n        }\n        else {\n            // probably supplied as a straight key/value object\n            customRequestParams = meta.extraParams || {};\n        }\n        __assign(params, customRequestParams);\n        params[startParam] = dateEnv.formatIso(range.start);\n        params[endParam] = dateEnv.formatIso(range.end);\n        if (dateEnv.timeZone !== 'local') {\n            params[timeZoneParam] = dateEnv.timeZone;\n        }\n        return params;\n    }\n\n    var recurring = {\n        parse: function (rawEvent, allDayDefault, leftoverProps, dateEnv) {\n            var createMarker = dateEnv.createMarker.bind(dateEnv);\n            var processors = {\n                daysOfWeek: null,\n                startTime: createDuration,\n                endTime: createDuration,\n                startRecur: createMarker,\n                endRecur: createMarker\n            };\n            var props = refineProps(rawEvent, processors, {}, leftoverProps);\n            var anyValid = false;\n            for (var propName in props) {\n                if (props[propName] != null) {\n                    anyValid = true;\n                    break;\n                }\n            }\n            var allDay;\n            if (props.startTime || props.endTime) {\n                allDay = false;\n            }\n            else if (allDayDefault != null) {\n                allDay = allDayDefault;\n            }\n            else {\n                allDay = true;\n            }\n            if (anyValid) {\n                return {\n                    allDay: allDay,\n                    duration: (props.startTime && props.endTime) ?\n                        subtractDurations(props.endTime, props.startTime) :\n                        null,\n                    typeData: props // doesn't need endTime anymore but oh well\n                };\n            }\n            return null;\n        },\n        expand: function (typeData, eventDef, framingRange, dateEnv) {\n            var clippedFramingRange = intersectRanges(framingRange, { start: typeData.startRecur, end: typeData.endRecur });\n            if (clippedFramingRange) {\n                return expandRanges(typeData.daysOfWeek, typeData.startTime, clippedFramingRange, dateEnv);\n            }\n            else {\n                return [];\n            }\n        }\n    };\n    var SimpleRecurrencePlugin = createPlugin({\n        recurringTypes: [recurring]\n    });\n    function expandRanges(daysOfWeek, startTime, framingRange, dateEnv) {\n        var dowHash = daysOfWeek ? arrayToHash(daysOfWeek) : null;\n        var dayMarker = startOfDay(framingRange.start);\n        var endMarker = framingRange.end;\n        var instanceStarts = [];\n        while (dayMarker < endMarker) {\n            var instanceStart \n            // if everyday, or this particular day-of-week\n            = void 0;\n            // if everyday, or this particular day-of-week\n            if (!dowHash || dowHash[dayMarker.getUTCDay()]) {\n                if (startTime) {\n                    instanceStart = dateEnv.add(dayMarker, startTime);\n                }\n                else {\n                    instanceStart = dayMarker;\n                }\n                instanceStarts.push(instanceStart);\n            }\n            dayMarker = addDays(dayMarker, 1);\n        }\n        return instanceStarts;\n    }\n\n    var config = {}; // TODO: make these options\n    var globalDefaults = {\n        defaultRangeSeparator: ' - ',\n        titleRangeSeparator: ' \\u2013 ',\n        defaultTimedEventDuration: '01:00:00',\n        defaultAllDayEventDuration: { day: 1 },\n        forceEventDuration: false,\n        nextDayThreshold: '00:00:00',\n        // display\n        columnHeader: true,\n        defaultView: '',\n        aspectRatio: 1.35,\n        header: {\n            left: 'title',\n            center: '',\n            right: 'today prev,next'\n        },\n        weekends: true,\n        weekNumbers: false,\n        weekNumberCalculation: 'local',\n        editable: false,\n        // nowIndicator: false,\n        scrollTime: '06:00:00',\n        minTime: '00:00:00',\n        maxTime: '24:00:00',\n        showNonCurrentDates: true,\n        // event ajax\n        lazyFetching: true,\n        startParam: 'start',\n        endParam: 'end',\n        timeZoneParam: 'timeZone',\n        timeZone: 'local',\n        // allDayDefault: undefined,\n        // locale\n        locales: [],\n        locale: '',\n        // dir: will get this from the default locale\n        // buttonIcons: null,\n        // allows setting a min-height to the event segment to prevent short events overlapping each other\n        timeGridEventMinHeight: 0,\n        themeSystem: 'standard',\n        // eventResizableFromStart: false,\n        dragRevertDuration: 500,\n        dragScroll: true,\n        allDayMaintainDuration: false,\n        // selectable: false,\n        unselectAuto: true,\n        // selectMinDistance: 0,\n        dropAccept: '*',\n        eventOrder: 'start,-duration,allDay,title',\n        // ^ if start tie, longer events go before shorter. final tie-breaker is title text\n        // rerenderDelay: null,\n        eventLimit: false,\n        eventLimitClick: 'popover',\n        dayPopoverFormat: { month: 'long', day: 'numeric', year: 'numeric' },\n        handleWindowResize: true,\n        windowResizeDelay: 100,\n        longPressDelay: 1000,\n        eventDragMinDistance: 5 // only applies to mouse\n    };\n    var rtlDefaults = {\n        header: {\n            left: 'next,prev today',\n            center: '',\n            right: 'title'\n        },\n        buttonIcons: {\n            // TODO: make RTL support the responibility of the theme\n            prev: 'fc-icon-chevron-right',\n            next: 'fc-icon-chevron-left',\n            prevYear: 'fc-icon-chevrons-right',\n            nextYear: 'fc-icon-chevrons-left'\n        }\n    };\n    var complexOptions = [\n        'header',\n        'footer',\n        'buttonText',\n        'buttonIcons'\n    ];\n    // Merges an array of option objects into a single object\n    function mergeOptions(optionObjs) {\n        return mergeProps(optionObjs, complexOptions);\n    }\n    // TODO: move this stuff to a \"plugin\"-related file...\n    var INTERNAL_PLUGINS = [\n        ArrayEventSourcePlugin,\n        FuncEventSourcePlugin,\n        JsonFeedEventSourcePlugin,\n        SimpleRecurrencePlugin\n    ];\n    function refinePluginDefs(pluginInputs) {\n        var plugins = [];\n        for (var _i = 0, pluginInputs_1 = pluginInputs; _i < pluginInputs_1.length; _i++) {\n            var pluginInput = pluginInputs_1[_i];\n            if (typeof pluginInput === 'string') {\n                var globalName = 'FullCalendar' + capitaliseFirstLetter(pluginInput);\n                if (!window[globalName]) {\n                    console.warn('Plugin file not loaded for ' + pluginInput);\n                }\n                else {\n                    plugins.push(window[globalName].default); // is an ES6 module\n                }\n            }\n            else {\n                plugins.push(pluginInput);\n            }\n        }\n        return INTERNAL_PLUGINS.concat(plugins);\n    }\n\n    var RAW_EN_LOCALE = {\n        code: 'en',\n        week: {\n            dow: 0,\n            doy: 4 // 4 days need to be within the year to be considered the first week\n        },\n        dir: 'ltr',\n        buttonText: {\n            prev: 'prev',\n            next: 'next',\n            prevYear: 'prev year',\n            nextYear: 'next year',\n            year: 'year',\n            today: 'today',\n            month: 'month',\n            week: 'week',\n            day: 'day',\n            list: 'list'\n        },\n        weekLabel: 'W',\n        allDayText: 'all-day',\n        eventLimitText: 'more',\n        noEventsMessage: 'No events to display'\n    };\n    function parseRawLocales(inputPlural) {\n        var globalArray = window['FullCalendarLocalesAll'] || [];\n        var globalMap = window['FullCalendarLocales'] || {};\n        var rawLocaleArray = [];\n        for (var _i = 0, inputPlural_1 = inputPlural; _i < inputPlural_1.length; _i++) {\n            var inputItem = inputPlural_1[_i];\n            if (typeof inputItem === 'string') {\n                if (globalMap[inputItem]) {\n                    rawLocaleArray.push(globalMap[inputItem]);\n                }\n                else {\n                    console.warn('You must have ' + inputItem + '.js locale file loaded.');\n                }\n            }\n            else {\n                rawLocaleArray.push(inputItem);\n            }\n        }\n        var defaultCode = rawLocaleArray.length ? rawLocaleArray[0].code : 'en';\n        var rawLocaleMap = {\n            en: RAW_EN_LOCALE\n        };\n        for (var _a = 0, _b = rawLocaleArray.concat(globalArray); _a < _b.length; _a++) {\n            var rawLocale = _b[_a];\n            rawLocaleMap[rawLocale.code] = rawLocale;\n        }\n        return {\n            map: rawLocaleMap,\n            defaultCode: defaultCode\n        };\n    }\n    function buildLocale(inputSingular, available) {\n        if (typeof inputSingular === 'object' && !Array.isArray(inputSingular)) {\n            return parseLocale(inputSingular.code, [inputSingular.code], inputSingular);\n        }\n        else {\n            return queryLocale(inputSingular, available);\n        }\n    }\n    function queryLocale(codeArg, available) {\n        var codes = [].concat(codeArg || []); // will convert to array\n        var raw = queryRawLocale(codes, available) || RAW_EN_LOCALE;\n        return parseLocale(codeArg, codes, raw);\n    }\n    function queryRawLocale(codes, available) {\n        for (var i = 0; i < codes.length; i++) {\n            var parts = codes[i].toLocaleLowerCase().split('-');\n            for (var j = parts.length; j > 0; j--) {\n                var simpleId = parts.slice(0, j).join('-');\n                if (available[simpleId]) {\n                    return available[simpleId];\n                }\n            }\n        }\n        return null;\n    }\n    function parseLocale(codeArg, codes, raw) {\n        var merged = mergeProps([RAW_EN_LOCALE, raw], ['buttonText']);\n        delete merged.code; // don't want this part of the options\n        var week = merged.week;\n        delete merged.week;\n        return {\n            codeArg: codeArg,\n            codes: codes,\n            week: week,\n            simpleNumberFormat: new Intl.NumberFormat(codeArg),\n            options: merged\n        };\n    }\n\n    var OptionsManager = /** @class */ (function () {\n        function OptionsManager(overrides) {\n            this.overrides = __assign({}, overrides); // make a copy\n            this.dynamicOverrides = {};\n            this.compute();\n        }\n        OptionsManager.prototype.add = function (name, value) {\n            this.dynamicOverrides[name] = value;\n            this.compute();\n        };\n        // Computes the flattened options hash for the calendar and assigns to `this.options`.\n        // Assumes this.overrides and this.dynamicOverrides have already been initialized.\n        OptionsManager.prototype.compute = function () {\n            // TODO: not a very efficient system\n            var locales = firstDefined(// explicit locale option given?\n            this.dynamicOverrides.locales, this.overrides.locales, globalDefaults.locales);\n            var locale = firstDefined(// explicit locales option given?\n            this.dynamicOverrides.locale, this.overrides.locale, globalDefaults.locale);\n            var available = parseRawLocales(locales);\n            var localeDefaults = buildLocale(locale || available.defaultCode, available.map).options;\n            var dir = firstDefined(// based on options computed so far, is direction RTL?\n            this.dynamicOverrides.dir, this.overrides.dir, localeDefaults.dir);\n            var dirDefaults = dir === 'rtl' ? rtlDefaults : {};\n            this.dirDefaults = dirDefaults;\n            this.localeDefaults = localeDefaults;\n            this.computed = mergeOptions([\n                globalDefaults,\n                dirDefaults,\n                localeDefaults,\n                this.overrides,\n                this.dynamicOverrides\n            ]);\n        };\n        return OptionsManager;\n    }());\n\n    var calendarSystemClassMap = {};\n    function registerCalendarSystem(name, theClass) {\n        calendarSystemClassMap[name] = theClass;\n    }\n    function createCalendarSystem(name) {\n        return new calendarSystemClassMap[name]();\n    }\n    var GregorianCalendarSystem = /** @class */ (function () {\n        function GregorianCalendarSystem() {\n        }\n        GregorianCalendarSystem.prototype.getMarkerYear = function (d) {\n            return d.getUTCFullYear();\n        };\n        GregorianCalendarSystem.prototype.getMarkerMonth = function (d) {\n            return d.getUTCMonth();\n        };\n        GregorianCalendarSystem.prototype.getMarkerDay = function (d) {\n            return d.getUTCDate();\n        };\n        GregorianCalendarSystem.prototype.arrayToMarker = function (arr) {\n            return arrayToUtcDate(arr);\n        };\n        GregorianCalendarSystem.prototype.markerToArray = function (marker) {\n            return dateToUtcArray(marker);\n        };\n        return GregorianCalendarSystem;\n    }());\n    registerCalendarSystem('gregory', GregorianCalendarSystem);\n\n    var ISO_START = /^\\s*\\d{4}-\\d\\d-\\d\\d([T ]\\d)?/;\n    var ISO_TZO_RE = /(?:(Z)|([-+])(\\d\\d)(?::(\\d\\d))?)$/;\n    function parse(str) {\n        var timeZoneOffset = null;\n        var isTimeUnspecified = false;\n        var m = ISO_START.exec(str);\n        if (m) {\n            isTimeUnspecified = !m[1];\n            if (isTimeUnspecified) {\n                str += 'T00:00:00Z';\n            }\n            else {\n                str = str.replace(ISO_TZO_RE, function (whole, z, sign, minutes, seconds) {\n                    if (z) {\n                        timeZoneOffset = 0;\n                    }\n                    else {\n                        timeZoneOffset = (parseInt(minutes, 10) * 60 +\n                            parseInt(seconds || 0, 10)) * (sign === '-' ? -1 : 1);\n                    }\n                    return '';\n                }) + 'Z'; // otherwise will parse in local\n            }\n        }\n        var marker = new Date(str);\n        if (!isValidDate(marker)) {\n            return null;\n        }\n        return {\n            marker: marker,\n            isTimeUnspecified: isTimeUnspecified,\n            timeZoneOffset: timeZoneOffset\n        };\n    }\n\n    var DateEnv = /** @class */ (function () {\n        function DateEnv(settings) {\n            var timeZone = this.timeZone = settings.timeZone;\n            var isNamedTimeZone = timeZone !== 'local' && timeZone !== 'UTC';\n            if (settings.namedTimeZoneImpl && isNamedTimeZone) {\n                this.namedTimeZoneImpl = new settings.namedTimeZoneImpl(timeZone);\n            }\n            this.canComputeOffset = Boolean(!isNamedTimeZone || this.namedTimeZoneImpl);\n            this.calendarSystem = createCalendarSystem(settings.calendarSystem);\n            this.locale = settings.locale;\n            this.weekDow = settings.locale.week.dow;\n            this.weekDoy = settings.locale.week.doy;\n            if (settings.weekNumberCalculation === 'ISO') {\n                this.weekDow = 1;\n                this.weekDoy = 4;\n            }\n            else if (typeof settings.firstDay === 'number') {\n                this.weekDow = settings.firstDay;\n            }\n            if (typeof settings.weekNumberCalculation === 'function') {\n                this.weekNumberFunc = settings.weekNumberCalculation;\n            }\n            this.weekLabel = settings.weekLabel != null ? settings.weekLabel : settings.locale.options.weekLabel;\n            this.cmdFormatter = settings.cmdFormatter;\n        }\n        // Creating / Parsing\n        DateEnv.prototype.createMarker = function (input) {\n            var meta = this.createMarkerMeta(input);\n            if (meta === null) {\n                return null;\n            }\n            return meta.marker;\n        };\n        DateEnv.prototype.createNowMarker = function () {\n            if (this.canComputeOffset) {\n                return this.timestampToMarker(new Date().valueOf());\n            }\n            else {\n                // if we can't compute the current date val for a timezone,\n                // better to give the current local date vals than UTC\n                return arrayToUtcDate(dateToLocalArray(new Date()));\n            }\n        };\n        DateEnv.prototype.createMarkerMeta = function (input) {\n            if (typeof input === 'string') {\n                return this.parse(input);\n            }\n            var marker = null;\n            if (typeof input === 'number') {\n                marker = this.timestampToMarker(input);\n            }\n            else if (input instanceof Date) {\n                input = input.valueOf();\n                if (!isNaN(input)) {\n                    marker = this.timestampToMarker(input);\n                }\n            }\n            else if (Array.isArray(input)) {\n                marker = arrayToUtcDate(input);\n            }\n            if (marker === null || !isValidDate(marker)) {\n                return null;\n            }\n            return { marker: marker, isTimeUnspecified: false, forcedTzo: null };\n        };\n        DateEnv.prototype.parse = function (s) {\n            var parts = parse(s);\n            if (parts === null) {\n                return null;\n            }\n            var marker = parts.marker;\n            var forcedTzo = null;\n            if (parts.timeZoneOffset !== null) {\n                if (this.canComputeOffset) {\n                    marker = this.timestampToMarker(marker.valueOf() - parts.timeZoneOffset * 60 * 1000);\n                }\n                else {\n                    forcedTzo = parts.timeZoneOffset;\n                }\n            }\n            return { marker: marker, isTimeUnspecified: parts.isTimeUnspecified, forcedTzo: forcedTzo };\n        };\n        // Accessors\n        DateEnv.prototype.getYear = function (marker) {\n            return this.calendarSystem.getMarkerYear(marker);\n        };\n        DateEnv.prototype.getMonth = function (marker) {\n            return this.calendarSystem.getMarkerMonth(marker);\n        };\n        // Adding / Subtracting\n        DateEnv.prototype.add = function (marker, dur) {\n            var a = this.calendarSystem.markerToArray(marker);\n            a[0] += dur.years;\n            a[1] += dur.months;\n            a[2] += dur.days;\n            a[6] += dur.milliseconds;\n            return this.calendarSystem.arrayToMarker(a);\n        };\n        DateEnv.prototype.subtract = function (marker, dur) {\n            var a = this.calendarSystem.markerToArray(marker);\n            a[0] -= dur.years;\n            a[1] -= dur.months;\n            a[2] -= dur.days;\n            a[6] -= dur.milliseconds;\n            return this.calendarSystem.arrayToMarker(a);\n        };\n        DateEnv.prototype.addYears = function (marker, n) {\n            var a = this.calendarSystem.markerToArray(marker);\n            a[0] += n;\n            return this.calendarSystem.arrayToMarker(a);\n        };\n        DateEnv.prototype.addMonths = function (marker, n) {\n            var a = this.calendarSystem.markerToArray(marker);\n            a[1] += n;\n            return this.calendarSystem.arrayToMarker(a);\n        };\n        // Diffing Whole Units\n        DateEnv.prototype.diffWholeYears = function (m0, m1) {\n            var calendarSystem = this.calendarSystem;\n            if (timeAsMs(m0) === timeAsMs(m1) &&\n                calendarSystem.getMarkerDay(m0) === calendarSystem.getMarkerDay(m1) &&\n                calendarSystem.getMarkerMonth(m0) === calendarSystem.getMarkerMonth(m1)) {\n                return calendarSystem.getMarkerYear(m1) - calendarSystem.getMarkerYear(m0);\n            }\n            return null;\n        };\n        DateEnv.prototype.diffWholeMonths = function (m0, m1) {\n            var calendarSystem = this.calendarSystem;\n            if (timeAsMs(m0) === timeAsMs(m1) &&\n                calendarSystem.getMarkerDay(m0) === calendarSystem.getMarkerDay(m1)) {\n                return (calendarSystem.getMarkerMonth(m1) - calendarSystem.getMarkerMonth(m0)) +\n                    (calendarSystem.getMarkerYear(m1) - calendarSystem.getMarkerYear(m0)) * 12;\n            }\n            return null;\n        };\n        // Range / Duration\n        DateEnv.prototype.greatestWholeUnit = function (m0, m1) {\n            var n = this.diffWholeYears(m0, m1);\n            if (n !== null) {\n                return { unit: 'year', value: n };\n            }\n            n = this.diffWholeMonths(m0, m1);\n            if (n !== null) {\n                return { unit: 'month', value: n };\n            }\n            n = diffWholeWeeks(m0, m1);\n            if (n !== null) {\n                return { unit: 'week', value: n };\n            }\n            n = diffWholeDays(m0, m1);\n            if (n !== null) {\n                return { unit: 'day', value: n };\n            }\n            n = diffHours(m0, m1);\n            if (isInt(n)) {\n                return { unit: 'hour', value: n };\n            }\n            n = diffMinutes(m0, m1);\n            if (isInt(n)) {\n                return { unit: 'minute', value: n };\n            }\n            n = diffSeconds(m0, m1);\n            if (isInt(n)) {\n                return { unit: 'second', value: n };\n            }\n            return { unit: 'millisecond', value: m1.valueOf() - m0.valueOf() };\n        };\n        DateEnv.prototype.countDurationsBetween = function (m0, m1, d) {\n            // TODO: can use greatestWholeUnit\n            var diff;\n            if (d.years) {\n                diff = this.diffWholeYears(m0, m1);\n                if (diff !== null) {\n                    return diff / asRoughYears(d);\n                }\n            }\n            if (d.months) {\n                diff = this.diffWholeMonths(m0, m1);\n                if (diff !== null) {\n                    return diff / asRoughMonths(d);\n                }\n            }\n            if (d.days) {\n                diff = diffWholeDays(m0, m1);\n                if (diff !== null) {\n                    return diff / asRoughDays(d);\n                }\n            }\n            return (m1.valueOf() - m0.valueOf()) / asRoughMs(d);\n        };\n        // Start-Of\n        DateEnv.prototype.startOf = function (m, unit) {\n            if (unit === 'year') {\n                return this.startOfYear(m);\n            }\n            else if (unit === 'month') {\n                return this.startOfMonth(m);\n            }\n            else if (unit === 'week') {\n                return this.startOfWeek(m);\n            }\n            else if (unit === 'day') {\n                return startOfDay(m);\n            }\n            else if (unit === 'hour') {\n                return startOfHour(m);\n            }\n            else if (unit === 'minute') {\n                return startOfMinute(m);\n            }\n            else if (unit === 'second') {\n                return startOfSecond(m);\n            }\n        };\n        DateEnv.prototype.startOfYear = function (m) {\n            return this.calendarSystem.arrayToMarker([\n                this.calendarSystem.getMarkerYear(m)\n            ]);\n        };\n        DateEnv.prototype.startOfMonth = function (m) {\n            return this.calendarSystem.arrayToMarker([\n                this.calendarSystem.getMarkerYear(m),\n                this.calendarSystem.getMarkerMonth(m)\n            ]);\n        };\n        DateEnv.prototype.startOfWeek = function (m) {\n            return this.calendarSystem.arrayToMarker([\n                this.calendarSystem.getMarkerYear(m),\n                this.calendarSystem.getMarkerMonth(m),\n                m.getUTCDate() - ((m.getUTCDay() - this.weekDow + 7) % 7)\n            ]);\n        };\n        // Week Number\n        DateEnv.prototype.computeWeekNumber = function (marker) {\n            if (this.weekNumberFunc) {\n                return this.weekNumberFunc(this.toDate(marker));\n            }\n            else {\n                return weekOfYear(marker, this.weekDow, this.weekDoy);\n            }\n        };\n        // TODO: choke on timeZoneName: long\n        DateEnv.prototype.format = function (marker, formatter, dateOptions) {\n            if (dateOptions === void 0) { dateOptions = {}; }\n            return formatter.format({\n                marker: marker,\n                timeZoneOffset: dateOptions.forcedTzo != null ?\n                    dateOptions.forcedTzo :\n                    this.offsetForMarker(marker)\n            }, this);\n        };\n        DateEnv.prototype.formatRange = function (start, end, formatter, dateOptions) {\n            if (dateOptions === void 0) { dateOptions = {}; }\n            if (dateOptions.isEndExclusive) {\n                end = addMs(end, -1);\n            }\n            return formatter.formatRange({\n                marker: start,\n                timeZoneOffset: dateOptions.forcedStartTzo != null ?\n                    dateOptions.forcedStartTzo :\n                    this.offsetForMarker(start)\n            }, {\n                marker: end,\n                timeZoneOffset: dateOptions.forcedEndTzo != null ?\n                    dateOptions.forcedEndTzo :\n                    this.offsetForMarker(end)\n            }, this);\n        };\n        DateEnv.prototype.formatIso = function (marker, extraOptions) {\n            if (extraOptions === void 0) { extraOptions = {}; }\n            var timeZoneOffset = null;\n            if (!extraOptions.omitTimeZoneOffset) {\n                if (extraOptions.forcedTzo != null) {\n                    timeZoneOffset = extraOptions.forcedTzo;\n                }\n                else {\n                    timeZoneOffset = this.offsetForMarker(marker);\n                }\n            }\n            return buildIsoString(marker, timeZoneOffset, extraOptions.omitTime);\n        };\n        // TimeZone\n        DateEnv.prototype.timestampToMarker = function (ms) {\n            if (this.timeZone === 'local') {\n                return arrayToUtcDate(dateToLocalArray(new Date(ms)));\n            }\n            else if (this.timeZone === 'UTC' || !this.namedTimeZoneImpl) {\n                return new Date(ms);\n            }\n            else {\n                return arrayToUtcDate(this.namedTimeZoneImpl.timestampToArray(ms));\n            }\n        };\n        DateEnv.prototype.offsetForMarker = function (m) {\n            if (this.timeZone === 'local') {\n                return -arrayToLocalDate(dateToUtcArray(m)).getTimezoneOffset(); // convert \"inverse\" offset to \"normal\" offset\n            }\n            else if (this.timeZone === 'UTC') {\n                return 0;\n            }\n            else if (this.namedTimeZoneImpl) {\n                return this.namedTimeZoneImpl.offsetForArray(dateToUtcArray(m));\n            }\n            return null;\n        };\n        // Conversion\n        DateEnv.prototype.toDate = function (m, forcedTzo) {\n            if (this.timeZone === 'local') {\n                return arrayToLocalDate(dateToUtcArray(m));\n            }\n            else if (this.timeZone === 'UTC') {\n                return new Date(m.valueOf()); // make sure it's a copy\n            }\n            else if (!this.namedTimeZoneImpl) {\n                return new Date(m.valueOf() - (forcedTzo || 0));\n            }\n            else {\n                return new Date(m.valueOf() -\n                    this.namedTimeZoneImpl.offsetForArray(dateToUtcArray(m)) * 1000 * 60 // convert minutes -> ms\n                );\n            }\n        };\n        return DateEnv;\n    }());\n\n    var SIMPLE_SOURCE_PROPS = {\n        id: String,\n        allDayDefault: Boolean,\n        eventDataTransform: Function,\n        success: Function,\n        failure: Function\n    };\n    var uid$2 = 0;\n    function doesSourceNeedRange(eventSource, calendar) {\n        var defs = calendar.pluginSystem.hooks.eventSourceDefs;\n        return !defs[eventSource.sourceDefId].ignoreRange;\n    }\n    function parseEventSource(raw, calendar) {\n        var defs = calendar.pluginSystem.hooks.eventSourceDefs;\n        for (var i = defs.length - 1; i >= 0; i--) { // later-added plugins take precedence\n            var def = defs[i];\n            var meta = def.parseMeta(raw);\n            if (meta) {\n                return parseEventSourceProps(typeof raw === 'object' ? raw : {}, meta, i, calendar);\n            }\n        }\n        return null;\n    }\n    function parseEventSourceProps(raw, meta, sourceDefId, calendar) {\n        var leftovers0 = {};\n        var props = refineProps(raw, SIMPLE_SOURCE_PROPS, {}, leftovers0);\n        var leftovers1 = {};\n        var ui = processUnscopedUiProps(leftovers0, calendar, leftovers1);\n        props.isFetching = false;\n        props.latestFetchId = '';\n        props.fetchRange = null;\n        props.publicId = String(raw.id || '');\n        props.sourceId = String(uid$2++);\n        props.sourceDefId = sourceDefId;\n        props.meta = meta;\n        props.ui = ui;\n        props.extendedProps = leftovers1;\n        return props;\n    }\n\n    function reduceEventSources (eventSources, action, dateProfile, calendar) {\n        switch (action.type) {\n            case 'ADD_EVENT_SOURCES': // already parsed\n                return addSources(eventSources, action.sources, dateProfile ? dateProfile.activeRange : null, calendar);\n            case 'REMOVE_EVENT_SOURCE':\n                return removeSource(eventSources, action.sourceId);\n            case 'PREV': // TODO: how do we track all actions that affect dateProfile :(\n            case 'NEXT':\n            case 'SET_DATE':\n            case 'SET_VIEW_TYPE':\n                if (dateProfile) {\n                    return fetchDirtySources(eventSources, dateProfile.activeRange, calendar);\n                }\n                else {\n                    return eventSources;\n                }\n            case 'FETCH_EVENT_SOURCES':\n            case 'CHANGE_TIMEZONE':\n                return fetchSourcesByIds(eventSources, action.sourceIds ?\n                    arrayToHash(action.sourceIds) :\n                    excludeStaticSources(eventSources, calendar), dateProfile ? dateProfile.activeRange : null, calendar);\n            case 'RECEIVE_EVENTS':\n            case 'RECEIVE_EVENT_ERROR':\n                return receiveResponse(eventSources, action.sourceId, action.fetchId, action.fetchRange);\n            case 'REMOVE_ALL_EVENT_SOURCES':\n                return {};\n            default:\n                return eventSources;\n        }\n    }\n    var uid$3 = 0;\n    function addSources(eventSourceHash, sources, fetchRange, calendar) {\n        var hash = {};\n        for (var _i = 0, sources_1 = sources; _i < sources_1.length; _i++) {\n            var source = sources_1[_i];\n            hash[source.sourceId] = source;\n        }\n        if (fetchRange) {\n            hash = fetchDirtySources(hash, fetchRange, calendar);\n        }\n        return __assign({}, eventSourceHash, hash);\n    }\n    function removeSource(eventSourceHash, sourceId) {\n        return filterHash(eventSourceHash, function (eventSource) {\n            return eventSource.sourceId !== sourceId;\n        });\n    }\n    function fetchDirtySources(sourceHash, fetchRange, calendar) {\n        return fetchSourcesByIds(sourceHash, filterHash(sourceHash, function (eventSource) {\n            return isSourceDirty(eventSource, fetchRange, calendar);\n        }), fetchRange, calendar);\n    }\n    function isSourceDirty(eventSource, fetchRange, calendar) {\n        if (!doesSourceNeedRange(eventSource, calendar)) {\n            return !eventSource.latestFetchId;\n        }\n        else {\n            return !calendar.opt('lazyFetching') ||\n                !eventSource.fetchRange ||\n                fetchRange.start < eventSource.fetchRange.start ||\n                fetchRange.end > eventSource.fetchRange.end;\n        }\n    }\n    function fetchSourcesByIds(prevSources, sourceIdHash, fetchRange, calendar) {\n        var nextSources = {};\n        for (var sourceId in prevSources) {\n            var source = prevSources[sourceId];\n            if (sourceIdHash[sourceId]) {\n                nextSources[sourceId] = fetchSource(source, fetchRange, calendar);\n            }\n            else {\n                nextSources[sourceId] = source;\n            }\n        }\n        return nextSources;\n    }\n    function fetchSource(eventSource, fetchRange, calendar) {\n        var sourceDef = calendar.pluginSystem.hooks.eventSourceDefs[eventSource.sourceDefId];\n        var fetchId = String(uid$3++);\n        sourceDef.fetch({\n            eventSource: eventSource,\n            calendar: calendar,\n            range: fetchRange\n        }, function (res) {\n            var rawEvents = res.rawEvents;\n            var calSuccess = calendar.opt('eventSourceSuccess');\n            var calSuccessRes;\n            var sourceSuccessRes;\n            if (eventSource.success) {\n                sourceSuccessRes = eventSource.success(rawEvents, res.xhr);\n            }\n            if (calSuccess) {\n                calSuccessRes = calSuccess(rawEvents, res.xhr);\n            }\n            rawEvents = sourceSuccessRes || calSuccessRes || rawEvents;\n            calendar.dispatch({\n                type: 'RECEIVE_EVENTS',\n                sourceId: eventSource.sourceId,\n                fetchId: fetchId,\n                fetchRange: fetchRange,\n                rawEvents: rawEvents\n            });\n        }, function (error) {\n            var callFailure = calendar.opt('eventSourceFailure');\n            console.warn(error.message, error);\n            if (eventSource.failure) {\n                eventSource.failure(error);\n            }\n            if (callFailure) {\n                callFailure(error);\n            }\n            calendar.dispatch({\n                type: 'RECEIVE_EVENT_ERROR',\n                sourceId: eventSource.sourceId,\n                fetchId: fetchId,\n                fetchRange: fetchRange,\n                error: error\n            });\n        });\n        return __assign({}, eventSource, { isFetching: true, latestFetchId: fetchId });\n    }\n    function receiveResponse(sourceHash, sourceId, fetchId, fetchRange) {\n        var _a;\n        var eventSource = sourceHash[sourceId];\n        if (eventSource && // not already removed\n            fetchId === eventSource.latestFetchId) {\n            return __assign({}, sourceHash, (_a = {}, _a[sourceId] = __assign({}, eventSource, { isFetching: false, fetchRange: fetchRange }), _a));\n        }\n        return sourceHash;\n    }\n    function excludeStaticSources(eventSources, calendar) {\n        return filterHash(eventSources, function (eventSource) {\n            return doesSourceNeedRange(eventSource, calendar);\n        });\n    }\n\n    var DateProfileGenerator = /** @class */ (function () {\n        function DateProfileGenerator(viewSpec, calendar) {\n            this.viewSpec = viewSpec;\n            this.options = viewSpec.options;\n            this.dateEnv = calendar.dateEnv;\n            this.calendar = calendar;\n            this.initHiddenDays();\n        }\n        /* Date Range Computation\n        ------------------------------------------------------------------------------------------------------------------*/\n        // Builds a structure with info about what the dates/ranges will be for the \"prev\" view.\n        DateProfileGenerator.prototype.buildPrev = function (currentDateProfile, currentDate) {\n            var dateEnv = this.dateEnv;\n            var prevDate = dateEnv.subtract(currentDate, currentDateProfile.dateIncrement);\n            return this.build(prevDate, -1);\n        };\n        // Builds a structure with info about what the dates/ranges will be for the \"next\" view.\n        DateProfileGenerator.prototype.buildNext = function (currentDateProfile, currentDate) {\n            var dateEnv = this.dateEnv;\n            var nextDate = dateEnv.add(currentDate, currentDateProfile.dateIncrement);\n            return this.build(nextDate, 1);\n        };\n        // Builds a structure holding dates/ranges for rendering around the given date.\n        // Optional direction param indicates whether the date is being incremented/decremented\n        // from its previous value. decremented = -1, incremented = 1 (default).\n        DateProfileGenerator.prototype.build = function (currentDate, direction, forceToValid) {\n            if (forceToValid === void 0) { forceToValid = false; }\n            var validRange;\n            var minTime = null;\n            var maxTime = null;\n            var currentInfo;\n            var isRangeAllDay;\n            var renderRange;\n            var activeRange;\n            var isValid;\n            validRange = this.buildValidRange();\n            validRange = this.trimHiddenDays(validRange);\n            if (forceToValid) {\n                currentDate = constrainMarkerToRange(currentDate, validRange);\n            }\n            currentInfo = this.buildCurrentRangeInfo(currentDate, direction);\n            isRangeAllDay = /^(year|month|week|day)$/.test(currentInfo.unit);\n            renderRange = this.buildRenderRange(this.trimHiddenDays(currentInfo.range), currentInfo.unit, isRangeAllDay);\n            renderRange = this.trimHiddenDays(renderRange);\n            activeRange = renderRange;\n            if (!this.options.showNonCurrentDates) {\n                activeRange = intersectRanges(activeRange, currentInfo.range);\n            }\n            minTime = createDuration(this.options.minTime);\n            maxTime = createDuration(this.options.maxTime);\n            activeRange = this.adjustActiveRange(activeRange, minTime, maxTime);\n            activeRange = intersectRanges(activeRange, validRange); // might return null\n            // it's invalid if the originally requested date is not contained,\n            // or if the range is completely outside of the valid range.\n            isValid = rangesIntersect(currentInfo.range, validRange);\n            return {\n                // constraint for where prev/next operations can go and where events can be dragged/resized to.\n                // an object with optional start and end properties.\n                validRange: validRange,\n                // range the view is formally responsible for.\n                // for example, a month view might have 1st-31st, excluding padded dates\n                currentRange: currentInfo.range,\n                // name of largest unit being displayed, like \"month\" or \"week\"\n                currentRangeUnit: currentInfo.unit,\n                isRangeAllDay: isRangeAllDay,\n                // dates that display events and accept drag-n-drop\n                // will be `null` if no dates accept events\n                activeRange: activeRange,\n                // date range with a rendered skeleton\n                // includes not-active days that need some sort of DOM\n                renderRange: renderRange,\n                // Duration object that denotes the first visible time of any given day\n                minTime: minTime,\n                // Duration object that denotes the exclusive visible end time of any given day\n                maxTime: maxTime,\n                isValid: isValid,\n                // how far the current date will move for a prev/next operation\n                dateIncrement: this.buildDateIncrement(currentInfo.duration)\n                // pass a fallback (might be null) ^\n            };\n        };\n        // Builds an object with optional start/end properties.\n        // Indicates the minimum/maximum dates to display.\n        // not responsible for trimming hidden days.\n        DateProfileGenerator.prototype.buildValidRange = function () {\n            return this.getRangeOption('validRange', this.calendar.getNow()) ||\n                { start: null, end: null }; // completely open-ended\n        };\n        // Builds a structure with info about the \"current\" range, the range that is\n        // highlighted as being the current month for example.\n        // See build() for a description of `direction`.\n        // Guaranteed to have `range` and `unit` properties. `duration` is optional.\n        DateProfileGenerator.prototype.buildCurrentRangeInfo = function (date, direction) {\n            var _a = this, viewSpec = _a.viewSpec, dateEnv = _a.dateEnv;\n            var duration = null;\n            var unit = null;\n            var range = null;\n            var dayCount;\n            if (viewSpec.duration) {\n                duration = viewSpec.duration;\n                unit = viewSpec.durationUnit;\n                range = this.buildRangeFromDuration(date, direction, duration, unit);\n            }\n            else if ((dayCount = this.options.dayCount)) {\n                unit = 'day';\n                range = this.buildRangeFromDayCount(date, direction, dayCount);\n            }\n            else if ((range = this.buildCustomVisibleRange(date))) {\n                unit = dateEnv.greatestWholeUnit(range.start, range.end).unit;\n            }\n            else {\n                duration = this.getFallbackDuration();\n                unit = greatestDurationDenominator(duration).unit;\n                range = this.buildRangeFromDuration(date, direction, duration, unit);\n            }\n            return { duration: duration, unit: unit, range: range };\n        };\n        DateProfileGenerator.prototype.getFallbackDuration = function () {\n            return createDuration({ day: 1 });\n        };\n        // Returns a new activeRange to have time values (un-ambiguate)\n        // minTime or maxTime causes the range to expand.\n        DateProfileGenerator.prototype.adjustActiveRange = function (range, minTime, maxTime) {\n            var dateEnv = this.dateEnv;\n            var start = range.start;\n            var end = range.end;\n            if (this.viewSpec.class.prototype.usesMinMaxTime) {\n                // expand active range if minTime is negative (why not when positive?)\n                if (asRoughDays(minTime) < 0) {\n                    start = startOfDay(start); // necessary?\n                    start = dateEnv.add(start, minTime);\n                }\n                // expand active range if maxTime is beyond one day (why not when positive?)\n                if (asRoughDays(maxTime) > 1) {\n                    end = startOfDay(end); // necessary?\n                    end = addDays(end, -1);\n                    end = dateEnv.add(end, maxTime);\n                }\n            }\n            return { start: start, end: end };\n        };\n        // Builds the \"current\" range when it is specified as an explicit duration.\n        // `unit` is the already-computed greatestDurationDenominator unit of duration.\n        DateProfileGenerator.prototype.buildRangeFromDuration = function (date, direction, duration, unit) {\n            var dateEnv = this.dateEnv;\n            var alignment = this.options.dateAlignment;\n            var dateIncrementInput;\n            var dateIncrementDuration;\n            var start;\n            var end;\n            var res;\n            // compute what the alignment should be\n            if (!alignment) {\n                dateIncrementInput = this.options.dateIncrement;\n                if (dateIncrementInput) {\n                    dateIncrementDuration = createDuration(dateIncrementInput);\n                    // use the smaller of the two units\n                    if (asRoughMs(dateIncrementDuration) < asRoughMs(duration)) {\n                        alignment = greatestDurationDenominator(dateIncrementDuration, !getWeeksFromInput(dateIncrementInput)).unit;\n                    }\n                    else {\n                        alignment = unit;\n                    }\n                }\n                else {\n                    alignment = unit;\n                }\n            }\n            // if the view displays a single day or smaller\n            if (asRoughDays(duration) <= 1) {\n                if (this.isHiddenDay(start)) {\n                    start = this.skipHiddenDays(start, direction);\n                    start = startOfDay(start);\n                }\n            }\n            function computeRes() {\n                start = dateEnv.startOf(date, alignment);\n                end = dateEnv.add(start, duration);\n                res = { start: start, end: end };\n            }\n            computeRes();\n            // if range is completely enveloped by hidden days, go past the hidden days\n            if (!this.trimHiddenDays(res)) {\n                date = this.skipHiddenDays(date, direction);\n                computeRes();\n            }\n            return res;\n        };\n        // Builds the \"current\" range when a dayCount is specified.\n        DateProfileGenerator.prototype.buildRangeFromDayCount = function (date, direction, dayCount) {\n            var dateEnv = this.dateEnv;\n            var customAlignment = this.options.dateAlignment;\n            var runningCount = 0;\n            var start = date;\n            var end;\n            if (customAlignment) {\n                start = dateEnv.startOf(start, customAlignment);\n            }\n            start = startOfDay(start);\n            start = this.skipHiddenDays(start, direction);\n            end = start;\n            do {\n                end = addDays(end, 1);\n                if (!this.isHiddenDay(end)) {\n                    runningCount++;\n                }\n            } while (runningCount < dayCount);\n            return { start: start, end: end };\n        };\n        // Builds a normalized range object for the \"visible\" range,\n        // which is a way to define the currentRange and activeRange at the same time.\n        DateProfileGenerator.prototype.buildCustomVisibleRange = function (date) {\n            var dateEnv = this.dateEnv;\n            var visibleRange = this.getRangeOption('visibleRange', dateEnv.toDate(date));\n            if (visibleRange && (visibleRange.start == null || visibleRange.end == null)) {\n                return null;\n            }\n            return visibleRange;\n        };\n        // Computes the range that will represent the element/cells for *rendering*,\n        // but which may have voided days/times.\n        // not responsible for trimming hidden days.\n        DateProfileGenerator.prototype.buildRenderRange = function (currentRange, currentRangeUnit, isRangeAllDay) {\n            return currentRange;\n        };\n        // Compute the duration value that should be added/substracted to the current date\n        // when a prev/next operation happens.\n        DateProfileGenerator.prototype.buildDateIncrement = function (fallback) {\n            var dateIncrementInput = this.options.dateIncrement;\n            var customAlignment;\n            if (dateIncrementInput) {\n                return createDuration(dateIncrementInput);\n            }\n            else if ((customAlignment = this.options.dateAlignment)) {\n                return createDuration(1, customAlignment);\n            }\n            else if (fallback) {\n                return fallback;\n            }\n            else {\n                return createDuration({ days: 1 });\n            }\n        };\n        // Arguments after name will be forwarded to a hypothetical function value\n        // WARNING: passed-in arguments will be given to generator functions as-is and can cause side-effects.\n        // Always clone your objects if you fear mutation.\n        DateProfileGenerator.prototype.getRangeOption = function (name) {\n            var otherArgs = [];\n            for (var _i = 1; _i < arguments.length; _i++) {\n                otherArgs[_i - 1] = arguments[_i];\n            }\n            var val = this.options[name];\n            if (typeof val === 'function') {\n                val = val.apply(null, otherArgs);\n            }\n            if (val) {\n                val = parseRange(val, this.dateEnv);\n            }\n            if (val) {\n                val = computeVisibleDayRange(val);\n            }\n            return val;\n        };\n        /* Hidden Days\n        ------------------------------------------------------------------------------------------------------------------*/\n        // Initializes internal variables related to calculating hidden days-of-week\n        DateProfileGenerator.prototype.initHiddenDays = function () {\n            var hiddenDays = this.options.hiddenDays || []; // array of day-of-week indices that are hidden\n            var isHiddenDayHash = []; // is the day-of-week hidden? (hash with day-of-week-index -> bool)\n            var dayCnt = 0;\n            var i;\n            if (this.options.weekends === false) {\n                hiddenDays.push(0, 6); // 0=sunday, 6=saturday\n            }\n            for (i = 0; i < 7; i++) {\n                if (!(isHiddenDayHash[i] = hiddenDays.indexOf(i) !== -1)) {\n                    dayCnt++;\n                }\n            }\n            if (!dayCnt) {\n                throw new Error('invalid hiddenDays'); // all days were hidden? bad.\n            }\n            this.isHiddenDayHash = isHiddenDayHash;\n        };\n        // Remove days from the beginning and end of the range that are computed as hidden.\n        // If the whole range is trimmed off, returns null\n        DateProfileGenerator.prototype.trimHiddenDays = function (range) {\n            var start = range.start;\n            var end = range.end;\n            if (start) {\n                start = this.skipHiddenDays(start);\n            }\n            if (end) {\n                end = this.skipHiddenDays(end, -1, true);\n            }\n            if (start == null || end == null || start < end) {\n                return { start: start, end: end };\n            }\n            return null;\n        };\n        // Is the current day hidden?\n        // `day` is a day-of-week index (0-6), or a Date (used for UTC)\n        DateProfileGenerator.prototype.isHiddenDay = function (day) {\n            if (day instanceof Date) {\n                day = day.getUTCDay();\n            }\n            return this.isHiddenDayHash[day];\n        };\n        // Incrementing the current day until it is no longer a hidden day, returning a copy.\n        // DOES NOT CONSIDER validRange!\n        // If the initial value of `date` is not a hidden day, don't do anything.\n        // Pass `isExclusive` as `true` if you are dealing with an end date.\n        // `inc` defaults to `1` (increment one day forward each time)\n        DateProfileGenerator.prototype.skipHiddenDays = function (date, inc, isExclusive) {\n            if (inc === void 0) { inc = 1; }\n            if (isExclusive === void 0) { isExclusive = false; }\n            while (this.isHiddenDayHash[(date.getUTCDay() + (isExclusive ? inc : 0) + 7) % 7]) {\n                date = addDays(date, inc);\n            }\n            return date;\n        };\n        return DateProfileGenerator;\n    }());\n    // TODO: find a way to avoid comparing DateProfiles. it's tedious\n    function isDateProfilesEqual(p0, p1) {\n        return rangesEqual(p0.activeRange, p1.activeRange) &&\n            rangesEqual(p0.validRange, p1.validRange) &&\n            durationsEqual(p0.minTime, p1.minTime) &&\n            durationsEqual(p0.maxTime, p1.maxTime);\n    }\n\n    function reduce (state, action, calendar) {\n        var viewType = reduceViewType(state.viewType, action);\n        var dateProfile = reduceDateProfile(state.dateProfile, action, state.currentDate, viewType, calendar);\n        var eventSources = reduceEventSources(state.eventSources, action, dateProfile, calendar);\n        var nextState = __assign({}, state, { viewType: viewType,\n            dateProfile: dateProfile, currentDate: reduceCurrentDate(state.currentDate, action, dateProfile), eventSources: eventSources, eventStore: reduceEventStore(state.eventStore, action, eventSources, dateProfile, calendar), dateSelection: reduceDateSelection(state.dateSelection, action, calendar), eventSelection: reduceSelectedEvent(state.eventSelection, action), eventDrag: reduceEventDrag(state.eventDrag, action, eventSources, calendar), eventResize: reduceEventResize(state.eventResize, action, eventSources, calendar), eventSourceLoadingLevel: computeLoadingLevel(eventSources), loadingLevel: computeLoadingLevel(eventSources) });\n        for (var _i = 0, _a = calendar.pluginSystem.hooks.reducers; _i < _a.length; _i++) {\n            var reducerFunc = _a[_i];\n            nextState = reducerFunc(nextState, action, calendar);\n        }\n        // console.log(action.type, nextState)\n        return nextState;\n    }\n    function reduceViewType(currentViewType, action) {\n        switch (action.type) {\n            case 'SET_VIEW_TYPE':\n                return action.viewType;\n            default:\n                return currentViewType;\n        }\n    }\n    function reduceDateProfile(currentDateProfile, action, currentDate, viewType, calendar) {\n        var newDateProfile;\n        switch (action.type) {\n            case 'PREV':\n                newDateProfile = calendar.dateProfileGenerators[viewType].buildPrev(currentDateProfile, currentDate);\n                break;\n            case 'NEXT':\n                newDateProfile = calendar.dateProfileGenerators[viewType].buildNext(currentDateProfile, currentDate);\n                break;\n            case 'SET_DATE':\n                if (!currentDateProfile.activeRange ||\n                    !rangeContainsMarker(currentDateProfile.currentRange, action.dateMarker)) {\n                    newDateProfile = calendar.dateProfileGenerators[viewType].build(action.dateMarker, undefined, true // forceToValid\n                    );\n                }\n                break;\n            case 'SET_VIEW_TYPE':\n                var generator = calendar.dateProfileGenerators[viewType];\n                if (!generator) {\n                    throw new Error(viewType ?\n                        'The FullCalendar view \"' + viewType + '\" does not exist. Make sure your plugins are loaded correctly.' :\n                        'No available FullCalendar view plugins.');\n                }\n                newDateProfile = generator.build(action.dateMarker || currentDate, undefined, true // forceToValid\n                );\n                break;\n        }\n        if (newDateProfile &&\n            newDateProfile.isValid &&\n            !(currentDateProfile && isDateProfilesEqual(currentDateProfile, newDateProfile))) {\n            return newDateProfile;\n        }\n        else {\n            return currentDateProfile;\n        }\n    }\n    function reduceCurrentDate(currentDate, action, dateProfile) {\n        switch (action.type) {\n            case 'PREV':\n            case 'NEXT':\n                if (!rangeContainsMarker(dateProfile.currentRange, currentDate)) {\n                    return dateProfile.currentRange.start;\n                }\n                else {\n                    return currentDate;\n                }\n            case 'SET_DATE':\n            case 'SET_VIEW_TYPE':\n                var newDate = action.dateMarker || currentDate;\n                if (dateProfile.activeRange && !rangeContainsMarker(dateProfile.activeRange, newDate)) {\n                    return dateProfile.currentRange.start;\n                }\n                else {\n                    return newDate;\n                }\n            default:\n                return currentDate;\n        }\n    }\n    function reduceDateSelection(currentSelection, action, calendar) {\n        switch (action.type) {\n            case 'SELECT_DATES':\n                return action.selection;\n            case 'UNSELECT_DATES':\n                return null;\n            default:\n                return currentSelection;\n        }\n    }\n    function reduceSelectedEvent(currentInstanceId, action) {\n        switch (action.type) {\n            case 'SELECT_EVENT':\n                return action.eventInstanceId;\n            case 'UNSELECT_EVENT':\n                return '';\n            default:\n                return currentInstanceId;\n        }\n    }\n    function reduceEventDrag(currentDrag, action, sources, calendar) {\n        switch (action.type) {\n            case 'SET_EVENT_DRAG':\n                var newDrag = action.state;\n                return {\n                    affectedEvents: newDrag.affectedEvents,\n                    mutatedEvents: newDrag.mutatedEvents,\n                    isEvent: newDrag.isEvent,\n                    origSeg: newDrag.origSeg\n                };\n            case 'UNSET_EVENT_DRAG':\n                return null;\n            default:\n                return currentDrag;\n        }\n    }\n    function reduceEventResize(currentResize, action, sources, calendar) {\n        switch (action.type) {\n            case 'SET_EVENT_RESIZE':\n                var newResize = action.state;\n                return {\n                    affectedEvents: newResize.affectedEvents,\n                    mutatedEvents: newResize.mutatedEvents,\n                    isEvent: newResize.isEvent,\n                    origSeg: newResize.origSeg\n                };\n            case 'UNSET_EVENT_RESIZE':\n                return null;\n            default:\n                return currentResize;\n        }\n    }\n    function computeLoadingLevel(eventSources) {\n        var cnt = 0;\n        for (var sourceId in eventSources) {\n            if (eventSources[sourceId].isFetching) {\n                cnt++;\n            }\n        }\n        return cnt;\n    }\n\n    var STANDARD_PROPS = {\n        start: null,\n        end: null,\n        allDay: Boolean\n    };\n    function parseDateSpan(raw, dateEnv, defaultDuration) {\n        var span = parseOpenDateSpan(raw, dateEnv);\n        var range = span.range;\n        if (!range.start) {\n            return null;\n        }\n        if (!range.end) {\n            if (defaultDuration == null) {\n                return null;\n            }\n            else {\n                range.end = dateEnv.add(range.start, defaultDuration);\n            }\n        }\n        return span;\n    }\n    /*\n    TODO: somehow combine with parseRange?\n    Will return null if the start/end props were present but parsed invalidly.\n    */\n    function parseOpenDateSpan(raw, dateEnv) {\n        var leftovers = {};\n        var standardProps = refineProps(raw, STANDARD_PROPS, {}, leftovers);\n        var startMeta = standardProps.start ? dateEnv.createMarkerMeta(standardProps.start) : null;\n        var endMeta = standardProps.end ? dateEnv.createMarkerMeta(standardProps.end) : null;\n        var allDay = standardProps.allDay;\n        if (allDay == null) {\n            allDay = (startMeta && startMeta.isTimeUnspecified) &&\n                (!endMeta || endMeta.isTimeUnspecified);\n        }\n        // use this leftover object as the selection object\n        leftovers.range = {\n            start: startMeta ? startMeta.marker : null,\n            end: endMeta ? endMeta.marker : null\n        };\n        leftovers.allDay = allDay;\n        return leftovers;\n    }\n    function isDateSpansEqual(span0, span1) {\n        return rangesEqual(span0.range, span1.range) &&\n            span0.allDay === span1.allDay &&\n            isSpanPropsEqual(span0, span1);\n    }\n    // the NON-DATE-RELATED props\n    function isSpanPropsEqual(span0, span1) {\n        for (var propName in span1) {\n            if (propName !== 'range' && propName !== 'allDay') {\n                if (span0[propName] !== span1[propName]) {\n                    return false;\n                }\n            }\n        }\n        // are there any props that span0 has that span1 DOESN'T have?\n        // both have range/allDay, so no need to special-case.\n        for (var propName in span0) {\n            if (!(propName in span1)) {\n                return false;\n            }\n        }\n        return true;\n    }\n    function buildDateSpanApi(span, dateEnv) {\n        return {\n            start: dateEnv.toDate(span.range.start),\n            end: dateEnv.toDate(span.range.end),\n            startStr: dateEnv.formatIso(span.range.start, { omitTime: span.allDay }),\n            endStr: dateEnv.formatIso(span.range.end, { omitTime: span.allDay }),\n            allDay: span.allDay\n        };\n    }\n    function buildDatePointApi(span, dateEnv) {\n        return {\n            date: dateEnv.toDate(span.range.start),\n            dateStr: dateEnv.formatIso(span.range.start, { omitTime: span.allDay }),\n            allDay: span.allDay\n        };\n    }\n    function fabricateEventRange(dateSpan, eventUiBases, calendar) {\n        var def = parseEventDef({ editable: false }, '', // sourceId\n        dateSpan.allDay, true, // hasEnd\n        calendar);\n        return {\n            def: def,\n            ui: compileEventUi(def, eventUiBases),\n            instance: createEventInstance(def.defId, dateSpan.range),\n            range: dateSpan.range,\n            isStart: true,\n            isEnd: true\n        };\n    }\n\n    function compileViewDefs(defaultConfigs, overrideConfigs) {\n        var hash = {};\n        var viewType;\n        for (viewType in defaultConfigs) {\n            ensureViewDef(viewType, hash, defaultConfigs, overrideConfigs);\n        }\n        for (viewType in overrideConfigs) {\n            ensureViewDef(viewType, hash, defaultConfigs, overrideConfigs);\n        }\n        return hash;\n    }\n    function ensureViewDef(viewType, hash, defaultConfigs, overrideConfigs) {\n        if (hash[viewType]) {\n            return hash[viewType];\n        }\n        var viewDef = buildViewDef(viewType, hash, defaultConfigs, overrideConfigs);\n        if (viewDef) {\n            hash[viewType] = viewDef;\n        }\n        return viewDef;\n    }\n    function buildViewDef(viewType, hash, defaultConfigs, overrideConfigs) {\n        var defaultConfig = defaultConfigs[viewType];\n        var overrideConfig = overrideConfigs[viewType];\n        var queryProp = function (name) {\n            return (defaultConfig && defaultConfig[name] !== null) ? defaultConfig[name] :\n                ((overrideConfig && overrideConfig[name] !== null) ? overrideConfig[name] : null);\n        };\n        var theClass = queryProp('class');\n        var superType = queryProp('superType');\n        if (!superType && theClass) {\n            superType =\n                findViewNameBySubclass(theClass, overrideConfigs) ||\n                    findViewNameBySubclass(theClass, defaultConfigs);\n        }\n        var superDef = superType ? ensureViewDef(superType, hash, defaultConfigs, overrideConfigs) : null;\n        if (!theClass && superDef) {\n            theClass = superDef.class;\n        }\n        if (!theClass) {\n            return null; // don't throw a warning, might be settings for a single-unit view\n        }\n        return {\n            type: viewType,\n            class: theClass,\n            defaults: __assign({}, (superDef ? superDef.defaults : {}), (defaultConfig ? defaultConfig.options : {})),\n            overrides: __assign({}, (superDef ? superDef.overrides : {}), (overrideConfig ? overrideConfig.options : {}))\n        };\n    }\n    function findViewNameBySubclass(viewSubclass, configs) {\n        var superProto = Object.getPrototypeOf(viewSubclass.prototype);\n        for (var viewType in configs) {\n            var parsed = configs[viewType];\n            // need DIRECT subclass, so instanceof won't do it\n            if (parsed.class && parsed.class.prototype === superProto) {\n                return viewType;\n            }\n        }\n        return '';\n    }\n\n    function parseViewConfigs(inputs) {\n        return mapHash(inputs, parseViewConfig);\n    }\n    var VIEW_DEF_PROPS = {\n        type: String,\n        class: null\n    };\n    function parseViewConfig(input) {\n        if (typeof input === 'function') {\n            input = { class: input };\n        }\n        var options = {};\n        var props = refineProps(input, VIEW_DEF_PROPS, {}, options);\n        return {\n            superType: props.type,\n            class: props.class,\n            options: options\n        };\n    }\n\n    function buildViewSpecs(defaultInputs, optionsManager) {\n        var defaultConfigs = parseViewConfigs(defaultInputs);\n        var overrideConfigs = parseViewConfigs(optionsManager.overrides.views);\n        var viewDefs = compileViewDefs(defaultConfigs, overrideConfigs);\n        return mapHash(viewDefs, function (viewDef) {\n            return buildViewSpec(viewDef, overrideConfigs, optionsManager);\n        });\n    }\n    function buildViewSpec(viewDef, overrideConfigs, optionsManager) {\n        var durationInput = viewDef.overrides.duration ||\n            viewDef.defaults.duration ||\n            optionsManager.dynamicOverrides.duration ||\n            optionsManager.overrides.duration;\n        var duration = null;\n        var durationUnit = '';\n        var singleUnit = '';\n        var singleUnitOverrides = {};\n        if (durationInput) {\n            duration = createDuration(durationInput);\n            if (duration) { // valid?\n                var denom = greatestDurationDenominator(duration, !getWeeksFromInput(durationInput));\n                durationUnit = denom.unit;\n                if (denom.value === 1) {\n                    singleUnit = durationUnit;\n                    singleUnitOverrides = overrideConfigs[durationUnit] ? overrideConfigs[durationUnit].options : {};\n                }\n            }\n        }\n        var queryButtonText = function (options) {\n            var buttonTextMap = options.buttonText || {};\n            var buttonTextKey = viewDef.defaults.buttonTextKey;\n            if (buttonTextKey != null && buttonTextMap[buttonTextKey] != null) {\n                return buttonTextMap[buttonTextKey];\n            }\n            if (buttonTextMap[viewDef.type] != null) {\n                return buttonTextMap[viewDef.type];\n            }\n            if (buttonTextMap[singleUnit] != null) {\n                return buttonTextMap[singleUnit];\n            }\n        };\n        return {\n            type: viewDef.type,\n            class: viewDef.class,\n            duration: duration,\n            durationUnit: durationUnit,\n            singleUnit: singleUnit,\n            options: __assign({}, globalDefaults, viewDef.defaults, optionsManager.dirDefaults, optionsManager.localeDefaults, optionsManager.overrides, singleUnitOverrides, viewDef.overrides, optionsManager.dynamicOverrides),\n            buttonTextOverride: queryButtonText(optionsManager.dynamicOverrides) ||\n                queryButtonText(optionsManager.overrides) || // constructor-specified buttonText lookup hash takes precedence\n                viewDef.overrides.buttonText,\n            buttonTextDefault: queryButtonText(optionsManager.localeDefaults) ||\n                queryButtonText(optionsManager.dirDefaults) ||\n                viewDef.defaults.buttonText ||\n                queryButtonText(globalDefaults) ||\n                viewDef.type // fall back to given view name\n        };\n    }\n\n    var Toolbar = /** @class */ (function (_super) {\n        __extends(Toolbar, _super);\n        function Toolbar(context, extraClassName) {\n            var _this = _super.call(this, context) || this;\n            _this._renderLayout = memoizeRendering(_this.renderLayout, _this.unrenderLayout);\n            _this._updateTitle = memoizeRendering(_this.updateTitle, null, [_this._renderLayout]);\n            _this._updateActiveButton = memoizeRendering(_this.updateActiveButton, null, [_this._renderLayout]);\n            _this._updateToday = memoizeRendering(_this.updateToday, null, [_this._renderLayout]);\n            _this._updatePrev = memoizeRendering(_this.updatePrev, null, [_this._renderLayout]);\n            _this._updateNext = memoizeRendering(_this.updateNext, null, [_this._renderLayout]);\n            _this.el = createElement('div', { className: 'fc-toolbar ' + extraClassName });\n            return _this;\n        }\n        Toolbar.prototype.destroy = function () {\n            _super.prototype.destroy.call(this);\n            this._renderLayout.unrender(); // should unrender everything else\n            removeElement(this.el);\n        };\n        Toolbar.prototype.render = function (props) {\n            this._renderLayout(props.layout);\n            this._updateTitle(props.title);\n            this._updateActiveButton(props.activeButton);\n            this._updateToday(props.isTodayEnabled);\n            this._updatePrev(props.isPrevEnabled);\n            this._updateNext(props.isNextEnabled);\n        };\n        Toolbar.prototype.renderLayout = function (layout) {\n            var el = this.el;\n            this.viewsWithButtons = [];\n            appendToElement(el, this.renderSection('left', layout.left));\n            appendToElement(el, this.renderSection('center', layout.center));\n            appendToElement(el, this.renderSection('right', layout.right));\n        };\n        Toolbar.prototype.unrenderLayout = function () {\n            this.el.innerHTML = '';\n        };\n        Toolbar.prototype.renderSection = function (position, buttonStr) {\n            var _this = this;\n            var _a = this, theme = _a.theme, calendar = _a.calendar;\n            var optionsManager = calendar.optionsManager;\n            var viewSpecs = calendar.viewSpecs;\n            var sectionEl = createElement('div', { className: 'fc-' + position });\n            var calendarCustomButtons = optionsManager.computed.customButtons || {};\n            var calendarButtonTextOverrides = optionsManager.overrides.buttonText || {};\n            var calendarButtonText = optionsManager.computed.buttonText || {};\n            if (buttonStr) {\n                buttonStr.split(' ').forEach(function (buttonGroupStr, i) {\n                    var groupChildren = [];\n                    var isOnlyButtons = true;\n                    var groupEl;\n                    buttonGroupStr.split(',').forEach(function (buttonName, j) {\n                        var customButtonProps;\n                        var viewSpec;\n                        var buttonClick;\n                        var buttonIcon; // only one of these will be set\n                        var buttonText; // \"\n                        var buttonInnerHtml;\n                        var buttonClasses;\n                        var buttonEl;\n                        var buttonAriaAttr;\n                        if (buttonName === 'title') {\n                            groupChildren.push(htmlToElement('<h2>&nbsp;</h2>')); // we always want it to take up height\n                            isOnlyButtons = false;\n                        }\n                        else {\n                            if ((customButtonProps = calendarCustomButtons[buttonName])) {\n                                buttonClick = function (ev) {\n                                    if (customButtonProps.click) {\n                                        customButtonProps.click.call(buttonEl, ev);\n                                    }\n                                };\n                                (buttonIcon = theme.getCustomButtonIconClass(customButtonProps)) ||\n                                    (buttonIcon = theme.getIconClass(buttonName)) ||\n                                    (buttonText = customButtonProps.text);\n                            }\n                            else if ((viewSpec = viewSpecs[buttonName])) {\n                                _this.viewsWithButtons.push(buttonName);\n                                buttonClick = function () {\n                                    calendar.changeView(buttonName);\n                                };\n                                (buttonText = viewSpec.buttonTextOverride) ||\n                                    (buttonIcon = theme.getIconClass(buttonName)) ||\n                                    (buttonText = viewSpec.buttonTextDefault);\n                            }\n                            else if (calendar[buttonName]) { // a calendar method\n                                buttonClick = function () {\n                                    calendar[buttonName]();\n                                };\n                                (buttonText = calendarButtonTextOverrides[buttonName]) ||\n                                    (buttonIcon = theme.getIconClass(buttonName)) ||\n                                    (buttonText = calendarButtonText[buttonName]);\n                                //            ^ everything else is considered default\n                            }\n                            if (buttonClick) {\n                                buttonClasses = [\n                                    'fc-' + buttonName + '-button',\n                                    theme.getClass('button')\n                                ];\n                                if (buttonText) {\n                                    buttonInnerHtml = htmlEscape(buttonText);\n                                    buttonAriaAttr = '';\n                                }\n                                else if (buttonIcon) {\n                                    buttonInnerHtml = \"<span class='\" + buttonIcon + \"'></span>\";\n                                    buttonAriaAttr = ' aria-label=\"' + buttonName + '\"';\n                                }\n                                buttonEl = htmlToElement(// type=\"button\" so that it doesn't submit a form\n                                '<button type=\"button\" class=\"' + buttonClasses.join(' ') + '\"' +\n                                    buttonAriaAttr +\n                                    '>' + buttonInnerHtml + '</button>');\n                                buttonEl.addEventListener('click', buttonClick);\n                                groupChildren.push(buttonEl);\n                            }\n                        }\n                    });\n                    if (groupChildren.length > 1) {\n                        groupEl = document.createElement('div');\n                        var buttonGroupClassName = theme.getClass('buttonGroup');\n                        if (isOnlyButtons && buttonGroupClassName) {\n                            groupEl.classList.add(buttonGroupClassName);\n                        }\n                        appendToElement(groupEl, groupChildren);\n                        sectionEl.appendChild(groupEl);\n                    }\n                    else {\n                        appendToElement(sectionEl, groupChildren); // 1 or 0 children\n                    }\n                });\n            }\n            return sectionEl;\n        };\n        Toolbar.prototype.updateToday = function (isTodayEnabled) {\n            this.toggleButtonEnabled('today', isTodayEnabled);\n        };\n        Toolbar.prototype.updatePrev = function (isPrevEnabled) {\n            this.toggleButtonEnabled('prev', isPrevEnabled);\n        };\n        Toolbar.prototype.updateNext = function (isNextEnabled) {\n            this.toggleButtonEnabled('next', isNextEnabled);\n        };\n        Toolbar.prototype.updateTitle = function (text) {\n            findElements(this.el, 'h2').forEach(function (titleEl) {\n                titleEl.innerText = text;\n            });\n        };\n        Toolbar.prototype.updateActiveButton = function (buttonName) {\n            var className = this.theme.getClass('buttonActive');\n            findElements(this.el, 'button').forEach(function (buttonEl) {\n                if (buttonName && buttonEl.classList.contains('fc-' + buttonName + '-button')) {\n                    buttonEl.classList.add(className);\n                }\n                else {\n                    buttonEl.classList.remove(className);\n                }\n            });\n        };\n        Toolbar.prototype.toggleButtonEnabled = function (buttonName, bool) {\n            findElements(this.el, '.fc-' + buttonName + '-button').forEach(function (buttonEl) {\n                buttonEl.disabled = !bool;\n            });\n        };\n        return Toolbar;\n    }(Component));\n\n    var CalendarComponent = /** @class */ (function (_super) {\n        __extends(CalendarComponent, _super);\n        function CalendarComponent(context, el) {\n            var _this = _super.call(this, context) || this;\n            _this._renderToolbars = memoizeRendering(_this.renderToolbars);\n            _this.buildViewPropTransformers = memoize(buildViewPropTransformers);\n            _this.el = el;\n            prependToElement(el, _this.contentEl = createElement('div', { className: 'fc-view-container' }));\n            var calendar = _this.calendar;\n            for (var _i = 0, _a = calendar.pluginSystem.hooks.viewContainerModifiers; _i < _a.length; _i++) {\n                var modifyViewContainer = _a[_i];\n                modifyViewContainer(_this.contentEl, calendar);\n            }\n            _this.toggleElClassNames(true);\n            _this.computeTitle = memoize(computeTitle);\n            _this.parseBusinessHours = memoize(function (input) {\n                return parseBusinessHours(input, _this.calendar);\n            });\n            return _this;\n        }\n        CalendarComponent.prototype.destroy = function () {\n            if (this.header) {\n                this.header.destroy();\n            }\n            if (this.footer) {\n                this.footer.destroy();\n            }\n            if (this.view) {\n                this.view.destroy();\n            }\n            removeElement(this.contentEl);\n            this.toggleElClassNames(false);\n            _super.prototype.destroy.call(this);\n        };\n        CalendarComponent.prototype.toggleElClassNames = function (bool) {\n            var classList = this.el.classList;\n            var dirClassName = 'fc-' + this.opt('dir');\n            var themeClassName = this.theme.getClass('widget');\n            if (bool) {\n                classList.add('fc');\n                classList.add(dirClassName);\n                classList.add(themeClassName);\n            }\n            else {\n                classList.remove('fc');\n                classList.remove(dirClassName);\n                classList.remove(themeClassName);\n            }\n        };\n        CalendarComponent.prototype.render = function (props) {\n            this.freezeHeight();\n            var title = this.computeTitle(props.dateProfile, props.viewSpec.options);\n            this._renderToolbars(props.viewSpec, props.dateProfile, props.currentDate, props.dateProfileGenerator, title);\n            this.renderView(props, title);\n            this.updateSize();\n            this.thawHeight();\n        };\n        CalendarComponent.prototype.renderToolbars = function (viewSpec, dateProfile, currentDate, dateProfileGenerator, title) {\n            var headerLayout = this.opt('header');\n            var footerLayout = this.opt('footer');\n            var now = this.calendar.getNow();\n            var todayInfo = dateProfileGenerator.build(now);\n            var prevInfo = dateProfileGenerator.buildPrev(dateProfile, currentDate);\n            var nextInfo = dateProfileGenerator.buildNext(dateProfile, currentDate);\n            var toolbarProps = {\n                title: title,\n                activeButton: viewSpec.type,\n                isTodayEnabled: todayInfo.isValid && !rangeContainsMarker(dateProfile.currentRange, now),\n                isPrevEnabled: prevInfo.isValid,\n                isNextEnabled: nextInfo.isValid\n            };\n            if (headerLayout) {\n                if (!this.header) {\n                    this.header = new Toolbar(this.context, 'fc-header-toolbar');\n                    prependToElement(this.el, this.header.el);\n                }\n                this.header.receiveProps(__assign({ layout: headerLayout }, toolbarProps));\n            }\n            else if (this.header) {\n                this.header.destroy();\n                this.header = null;\n            }\n            if (footerLayout) {\n                if (!this.footer) {\n                    this.footer = new Toolbar(this.context, 'fc-footer-toolbar');\n                    appendToElement(this.el, this.footer.el);\n                }\n                this.footer.receiveProps(__assign({ layout: footerLayout }, toolbarProps));\n            }\n            else if (this.footer) {\n                this.footer.destroy();\n                this.footer = null;\n            }\n        };\n        CalendarComponent.prototype.renderView = function (props, title) {\n            var view = this.view;\n            var viewSpec = props.viewSpec, dateProfileGenerator = props.dateProfileGenerator;\n            if (!view || view.viewSpec !== viewSpec) {\n                if (view) {\n                    view.destroy();\n                }\n                view = this.view = new viewSpec['class']({\n                    calendar: this.calendar,\n                    view: null,\n                    dateEnv: this.dateEnv,\n                    theme: this.theme,\n                    options: viewSpec.options\n                }, viewSpec, dateProfileGenerator, this.contentEl);\n            }\n            else {\n                view.addScroll(view.queryScroll());\n            }\n            view.title = title; // for the API\n            var viewProps = {\n                dateProfile: props.dateProfile,\n                businessHours: this.parseBusinessHours(viewSpec.options.businessHours),\n                eventStore: props.eventStore,\n                eventUiBases: props.eventUiBases,\n                dateSelection: props.dateSelection,\n                eventSelection: props.eventSelection,\n                eventDrag: props.eventDrag,\n                eventResize: props.eventResize\n            };\n            var transformers = this.buildViewPropTransformers(this.calendar.pluginSystem.hooks.viewPropsTransformers);\n            for (var _i = 0, transformers_1 = transformers; _i < transformers_1.length; _i++) {\n                var transformer = transformers_1[_i];\n                __assign(viewProps, transformer.transform(viewProps, viewSpec, props, view));\n            }\n            view.receiveProps(viewProps);\n        };\n        // Sizing\n        // -----------------------------------------------------------------------------------------------------------------\n        CalendarComponent.prototype.updateSize = function (isResize) {\n            if (isResize === void 0) { isResize = false; }\n            var view = this.view;\n            if (isResize) {\n                view.addScroll(view.queryScroll());\n            }\n            if (isResize || this.isHeightAuto == null) {\n                this.computeHeightVars();\n            }\n            view.updateSize(isResize, this.viewHeight, this.isHeightAuto);\n            view.updateNowIndicator(); // we need to guarantee this will run after updateSize\n            view.popScroll(isResize);\n        };\n        CalendarComponent.prototype.computeHeightVars = function () {\n            var calendar = this.calendar; // yuck. need to handle dynamic options\n            var heightInput = calendar.opt('height');\n            var contentHeightInput = calendar.opt('contentHeight');\n            this.isHeightAuto = heightInput === 'auto' || contentHeightInput === 'auto';\n            if (typeof contentHeightInput === 'number') { // exists and not 'auto'\n                this.viewHeight = contentHeightInput;\n            }\n            else if (typeof contentHeightInput === 'function') { // exists and is a function\n                this.viewHeight = contentHeightInput();\n            }\n            else if (typeof heightInput === 'number') { // exists and not 'auto'\n                this.viewHeight = heightInput - this.queryToolbarsHeight();\n            }\n            else if (typeof heightInput === 'function') { // exists and is a function\n                this.viewHeight = heightInput() - this.queryToolbarsHeight();\n            }\n            else if (heightInput === 'parent') { // set to height of parent element\n                this.viewHeight = this.el.parentNode.offsetHeight - this.queryToolbarsHeight();\n            }\n            else {\n                this.viewHeight = Math.round(this.contentEl.offsetWidth /\n                    Math.max(calendar.opt('aspectRatio'), .5));\n            }\n        };\n        CalendarComponent.prototype.queryToolbarsHeight = function () {\n            var height = 0;\n            if (this.header) {\n                height += computeHeightAndMargins(this.header.el);\n            }\n            if (this.footer) {\n                height += computeHeightAndMargins(this.footer.el);\n            }\n            return height;\n        };\n        // Height \"Freezing\"\n        // -----------------------------------------------------------------------------------------------------------------\n        CalendarComponent.prototype.freezeHeight = function () {\n            applyStyle(this.el, {\n                height: this.el.offsetHeight,\n                overflow: 'hidden'\n            });\n        };\n        CalendarComponent.prototype.thawHeight = function () {\n            applyStyle(this.el, {\n                height: '',\n                overflow: ''\n            });\n        };\n        return CalendarComponent;\n    }(Component));\n    // Title and Date Formatting\n    // -----------------------------------------------------------------------------------------------------------------\n    // Computes what the title at the top of the calendar should be for this view\n    function computeTitle(dateProfile, viewOptions) {\n        var range;\n        // for views that span a large unit of time, show the proper interval, ignoring stray days before and after\n        if (/^(year|month)$/.test(dateProfile.currentRangeUnit)) {\n            range = dateProfile.currentRange;\n        }\n        else { // for day units or smaller, use the actual day range\n            range = dateProfile.activeRange;\n        }\n        return this.dateEnv.formatRange(range.start, range.end, createFormatter(viewOptions.titleFormat || computeTitleFormat(dateProfile), viewOptions.titleRangeSeparator), { isEndExclusive: dateProfile.isRangeAllDay });\n    }\n    // Generates the format string that should be used to generate the title for the current date range.\n    // Attempts to compute the most appropriate format if not explicitly specified with `titleFormat`.\n    function computeTitleFormat(dateProfile) {\n        var currentRangeUnit = dateProfile.currentRangeUnit;\n        if (currentRangeUnit === 'year') {\n            return { year: 'numeric' };\n        }\n        else if (currentRangeUnit === 'month') {\n            return { year: 'numeric', month: 'long' }; // like \"September 2014\"\n        }\n        else {\n            var days = diffWholeDays(dateProfile.currentRange.start, dateProfile.currentRange.end);\n            if (days !== null && days > 1) {\n                // multi-day range. shorter, like \"Sep 9 - 10 2014\"\n                return { year: 'numeric', month: 'short', day: 'numeric' };\n            }\n            else {\n                // one day. longer, like \"September 9 2014\"\n                return { year: 'numeric', month: 'long', day: 'numeric' };\n            }\n        }\n    }\n    // Plugin\n    // -----------------------------------------------------------------------------------------------------------------\n    function buildViewPropTransformers(theClasses) {\n        return theClasses.map(function (theClass) {\n            return new theClass();\n        });\n    }\n\n    var Interaction = /** @class */ (function () {\n        function Interaction(settings) {\n            this.component = settings.component;\n        }\n        Interaction.prototype.destroy = function () {\n        };\n        return Interaction;\n    }());\n    function parseInteractionSettings(component, input) {\n        return {\n            component: component,\n            el: input.el,\n            useEventCenter: input.useEventCenter != null ? input.useEventCenter : true\n        };\n    }\n    function interactionSettingsToStore(settings) {\n        var _a;\n        return _a = {},\n            _a[settings.component.uid] = settings,\n            _a;\n    }\n    // global state\n    var interactionSettingsStore = {};\n\n    /*\n    Detects when the user clicks on an event within a DateComponent\n    */\n    var EventClicking = /** @class */ (function (_super) {\n        __extends(EventClicking, _super);\n        function EventClicking(settings) {\n            var _this = _super.call(this, settings) || this;\n            _this.handleSegClick = function (ev, segEl) {\n                var component = _this.component;\n                var seg = getElSeg(segEl);\n                if (seg && // might be the <div> surrounding the more link\n                    component.isValidSegDownEl(ev.target)) {\n                    // our way to simulate a link click for elements that can't be <a> tags\n                    // grab before trigger fired in case trigger trashes DOM thru rerendering\n                    var hasUrlContainer = elementClosest(ev.target, '.fc-has-url');\n                    var url = hasUrlContainer ? hasUrlContainer.querySelector('a[href]').href : '';\n                    component.publiclyTrigger('eventClick', [\n                        {\n                            el: segEl,\n                            event: new EventApi(component.calendar, seg.eventRange.def, seg.eventRange.instance),\n                            jsEvent: ev,\n                            view: component.view\n                        }\n                    ]);\n                    if (url && !ev.defaultPrevented) {\n                        window.location.href = url;\n                    }\n                }\n            };\n            var component = settings.component;\n            _this.destroy = listenBySelector(component.el, 'click', component.fgSegSelector + ',' + component.bgSegSelector, _this.handleSegClick);\n            return _this;\n        }\n        return EventClicking;\n    }(Interaction));\n\n    /*\n    Triggers events and adds/removes core classNames when the user's pointer\n    enters/leaves event-elements of a component.\n    */\n    var EventHovering = /** @class */ (function (_super) {\n        __extends(EventHovering, _super);\n        function EventHovering(settings) {\n            var _this = _super.call(this, settings) || this;\n            // for simulating an eventMouseLeave when the event el is destroyed while mouse is over it\n            _this.handleEventElRemove = function (el) {\n                if (el === _this.currentSegEl) {\n                    _this.handleSegLeave(null, _this.currentSegEl);\n                }\n            };\n            _this.handleSegEnter = function (ev, segEl) {\n                if (getElSeg(segEl)) { // TODO: better way to make sure not hovering over more+ link or its wrapper\n                    segEl.classList.add('fc-allow-mouse-resize');\n                    _this.currentSegEl = segEl;\n                    _this.triggerEvent('eventMouseEnter', ev, segEl);\n                }\n            };\n            _this.handleSegLeave = function (ev, segEl) {\n                if (_this.currentSegEl) {\n                    segEl.classList.remove('fc-allow-mouse-resize');\n                    _this.currentSegEl = null;\n                    _this.triggerEvent('eventMouseLeave', ev, segEl);\n                }\n            };\n            var component = settings.component;\n            _this.removeHoverListeners = listenToHoverBySelector(component.el, component.fgSegSelector + ',' + component.bgSegSelector, _this.handleSegEnter, _this.handleSegLeave);\n            component.calendar.on('eventElRemove', _this.handleEventElRemove);\n            return _this;\n        }\n        EventHovering.prototype.destroy = function () {\n            this.removeHoverListeners();\n            this.component.calendar.off('eventElRemove', this.handleEventElRemove);\n        };\n        EventHovering.prototype.triggerEvent = function (publicEvName, ev, segEl) {\n            var component = this.component;\n            var seg = getElSeg(segEl);\n            if (!ev || component.isValidSegDownEl(ev.target)) {\n                component.publiclyTrigger(publicEvName, [\n                    {\n                        el: segEl,\n                        event: new EventApi(this.component.calendar, seg.eventRange.def, seg.eventRange.instance),\n                        jsEvent: ev,\n                        view: component.view\n                    }\n                ]);\n            }\n        };\n        return EventHovering;\n    }(Interaction));\n\n    var StandardTheme = /** @class */ (function (_super) {\n        __extends(StandardTheme, _super);\n        function StandardTheme() {\n            return _super !== null && _super.apply(this, arguments) || this;\n        }\n        return StandardTheme;\n    }(Theme));\n    StandardTheme.prototype.classes = {\n        widget: 'fc-unthemed',\n        widgetHeader: 'fc-widget-header',\n        widgetContent: 'fc-widget-content',\n        buttonGroup: 'fc-button-group',\n        button: 'fc-button fc-button-primary',\n        buttonActive: 'fc-button-active',\n        popoverHeader: 'fc-widget-header',\n        popoverContent: 'fc-widget-content',\n        // day grid\n        headerRow: 'fc-widget-header',\n        dayRow: 'fc-widget-content',\n        // list view\n        listView: 'fc-widget-content'\n    };\n    StandardTheme.prototype.baseIconClass = 'fc-icon';\n    StandardTheme.prototype.iconClasses = {\n        close: 'fc-icon-x',\n        prev: 'fc-icon-chevron-left',\n        next: 'fc-icon-chevron-right',\n        prevYear: 'fc-icon-chevrons-left',\n        nextYear: 'fc-icon-chevrons-right'\n    };\n    StandardTheme.prototype.iconOverrideOption = 'buttonIcons';\n    StandardTheme.prototype.iconOverrideCustomButtonOption = 'icon';\n    StandardTheme.prototype.iconOverridePrefix = 'fc-icon-';\n\n    var Calendar = /** @class */ (function () {\n        function Calendar(el, overrides) {\n            var _this = this;\n            this.parseRawLocales = memoize(parseRawLocales);\n            this.buildLocale = memoize(buildLocale);\n            this.buildDateEnv = memoize(buildDateEnv);\n            this.buildTheme = memoize(buildTheme);\n            this.buildEventUiSingleBase = memoize(this._buildEventUiSingleBase);\n            this.buildSelectionConfig = memoize(this._buildSelectionConfig);\n            this.buildEventUiBySource = memoizeOutput(buildEventUiBySource, isPropsEqual);\n            this.buildEventUiBases = memoize(buildEventUiBases);\n            this.interactionsStore = {};\n            this.actionQueue = [];\n            this.isReducing = false;\n            // isDisplaying: boolean = false // installed in DOM? accepting renders?\n            this.needsRerender = false; // needs a render?\n            this.needsFullRerender = false;\n            this.isRendering = false; // currently in the executeRender function?\n            this.renderingPauseDepth = 0;\n            this.buildDelayedRerender = memoize(buildDelayedRerender);\n            this.afterSizingTriggers = {};\n            this.isViewUpdated = false;\n            this.isDatesUpdated = false;\n            this.isEventsUpdated = false;\n            this.el = el;\n            this.optionsManager = new OptionsManager(overrides || {});\n            this.pluginSystem = new PluginSystem();\n            // only do once. don't do in handleOptions. because can't remove plugins\n            var pluginDefs = refinePluginDefs(this.optionsManager.computed.plugins || []);\n            for (var _i = 0, pluginDefs_1 = pluginDefs; _i < pluginDefs_1.length; _i++) {\n                var pluginDef = pluginDefs_1[_i];\n                this.pluginSystem.add(pluginDef);\n            }\n            this.handleOptions(this.optionsManager.computed);\n            this.publiclyTrigger('_init'); // for tests\n            this.hydrate();\n            this.calendarInteractions = this.pluginSystem.hooks.calendarInteractions\n                .map(function (calendarInteractionClass) {\n                return new calendarInteractionClass(_this);\n            });\n        }\n        Object.defineProperty(Calendar.prototype, \"view\", {\n            // public API\n            get: function () {\n                return this.component ? this.component.view : null;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        // Public API for rendering\n        // -----------------------------------------------------------------------------------------------------------------\n        Calendar.prototype.render = function () {\n            if (!this.component) {\n                this.renderableEventStore = createEmptyEventStore();\n                this.bindHandlers();\n                this.executeRender();\n            }\n            else {\n                this.requestRerender(true);\n            }\n        };\n        Calendar.prototype.destroy = function () {\n            if (this.component) {\n                this.unbindHandlers();\n                this.component.destroy(); // don't null-out. in case API needs access\n                this.component = null;\n                for (var _i = 0, _a = this.calendarInteractions; _i < _a.length; _i++) {\n                    var interaction = _a[_i];\n                    interaction.destroy();\n                }\n            }\n        };\n        // Handlers\n        // -----------------------------------------------------------------------------------------------------------------\n        Calendar.prototype.bindHandlers = function () {\n            var _this = this;\n            // event delegation for nav links\n            this.removeNavLinkListener = listenBySelector(this.el, 'click', 'a[data-goto]', function (ev, anchorEl) {\n                var gotoOptions = anchorEl.getAttribute('data-goto');\n                gotoOptions = gotoOptions ? JSON.parse(gotoOptions) : {};\n                var dateEnv = _this.dateEnv;\n                var dateMarker = dateEnv.createMarker(gotoOptions.date);\n                var viewType = gotoOptions.type;\n                // property like \"navLinkDayClick\". might be a string or a function\n                var customAction = _this.viewOpt('navLink' + capitaliseFirstLetter(viewType) + 'Click');\n                if (typeof customAction === 'function') {\n                    customAction(dateEnv.toDate(dateMarker), ev);\n                }\n                else {\n                    if (typeof customAction === 'string') {\n                        viewType = customAction;\n                    }\n                    _this.zoomTo(dateMarker, viewType);\n                }\n            });\n            if (this.opt('handleWindowResize')) {\n                window.addEventListener('resize', this.windowResizeProxy = debounce(// prevents rapid calls\n                this.windowResize.bind(this), this.opt('windowResizeDelay')));\n            }\n        };\n        Calendar.prototype.unbindHandlers = function () {\n            this.removeNavLinkListener();\n            if (this.windowResizeProxy) {\n                window.removeEventListener('resize', this.windowResizeProxy);\n                this.windowResizeProxy = null;\n            }\n        };\n        // Dispatcher\n        // -----------------------------------------------------------------------------------------------------------------\n        Calendar.prototype.hydrate = function () {\n            var _this = this;\n            this.state = this.buildInitialState();\n            var rawSources = this.opt('eventSources') || [];\n            var singleRawSource = this.opt('events');\n            var sources = []; // parsed\n            if (singleRawSource) {\n                rawSources.unshift(singleRawSource);\n            }\n            for (var _i = 0, rawSources_1 = rawSources; _i < rawSources_1.length; _i++) {\n                var rawSource = rawSources_1[_i];\n                var source = parseEventSource(rawSource, this);\n                if (source) {\n                    sources.push(source);\n                }\n            }\n            this.batchRendering(function () {\n                _this.dispatch({ type: 'INIT' }); // pass in sources here?\n                _this.dispatch({ type: 'ADD_EVENT_SOURCES', sources: sources });\n                _this.dispatch({\n                    type: 'SET_VIEW_TYPE',\n                    viewType: _this.opt('defaultView') || _this.pluginSystem.hooks.defaultView\n                });\n            });\n        };\n        Calendar.prototype.buildInitialState = function () {\n            return {\n                viewType: null,\n                loadingLevel: 0,\n                eventSourceLoadingLevel: 0,\n                currentDate: this.getInitialDate(),\n                dateProfile: null,\n                eventSources: {},\n                eventStore: createEmptyEventStore(),\n                dateSelection: null,\n                eventSelection: '',\n                eventDrag: null,\n                eventResize: null\n            };\n        };\n        Calendar.prototype.dispatch = function (action) {\n            this.actionQueue.push(action);\n            if (!this.isReducing) {\n                this.isReducing = true;\n                var oldState = this.state;\n                while (this.actionQueue.length) {\n                    this.state = this.reduce(this.state, this.actionQueue.shift(), this);\n                }\n                var newState = this.state;\n                this.isReducing = false;\n                if (!oldState.loadingLevel && newState.loadingLevel) {\n                    this.publiclyTrigger('loading', [true]);\n                }\n                else if (oldState.loadingLevel && !newState.loadingLevel) {\n                    this.publiclyTrigger('loading', [false]);\n                }\n                var view = this.component && this.component.view;\n                if (oldState.eventStore !== newState.eventStore || this.needsFullRerender) {\n                    if (oldState.eventStore) {\n                        this.isEventsUpdated = true;\n                    }\n                }\n                if (oldState.dateProfile !== newState.dateProfile || this.needsFullRerender) {\n                    if (oldState.dateProfile && view) { // why would view be null!?\n                        this.publiclyTrigger('datesDestroy', [\n                            {\n                                view: view,\n                                el: view.el\n                            }\n                        ]);\n                    }\n                    this.isDatesUpdated = true;\n                }\n                if (oldState.viewType !== newState.viewType || this.needsFullRerender) {\n                    if (oldState.viewType && view) { // why would view be null!?\n                        this.publiclyTrigger('viewSkeletonDestroy', [\n                            {\n                                view: view,\n                                el: view.el\n                            }\n                        ]);\n                    }\n                    this.isViewUpdated = true;\n                }\n                this.requestRerender();\n            }\n        };\n        Calendar.prototype.reduce = function (state, action, calendar) {\n            return reduce(state, action, calendar);\n        };\n        // Render Queue\n        // -----------------------------------------------------------------------------------------------------------------\n        Calendar.prototype.requestRerender = function (needsFull) {\n            if (needsFull === void 0) { needsFull = false; }\n            this.needsRerender = true;\n            this.needsFullRerender = this.needsFullRerender || needsFull;\n            this.delayedRerender(); // will call a debounced-version of tryRerender\n        };\n        Calendar.prototype.tryRerender = function () {\n            if (this.component && // must be accepting renders\n                this.needsRerender && // indicates that a rerender was requested\n                !this.renderingPauseDepth && // not paused\n                !this.isRendering // not currently in the render loop\n            ) {\n                this.executeRender();\n            }\n        };\n        Calendar.prototype.batchRendering = function (func) {\n            this.renderingPauseDepth++;\n            func();\n            this.renderingPauseDepth--;\n            this.requestRerender();\n        };\n        // Rendering\n        // -----------------------------------------------------------------------------------------------------------------\n        Calendar.prototype.executeRender = function () {\n            var needsFullRerender = this.needsFullRerender; // save before clearing\n            // clear these BEFORE the render so that new values will accumulate during render\n            this.needsRerender = false;\n            this.needsFullRerender = false;\n            this.isRendering = true;\n            this.renderComponent(needsFullRerender);\n            this.isRendering = false;\n            // received a rerender request while rendering\n            if (this.needsRerender) {\n                this.delayedRerender();\n            }\n        };\n        /*\n        don't call this directly. use executeRender instead\n        */\n        Calendar.prototype.renderComponent = function (needsFull) {\n            var _a = this, state = _a.state, component = _a.component;\n            var viewType = state.viewType;\n            var viewSpec = this.viewSpecs[viewType];\n            var savedScroll = (needsFull && component) ? component.view.queryScroll() : null;\n            if (!viewSpec) {\n                throw new Error(\"View type \\\"\" + viewType + \"\\\" is not valid\");\n            }\n            // if event sources are still loading and progressive rendering hasn't been enabled,\n            // keep rendering the last fully loaded set of events\n            var renderableEventStore = this.renderableEventStore =\n                (state.eventSourceLoadingLevel && !this.opt('progressiveEventRendering')) ?\n                    this.renderableEventStore :\n                    state.eventStore;\n            var eventUiSingleBase = this.buildEventUiSingleBase(viewSpec.options);\n            var eventUiBySource = this.buildEventUiBySource(state.eventSources);\n            var eventUiBases = this.eventUiBases = this.buildEventUiBases(renderableEventStore.defs, eventUiSingleBase, eventUiBySource);\n            if (needsFull || !component) {\n                if (component) {\n                    component.freezeHeight(); // next component will unfreeze it\n                    component.destroy();\n                }\n                component = this.component = new CalendarComponent({\n                    calendar: this,\n                    view: null,\n                    dateEnv: this.dateEnv,\n                    theme: this.theme,\n                    options: this.optionsManager.computed\n                }, this.el);\n            }\n            component.receiveProps(__assign({}, state, { viewSpec: viewSpec, dateProfile: state.dateProfile, dateProfileGenerator: this.dateProfileGenerators[viewType], eventStore: renderableEventStore, eventUiBases: eventUiBases, dateSelection: state.dateSelection, eventSelection: state.eventSelection, eventDrag: state.eventDrag, eventResize: state.eventResize }));\n            if (savedScroll) {\n                component.view.applyScroll(savedScroll, false);\n            }\n            if (this.isViewUpdated) {\n                this.isViewUpdated = false;\n                this.publiclyTrigger('viewSkeletonRender', [\n                    {\n                        view: component.view,\n                        el: component.view.el\n                    }\n                ]);\n            }\n            if (this.isDatesUpdated) {\n                this.isDatesUpdated = false;\n                this.publiclyTrigger('datesRender', [\n                    {\n                        view: component.view,\n                        el: component.view.el\n                    }\n                ]);\n            }\n            if (this.isEventsUpdated) {\n                this.isEventsUpdated = false;\n            }\n            this.releaseAfterSizingTriggers();\n        };\n        // Options\n        // -----------------------------------------------------------------------------------------------------------------\n        Calendar.prototype.setOption = function (name, value) {\n            var _this = this;\n            var oldDateEnv = this.dateEnv;\n            this.optionsManager.add(name, value);\n            this.handleOptions(this.optionsManager.computed);\n            if (name === 'height' || name === 'contentHeight' || name === 'aspectRatio') {\n                this.updateSize();\n            }\n            else if (name === 'defaultDate' || name === 'defaultView') ;\n            else if (/^(event|select)(Overlap|Constraint|Allow)$/.test(name)) ;\n            else {\n                this.needsFullRerender = true;\n                this.batchRendering(function () {\n                    if (name === 'timeZone') {\n                        _this.dispatch({\n                            type: 'CHANGE_TIMEZONE',\n                            oldDateEnv: oldDateEnv\n                        });\n                    }\n                    /* HACK\n                    has the same effect as calling this.requestRerender(true)\n                    but recomputes the state's dateProfile\n                    */\n                    _this.dispatch({\n                        type: 'SET_VIEW_TYPE',\n                        viewType: _this.state.viewType\n                    });\n                });\n            }\n        };\n        Calendar.prototype.getOption = function (name) {\n            return this.optionsManager.computed[name];\n        };\n        Calendar.prototype.opt = function (name) {\n            return this.optionsManager.computed[name];\n        };\n        Calendar.prototype.viewOpt = function (name) {\n            return this.viewOpts()[name];\n        };\n        Calendar.prototype.viewOpts = function () {\n            return this.viewSpecs[this.state.viewType].options;\n        };\n        Calendar.prototype.handleOptions = function (options) {\n            var _this = this;\n            var pluginHooks = this.pluginSystem.hooks;\n            this.defaultAllDayEventDuration = createDuration(options.defaultAllDayEventDuration);\n            this.defaultTimedEventDuration = createDuration(options.defaultTimedEventDuration);\n            this.delayedRerender = this.buildDelayedRerender(options.rerenderDelay);\n            this.theme = this.buildTheme(options);\n            var available = this.parseRawLocales(options.locales);\n            this.availableRawLocales = available.map;\n            var locale = this.buildLocale(options.locale || available.defaultCode, available.map);\n            this.dateEnv = this.buildDateEnv(locale, options.timeZone, pluginHooks.namedTimeZonedImpl, options.firstDay, options.weekNumberCalculation, options.weekLabel, pluginHooks.cmdFormatter);\n            this.selectionConfig = this.buildSelectionConfig(options); // needs dateEnv. do after :(\n            // ineffecient to do every time?\n            this.viewSpecs = buildViewSpecs(pluginHooks.views, this.optionsManager);\n            // ineffecient to do every time?\n            this.dateProfileGenerators = mapHash(this.viewSpecs, function (viewSpec) {\n                return new viewSpec.class.prototype.dateProfileGeneratorClass(viewSpec, _this);\n            });\n        };\n        Calendar.prototype.getAvailableLocaleCodes = function () {\n            return Object.keys(this.availableRawLocales);\n        };\n        Calendar.prototype._buildSelectionConfig = function (rawOpts) {\n            return processScopedUiProps('select', rawOpts, this);\n        };\n        Calendar.prototype._buildEventUiSingleBase = function (rawOpts) {\n            if (rawOpts.editable) { // so 'editable' affected events\n                rawOpts = __assign({}, rawOpts, { eventEditable: true });\n            }\n            return processScopedUiProps('event', rawOpts, this);\n        };\n        // Trigger\n        // -----------------------------------------------------------------------------------------------------------------\n        Calendar.prototype.hasPublicHandlers = function (name) {\n            return this.hasHandlers(name) ||\n                this.opt(name); // handler specified in options\n        };\n        Calendar.prototype.publiclyTrigger = function (name, args) {\n            var optHandler = this.opt(name);\n            this.triggerWith(name, this, args);\n            if (optHandler) {\n                return optHandler.apply(this, args);\n            }\n        };\n        Calendar.prototype.publiclyTriggerAfterSizing = function (name, args) {\n            var afterSizingTriggers = this.afterSizingTriggers;\n            (afterSizingTriggers[name] || (afterSizingTriggers[name] = [])).push(args);\n        };\n        Calendar.prototype.releaseAfterSizingTriggers = function () {\n            var afterSizingTriggers = this.afterSizingTriggers;\n            for (var name_1 in afterSizingTriggers) {\n                for (var _i = 0, _a = afterSizingTriggers[name_1]; _i < _a.length; _i++) {\n                    var args = _a[_i];\n                    this.publiclyTrigger(name_1, args);\n                }\n            }\n            this.afterSizingTriggers = {};\n        };\n        // View\n        // -----------------------------------------------------------------------------------------------------------------\n        // Returns a boolean about whether the view is okay to instantiate at some point\n        Calendar.prototype.isValidViewType = function (viewType) {\n            return Boolean(this.viewSpecs[viewType]);\n        };\n        Calendar.prototype.changeView = function (viewType, dateOrRange) {\n            var dateMarker = null;\n            if (dateOrRange) {\n                if (dateOrRange.start && dateOrRange.end) { // a range\n                    this.optionsManager.add('visibleRange', dateOrRange); // will not rerender\n                    this.handleOptions(this.optionsManager.computed); // ...but yuck\n                }\n                else { // a date\n                    dateMarker = this.dateEnv.createMarker(dateOrRange); // just like gotoDate\n                }\n            }\n            this.unselect();\n            this.dispatch({\n                type: 'SET_VIEW_TYPE',\n                viewType: viewType,\n                dateMarker: dateMarker\n            });\n        };\n        // Forces navigation to a view for the given date.\n        // `viewType` can be a specific view name or a generic one like \"week\" or \"day\".\n        // needs to change\n        Calendar.prototype.zoomTo = function (dateMarker, viewType) {\n            var spec;\n            viewType = viewType || 'day'; // day is default zoom\n            spec = this.viewSpecs[viewType] ||\n                this.getUnitViewSpec(viewType);\n            this.unselect();\n            if (spec) {\n                this.dispatch({\n                    type: 'SET_VIEW_TYPE',\n                    viewType: spec.type,\n                    dateMarker: dateMarker\n                });\n            }\n            else {\n                this.dispatch({\n                    type: 'SET_DATE',\n                    dateMarker: dateMarker\n                });\n            }\n        };\n        // Given a duration singular unit, like \"week\" or \"day\", finds a matching view spec.\n        // Preference is given to views that have corresponding buttons.\n        Calendar.prototype.getUnitViewSpec = function (unit) {\n            var viewTypes;\n            var i;\n            var spec;\n            // put views that have buttons first. there will be duplicates, but oh well\n            viewTypes = this.component.header.viewsWithButtons; // TODO: include footer as well?\n            for (var viewType in this.viewSpecs) {\n                viewTypes.push(viewType);\n            }\n            for (i = 0; i < viewTypes.length; i++) {\n                spec = this.viewSpecs[viewTypes[i]];\n                if (spec) {\n                    if (spec.singleUnit === unit) {\n                        return spec;\n                    }\n                }\n            }\n        };\n        // Current Date\n        // -----------------------------------------------------------------------------------------------------------------\n        Calendar.prototype.getInitialDate = function () {\n            var defaultDateInput = this.opt('defaultDate');\n            // compute the initial ambig-timezone date\n            if (defaultDateInput != null) {\n                return this.dateEnv.createMarker(defaultDateInput);\n            }\n            else {\n                return this.getNow(); // getNow already returns unzoned\n            }\n        };\n        Calendar.prototype.prev = function () {\n            this.unselect();\n            this.dispatch({ type: 'PREV' });\n        };\n        Calendar.prototype.next = function () {\n            this.unselect();\n            this.dispatch({ type: 'NEXT' });\n        };\n        Calendar.prototype.prevYear = function () {\n            this.unselect();\n            this.dispatch({\n                type: 'SET_DATE',\n                dateMarker: this.dateEnv.addYears(this.state.currentDate, -1)\n            });\n        };\n        Calendar.prototype.nextYear = function () {\n            this.unselect();\n            this.dispatch({\n                type: 'SET_DATE',\n                dateMarker: this.dateEnv.addYears(this.state.currentDate, 1)\n            });\n        };\n        Calendar.prototype.today = function () {\n            this.unselect();\n            this.dispatch({\n                type: 'SET_DATE',\n                dateMarker: this.getNow()\n            });\n        };\n        Calendar.prototype.gotoDate = function (zonedDateInput) {\n            this.unselect();\n            this.dispatch({\n                type: 'SET_DATE',\n                dateMarker: this.dateEnv.createMarker(zonedDateInput)\n            });\n        };\n        Calendar.prototype.incrementDate = function (deltaInput) {\n            var delta = createDuration(deltaInput);\n            if (delta) { // else, warn about invalid input?\n                this.unselect();\n                this.dispatch({\n                    type: 'SET_DATE',\n                    dateMarker: this.dateEnv.add(this.state.currentDate, delta)\n                });\n            }\n        };\n        // for external API\n        Calendar.prototype.getDate = function () {\n            return this.dateEnv.toDate(this.state.currentDate);\n        };\n        // Date Formatting Utils\n        // -----------------------------------------------------------------------------------------------------------------\n        Calendar.prototype.formatDate = function (d, formatter) {\n            var dateEnv = this.dateEnv;\n            return dateEnv.format(dateEnv.createMarker(d), createFormatter(formatter));\n        };\n        // `settings` is for formatter AND isEndExclusive\n        Calendar.prototype.formatRange = function (d0, d1, settings) {\n            var dateEnv = this.dateEnv;\n            return dateEnv.formatRange(dateEnv.createMarker(d0), dateEnv.createMarker(d1), createFormatter(settings, this.opt('defaultRangeSeparator')), settings);\n        };\n        Calendar.prototype.formatIso = function (d, omitTime) {\n            var dateEnv = this.dateEnv;\n            return dateEnv.formatIso(dateEnv.createMarker(d), { omitTime: omitTime });\n        };\n        // Sizing\n        // -----------------------------------------------------------------------------------------------------------------\n        Calendar.prototype.windowResize = function (ev) {\n            if (!this.isHandlingWindowResize &&\n                this.component && // why?\n                ev.target === window // not a jqui resize event\n            ) {\n                this.isHandlingWindowResize = true;\n                this.updateSize();\n                this.publiclyTrigger('windowResize', [this.view]);\n                this.isHandlingWindowResize = false;\n            }\n        };\n        Calendar.prototype.updateSize = function () {\n            this.component.updateSize(true);\n        };\n        // Component Registration\n        // -----------------------------------------------------------------------------------------------------------------\n        Calendar.prototype.registerInteractiveComponent = function (component, settingsInput) {\n            var settings = parseInteractionSettings(component, settingsInput);\n            var DEFAULT_INTERACTIONS = [\n                EventClicking,\n                EventHovering\n            ];\n            var interactionClasses = DEFAULT_INTERACTIONS.concat(this.pluginSystem.hooks.componentInteractions);\n            var interactions = interactionClasses.map(function (interactionClass) {\n                return new interactionClass(settings);\n            });\n            this.interactionsStore[component.uid] = interactions;\n            interactionSettingsStore[component.uid] = settings;\n        };\n        Calendar.prototype.unregisterInteractiveComponent = function (component) {\n            for (var _i = 0, _a = this.interactionsStore[component.uid]; _i < _a.length; _i++) {\n                var listener = _a[_i];\n                listener.destroy();\n            }\n            delete this.interactionsStore[component.uid];\n            delete interactionSettingsStore[component.uid];\n        };\n        // Date Selection / Event Selection / DayClick\n        // -----------------------------------------------------------------------------------------------------------------\n        // this public method receives start/end dates in any format, with any timezone\n        // NOTE: args were changed from v3\n        Calendar.prototype.select = function (dateOrObj, endDate) {\n            var selectionInput;\n            if (endDate == null) {\n                if (dateOrObj.start != null) {\n                    selectionInput = dateOrObj;\n                }\n                else {\n                    selectionInput = {\n                        start: dateOrObj,\n                        end: null\n                    };\n                }\n            }\n            else {\n                selectionInput = {\n                    start: dateOrObj,\n                    end: endDate\n                };\n            }\n            var selection = parseDateSpan(selectionInput, this.dateEnv, createDuration({ days: 1 }) // TODO: cache this?\n            );\n            if (selection) { // throw parse error otherwise?\n                this.dispatch({ type: 'SELECT_DATES', selection: selection });\n                this.triggerDateSelect(selection);\n            }\n        };\n        // public method\n        Calendar.prototype.unselect = function (pev) {\n            if (this.state.dateSelection) {\n                this.dispatch({ type: 'UNSELECT_DATES' });\n                this.triggerDateUnselect(pev);\n            }\n        };\n        Calendar.prototype.triggerDateSelect = function (selection, pev) {\n            var arg = this.buildDateSpanApi(selection);\n            arg.jsEvent = pev ? pev.origEvent : null;\n            arg.view = this.view;\n            this.publiclyTrigger('select', [arg]);\n        };\n        Calendar.prototype.triggerDateUnselect = function (pev) {\n            this.publiclyTrigger('unselect', [\n                {\n                    jsEvent: pev ? pev.origEvent : null,\n                    view: this.view\n                }\n            ]);\n        };\n        // TODO: receive pev?\n        Calendar.prototype.triggerDateClick = function (dateSpan, dayEl, view, ev) {\n            var arg = this.buildDatePointApi(dateSpan);\n            arg.dayEl = dayEl;\n            arg.jsEvent = ev;\n            arg.view = view;\n            this.publiclyTrigger('dateClick', [arg]);\n        };\n        Calendar.prototype.buildDatePointApi = function (dateSpan) {\n            var props = {};\n            for (var _i = 0, _a = this.pluginSystem.hooks.datePointTransforms; _i < _a.length; _i++) {\n                var transform = _a[_i];\n                __assign(props, transform(dateSpan, this));\n            }\n            __assign(props, buildDatePointApi(dateSpan, this.dateEnv));\n            return props;\n        };\n        Calendar.prototype.buildDateSpanApi = function (dateSpan) {\n            var props = {};\n            for (var _i = 0, _a = this.pluginSystem.hooks.dateSpanTransforms; _i < _a.length; _i++) {\n                var transform = _a[_i];\n                __assign(props, transform(dateSpan, this));\n            }\n            __assign(props, buildDateSpanApi(dateSpan, this.dateEnv));\n            return props;\n        };\n        // Date Utils\n        // -----------------------------------------------------------------------------------------------------------------\n        // Returns a DateMarker for the current date, as defined by the client's computer or from the `now` option\n        Calendar.prototype.getNow = function () {\n            var now = this.opt('now');\n            if (typeof now === 'function') {\n                now = now();\n            }\n            if (now == null) {\n                return this.dateEnv.createNowMarker();\n            }\n            return this.dateEnv.createMarker(now);\n        };\n        // Event-Date Utilities\n        // -----------------------------------------------------------------------------------------------------------------\n        // Given an event's allDay status and start date, return what its fallback end date should be.\n        // TODO: rename to computeDefaultEventEnd\n        Calendar.prototype.getDefaultEventEnd = function (allDay, marker) {\n            var end = marker;\n            if (allDay) {\n                end = startOfDay(end);\n                end = this.dateEnv.add(end, this.defaultAllDayEventDuration);\n            }\n            else {\n                end = this.dateEnv.add(end, this.defaultTimedEventDuration);\n            }\n            return end;\n        };\n        // Public Events API\n        // -----------------------------------------------------------------------------------------------------------------\n        Calendar.prototype.addEvent = function (eventInput, sourceInput) {\n            if (eventInput instanceof EventApi) {\n                var def = eventInput._def;\n                var instance = eventInput._instance;\n                // not already present? don't want to add an old snapshot\n                if (!this.state.eventStore.defs[def.defId]) {\n                    this.dispatch({\n                        type: 'ADD_EVENTS',\n                        eventStore: eventTupleToStore({ def: def, instance: instance }) // TODO: better util for two args?\n                    });\n                }\n                return eventInput;\n            }\n            var sourceId;\n            if (sourceInput instanceof EventSourceApi) {\n                sourceId = sourceInput.internalEventSource.sourceId;\n            }\n            else if (sourceInput != null) {\n                var sourceApi = this.getEventSourceById(sourceInput); // TODO: use an internal function\n                if (!sourceApi) {\n                    console.warn('Could not find an event source with ID \"' + sourceInput + '\"'); // TODO: test\n                    return null;\n                }\n                else {\n                    sourceId = sourceApi.internalEventSource.sourceId;\n                }\n            }\n            var tuple = parseEvent(eventInput, sourceId, this);\n            if (tuple) {\n                this.dispatch({\n                    type: 'ADD_EVENTS',\n                    eventStore: eventTupleToStore(tuple)\n                });\n                return new EventApi(this, tuple.def, tuple.def.recurringDef ? null : tuple.instance);\n            }\n            return null;\n        };\n        // TODO: optimize\n        Calendar.prototype.getEventById = function (id) {\n            var _a = this.state.eventStore, defs = _a.defs, instances = _a.instances;\n            id = String(id);\n            for (var defId in defs) {\n                var def = defs[defId];\n                if (def.publicId === id) {\n                    if (def.recurringDef) {\n                        return new EventApi(this, def, null);\n                    }\n                    else {\n                        for (var instanceId in instances) {\n                            var instance = instances[instanceId];\n                            if (instance.defId === def.defId) {\n                                return new EventApi(this, def, instance);\n                            }\n                        }\n                    }\n                }\n            }\n            return null;\n        };\n        Calendar.prototype.getEvents = function () {\n            var _a = this.state.eventStore, defs = _a.defs, instances = _a.instances;\n            var eventApis = [];\n            for (var id in instances) {\n                var instance = instances[id];\n                var def = defs[instance.defId];\n                eventApis.push(new EventApi(this, def, instance));\n            }\n            return eventApis;\n        };\n        Calendar.prototype.removeAllEvents = function () {\n            this.dispatch({ type: 'REMOVE_ALL_EVENTS' });\n        };\n        Calendar.prototype.rerenderEvents = function () {\n            this.dispatch({ type: 'RESET_EVENTS' });\n        };\n        // Public Event Sources API\n        // -----------------------------------------------------------------------------------------------------------------\n        Calendar.prototype.getEventSources = function () {\n            var sourceHash = this.state.eventSources;\n            var sourceApis = [];\n            for (var internalId in sourceHash) {\n                sourceApis.push(new EventSourceApi(this, sourceHash[internalId]));\n            }\n            return sourceApis;\n        };\n        Calendar.prototype.getEventSourceById = function (id) {\n            var sourceHash = this.state.eventSources;\n            id = String(id);\n            for (var sourceId in sourceHash) {\n                if (sourceHash[sourceId].publicId === id) {\n                    return new EventSourceApi(this, sourceHash[sourceId]);\n                }\n            }\n            return null;\n        };\n        Calendar.prototype.addEventSource = function (sourceInput) {\n            if (sourceInput instanceof EventSourceApi) {\n                // not already present? don't want to add an old snapshot\n                if (!this.state.eventSources[sourceInput.internalEventSource.sourceId]) {\n                    this.dispatch({\n                        type: 'ADD_EVENT_SOURCES',\n                        sources: [sourceInput.internalEventSource]\n                    });\n                }\n                return sourceInput;\n            }\n            var eventSource = parseEventSource(sourceInput, this);\n            if (eventSource) { // TODO: error otherwise?\n                this.dispatch({ type: 'ADD_EVENT_SOURCES', sources: [eventSource] });\n                return new EventSourceApi(this, eventSource);\n            }\n            return null;\n        };\n        Calendar.prototype.removeAllEventSources = function () {\n            this.dispatch({ type: 'REMOVE_ALL_EVENT_SOURCES' });\n        };\n        Calendar.prototype.refetchEvents = function () {\n            this.dispatch({ type: 'FETCH_EVENT_SOURCES' });\n        };\n        return Calendar;\n    }());\n    EmitterMixin.mixInto(Calendar);\n    // for memoizers\n    // -----------------------------------------------------------------------------------------------------------------\n    function buildDateEnv(locale, timeZone, namedTimeZoneImpl, firstDay, weekNumberCalculation, weekLabel, cmdFormatter) {\n        return new DateEnv({\n            calendarSystem: 'gregory',\n            timeZone: timeZone,\n            namedTimeZoneImpl: namedTimeZoneImpl,\n            locale: locale,\n            weekNumberCalculation: weekNumberCalculation,\n            firstDay: firstDay,\n            weekLabel: weekLabel,\n            cmdFormatter: cmdFormatter\n        });\n    }\n    function buildTheme(calendarOptions) {\n        var themeClass = this.pluginSystem.hooks.themeClasses[calendarOptions.themeSystem] || StandardTheme;\n        return new themeClass(calendarOptions);\n    }\n    function buildDelayedRerender(wait) {\n        var func = this.tryRerender.bind(this);\n        if (wait != null) {\n            func = debounce(func, wait);\n        }\n        return func;\n    }\n    function buildEventUiBySource(eventSources) {\n        return mapHash(eventSources, function (eventSource) {\n            return eventSource.ui;\n        });\n    }\n    function buildEventUiBases(eventDefs, eventUiSingleBase, eventUiBySource) {\n        var eventUiBases = { '': eventUiSingleBase };\n        for (var defId in eventDefs) {\n            var def = eventDefs[defId];\n            if (def.sourceId && eventUiBySource[def.sourceId]) {\n                eventUiBases[defId] = eventUiBySource[def.sourceId];\n            }\n        }\n        return eventUiBases;\n    }\n\n    var View = /** @class */ (function (_super) {\n        __extends(View, _super);\n        function View(context, viewSpec, dateProfileGenerator, parentEl) {\n            var _this = _super.call(this, context, createElement('div', { className: 'fc-view fc-' + viewSpec.type + '-view' }), true // isView (HACK)\n            ) || this;\n            _this.renderDatesMem = memoizeRendering(_this.renderDatesWrap, _this.unrenderDatesWrap);\n            _this.renderBusinessHoursMem = memoizeRendering(_this.renderBusinessHours, _this.unrenderBusinessHours, [_this.renderDatesMem]);\n            _this.renderDateSelectionMem = memoizeRendering(_this.renderDateSelectionWrap, _this.unrenderDateSelectionWrap, [_this.renderDatesMem]);\n            _this.renderEventsMem = memoizeRendering(_this.renderEvents, _this.unrenderEvents, [_this.renderDatesMem]);\n            _this.renderEventSelectionMem = memoizeRendering(_this.renderEventSelectionWrap, _this.unrenderEventSelectionWrap, [_this.renderEventsMem]);\n            _this.renderEventDragMem = memoizeRendering(_this.renderEventDragWrap, _this.unrenderEventDragWrap, [_this.renderDatesMem]);\n            _this.renderEventResizeMem = memoizeRendering(_this.renderEventResizeWrap, _this.unrenderEventResizeWrap, [_this.renderDatesMem]);\n            _this.viewSpec = viewSpec;\n            _this.dateProfileGenerator = dateProfileGenerator;\n            _this.type = viewSpec.type;\n            _this.eventOrderSpecs = parseFieldSpecs(_this.opt('eventOrder'));\n            _this.nextDayThreshold = createDuration(_this.opt('nextDayThreshold'));\n            parentEl.appendChild(_this.el);\n            _this.initialize();\n            return _this;\n        }\n        View.prototype.initialize = function () {\n        };\n        Object.defineProperty(View.prototype, \"activeStart\", {\n            // Date Setting/Unsetting\n            // -----------------------------------------------------------------------------------------------------------------\n            get: function () {\n                return this.dateEnv.toDate(this.props.dateProfile.activeRange.start);\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(View.prototype, \"activeEnd\", {\n            get: function () {\n                return this.dateEnv.toDate(this.props.dateProfile.activeRange.end);\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(View.prototype, \"currentStart\", {\n            get: function () {\n                return this.dateEnv.toDate(this.props.dateProfile.currentRange.start);\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(View.prototype, \"currentEnd\", {\n            get: function () {\n                return this.dateEnv.toDate(this.props.dateProfile.currentRange.end);\n            },\n            enumerable: true,\n            configurable: true\n        });\n        // General Rendering\n        // -----------------------------------------------------------------------------------------------------------------\n        View.prototype.render = function (props) {\n            this.renderDatesMem(props.dateProfile);\n            this.renderBusinessHoursMem(props.businessHours);\n            this.renderDateSelectionMem(props.dateSelection);\n            this.renderEventsMem(props.eventStore);\n            this.renderEventSelectionMem(props.eventSelection);\n            this.renderEventDragMem(props.eventDrag);\n            this.renderEventResizeMem(props.eventResize);\n        };\n        View.prototype.destroy = function () {\n            _super.prototype.destroy.call(this);\n            this.renderDatesMem.unrender(); // should unrender everything else\n        };\n        // Sizing\n        // -----------------------------------------------------------------------------------------------------------------\n        View.prototype.updateSize = function (isResize, viewHeight, isAuto) {\n            var calendar = this.calendar;\n            if (isResize || calendar.isViewUpdated || calendar.isDatesUpdated || calendar.isEventsUpdated) {\n                // sort of the catch-all sizing\n                // anything that might cause dimension changes\n                this.updateBaseSize(isResize, viewHeight, isAuto);\n            }\n        };\n        View.prototype.updateBaseSize = function (isResize, viewHeight, isAuto) {\n        };\n        // Date Rendering\n        // -----------------------------------------------------------------------------------------------------------------\n        View.prototype.renderDatesWrap = function (dateProfile) {\n            this.renderDates(dateProfile);\n            this.addScroll({ isDateInit: true });\n            this.startNowIndicator(dateProfile); // shouldn't render yet because updateSize will be called soon\n        };\n        View.prototype.unrenderDatesWrap = function () {\n            this.stopNowIndicator();\n            this.unrenderDates();\n        };\n        View.prototype.renderDates = function (dateProfile) { };\n        View.prototype.unrenderDates = function () { };\n        // Business Hours\n        // -----------------------------------------------------------------------------------------------------------------\n        View.prototype.renderBusinessHours = function (businessHours) { };\n        View.prototype.unrenderBusinessHours = function () { };\n        // Date Selection\n        // -----------------------------------------------------------------------------------------------------------------\n        View.prototype.renderDateSelectionWrap = function (selection) {\n            if (selection) {\n                this.renderDateSelection(selection);\n            }\n        };\n        View.prototype.unrenderDateSelectionWrap = function (selection) {\n            if (selection) {\n                this.unrenderDateSelection(selection);\n            }\n        };\n        View.prototype.renderDateSelection = function (selection) { };\n        View.prototype.unrenderDateSelection = function (selection) { };\n        // Event Rendering\n        // -----------------------------------------------------------------------------------------------------------------\n        View.prototype.renderEvents = function (eventStore) { };\n        View.prototype.unrenderEvents = function () { };\n        // util for subclasses\n        View.prototype.sliceEvents = function (eventStore, allDay) {\n            var props = this.props;\n            return sliceEventStore(eventStore, props.eventUiBases, props.dateProfile.activeRange, allDay ? this.nextDayThreshold : null).fg;\n        };\n        // Event Selection\n        // -----------------------------------------------------------------------------------------------------------------\n        View.prototype.renderEventSelectionWrap = function (instanceId) {\n            if (instanceId) {\n                this.renderEventSelection(instanceId);\n            }\n        };\n        View.prototype.unrenderEventSelectionWrap = function (instanceId) {\n            if (instanceId) {\n                this.unrenderEventSelection(instanceId);\n            }\n        };\n        View.prototype.renderEventSelection = function (instanceId) { };\n        View.prototype.unrenderEventSelection = function (instanceId) { };\n        // Event Drag\n        // -----------------------------------------------------------------------------------------------------------------\n        View.prototype.renderEventDragWrap = function (state) {\n            if (state) {\n                this.renderEventDrag(state);\n            }\n        };\n        View.prototype.unrenderEventDragWrap = function (state) {\n            if (state) {\n                this.unrenderEventDrag(state);\n            }\n        };\n        View.prototype.renderEventDrag = function (state) { };\n        View.prototype.unrenderEventDrag = function (state) { };\n        // Event Resize\n        // -----------------------------------------------------------------------------------------------------------------\n        View.prototype.renderEventResizeWrap = function (state) {\n            if (state) {\n                this.renderEventResize(state);\n            }\n        };\n        View.prototype.unrenderEventResizeWrap = function (state) {\n            if (state) {\n                this.unrenderEventResize(state);\n            }\n        };\n        View.prototype.renderEventResize = function (state) { };\n        View.prototype.unrenderEventResize = function (state) { };\n        /* Now Indicator\n        ------------------------------------------------------------------------------------------------------------------*/\n        // Immediately render the current time indicator and begins re-rendering it at an interval,\n        // which is defined by this.getNowIndicatorUnit().\n        // TODO: somehow do this for the current whole day's background too\n        View.prototype.startNowIndicator = function (dateProfile) {\n            var _this = this;\n            var dateEnv = this.dateEnv;\n            var unit;\n            var update;\n            var delay; // ms wait value\n            if (this.opt('nowIndicator')) {\n                unit = this.getNowIndicatorUnit(dateProfile);\n                if (unit) {\n                    update = this.updateNowIndicator.bind(this);\n                    this.initialNowDate = this.calendar.getNow();\n                    this.initialNowQueriedMs = new Date().valueOf();\n                    // wait until the beginning of the next interval\n                    delay = dateEnv.add(dateEnv.startOf(this.initialNowDate, unit), createDuration(1, unit)).valueOf() - this.initialNowDate.valueOf();\n                    // TODO: maybe always use setTimeout, waiting until start of next unit\n                    this.nowIndicatorTimeoutID = setTimeout(function () {\n                        _this.nowIndicatorTimeoutID = null;\n                        update();\n                        if (unit === 'second') {\n                            delay = 1000; // every second\n                        }\n                        else {\n                            delay = 1000 * 60; // otherwise, every minute\n                        }\n                        _this.nowIndicatorIntervalID = setInterval(update, delay); // update every interval\n                    }, delay);\n                }\n                // rendering will be initiated in updateSize\n            }\n        };\n        // rerenders the now indicator, computing the new current time from the amount of time that has passed\n        // since the initial getNow call.\n        View.prototype.updateNowIndicator = function () {\n            if (this.props.dateProfile && // a way to determine if dates were rendered yet\n                this.initialNowDate // activated before?\n            ) {\n                this.unrenderNowIndicator(); // won't unrender if unnecessary\n                this.renderNowIndicator(addMs(this.initialNowDate, new Date().valueOf() - this.initialNowQueriedMs));\n                this.isNowIndicatorRendered = true;\n            }\n        };\n        // Immediately unrenders the view's current time indicator and stops any re-rendering timers.\n        // Won't cause side effects if indicator isn't rendered.\n        View.prototype.stopNowIndicator = function () {\n            if (this.isNowIndicatorRendered) {\n                if (this.nowIndicatorTimeoutID) {\n                    clearTimeout(this.nowIndicatorTimeoutID);\n                    this.nowIndicatorTimeoutID = null;\n                }\n                if (this.nowIndicatorIntervalID) {\n                    clearInterval(this.nowIndicatorIntervalID);\n                    this.nowIndicatorIntervalID = null;\n                }\n                this.unrenderNowIndicator();\n                this.isNowIndicatorRendered = false;\n            }\n        };\n        View.prototype.getNowIndicatorUnit = function (dateProfile) {\n            // subclasses should implement\n        };\n        // Renders a current time indicator at the given datetime\n        View.prototype.renderNowIndicator = function (date) {\n            // SUBCLASSES MUST PASS TO CHILDREN!\n        };\n        // Undoes the rendering actions from renderNowIndicator\n        View.prototype.unrenderNowIndicator = function () {\n            // SUBCLASSES MUST PASS TO CHILDREN!\n        };\n        /* Scroller\n        ------------------------------------------------------------------------------------------------------------------*/\n        View.prototype.addScroll = function (scroll) {\n            var queuedScroll = this.queuedScroll || (this.queuedScroll = {});\n            __assign(queuedScroll, scroll);\n        };\n        View.prototype.popScroll = function (isResize) {\n            this.applyQueuedScroll(isResize);\n            this.queuedScroll = null;\n        };\n        View.prototype.applyQueuedScroll = function (isResize) {\n            this.applyScroll(this.queuedScroll || {}, isResize);\n        };\n        View.prototype.queryScroll = function () {\n            var scroll = {};\n            if (this.props.dateProfile) { // dates rendered yet?\n                __assign(scroll, this.queryDateScroll());\n            }\n            return scroll;\n        };\n        View.prototype.applyScroll = function (scroll, isResize) {\n            if (scroll.isDateInit) {\n                delete scroll.isDateInit;\n                if (this.props.dateProfile) { // dates rendered yet?\n                    __assign(scroll, this.computeInitialDateScroll());\n                }\n            }\n            if (this.props.dateProfile) { // dates rendered yet?\n                this.applyDateScroll(scroll);\n            }\n        };\n        View.prototype.computeInitialDateScroll = function () {\n            return {}; // subclasses must implement\n        };\n        View.prototype.queryDateScroll = function () {\n            return {}; // subclasses must implement\n        };\n        View.prototype.applyDateScroll = function (scroll) {\n            // subclasses must implement\n        };\n        return View;\n    }(DateComponent));\n    EmitterMixin.mixInto(View);\n    View.prototype.usesMinMaxTime = false;\n    View.prototype.dateProfileGeneratorClass = DateProfileGenerator;\n\n    var FgEventRenderer = /** @class */ (function () {\n        function FgEventRenderer(context) {\n            this.segs = [];\n            this.isSizeDirty = false;\n            this.context = context;\n        }\n        FgEventRenderer.prototype.renderSegs = function (segs, mirrorInfo) {\n            this.rangeUpdated(); // called too frequently :(\n            // render an `.el` on each seg\n            // returns a subset of the segs. segs that were actually rendered\n            segs = this.renderSegEls(segs, mirrorInfo);\n            this.segs = segs;\n            this.attachSegs(segs, mirrorInfo);\n            this.isSizeDirty = true;\n            this.context.view.triggerRenderedSegs(this.segs, Boolean(mirrorInfo));\n        };\n        FgEventRenderer.prototype.unrender = function (_segs, mirrorInfo) {\n            this.context.view.triggerWillRemoveSegs(this.segs, Boolean(mirrorInfo));\n            this.detachSegs(this.segs);\n            this.segs = [];\n        };\n        // Updates values that rely on options and also relate to range\n        FgEventRenderer.prototype.rangeUpdated = function () {\n            var options = this.context.options;\n            var displayEventTime;\n            var displayEventEnd;\n            this.eventTimeFormat = createFormatter(options.eventTimeFormat || this.computeEventTimeFormat(), options.defaultRangeSeparator);\n            displayEventTime = options.displayEventTime;\n            if (displayEventTime == null) {\n                displayEventTime = this.computeDisplayEventTime(); // might be based off of range\n            }\n            displayEventEnd = options.displayEventEnd;\n            if (displayEventEnd == null) {\n                displayEventEnd = this.computeDisplayEventEnd(); // might be based off of range\n            }\n            this.displayEventTime = displayEventTime;\n            this.displayEventEnd = displayEventEnd;\n        };\n        // Renders and assigns an `el` property for each foreground event segment.\n        // Only returns segments that successfully rendered.\n        FgEventRenderer.prototype.renderSegEls = function (segs, mirrorInfo) {\n            var html = '';\n            var i;\n            if (segs.length) { // don't build an empty html string\n                // build a large concatenation of event segment HTML\n                for (i = 0; i < segs.length; i++) {\n                    html += this.renderSegHtml(segs[i], mirrorInfo);\n                }\n                // Grab individual elements from the combined HTML string. Use each as the default rendering.\n                // Then, compute the 'el' for each segment. An el might be null if the eventRender callback returned false.\n                htmlToElements(html).forEach(function (el, i) {\n                    var seg = segs[i];\n                    if (el) {\n                        seg.el = el;\n                    }\n                });\n                segs = filterSegsViaEls(this.context.view, segs, Boolean(mirrorInfo));\n            }\n            return segs;\n        };\n        // Generic utility for generating the HTML classNames for an event segment's element\n        FgEventRenderer.prototype.getSegClasses = function (seg, isDraggable, isResizable, mirrorInfo) {\n            var classes = [\n                'fc-event',\n                seg.isStart ? 'fc-start' : 'fc-not-start',\n                seg.isEnd ? 'fc-end' : 'fc-not-end'\n            ].concat(seg.eventRange.ui.classNames);\n            if (isDraggable) {\n                classes.push('fc-draggable');\n            }\n            if (isResizable) {\n                classes.push('fc-resizable');\n            }\n            if (mirrorInfo) {\n                classes.push('fc-mirror');\n                if (mirrorInfo.isDragging) {\n                    classes.push('fc-dragging');\n                }\n                if (mirrorInfo.isResizing) {\n                    classes.push('fc-resizing');\n                }\n            }\n            return classes;\n        };\n        // Compute the text that should be displayed on an event's element.\n        // `range` can be the Event object itself, or something range-like, with at least a `start`.\n        // If event times are disabled, or the event has no time, will return a blank string.\n        // If not specified, formatter will default to the eventTimeFormat setting,\n        // and displayEnd will default to the displayEventEnd setting.\n        FgEventRenderer.prototype.getTimeText = function (eventRange, formatter, displayEnd) {\n            var def = eventRange.def, instance = eventRange.instance;\n            return this._getTimeText(instance.range.start, def.hasEnd ? instance.range.end : null, def.allDay, formatter, displayEnd, instance.forcedStartTzo, instance.forcedEndTzo);\n        };\n        FgEventRenderer.prototype._getTimeText = function (start, end, allDay, formatter, displayEnd, forcedStartTzo, forcedEndTzo) {\n            var dateEnv = this.context.dateEnv;\n            if (formatter == null) {\n                formatter = this.eventTimeFormat;\n            }\n            if (displayEnd == null) {\n                displayEnd = this.displayEventEnd;\n            }\n            if (this.displayEventTime && !allDay) {\n                if (displayEnd && end) {\n                    return dateEnv.formatRange(start, end, formatter, {\n                        forcedStartTzo: forcedStartTzo,\n                        forcedEndTzo: forcedEndTzo\n                    });\n                }\n                else {\n                    return dateEnv.format(start, formatter, {\n                        forcedTzo: forcedStartTzo\n                    });\n                }\n            }\n            return '';\n        };\n        FgEventRenderer.prototype.computeEventTimeFormat = function () {\n            return {\n                hour: 'numeric',\n                minute: '2-digit',\n                omitZeroMinute: true\n            };\n        };\n        FgEventRenderer.prototype.computeDisplayEventTime = function () {\n            return true;\n        };\n        FgEventRenderer.prototype.computeDisplayEventEnd = function () {\n            return true;\n        };\n        // Utility for generating event skin-related CSS properties\n        FgEventRenderer.prototype.getSkinCss = function (ui) {\n            return {\n                'background-color': ui.backgroundColor,\n                'border-color': ui.borderColor,\n                color: ui.textColor\n            };\n        };\n        FgEventRenderer.prototype.sortEventSegs = function (segs) {\n            var specs = this.context.view.eventOrderSpecs;\n            var objs = segs.map(buildSegCompareObj);\n            objs.sort(function (obj0, obj1) {\n                return compareByFieldSpecs(obj0, obj1, specs);\n            });\n            return objs.map(function (c) {\n                return c._seg;\n            });\n        };\n        FgEventRenderer.prototype.computeSizes = function (force) {\n            if (force || this.isSizeDirty) {\n                this.computeSegSizes(this.segs);\n            }\n        };\n        FgEventRenderer.prototype.assignSizes = function (force) {\n            if (force || this.isSizeDirty) {\n                this.assignSegSizes(this.segs);\n                this.isSizeDirty = false;\n            }\n        };\n        FgEventRenderer.prototype.computeSegSizes = function (segs) {\n        };\n        FgEventRenderer.prototype.assignSegSizes = function (segs) {\n        };\n        // Manipulation on rendered segs\n        FgEventRenderer.prototype.hideByHash = function (hash) {\n            if (hash) {\n                for (var _i = 0, _a = this.segs; _i < _a.length; _i++) {\n                    var seg = _a[_i];\n                    if (hash[seg.eventRange.instance.instanceId]) {\n                        seg.el.style.visibility = 'hidden';\n                    }\n                }\n            }\n        };\n        FgEventRenderer.prototype.showByHash = function (hash) {\n            if (hash) {\n                for (var _i = 0, _a = this.segs; _i < _a.length; _i++) {\n                    var seg = _a[_i];\n                    if (hash[seg.eventRange.instance.instanceId]) {\n                        seg.el.style.visibility = '';\n                    }\n                }\n            }\n        };\n        FgEventRenderer.prototype.selectByInstanceId = function (instanceId) {\n            if (instanceId) {\n                for (var _i = 0, _a = this.segs; _i < _a.length; _i++) {\n                    var seg = _a[_i];\n                    var eventInstance = seg.eventRange.instance;\n                    if (eventInstance && eventInstance.instanceId === instanceId &&\n                        seg.el // necessary?\n                    ) {\n                        seg.el.classList.add('fc-selected');\n                    }\n                }\n            }\n        };\n        FgEventRenderer.prototype.unselectByInstanceId = function (instanceId) {\n            if (instanceId) {\n                for (var _i = 0, _a = this.segs; _i < _a.length; _i++) {\n                    var seg = _a[_i];\n                    if (seg.el) { // necessary?\n                        seg.el.classList.remove('fc-selected');\n                    }\n                }\n            }\n        };\n        return FgEventRenderer;\n    }());\n    // returns a object with all primitive props that can be compared\n    function buildSegCompareObj(seg) {\n        var eventDef = seg.eventRange.def;\n        var range = seg.eventRange.instance.range;\n        var start = range.start ? range.start.valueOf() : 0; // TODO: better support for open-range events\n        var end = range.end ? range.end.valueOf() : 0; // \"\n        return __assign({}, eventDef.extendedProps, eventDef, { id: eventDef.publicId, start: start,\n            end: end, duration: end - start, allDay: Number(eventDef.allDay), _seg: seg // for later retrieval\n         });\n    }\n\n    var FillRenderer = /** @class */ (function () {\n        function FillRenderer(context) {\n            this.fillSegTag = 'div';\n            this.dirtySizeFlags = {};\n            this.context = context;\n            this.containerElsByType = {};\n            this.segsByType = {};\n        }\n        FillRenderer.prototype.getSegsByType = function (type) {\n            return this.segsByType[type] || [];\n        };\n        FillRenderer.prototype.renderSegs = function (type, segs) {\n            var _a;\n            var renderedSegs = this.renderSegEls(type, segs); // assignes `.el` to each seg. returns successfully rendered segs\n            var containerEls = this.attachSegs(type, renderedSegs);\n            if (containerEls) {\n                (_a = (this.containerElsByType[type] || (this.containerElsByType[type] = []))).push.apply(_a, containerEls);\n            }\n            this.segsByType[type] = renderedSegs;\n            if (type === 'bgEvent') {\n                this.context.view.triggerRenderedSegs(renderedSegs, false); // isMirror=false\n            }\n            this.dirtySizeFlags[type] = true;\n        };\n        // Unrenders a specific type of fill that is currently rendered on the grid\n        FillRenderer.prototype.unrender = function (type) {\n            var segs = this.segsByType[type];\n            if (segs) {\n                if (type === 'bgEvent') {\n                    this.context.view.triggerWillRemoveSegs(segs, false); // isMirror=false\n                }\n                this.detachSegs(type, segs);\n            }\n        };\n        // Renders and assigns an `el` property for each fill segment. Generic enough to work with different types.\n        // Only returns segments that successfully rendered.\n        FillRenderer.prototype.renderSegEls = function (type, segs) {\n            var _this = this;\n            var html = '';\n            var i;\n            if (segs.length) {\n                // build a large concatenation of segment HTML\n                for (i = 0; i < segs.length; i++) {\n                    html += this.renderSegHtml(type, segs[i]);\n                }\n                // Grab individual elements from the combined HTML string. Use each as the default rendering.\n                // Then, compute the 'el' for each segment.\n                htmlToElements(html).forEach(function (el, i) {\n                    var seg = segs[i];\n                    if (el) {\n                        seg.el = el;\n                    }\n                });\n                if (type === 'bgEvent') {\n                    segs = filterSegsViaEls(this.context.view, segs, false // isMirror. background events can never be mirror elements\n                    );\n                }\n                // correct element type? (would be bad if a non-TD were inserted into a table for example)\n                segs = segs.filter(function (seg) {\n                    return elementMatches(seg.el, _this.fillSegTag);\n                });\n            }\n            return segs;\n        };\n        // Builds the HTML needed for one fill segment. Generic enough to work with different types.\n        FillRenderer.prototype.renderSegHtml = function (type, seg) {\n            var css = null;\n            var classNames = [];\n            if (type !== 'highlight' && type !== 'businessHours') {\n                css = {\n                    'background-color': seg.eventRange.ui.backgroundColor\n                };\n            }\n            if (type !== 'highlight') {\n                classNames = classNames.concat(seg.eventRange.ui.classNames);\n            }\n            if (type === 'businessHours') {\n                classNames.push('fc-bgevent');\n            }\n            else {\n                classNames.push('fc-' + type.toLowerCase());\n            }\n            return '<' + this.fillSegTag +\n                (classNames.length ? ' class=\"' + classNames.join(' ') + '\"' : '') +\n                (css ? ' style=\"' + cssToStr(css) + '\"' : '') +\n                '></' + this.fillSegTag + '>';\n        };\n        FillRenderer.prototype.detachSegs = function (type, segs) {\n            var containerEls = this.containerElsByType[type];\n            if (containerEls) {\n                containerEls.forEach(removeElement);\n                delete this.containerElsByType[type];\n            }\n        };\n        FillRenderer.prototype.computeSizes = function (force) {\n            for (var type in this.segsByType) {\n                if (force || this.dirtySizeFlags[type]) {\n                    this.computeSegSizes(this.segsByType[type]);\n                }\n            }\n        };\n        FillRenderer.prototype.assignSizes = function (force) {\n            for (var type in this.segsByType) {\n                if (force || this.dirtySizeFlags[type]) {\n                    this.assignSegSizes(this.segsByType[type]);\n                }\n            }\n            this.dirtySizeFlags = {};\n        };\n        FillRenderer.prototype.computeSegSizes = function (segs) {\n        };\n        FillRenderer.prototype.assignSegSizes = function (segs) {\n        };\n        return FillRenderer;\n    }());\n\n    var NamedTimeZoneImpl = /** @class */ (function () {\n        function NamedTimeZoneImpl(timeZoneName) {\n            this.timeZoneName = timeZoneName;\n        }\n        return NamedTimeZoneImpl;\n    }());\n\n    /*\n    An abstraction for a dragging interaction originating on an event.\n    Does higher-level things than PointerDragger, such as possibly:\n    - a \"mirror\" that moves with the pointer\n    - a minimum number of pixels or other criteria for a true drag to begin\n\n    subclasses must emit:\n    - pointerdown\n    - dragstart\n    - dragmove\n    - pointerup\n    - dragend\n    */\n    var ElementDragging = /** @class */ (function () {\n        function ElementDragging(el) {\n            this.emitter = new EmitterMixin();\n        }\n        ElementDragging.prototype.destroy = function () {\n        };\n        ElementDragging.prototype.setMirrorIsVisible = function (bool) {\n            // optional if subclass doesn't want to support a mirror\n        };\n        ElementDragging.prototype.setMirrorNeedsRevert = function (bool) {\n            // optional if subclass doesn't want to support a mirror\n        };\n        ElementDragging.prototype.setAutoScrollEnabled = function (bool) {\n            // optional\n        };\n        return ElementDragging;\n    }());\n\n    function formatDate(dateInput, settings) {\n        if (settings === void 0) { settings = {}; }\n        var dateEnv = buildDateEnv$1(settings);\n        var formatter = createFormatter(settings);\n        var dateMeta = dateEnv.createMarkerMeta(dateInput);\n        if (!dateMeta) { // TODO: warning?\n            return '';\n        }\n        return dateEnv.format(dateMeta.marker, formatter, {\n            forcedTzo: dateMeta.forcedTzo\n        });\n    }\n    function formatRange(startInput, endInput, settings // mixture of env and formatter settings\n    ) {\n        var dateEnv = buildDateEnv$1(typeof settings === 'object' && settings ? settings : {}); // pass in if non-null object\n        var formatter = createFormatter(settings, globalDefaults.defaultRangeSeparator);\n        var startMeta = dateEnv.createMarkerMeta(startInput);\n        var endMeta = dateEnv.createMarkerMeta(endInput);\n        if (!startMeta || !endMeta) { // TODO: warning?\n            return '';\n        }\n        return dateEnv.formatRange(startMeta.marker, endMeta.marker, formatter, {\n            forcedStartTzo: startMeta.forcedTzo,\n            forcedEndTzo: endMeta.forcedTzo,\n            isEndExclusive: settings.isEndExclusive\n        });\n    }\n    // TODO: more DRY and optimized\n    function buildDateEnv$1(settings) {\n        var locale = buildLocale(settings.locale || 'en', parseRawLocales([]).map); // TODO: don't hardcode 'en' everywhere\n        // ensure required settings\n        settings = __assign({ timeZone: globalDefaults.timeZone, calendarSystem: 'gregory' }, settings, { locale: locale });\n        return new DateEnv(settings);\n    }\n\n    var DRAG_META_PROPS = {\n        startTime: createDuration,\n        duration: createDuration,\n        create: Boolean,\n        sourceId: String\n    };\n    var DRAG_META_DEFAULTS = {\n        create: true\n    };\n    function parseDragMeta(raw) {\n        var leftoverProps = {};\n        var refined = refineProps(raw, DRAG_META_PROPS, DRAG_META_DEFAULTS, leftoverProps);\n        refined.leftoverProps = leftoverProps;\n        return refined;\n    }\n\n    // Computes a default column header formatting string if `colFormat` is not explicitly defined\n    function computeFallbackHeaderFormat(datesRepDistinctDays, dayCnt) {\n        // if more than one week row, or if there are a lot of columns with not much space,\n        // put just the day numbers will be in each cell\n        if (!datesRepDistinctDays || dayCnt > 10) {\n            return { weekday: 'short' }; // \"Sat\"\n        }\n        else if (dayCnt > 1) {\n            return { weekday: 'short', month: 'numeric', day: 'numeric', omitCommas: true }; // \"Sat 11/12\"\n        }\n        else {\n            return { weekday: 'long' }; // \"Saturday\"\n        }\n    }\n    function renderDateCell(dateMarker, dateProfile, datesRepDistinctDays, colCnt, colHeadFormat, context, colspan, otherAttrs) {\n        var view = context.view, dateEnv = context.dateEnv, theme = context.theme, options = context.options;\n        var isDateValid = rangeContainsMarker(dateProfile.activeRange, dateMarker); // TODO: called too frequently. cache somehow.\n        var classNames = [\n            'fc-day-header',\n            theme.getClass('widgetHeader')\n        ];\n        var innerHtml;\n        if (typeof options.columnHeaderHtml === 'function') {\n            innerHtml = options.columnHeaderHtml(dateEnv.toDate(dateMarker));\n        }\n        else if (typeof options.columnHeaderText === 'function') {\n            innerHtml = htmlEscape(options.columnHeaderText(dateEnv.toDate(dateMarker)));\n        }\n        else {\n            innerHtml = htmlEscape(dateEnv.format(dateMarker, colHeadFormat));\n        }\n        // if only one row of days, the classNames on the header can represent the specific days beneath\n        if (datesRepDistinctDays) {\n            classNames = classNames.concat(\n            // includes the day-of-week class\n            // noThemeHighlight=true (don't highlight the header)\n            getDayClasses(dateMarker, dateProfile, context, true));\n        }\n        else {\n            classNames.push('fc-' + DAY_IDS[dateMarker.getUTCDay()]); // only add the day-of-week class\n        }\n        return '' +\n            '<th class=\"' + classNames.join(' ') + '\"' +\n            ((isDateValid && datesRepDistinctDays) ?\n                ' data-date=\"' + dateEnv.formatIso(dateMarker, { omitTime: true }) + '\"' :\n                '') +\n            (colspan > 1 ?\n                ' colspan=\"' + colspan + '\"' :\n                '') +\n            (otherAttrs ?\n                ' ' + otherAttrs :\n                '') +\n            '>' +\n            (isDateValid ?\n                // don't make a link if the heading could represent multiple days, or if there's only one day (forceOff)\n                buildGotoAnchorHtml(view, { date: dateMarker, forceOff: !datesRepDistinctDays || colCnt === 1 }, innerHtml) :\n                // if not valid, display text, but no link\n                innerHtml) +\n            '</th>';\n    }\n\n    var DayHeader = /** @class */ (function (_super) {\n        __extends(DayHeader, _super);\n        function DayHeader(context, parentEl) {\n            var _this = _super.call(this, context) || this;\n            parentEl.innerHTML = ''; // because might be nbsp\n            parentEl.appendChild(_this.el = htmlToElement('<div class=\"fc-row ' + _this.theme.getClass('headerRow') + '\">' +\n                '<table class=\"' + _this.theme.getClass('tableGrid') + '\">' +\n                '<thead></thead>' +\n                '</table>' +\n                '</div>'));\n            _this.thead = _this.el.querySelector('thead');\n            return _this;\n        }\n        DayHeader.prototype.destroy = function () {\n            removeElement(this.el);\n        };\n        DayHeader.prototype.render = function (props) {\n            var dates = props.dates, datesRepDistinctDays = props.datesRepDistinctDays;\n            var parts = [];\n            if (props.renderIntroHtml) {\n                parts.push(props.renderIntroHtml());\n            }\n            var colHeadFormat = createFormatter(this.opt('columnHeaderFormat') ||\n                computeFallbackHeaderFormat(datesRepDistinctDays, dates.length));\n            for (var _i = 0, dates_1 = dates; _i < dates_1.length; _i++) {\n                var date = dates_1[_i];\n                parts.push(renderDateCell(date, props.dateProfile, datesRepDistinctDays, dates.length, colHeadFormat, this.context));\n            }\n            if (this.isRtl) {\n                parts.reverse();\n            }\n            this.thead.innerHTML = '<tr>' + parts.join('') + '</tr>';\n        };\n        return DayHeader;\n    }(Component));\n\n    var DaySeries = /** @class */ (function () {\n        function DaySeries(range, dateProfileGenerator) {\n            var date = range.start;\n            var end = range.end;\n            var indices = [];\n            var dates = [];\n            var dayIndex = -1;\n            while (date < end) { // loop each day from start to end\n                if (dateProfileGenerator.isHiddenDay(date)) {\n                    indices.push(dayIndex + 0.5); // mark that it's between indices\n                }\n                else {\n                    dayIndex++;\n                    indices.push(dayIndex);\n                    dates.push(date);\n                }\n                date = addDays(date, 1);\n            }\n            this.dates = dates;\n            this.indices = indices;\n            this.cnt = dates.length;\n        }\n        DaySeries.prototype.sliceRange = function (range) {\n            var firstIndex = this.getDateDayIndex(range.start); // inclusive first index\n            var lastIndex = this.getDateDayIndex(addDays(range.end, -1)); // inclusive last index\n            var clippedFirstIndex = Math.max(0, firstIndex);\n            var clippedLastIndex = Math.min(this.cnt - 1, lastIndex);\n            // deal with in-between indices\n            clippedFirstIndex = Math.ceil(clippedFirstIndex); // in-between starts round to next cell\n            clippedLastIndex = Math.floor(clippedLastIndex); // in-between ends round to prev cell\n            if (clippedFirstIndex <= clippedLastIndex) {\n                return {\n                    firstIndex: clippedFirstIndex,\n                    lastIndex: clippedLastIndex,\n                    isStart: firstIndex === clippedFirstIndex,\n                    isEnd: lastIndex === clippedLastIndex\n                };\n            }\n            else {\n                return null;\n            }\n        };\n        // Given a date, returns its chronolocial cell-index from the first cell of the grid.\n        // If the date lies between cells (because of hiddenDays), returns a floating-point value between offsets.\n        // If before the first offset, returns a negative number.\n        // If after the last offset, returns an offset past the last cell offset.\n        // Only works for *start* dates of cells. Will not work for exclusive end dates for cells.\n        DaySeries.prototype.getDateDayIndex = function (date) {\n            var indices = this.indices;\n            var dayOffset = Math.floor(diffDays(this.dates[0], date));\n            if (dayOffset < 0) {\n                return indices[0] - 1;\n            }\n            else if (dayOffset >= indices.length) {\n                return indices[indices.length - 1] + 1;\n            }\n            else {\n                return indices[dayOffset];\n            }\n        };\n        return DaySeries;\n    }());\n\n    var DayTable = /** @class */ (function () {\n        function DayTable(daySeries, breakOnWeeks) {\n            var dates = daySeries.dates;\n            var daysPerRow;\n            var firstDay;\n            var rowCnt;\n            if (breakOnWeeks) {\n                // count columns until the day-of-week repeats\n                firstDay = dates[0].getUTCDay();\n                for (daysPerRow = 1; daysPerRow < dates.length; daysPerRow++) {\n                    if (dates[daysPerRow].getUTCDay() === firstDay) {\n                        break;\n                    }\n                }\n                rowCnt = Math.ceil(dates.length / daysPerRow);\n            }\n            else {\n                rowCnt = 1;\n                daysPerRow = dates.length;\n            }\n            this.rowCnt = rowCnt;\n            this.colCnt = daysPerRow;\n            this.daySeries = daySeries;\n            this.cells = this.buildCells();\n            this.headerDates = this.buildHeaderDates();\n        }\n        DayTable.prototype.buildCells = function () {\n            var rows = [];\n            for (var row = 0; row < this.rowCnt; row++) {\n                var cells = [];\n                for (var col = 0; col < this.colCnt; col++) {\n                    cells.push(this.buildCell(row, col));\n                }\n                rows.push(cells);\n            }\n            return rows;\n        };\n        DayTable.prototype.buildCell = function (row, col) {\n            return {\n                date: this.daySeries.dates[row * this.colCnt + col]\n            };\n        };\n        DayTable.prototype.buildHeaderDates = function () {\n            var dates = [];\n            for (var col = 0; col < this.colCnt; col++) {\n                dates.push(this.cells[0][col].date);\n            }\n            return dates;\n        };\n        DayTable.prototype.sliceRange = function (range) {\n            var colCnt = this.colCnt;\n            var seriesSeg = this.daySeries.sliceRange(range);\n            var segs = [];\n            if (seriesSeg) {\n                var firstIndex = seriesSeg.firstIndex, lastIndex = seriesSeg.lastIndex;\n                var index = firstIndex;\n                while (index <= lastIndex) {\n                    var row = Math.floor(index / colCnt);\n                    var nextIndex = Math.min((row + 1) * colCnt, lastIndex + 1);\n                    segs.push({\n                        row: row,\n                        firstCol: index % colCnt,\n                        lastCol: (nextIndex - 1) % colCnt,\n                        isStart: seriesSeg.isStart && index === firstIndex,\n                        isEnd: seriesSeg.isEnd && (nextIndex - 1) === lastIndex\n                    });\n                    index = nextIndex;\n                }\n            }\n            return segs;\n        };\n        return DayTable;\n    }());\n\n    var Slicer = /** @class */ (function () {\n        function Slicer() {\n            this.sliceBusinessHours = memoize(this._sliceBusinessHours);\n            this.sliceDateSelection = memoize(this._sliceDateSpan);\n            this.sliceEventStore = memoize(this._sliceEventStore);\n            this.sliceEventDrag = memoize(this._sliceInteraction);\n            this.sliceEventResize = memoize(this._sliceInteraction);\n        }\n        Slicer.prototype.sliceProps = function (props, dateProfile, nextDayThreshold, component) {\n            var extraArgs = [];\n            for (var _i = 4; _i < arguments.length; _i++) {\n                extraArgs[_i - 4] = arguments[_i];\n            }\n            var eventUiBases = props.eventUiBases;\n            var eventSegs = this.sliceEventStore.apply(this, [props.eventStore, eventUiBases, dateProfile, nextDayThreshold, component].concat(extraArgs));\n            return {\n                dateSelectionSegs: this.sliceDateSelection.apply(this, [props.dateSelection, eventUiBases, component].concat(extraArgs)),\n                businessHourSegs: this.sliceBusinessHours.apply(this, [props.businessHours, dateProfile, nextDayThreshold, component].concat(extraArgs)),\n                fgEventSegs: eventSegs.fg,\n                bgEventSegs: eventSegs.bg,\n                eventDrag: this.sliceEventDrag.apply(this, [props.eventDrag, eventUiBases, dateProfile, nextDayThreshold, component].concat(extraArgs)),\n                eventResize: this.sliceEventResize.apply(this, [props.eventResize, eventUiBases, dateProfile, nextDayThreshold, component].concat(extraArgs)),\n                eventSelection: props.eventSelection\n            }; // TODO: give interactionSegs?\n        };\n        Slicer.prototype.sliceNowDate = function (// does not memoize\n        date, component) {\n            var extraArgs = [];\n            for (var _i = 2; _i < arguments.length; _i++) {\n                extraArgs[_i - 2] = arguments[_i];\n            }\n            return this._sliceDateSpan.apply(this, [{ range: { start: date, end: addMs(date, 1) }, allDay: false },\n                {},\n                component].concat(extraArgs));\n        };\n        Slicer.prototype._sliceBusinessHours = function (businessHours, dateProfile, nextDayThreshold, component) {\n            var extraArgs = [];\n            for (var _i = 4; _i < arguments.length; _i++) {\n                extraArgs[_i - 4] = arguments[_i];\n            }\n            if (!businessHours) {\n                return [];\n            }\n            return this._sliceEventStore.apply(this, [expandRecurring(businessHours, computeActiveRange(dateProfile, Boolean(nextDayThreshold)), component.calendar),\n                {},\n                dateProfile,\n                nextDayThreshold,\n                component].concat(extraArgs)).bg;\n        };\n        Slicer.prototype._sliceEventStore = function (eventStore, eventUiBases, dateProfile, nextDayThreshold, component) {\n            var extraArgs = [];\n            for (var _i = 5; _i < arguments.length; _i++) {\n                extraArgs[_i - 5] = arguments[_i];\n            }\n            if (eventStore) {\n                var rangeRes = sliceEventStore(eventStore, eventUiBases, computeActiveRange(dateProfile, Boolean(nextDayThreshold)), nextDayThreshold);\n                return {\n                    bg: this.sliceEventRanges(rangeRes.bg, component, extraArgs),\n                    fg: this.sliceEventRanges(rangeRes.fg, component, extraArgs)\n                };\n            }\n            else {\n                return { bg: [], fg: [] };\n            }\n        };\n        Slicer.prototype._sliceInteraction = function (interaction, eventUiBases, dateProfile, nextDayThreshold, component) {\n            var extraArgs = [];\n            for (var _i = 5; _i < arguments.length; _i++) {\n                extraArgs[_i - 5] = arguments[_i];\n            }\n            if (!interaction) {\n                return null;\n            }\n            var rangeRes = sliceEventStore(interaction.mutatedEvents, eventUiBases, computeActiveRange(dateProfile, Boolean(nextDayThreshold)), nextDayThreshold);\n            return {\n                segs: this.sliceEventRanges(rangeRes.fg, component, extraArgs),\n                affectedInstances: interaction.affectedEvents.instances,\n                isEvent: interaction.isEvent,\n                sourceSeg: interaction.origSeg\n            };\n        };\n        Slicer.prototype._sliceDateSpan = function (dateSpan, eventUiBases, component) {\n            var extraArgs = [];\n            for (var _i = 3; _i < arguments.length; _i++) {\n                extraArgs[_i - 3] = arguments[_i];\n            }\n            if (!dateSpan) {\n                return [];\n            }\n            var eventRange = fabricateEventRange(dateSpan, eventUiBases, component.calendar);\n            var segs = this.sliceRange.apply(this, [dateSpan.range].concat(extraArgs));\n            for (var _a = 0, segs_1 = segs; _a < segs_1.length; _a++) {\n                var seg = segs_1[_a];\n                seg.component = component;\n                seg.eventRange = eventRange;\n            }\n            return segs;\n        };\n        /*\n        \"complete\" seg means it has component and eventRange\n        */\n        Slicer.prototype.sliceEventRanges = function (eventRanges, component, // TODO: kill\n        extraArgs) {\n            var segs = [];\n            for (var _i = 0, eventRanges_1 = eventRanges; _i < eventRanges_1.length; _i++) {\n                var eventRange = eventRanges_1[_i];\n                segs.push.apply(segs, this.sliceEventRange(eventRange, component, extraArgs));\n            }\n            return segs;\n        };\n        /*\n        \"complete\" seg means it has component and eventRange\n        */\n        Slicer.prototype.sliceEventRange = function (eventRange, component, // TODO: kill\n        extraArgs) {\n            var segs = this.sliceRange.apply(this, [eventRange.range].concat(extraArgs));\n            for (var _i = 0, segs_2 = segs; _i < segs_2.length; _i++) {\n                var seg = segs_2[_i];\n                seg.component = component;\n                seg.eventRange = eventRange;\n                seg.isStart = eventRange.isStart && seg.isStart;\n                seg.isEnd = eventRange.isEnd && seg.isEnd;\n            }\n            return segs;\n        };\n        return Slicer;\n    }());\n    /*\n    for incorporating minTime/maxTime if appropriate\n    TODO: should be part of DateProfile!\n    TimelineDateProfile already does this btw\n    */\n    function computeActiveRange(dateProfile, isComponentAllDay) {\n        var range = dateProfile.activeRange;\n        if (isComponentAllDay) {\n            return range;\n        }\n        return {\n            start: addMs(range.start, dateProfile.minTime.milliseconds),\n            end: addMs(range.end, dateProfile.maxTime.milliseconds - 864e5) // 864e5 = ms in a day\n        };\n    }\n\n    // exports\n    // --------------------------------------------------------------------------------------------------\n    var version = '4.0.1';\n\n    exports.version = version;\n    exports.parseEventDef = parseEventDef;\n    exports.createEventInstance = createEventInstance;\n    exports.parseBusinessHours = parseBusinessHours;\n    exports.applyAll = applyAll;\n    exports.debounce = debounce;\n    exports.padStart = padStart;\n    exports.isInt = isInt;\n    exports.capitaliseFirstLetter = capitaliseFirstLetter;\n    exports.parseFieldSpecs = parseFieldSpecs;\n    exports.compareByFieldSpecs = compareByFieldSpecs;\n    exports.compareByFieldSpec = compareByFieldSpec;\n    exports.flexibleCompare = flexibleCompare;\n    exports.computeVisibleDayRange = computeVisibleDayRange;\n    exports.refineProps = refineProps;\n    exports.matchCellWidths = matchCellWidths;\n    exports.uncompensateScroll = uncompensateScroll;\n    exports.compensateScroll = compensateScroll;\n    exports.subtractInnerElHeight = subtractInnerElHeight;\n    exports.isMultiDayRange = isMultiDayRange;\n    exports.distributeHeight = distributeHeight;\n    exports.undistributeHeight = undistributeHeight;\n    exports.preventSelection = preventSelection;\n    exports.allowSelection = allowSelection;\n    exports.preventContextMenu = preventContextMenu;\n    exports.allowContextMenu = allowContextMenu;\n    exports.compareNumbers = compareNumbers;\n    exports.enableCursor = enableCursor;\n    exports.disableCursor = disableCursor;\n    exports.diffDates = diffDates;\n    exports.htmlEscape = htmlEscape;\n    exports.cssToStr = cssToStr;\n    exports.removeExact = removeExact;\n    exports.isArraysEqual = isArraysEqual;\n    exports.memoize = memoize;\n    exports.memoizeOutput = memoizeOutput;\n    exports.memoizeRendering = memoizeRendering;\n    exports.intersectRects = intersectRects;\n    exports.pointInsideRect = pointInsideRect;\n    exports.constrainPoint = constrainPoint;\n    exports.getRectCenter = getRectCenter;\n    exports.diffPoints = diffPoints;\n    exports.translateRect = translateRect;\n    exports.isPropsEqual = isPropsEqual;\n    exports.mapHash = mapHash;\n    exports.filterHash = filterHash;\n    exports.findElements = findElements;\n    exports.findChildren = findChildren;\n    exports.htmlToElement = htmlToElement;\n    exports.createElement = createElement;\n    exports.insertAfterElement = insertAfterElement;\n    exports.prependToElement = prependToElement;\n    exports.removeElement = removeElement;\n    exports.appendToElement = appendToElement;\n    exports.applyStyle = applyStyle;\n    exports.applyStyleProp = applyStyleProp;\n    exports.elementMatches = elementMatches;\n    exports.elementClosest = elementClosest;\n    exports.forceClassName = forceClassName;\n    exports.filterEventStoreDefs = filterEventStoreDefs;\n    exports.createEmptyEventStore = createEmptyEventStore;\n    exports.mergeEventStores = mergeEventStores;\n    exports.getRelevantEvents = getRelevantEvents;\n    exports.eventTupleToStore = eventTupleToStore;\n    exports.processScopedUiProps = processScopedUiProps;\n    exports.combineEventUis = combineEventUis;\n    exports.Splitter = Splitter;\n    exports.buildGotoAnchorHtml = buildGotoAnchorHtml;\n    exports.getAllDayHtml = getAllDayHtml;\n    exports.getDayClasses = getDayClasses;\n    exports.preventDefault = preventDefault;\n    exports.listenBySelector = listenBySelector;\n    exports.whenTransitionDone = whenTransitionDone;\n    exports.computeInnerRect = computeInnerRect;\n    exports.computeEdges = computeEdges;\n    exports.computeHeightAndMargins = computeHeightAndMargins;\n    exports.getClippingParents = getClippingParents;\n    exports.computeClippingRect = computeClippingRect;\n    exports.computeRect = computeRect;\n    exports.unpromisify = unpromisify;\n    exports.EmitterMixin = EmitterMixin;\n    exports.rangeContainsMarker = rangeContainsMarker;\n    exports.intersectRanges = intersectRanges;\n    exports.rangesEqual = rangesEqual;\n    exports.rangesIntersect = rangesIntersect;\n    exports.rangeContainsRange = rangeContainsRange;\n    exports.Mixin = Mixin;\n    exports.PositionCache = PositionCache;\n    exports.ScrollComponent = ScrollComponent;\n    exports.ScrollController = ScrollController;\n    exports.ElementScrollController = ElementScrollController;\n    exports.WindowScrollController = WindowScrollController;\n    exports.Theme = Theme;\n    exports.Component = Component;\n    exports.DateComponent = DateComponent;\n    exports.Calendar = Calendar;\n    exports.View = View;\n    exports.FgEventRenderer = FgEventRenderer;\n    exports.buildSegCompareObj = buildSegCompareObj;\n    exports.FillRenderer = FillRenderer;\n    exports.DateProfileGenerator = DateProfileGenerator;\n    exports.isDateSpansEqual = isDateSpansEqual;\n    exports.addDays = addDays;\n    exports.startOfDay = startOfDay;\n    exports.addMs = addMs;\n    exports.addWeeks = addWeeks;\n    exports.diffWeeks = diffWeeks;\n    exports.diffWholeWeeks = diffWholeWeeks;\n    exports.diffWholeDays = diffWholeDays;\n    exports.diffDayAndTime = diffDayAndTime;\n    exports.diffDays = diffDays;\n    exports.isValidDate = isValidDate;\n    exports.createDuration = createDuration;\n    exports.isSingleDay = isSingleDay;\n    exports.multiplyDuration = multiplyDuration;\n    exports.addDurations = addDurations;\n    exports.asRoughMinutes = asRoughMinutes;\n    exports.asRoughSeconds = asRoughSeconds;\n    exports.asRoughMs = asRoughMs;\n    exports.wholeDivideDurations = wholeDivideDurations;\n    exports.greatestDurationDenominator = greatestDurationDenominator;\n    exports.DateEnv = DateEnv;\n    exports.createFormatter = createFormatter;\n    exports.formatIsoTimeString = formatIsoTimeString;\n    exports.NamedTimeZoneImpl = NamedTimeZoneImpl;\n    exports.parseMarker = parse;\n    exports.Interaction = Interaction;\n    exports.interactionSettingsToStore = interactionSettingsToStore;\n    exports.interactionSettingsStore = interactionSettingsStore;\n    exports.ElementDragging = ElementDragging;\n    exports.formatDate = formatDate;\n    exports.formatRange = formatRange;\n    exports.globalDefaults = globalDefaults;\n    exports.config = config;\n    exports.parseDragMeta = parseDragMeta;\n    exports.createPlugin = createPlugin;\n    exports.DayHeader = DayHeader;\n    exports.computeFallbackHeaderFormat = computeFallbackHeaderFormat;\n    exports.renderDateCell = renderDateCell;\n    exports.DaySeries = DaySeries;\n    exports.sliceEventStore = sliceEventStore;\n    exports.hasBgRendering = hasBgRendering;\n    exports.getElSeg = getElSeg;\n    exports.DayTable = DayTable;\n    exports.Slicer = Slicer;\n    exports.applyMutationToEventStore = applyMutationToEventStore;\n    exports.isPropsValid = isPropsValid;\n    exports.isInteractionValid = isInteractionValid;\n    exports.EventApi = EventApi;\n    exports.requestJson = requestJson;\n\n    Object.defineProperty(exports, '__esModule', { value: true });\n\n}));\n"]},"metadata":{},"sourceType":"script"}