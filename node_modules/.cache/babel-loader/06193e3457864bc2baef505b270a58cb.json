{"ast":null,"code":"import _createForOfIteratorHelper from\"C:\\\\Users\\\\zura.ph\\\\WebstormProjects\\\\slotmaster-dashboard\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createForOfIteratorHelper\";import _toConsumableArray from\"C:\\\\Users\\\\zura.ph\\\\WebstormProjects\\\\slotmaster-dashboard\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"C:\\\\Users\\\\zura.ph\\\\WebstormProjects\\\\slotmaster-dashboard\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\zura.ph\\\\WebstormProjects\\\\slotmaster-dashboard\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _assertThisInitialized from\"C:\\\\Users\\\\zura.ph\\\\WebstormProjects\\\\slotmaster-dashboard\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";import _inherits from\"C:\\\\Users\\\\zura.ph\\\\WebstormProjects\\\\slotmaster-dashboard\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\zura.ph\\\\WebstormProjects\\\\slotmaster-dashboard\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{Component}from'react';import{Button}from'../button/Button';import{Messages}from'../messages/Messages';import{ProgressBar}from'../progressbar/ProgressBar';import DomHandler from'../utils/DomHandler';import{classNames}from'../utils/ClassNames';import{Ripple}from'../ripple/Ripple';import ObjectUtils from'../utils/ObjectUtils';import{localeOption}from'../api/Locale';export var FileUpload=/*#__PURE__*/function(_Component){_inherits(FileUpload,_Component);var _super=_createSuper(FileUpload);function FileUpload(props){var _this;_classCallCheck(this,FileUpload);_this=_super.call(this,props);_this.state={files:[],msgs:[],focused:false};_this.choose=_this.choose.bind(_assertThisInitialized(_this));_this.upload=_this.upload.bind(_assertThisInitialized(_this));_this.clear=_this.clear.bind(_assertThisInitialized(_this));_this.onFileSelect=_this.onFileSelect.bind(_assertThisInitialized(_this));_this.onDragEnter=_this.onDragEnter.bind(_assertThisInitialized(_this));_this.onDragOver=_this.onDragOver.bind(_assertThisInitialized(_this));_this.onDragLeave=_this.onDragLeave.bind(_assertThisInitialized(_this));_this.onDrop=_this.onDrop.bind(_assertThisInitialized(_this));_this.onKeyDown=_this.onKeyDown.bind(_assertThisInitialized(_this));_this.onFocus=_this.onFocus.bind(_assertThisInitialized(_this));_this.onBlur=_this.onBlur.bind(_assertThisInitialized(_this));_this.onSimpleUploaderClick=_this.onSimpleUploaderClick.bind(_assertThisInitialized(_this));_this.duplicateIEEvent=false;return _this;}_createClass(FileUpload,[{key:\"hasFiles\",value:function hasFiles(){return this.state.files&&this.state.files.length>0;}},{key:\"isImage\",value:function isImage(file){return /^image\\//.test(file.type);}},{key:\"chooseDisabled\",value:function chooseDisabled(){return this.props.disabled||this.props.fileLimit&&this.props.fileLimit<=this.state.files.length+this.uploadedFileCount;}},{key:\"uploadDisabled\",value:function uploadDisabled(){return this.props.disabled||!this.hasFiles();}},{key:\"cancelDisabled\",value:function cancelDisabled(){return this.props.disabled||!this.hasFiles();}},{key:\"chooseButtonLabel\",value:function chooseButtonLabel(){return this.props.chooseLabel||localeOption('choose');}},{key:\"uploadButtonLabel\",value:function uploadButtonLabel(){return this.props.uploadLabel||localeOption('upload');}},{key:\"cancelButtonLabel\",value:function cancelButtonLabel(){return this.props.cancelLabel||localeOption('cancel');}},{key:\"remove\",value:function remove(event,index){this.clearInputElement();var currentFiles=_toConsumableArray(this.state.files);var removedFile=this.state.files[index];currentFiles.splice(index,1);this.setState({files:currentFiles});if(this.props.onRemove){this.props.onRemove({originalEvent:event,file:removedFile});}}},{key:\"clearInputElement\",value:function clearInputElement(){this.fileInput.value='';}},{key:\"clearIEInput\",value:function clearIEInput(){if(this.fileInput){this.duplicateIEEvent=true;//IE11 fix to prevent onFileChange trigger again\nthis.fileInput.value='';}}},{key:\"formatSize\",value:function formatSize(bytes){if(bytes===0){return'0 B';}var k=1000,dm=3,sizes=['B','KB','MB','GB','TB','PB','EB','ZB','YB'],i=Math.floor(Math.log(bytes)/Math.log(k));return parseFloat((bytes/Math.pow(k,i)).toFixed(dm))+' '+sizes[i];}},{key:\"onFileSelect\",value:function onFileSelect(event){var _this2=this;if(event.type!=='drop'&&this.isIE11()&&this.duplicateIEEvent){this.duplicateIEEvent=false;return;}this.setState({msgs:[]});this.files=this.state.files||[];var files=event.dataTransfer?event.dataTransfer.files:event.target.files;for(var i=0;i<files.length;i++){var file=files[i];if(!this.isFileSelected(file)){if(this.validate(file)){if(this.isImage(file)){file.objectURL=window.URL.createObjectURL(file);}this.files.push(file);}}}this.setState({files:this.files},function(){if(_this2.hasFiles()&&_this2.props.auto){_this2.upload();}});if(this.props.onSelect){this.props.onSelect({originalEvent:event,files:files});}if(event.type!=='drop'&&this.isIE11()){this.clearIEInput();}else{this.clearInputElement();}if(this.props.mode==='basic'&&this.files.length>0){this.fileInput.style.display='none';}}},{key:\"isFileSelected\",value:function isFileSelected(file){var _iterator=_createForOfIteratorHelper(this.state.files),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var sFile=_step.value;if(sFile.name+sFile.type+sFile.size===file.name+file.type+file.size)return true;}}catch(err){_iterator.e(err);}finally{_iterator.f();}return false;}},{key:\"isIE11\",value:function isIE11(){return!!window['MSInputMethodContext']&&!!document['documentMode'];}},{key:\"validate\",value:function validate(file){if(this.props.maxFileSize&&file.size>this.props.maxFileSize){var message={severity:'error',summary:this.props.invalidFileSizeMessageSummary.replace('{0}',file.name),detail:this.props.invalidFileSizeMessageDetail.replace('{0}',this.formatSize(this.props.maxFileSize))};if(this.props.mode==='advanced'){this.messagesUI.show(message);}if(this.props.onValidationFail){this.props.onValidationFail(file);}return false;}return true;}},{key:\"upload\",value:function upload(){var _this3=this;if(this.props.customUpload){if(this.props.fileLimit){this.uploadedFileCount+=this.state.files.length;}if(this.props.uploadHandler){this.props.uploadHandler({files:this.state.files});}}else{this.setState({msgs:[]});var xhr=new XMLHttpRequest();var formData=new FormData();if(this.props.onBeforeUpload){this.props.onBeforeUpload({'xhr':xhr,'formData':formData});}var _iterator2=_createForOfIteratorHelper(this.state.files),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var file=_step2.value;formData.append(this.props.name,file,file.name);}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}xhr.upload.addEventListener('progress',function(event){if(event.lengthComputable){_this3.setState({progress:Math.round(event.loaded*100/event.total)});}if(_this3.props.onProgress){_this3.props.onProgress({originalEvent:event,progress:_this3.progress});};});xhr.onreadystatechange=function(){if(xhr.readyState===4){_this3.setState({progress:0});if(xhr.status>=200&&xhr.status<300){if(_this3.props.fileLimit){_this3.uploadedFileCount+=_this3.state.files.length;}if(_this3.props.onUpload){_this3.props.onUpload({xhr:xhr,files:_this3.state.files});}}else{if(_this3.props.onError){_this3.props.onError({xhr:xhr,files:_this3.state.files});}}_this3.clear();}};xhr.open('POST',this.props.url,true);if(this.props.onBeforeSend){this.props.onBeforeSend({'xhr':xhr,'formData':formData});}xhr.withCredentials=this.props.withCredentials;xhr.send(formData);}}},{key:\"clear\",value:function clear(){this.setState({files:[]});if(this.props.onClear){this.props.onClear();}this.clearInputElement();}},{key:\"choose\",value:function choose(){this.fileInput.click();}},{key:\"onFocus\",value:function onFocus(){this.setState({focused:true});}},{key:\"onBlur\",value:function onBlur(){this.setState({focused:false});}},{key:\"onKeyDown\",value:function onKeyDown(event){if(event.which===13){// enter\nthis.choose();}}},{key:\"onDragEnter\",value:function onDragEnter(event){if(!this.props.disabled){event.stopPropagation();event.preventDefault();}}},{key:\"onDragOver\",value:function onDragOver(event){if(!this.props.disabled){DomHandler.addClass(this.content,'p-fileupload-highlight');event.stopPropagation();event.preventDefault();}}},{key:\"onDragLeave\",value:function onDragLeave(event){if(!this.props.disabled){DomHandler.removeClass(this.content,'p-fileupload-highlight');}}},{key:\"onDrop\",value:function onDrop(event){if(!this.props.disabled){DomHandler.removeClass(this.content,'p-fileupload-highlight');event.stopPropagation();event.preventDefault();var files=event.dataTransfer?event.dataTransfer.files:event.target.files;var allowDrop=this.props.multiple||files&&files.length===1;if(allowDrop){this.onFileSelect(event);}}}},{key:\"onSimpleUploaderClick\",value:function onSimpleUploaderClick(){if(this.hasFiles()){this.upload();}else{this.fileInput.click();}}},{key:\"renderChooseButton\",value:function renderChooseButton(){var _this4=this;var className=classNames('p-button p-fileupload-choose p-component',{'p-disabled':this.props.disabled,'p-focus':this.state.focused});return/*#__PURE__*/React.createElement(\"span\",{className:className,onClick:this.choose,onKeyDown:this.onKeyDown,onFocus:this.onFocus,onBlur:this.onBlur,tabIndex:0},/*#__PURE__*/React.createElement(\"input\",{ref:function ref(el){return _this4.fileInput=el;},type:\"file\",onChange:this.onFileSelect,multiple:this.props.multiple,accept:this.props.accept,disabled:this.chooseDisabled()}),/*#__PURE__*/React.createElement(\"span\",{className:\"p-button-icon p-button-icon-left p-clickable pi pi-fw pi-plus\"}),/*#__PURE__*/React.createElement(\"span\",{className:\"p-button-label p-clickable\"},this.chooseButtonLabel()),/*#__PURE__*/React.createElement(Ripple,null));}},{key:\"renderFiles\",value:function renderFiles(){var _this5=this;return/*#__PURE__*/React.createElement(\"div\",{className:\"p-fileupload-files\"},this.state.files.map(function(file,index){var preview=_this5.isImage(file)?/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"img\",{alt:file.name,role:\"presentation\",src:file.objectURL,width:_this5.props.previewWidth})):null;var fileName=/*#__PURE__*/React.createElement(\"div\",null,file.name);var size=/*#__PURE__*/React.createElement(\"div\",null,_this5.formatSize(file.size));var removeButton=/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Button,{type:\"button\",icon:\"pi pi-times\",onClick:function onClick(e){return _this5.remove(e,index);}}));return/*#__PURE__*/React.createElement(\"div\",{className:\"p-fileupload-row\",key:file.name+file.type+file.size},preview,fileName,size,removeButton);}));}},{key:\"renderEmptyContent\",value:function renderEmptyContent(){if(this.props.emptyTemplate&&!this.hasFiles()){return ObjectUtils.getJSXElement(this.props.emptyTemplate,this.props);}return null;}},{key:\"renderAdvanced\",value:function renderAdvanced(){var _this6=this;var className=classNames('p-fileupload p-fileupload-advanced p-component',this.props.className);var uploadButton,cancelButton,filesList,progressBar;var chooseButton=this.renderChooseButton();var emptyContent=this.renderEmptyContent();if(!this.props.auto){uploadButton=/*#__PURE__*/React.createElement(Button,{type:\"button\",label:this.uploadButtonLabel(),icon:\"pi pi-upload\",onClick:this.upload,disabled:this.uploadDisabled()});cancelButton=/*#__PURE__*/React.createElement(Button,{type:\"button\",label:this.cancelButtonLabel(),icon:\"pi pi-times\",onClick:this.clear,disabled:this.cancelDisabled()});}if(this.hasFiles()){filesList=this.renderFiles();progressBar=/*#__PURE__*/React.createElement(ProgressBar,{value:this.state.progress,showValue:false});}return/*#__PURE__*/React.createElement(\"div\",{id:this.props.id,className:className,style:this.props.style},/*#__PURE__*/React.createElement(\"div\",{className:\"p-fileupload-buttonbar\"},chooseButton,uploadButton,cancelButton),/*#__PURE__*/React.createElement(\"div\",{ref:function ref(el){_this6.content=el;},className:\"p-fileupload-content\",onDragEnter:this.onDragEnter,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onDrop:this.onDrop},progressBar,/*#__PURE__*/React.createElement(Messages,{ref:function ref(el){return _this6.messagesUI=el;}}),filesList,emptyContent));}},{key:\"renderBasic\",value:function renderBasic(){var _this7=this;var className=classNames('p-fileupload p-fileupload-basic p-component',this.props.className);var buttonClassName=classNames('p-button p-component p-fileupload-choose',{'p-fileupload-choose-selected':this.hasFiles(),'p-disabled':this.props.disabled,'p-focus':this.state.focused});var iconClassName=classNames('p-button-icon p-button-icon-left pi',{'pi-plus':!this.hasFiles()||this.props.auto,'pi-upload':this.hasFiles()&&!this.props.auto});var chooseLabel=this.chooseButtonLabel();var label=this.props.auto?chooseLabel:this.hasFiles()?this.state.files[0].name:chooseLabel;return/*#__PURE__*/React.createElement(\"div\",{className:className},/*#__PURE__*/React.createElement(Messages,{ref:function ref(el){return _this7.messagesUI=el;}}),/*#__PURE__*/React.createElement(\"span\",{className:buttonClassName,onMouseUp:this.onSimpleUploaderClick,onKeyDown:this.onKeyDown,onFocus:this.onFocus,onBlur:this.onBlur,tabIndex:0},/*#__PURE__*/React.createElement(\"span\",{className:iconClassName}),/*#__PURE__*/React.createElement(\"span\",{className:\"p-button-label p-clickable\"},label),!this.hasFiles()&&/*#__PURE__*/React.createElement(\"input\",{ref:function ref(el){return _this7.fileInput=el;},type:\"file\",accept:this.props.accept,disabled:this.props.disabled,onChange:this.onFileSelect}),/*#__PURE__*/React.createElement(Ripple,null)));}},{key:\"render\",value:function render(){if(this.props.mode==='advanced')return this.renderAdvanced();else if(this.props.mode==='basic')return this.renderBasic();}}]);return FileUpload;}(Component);FileUpload.defaultProps={id:null,name:null,url:null,mode:'advanced',multiple:false,accept:null,disabled:false,auto:false,maxFileSize:null,invalidFileSizeMessageSummary:'{0}: Invalid file size, ',invalidFileSizeMessageDetail:'maximum upload size is {0}.',style:null,className:null,widthCredentials:false,previewWidth:50,chooseLabel:null,uploadLabel:null,cancelLabel:null,customUpload:false,emptyTemplate:null,onBeforeUpload:null,onBeforeSend:null,onUpload:null,onError:null,onClear:null,onSelect:null,onProgress:null,onValidationFail:null,uploadHandler:null,onRemove:null};","map":{"version":3,"sources":["C:/Users/zura.ph/WebstormProjects/slotmaster-dashboard/src/components/fileupload/FileUpload.js"],"names":["React","Component","Button","Messages","ProgressBar","DomHandler","classNames","Ripple","ObjectUtils","localeOption","FileUpload","props","state","files","msgs","focused","choose","bind","upload","clear","onFileSelect","onDragEnter","onDragOver","onDragLeave","onDrop","onKeyDown","onFocus","onBlur","onSimpleUploaderClick","duplicateIEEvent","length","file","test","type","disabled","fileLimit","uploadedFileCount","hasFiles","chooseLabel","uploadLabel","cancelLabel","event","index","clearInputElement","currentFiles","removedFile","splice","setState","onRemove","originalEvent","fileInput","value","bytes","k","dm","sizes","i","Math","floor","log","parseFloat","pow","toFixed","isIE11","dataTransfer","target","isFileSelected","validate","isImage","objectURL","window","URL","createObjectURL","push","auto","onSelect","clearIEInput","mode","style","display","sFile","name","size","document","maxFileSize","message","severity","summary","invalidFileSizeMessageSummary","replace","detail","invalidFileSizeMessageDetail","formatSize","messagesUI","show","onValidationFail","customUpload","uploadHandler","xhr","XMLHttpRequest","formData","FormData","onBeforeUpload","append","addEventListener","lengthComputable","progress","round","loaded","total","onProgress","onreadystatechange","readyState","status","onUpload","onError","open","url","onBeforeSend","withCredentials","send","onClear","click","which","stopPropagation","preventDefault","addClass","content","removeClass","allowDrop","multiple","className","el","accept","chooseDisabled","chooseButtonLabel","map","preview","previewWidth","fileName","removeButton","e","remove","emptyTemplate","getJSXElement","uploadButton","cancelButton","filesList","progressBar","chooseButton","renderChooseButton","emptyContent","renderEmptyContent","uploadButtonLabel","uploadDisabled","cancelButtonLabel","cancelDisabled","renderFiles","id","buttonClassName","iconClassName","label","renderAdvanced","renderBasic","defaultProps","widthCredentials"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport {Button} from '../button/Button';\r\nimport {Messages} from '../messages/Messages';\r\nimport {ProgressBar} from '../progressbar/ProgressBar';\r\nimport DomHandler from '../utils/DomHandler';\r\nimport { classNames } from '../utils/ClassNames';\r\nimport { Ripple } from '../ripple/Ripple';\r\nimport ObjectUtils from '../utils/ObjectUtils';\r\nimport { localeOption } from '../api/Locale';\r\n\r\nexport class FileUpload extends Component {\r\n\r\n    static defaultProps = {\r\n        id: null,\r\n        name: null,\r\n        url: null,\r\n        mode: 'advanced',\r\n        multiple: false,\r\n        accept: null,\r\n        disabled: false,\r\n        auto: false,\r\n        maxFileSize: null,\r\n        invalidFileSizeMessageSummary: '{0}: Invalid file size, ',\r\n        invalidFileSizeMessageDetail: 'maximum upload size is {0}.',\r\n        style: null,\r\n        className: null,\r\n        widthCredentials: false,\r\n        previewWidth: 50,\r\n        chooseLabel: null,\r\n        uploadLabel: null,\r\n        cancelLabel: null,\r\n        customUpload: false,\r\n        emptyTemplate: null,\r\n        onBeforeUpload: null,\r\n        onBeforeSend: null,\r\n        onUpload: null,\r\n        onError: null,\r\n        onClear: null,\r\n        onSelect: null,\r\n        onProgress: null,\r\n        onValidationFail: null,\r\n        uploadHandler: null,\r\n        onRemove: null\r\n    }\r\n\r\n    static propTypes = {\r\n        id: PropTypes.string,\r\n        name: PropTypes.string,\r\n        url: PropTypes.string,\r\n        mode: PropTypes.string,\r\n        multiple: PropTypes.bool,\r\n        accept: PropTypes.string,\r\n        disabled: PropTypes.bool,\r\n        auto: PropTypes.bool,\r\n        maxFileSize: PropTypes.number,\r\n        invalidFileSizeMessageSummary: PropTypes.string,\r\n        invalidFileSizeMessageDetail: PropTypes.string,\r\n        style: PropTypes.object,\r\n        className: PropTypes.string,\r\n        widthCredentials: PropTypes.bool,\r\n        previewWidth: PropTypes.number,\r\n        chooseLabel: PropTypes.string,\r\n        uploadLabel: PropTypes.string,\r\n        cancelLabel: PropTypes.string,\r\n        customUpload: PropTypes.bool,\r\n        emptyTemplate: PropTypes.any,\r\n        onBeforeUpload: PropTypes.func,\r\n        onBeforeSend: PropTypes.func,\r\n        onUpload: PropTypes.func,\r\n        onError: PropTypes.func,\r\n        onClear: PropTypes.func,\r\n        onSelect: PropTypes.func,\r\n        onProgress: PropTypes.func,\r\n        onValidationFail: PropTypes.func,\r\n        uploadHandler: PropTypes.func,\r\n        onRemove: PropTypes.func\r\n    };\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            files: [],\r\n            msgs: [],\r\n            focused: false\r\n        };\r\n\r\n        this.choose = this.choose.bind(this);\r\n        this.upload = this.upload.bind(this);\r\n        this.clear = this.clear.bind(this);\r\n        this.onFileSelect = this.onFileSelect.bind(this);\r\n        this.onDragEnter = this.onDragEnter.bind(this);\r\n        this.onDragOver = this.onDragOver.bind(this);\r\n        this.onDragLeave = this.onDragLeave.bind(this);\r\n        this.onDrop = this.onDrop.bind(this);\r\n        this.onKeyDown = this.onKeyDown.bind(this);\r\n        this.onFocus = this.onFocus.bind(this);\r\n        this.onBlur = this.onBlur.bind(this);\r\n        this.onSimpleUploaderClick = this.onSimpleUploaderClick.bind(this);\r\n\r\n        this.duplicateIEEvent = false;\r\n    }\r\n\r\n    hasFiles() {\r\n        return this.state.files && this.state.files.length > 0;\r\n    }\r\n\r\n    isImage(file) {\r\n        return /^image\\//.test(file.type);\r\n    }\r\n\r\n    chooseDisabled() {\r\n        return this.props.disabled || (this.props.fileLimit && this.props.fileLimit <= this.state.files.length + this.uploadedFileCount);\r\n    }\r\n\r\n    uploadDisabled() {\r\n        return this.props.disabled || !this.hasFiles();\r\n    }\r\n\r\n    cancelDisabled() {\r\n        return this.props.disabled || !this.hasFiles();\r\n    }\r\n\r\n    chooseButtonLabel() {\r\n        return this.props.chooseLabel || localeOption('choose');\r\n    }\r\n\r\n    uploadButtonLabel() {\r\n        return this.props.uploadLabel || localeOption('upload');\r\n    }\r\n\r\n    cancelButtonLabel() {\r\n        return this.props.cancelLabel || localeOption('cancel');\r\n    }\r\n\r\n    remove(event, index) {\r\n        this.clearInputElement();\r\n        let currentFiles = [...this.state.files];\r\n        let removedFile = this.state.files[index];\r\n\r\n        currentFiles.splice(index, 1);\r\n        this.setState({ files: currentFiles });\r\n\r\n        if (this.props.onRemove) {\r\n            this.props.onRemove({\r\n                originalEvent: event,\r\n                file: removedFile\r\n            })\r\n        }\r\n    }\r\n\r\n    clearInputElement() {\r\n        this.fileInput.value = '';\r\n    }\r\n\r\n    clearIEInput() {\r\n        if (this.fileInput) {\r\n            this.duplicateIEEvent = true; //IE11 fix to prevent onFileChange trigger again\r\n            this.fileInput.value = '';\r\n        }\r\n    }\r\n\r\n    formatSize(bytes) {\r\n        if(bytes === 0) {\r\n            return '0 B';\r\n        }\r\n        let k = 1000,\r\n        dm = 3,\r\n        sizes = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'],\r\n        i = Math.floor(Math.log(bytes) / Math.log(k));\r\n\r\n        return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];\r\n    }\r\n\r\n    onFileSelect(event) {\r\n        if (event.type !== 'drop' && this.isIE11() && this.duplicateIEEvent) {\r\n            this.duplicateIEEvent = false;\r\n            return;\r\n        }\r\n\r\n        this.setState({msgs:[]});\r\n        this.files = this.state.files || [];\r\n        let files = event.dataTransfer ? event.dataTransfer.files : event.target.files;\r\n        for (let i = 0; i < files.length; i++) {\r\n            let file = files[i];\r\n\r\n            if (!this.isFileSelected(file)) {\r\n                if (this.validate(file)) {\r\n                    if (this.isImage(file)) {\r\n                        file.objectURL = window.URL.createObjectURL(file);\r\n                    }\r\n                    this.files.push(file);\r\n                }\r\n            }\r\n        }\r\n\r\n        this.setState({files: this.files}, () => {\r\n            if (this.hasFiles() && this.props.auto) {\r\n                this.upload();\r\n            }\r\n        });\r\n\r\n        if(this.props.onSelect) {\r\n            this.props.onSelect({originalEvent: event, files: files});\r\n        }\r\n\r\n        if (event.type !== 'drop' && this.isIE11()) {\r\n            this.clearIEInput();\r\n        }\r\n        else {\r\n            this.clearInputElement();\r\n        }\r\n\r\n        if(this.props.mode === 'basic' && this.files.length > 0) {\r\n            this.fileInput.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    isFileSelected(file){\r\n        for (let sFile of this.state.files){\r\n            if ((sFile.name + sFile.type + sFile.size) === (file.name + file.type+file.size))\r\n                return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    isIE11() {\r\n        return !!window['MSInputMethodContext'] && !!document['documentMode'];\r\n    }\r\n\r\n    validate(file) {\r\n        if (this.props.maxFileSize && file.size > this.props.maxFileSize) {\r\n            const message = {\r\n                severity: 'error',\r\n                summary: this.props.invalidFileSizeMessageSummary.replace('{0}', file.name),\r\n                detail: this.props.invalidFileSizeMessageDetail.replace('{0}', this.formatSize(this.props.maxFileSize))\r\n            };\r\n\r\n            if (this.props.mode === 'advanced') {\r\n                this.messagesUI.show(message);\r\n            }\r\n\r\n            if (this.props.onValidationFail) {\r\n                this.props.onValidationFail(file);\r\n            }\r\n\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    upload() {\r\n        if (this.props.customUpload) {\r\n            if (this.props.fileLimit) {\r\n                this.uploadedFileCount += this.state.files.length;\r\n            }\r\n\r\n            if (this.props.uploadHandler) {\r\n                this.props.uploadHandler({\r\n                    files: this.state.files\r\n                })\r\n            }\r\n        }\r\n        else {\r\n            this.setState({msgs:[]});\r\n            let xhr = new XMLHttpRequest();\r\n            let formData = new FormData();\r\n\r\n            if (this.props.onBeforeUpload) {\r\n                this.props.onBeforeUpload({\r\n                    'xhr': xhr,\r\n                    'formData': formData\r\n                });\r\n            }\r\n\r\n            for (let file of this.state.files) {\r\n                formData.append(this.props.name, file, file.name);\r\n            }\r\n\r\n            xhr.upload.addEventListener('progress', (event) => {\r\n                if (event.lengthComputable) {\r\n                    this.setState({progress: Math.round((event.loaded * 100) / event.total)});\r\n                }\r\n\r\n                if (this.props.onProgress) {\r\n                    this.props.onProgress({\r\n                        originalEvent: event,\r\n                        progress: this.progress\r\n                    });\r\n                };\r\n            });\r\n\r\n            xhr.onreadystatechange = () => {\r\n                if (xhr.readyState === 4) {\r\n                    this.setState({ progress: 0 });\r\n\r\n                    if (xhr.status >= 200 && xhr.status < 300) {\r\n                        if (this.props.fileLimit) {\r\n                            this.uploadedFileCount += this.state.files.length;\r\n                        }\r\n\r\n                        if (this.props.onUpload) {\r\n                            this.props.onUpload({xhr: xhr, files: this.state.files});\r\n                        }\r\n                    }\r\n                    else {\r\n                        if (this.props.onError) {\r\n                            this.props.onError({xhr: xhr, files: this.state.files});\r\n                        }\r\n                    }\r\n\r\n                    this.clear();\r\n                }\r\n            };\r\n\r\n            xhr.open('POST', this.props.url, true);\r\n\r\n            if(this.props.onBeforeSend) {\r\n                this.props.onBeforeSend({\r\n                    'xhr': xhr,\r\n                    'formData': formData\r\n                });\r\n            }\r\n\r\n            xhr.withCredentials = this.props.withCredentials;\r\n\r\n            xhr.send(formData);\r\n        }\r\n    }\r\n\r\n    clear() {\r\n        this.setState({ files:[] });\r\n        if (this.props.onClear) {\r\n            this.props.onClear();\r\n        }\r\n        this.clearInputElement();\r\n    }\r\n\r\n    choose() {\r\n        this.fileInput.click();\r\n    }\r\n\r\n    onFocus() {\r\n        this.setState({ focused: true });\r\n    }\r\n\r\n    onBlur() {\r\n        this.setState({ focused: false });\r\n    }\r\n\r\n    onKeyDown(event) {\r\n        if (event.which === 13) { // enter\r\n            this.choose();\r\n        }\r\n    }\r\n\r\n    onDragEnter(event) {\r\n        if(!this.props.disabled) {\r\n            event.stopPropagation();\r\n            event.preventDefault();\r\n        }\r\n    }\r\n\r\n    onDragOver(event) {\r\n        if (!this.props.disabled) {\r\n            DomHandler.addClass(this.content, 'p-fileupload-highlight');\r\n            event.stopPropagation();\r\n            event.preventDefault();\r\n        }\r\n    }\r\n\r\n    onDragLeave(event) {\r\n        if (!this.props.disabled) {\r\n            DomHandler.removeClass(this.content, 'p-fileupload-highlight');\r\n        }\r\n    }\r\n\r\n    onDrop(event) {\r\n        if (!this.props.disabled) {\r\n            DomHandler.removeClass(this.content, 'p-fileupload-highlight');\r\n            event.stopPropagation();\r\n            event.preventDefault();\r\n\r\n            let files = event.dataTransfer ? event.dataTransfer.files : event.target.files;\r\n            let allowDrop = this.props.multiple||(files && files.length === 1);\r\n\r\n            if(allowDrop) {\r\n                this.onFileSelect(event);\r\n            }\r\n        }\r\n    }\r\n\r\n    onSimpleUploaderClick() {\r\n        if (this.hasFiles()) {\r\n            this.upload();\r\n        }\r\n        else {\r\n            this.fileInput.click();\r\n        }\r\n    }\r\n\r\n    renderChooseButton() {\r\n        let className = classNames('p-button p-fileupload-choose p-component', {\r\n            'p-disabled': this.props.disabled,\r\n            'p-focus': this.state.focused\r\n        });\r\n\r\n        return (\r\n            <span className={className} onClick={this.choose} onKeyDown={this.onKeyDown} onFocus={this.onFocus} onBlur={this.onBlur} tabIndex={0}>\r\n                <input ref={(el) => this.fileInput = el} type=\"file\" onChange={this.onFileSelect}\r\n                    multiple={this.props.multiple} accept={this.props.accept} disabled={this.chooseDisabled()} />\r\n                <span className=\"p-button-icon p-button-icon-left p-clickable pi pi-fw pi-plus\"></span>\r\n                <span className=\"p-button-label p-clickable\">{this.chooseButtonLabel()}</span>\r\n                <Ripple />\r\n            </span>\r\n        );\r\n    }\r\n\r\n    renderFiles() {\r\n        return (\r\n            <div className=\"p-fileupload-files\">\r\n                {\r\n                    this.state.files.map((file, index) => {\r\n                        let preview = this.isImage(file) ? <div><img alt={file.name} role=\"presentation\" src={file.objectURL} width={this.props.previewWidth} /></div> : null;\r\n                        let fileName = <div>{file.name}</div>;\r\n                        let size = <div>{this.formatSize(file.size)}</div>;\r\n                        let removeButton = <div><Button type=\"button\" icon=\"pi pi-times\" onClick={(e) => this.remove(e, index)} /></div>\r\n\r\n                        return <div className=\"p-fileupload-row\" key={file.name + file.type + file.size}>\r\n                                 {preview}\r\n                                 {fileName}\r\n                                 {size}\r\n                                 {removeButton}\r\n                            </div>\r\n                    })\r\n                }\r\n            </div>\r\n        );\r\n    }\r\n\r\n    renderEmptyContent() {\r\n        if (this.props.emptyTemplate && !this.hasFiles()) {\r\n            return ObjectUtils.getJSXElement(this.props.emptyTemplate, this.props);\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    renderAdvanced() {\r\n        const className = classNames('p-fileupload p-fileupload-advanced p-component', this.props.className);\r\n        let uploadButton, cancelButton, filesList, progressBar;\r\n        const chooseButton = this.renderChooseButton();\r\n        const emptyContent = this.renderEmptyContent();\r\n\r\n        if (!this.props.auto) {\r\n            uploadButton = <Button type=\"button\" label={this.uploadButtonLabel()} icon=\"pi pi-upload\" onClick={this.upload} disabled={this.uploadDisabled()} />;\r\n            cancelButton = <Button type=\"button\" label={this.cancelButtonLabel()} icon=\"pi pi-times\" onClick={this.clear} disabled={this.cancelDisabled()} />;\r\n        }\r\n\r\n        if (this.hasFiles()) {\r\n            filesList = this.renderFiles();\r\n            progressBar = <ProgressBar value={this.state.progress} showValue={false} />;\r\n        }\r\n\r\n        return (\r\n            <div id={this.props.id} className={className} style={this.props.style}>\r\n                <div className=\"p-fileupload-buttonbar\">\r\n                    {chooseButton}\r\n                    {uploadButton}\r\n                    {cancelButton}\r\n                </div>\r\n                <div ref={(el) => {this.content = el;}} className=\"p-fileupload-content\"\r\n                    onDragEnter={this.onDragEnter} onDragOver={this.onDragOver} onDragLeave={this.onDragLeave} onDrop={this.onDrop}>\r\n                    {progressBar}\r\n                    <Messages ref={(el) => this.messagesUI = el } />\r\n                    {filesList}\r\n                    {emptyContent}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    renderBasic() {\r\n        const className = classNames('p-fileupload p-fileupload-basic p-component', this.props.className);\r\n        const buttonClassName = classNames('p-button p-component p-fileupload-choose', { 'p-fileupload-choose-selected': this.hasFiles(), 'p-disabled': this.props.disabled, 'p-focus': this.state.focused });\r\n        const iconClassName = classNames('p-button-icon p-button-icon-left pi', { 'pi-plus': !this.hasFiles() || this.props.auto, 'pi-upload': this.hasFiles() && !this.props.auto });\r\n        const chooseLabel = this.chooseButtonLabel();\r\n        const label = this.props.auto ? chooseLabel : this.hasFiles() ? this.state.files[0].name : chooseLabel;\r\n\r\n        return (\r\n            <div className={className}>\r\n                <Messages ref={(el) => this.messagesUI = el } />\r\n                <span className={buttonClassName} onMouseUp={this.onSimpleUploaderClick} onKeyDown={this.onKeyDown} onFocus={this.onFocus} onBlur={this.onBlur} tabIndex={0}>\r\n                    <span className={iconClassName}></span>\r\n                    <span className=\"p-button-label p-clickable\">{label}</span>\r\n                    { !this.hasFiles() && <input ref={(el) => this.fileInput = el} type=\"file\" accept={this.props.accept} disabled={this.props.disabled} onChange={this.onFileSelect} /> }\r\n                    <Ripple />\r\n                </span>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    render() {\r\n        if (this.props.mode === 'advanced')\r\n            return this.renderAdvanced();\r\n        else if (this.props.mode === 'basic')\r\n            return this.renderBasic();\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}